(self.webpackChunklibre_routing_playground=self.webpackChunklibre_routing_playground||[]).push([[179],{69:zs=>{const ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",an=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],ue=typeof BigInt<"u"?BigInt:Number;function mn(Kt){let dt=Kt;return dt&ue(1)&&(dt=~dt),dt>>=ue(1),+dt.toString()}function Kr(Kt){let dt="",qt=ue(Kt);for(;qt>31;){const In=qt&ue(31)|ue(32);dt+=ar[In],qt>>=ue(5)}return dt+ar[qt]}function Vn(Kt){let dt=ue(Kt);const qt=dt<0;return dt<<=ue(1),qt&&(dt=~dt),Kr(dt)}zs.exports={encode:function wr({precision:Kt=5,thirdDim:dt=0,thirdDimPrecision:qt=0,polyline:In}){const Vr=10**Kt,Yn=10**qt,Dr=function ln(Kt,dt,qt){if(Kt<0||Kt>15)throw new Error("precision out of range. Should be between 0 and 15");if(qt<0||qt>15)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(dt<0||dt>7||4===dt||5===dt)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");const In=qt<<7|dt<<4|Kt;return Kr(1)+Kr(In)}(Kt,dt,qt),Yr=[];let Er=ue(0),Jr=ue(0),tt=ue(0);return In.forEach(Gn=>{const di=ue(Math.round(Gn[0]*Vr));Yr.push(Vn(di-Er)),Er=di;const Qr=ue(Math.round(Gn[1]*Vr));if(Yr.push(Vn(Qr-Jr)),Jr=Qr,dt){const rn=ue(Math.round(Gn[2]*Yn));Yr.push(Vn(rn-tt)),tt=rn}}),[...Dr,...Yr].join("")},decode:function Yt(Kt){const dt=function Sn(Kt){let dt=ue(0),qt=ue(0);const In=[];if(Kt.split("").forEach(Vr=>{const Yn=ue(function zt(Kt){const dt=Kt.charCodeAt(0);return an[dt-45]}(Vr));dt|=(Yn&ue(31))<<qt,(Yn&ue(32))===ue(0)?(In.push(dt),dt=ue(0),qt=ue(0)):qt+=ue(5)}),qt>0)throw new Error("Invalid encoding");return In}(Kt),qt=function bn(Kt,dt){if(1!=+Kt.toString())throw new Error("Invalid format version");const qt=+dt.toString();return{precision:15&qt,thirdDim:qt>>4&7,thirdDimPrecision:qt>>7&15}}(dt[0],dt[1]),In=10**qt.precision,Vr=10**qt.thirdDimPrecision,{thirdDim:Yn}=qt;let Dr=0,Yr=0,Er=0;const Jr=[];let tt=2;for(;tt<dt.length;)Dr+=mn(dt[tt])/In,Yr+=mn(dt[tt+1])/In,Yn?(Er+=mn(dt[tt+2])/Vr,Jr.push([Dr,Yr,Er]),tt+=3):(Jr.push([Dr,Yr]),tt+=2);if(tt!==dt.length)throw new Error("Invalid encoding. Premature ending reached");return{...qt,polyline:Jr}},ABSENT:0,LEVEL:1,ALTITUDE:2,ELEVATION:3}},382:(zs,Fo,ar)=>{"use strict";function an(e){return"function"==typeof e}function Oo(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Ns=Oo(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,s)=>`${s+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function y(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class pn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(an(r))try{r()}catch(c){t=c instanceof Ns?c.errors:[c]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const c of s)try{Je(c)}catch(d){t=t??[],d instanceof Ns?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Ns(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Je(t);else{if(t instanceof pn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&y(n,t)}remove(t){const{_finalizers:n}=this;n&&y(n,t),t instanceof pn&&t._removeParent(this)}}pn.EMPTY=(()=>{const e=new pn;return e.closed=!0,e})();const ui=pn.EMPTY;function hi(e){return e instanceof pn||e&&"closed"in e&&an(e.remove)&&an(e.add)&&an(e.unsubscribe)}function Je(e){an(e)?e():e.unsubscribe()}const ue={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Yt={setTimeout(e,t,...n){const{delegate:r}=Yt;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Yt;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function zt(e){Yt.setTimeout(()=>{const{onUnhandledError:t}=ue;if(!t)throw e;t(e)})}function Sn(){}const bn=ln("C",void 0,void 0);function ln(e,t,n){return{kind:e,value:t,error:n}}let Kr=null;function Vn(e){if(ue.useDeprecatedSynchronousErrorHandling){const t=!Kr;if(t&&(Kr={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=Kr;if(Kr=null,n)throw r}}else e()}class dt extends pn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,hi(t)&&t.add(this)):this.destination=Jr}static create(t,n,r){return new Yn(t,n,r)}next(t){this.isStopped?Er(function wr(e){return ln("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Er(function mn(e){return ln("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Er(bn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const qt=Function.prototype.bind;function In(e,t){return qt.call(e,t)}class Vr{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){Dr(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){Dr(r)}else Dr(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Dr(n)}}}class Yn extends dt{constructor(t,n,r){let s;if(super(),an(t)||!t)s={next:t??void 0,error:n??void 0,complete:r??void 0};else{let c;this&&ue.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),s={next:t.next&&In(t.next,c),error:t.error&&In(t.error,c),complete:t.complete&&In(t.complete,c)}):s=t}this.destination=new Vr(s)}}function Dr(e){ue.useDeprecatedSynchronousErrorHandling?function Kt(e){ue.useDeprecatedSynchronousErrorHandling&&Kr&&(Kr.errorThrown=!0,Kr.error=e)}(e):zt(e)}function Er(e,t){const{onStoppedNotification:n}=ue;n&&Yt.setTimeout(()=>n(e,t))}const Jr={closed:!0,next:Sn,error:function Yr(e){throw e},complete:Sn},tt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Gn(e){return e}function Qr(e){return 0===e.length?Gn:1===e.length?e[0]:function(n){return e.reduce((r,s)=>s(r),n)}}let rn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,s){const c=function po(e){return e&&e instanceof dt||function ns(e){return e&&an(e.next)&&an(e.error)&&an(e.complete)}(e)&&hi(e)}(n)?n:new Yn(n,r,s);return Vn(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=zo(r))((s,c)=>{const d=new Yn({next:_=>{try{n(_)}catch(w){c(w),d.unsubscribe()}},error:c,complete:s});this.subscribe(d)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[tt](){return this}pipe(...n){return Qr(n)(this)}toPromise(n){return new(n=zo(n))((r,s)=>{let c;this.subscribe(d=>c=d,d=>s(d),()=>r(c))})}}return e.create=t=>new e(t),e})();function zo(e){var t;return null!==(t=e??ue.Promise)&&void 0!==t?t:Promise}const No=Oo(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $r=(()=>{class e extends rn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new wi(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new No}next(n){Vn(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){Vn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Vn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:s,observers:c}=this;return r||s?ui:(this.currentObservers=null,c.push(n),new pn(()=>{this.currentObservers=null,y(c,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:s,isStopped:c}=this;r?n.error(s):c&&n.complete()}asObservable(){const n=new rn;return n.source=this,n}}return e.create=(t,n)=>new wi(t,n),e})();class wi extends $r{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:ui}}function Qi(e){return an(e?.lift)}function wn(e){return t=>{if(Qi(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function On(e,t,n,r,s){return new rl(e,t,n,r,s)}class rl extends dt{constructor(t,n,r,s,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(w){t.error(w)}}:super._next,this._error=s?function(_){try{s(_)}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Nt(e,t){return wn((n,r)=>{let s=0;n.subscribe(On(r,c=>{r.next(e.call(t,c,s++))}))})}function Jt(e){return this instanceof Jt?(this.v=e,this):new Jt(e)}function rs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function js(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=e[c]&&function(d){return new Promise(function(_,w){!function s(c,d,_,w){Promise.resolve(w).then(function(C){c({value:C,done:_})},d)}(_,w,(d=e[c](d)).done,d.value)})}}}const Vo=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ei(e){return an(e?.then)}function to(e){return an(e[tt])}function qn(e){return Symbol.asyncIterator&&an(e?.[Symbol.asyncIterator])}function hn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const $o=function Ci(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Jn(e){return an(e?.[$o])}function Si(e){return function Di(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=n.apply(e,t||[]),c=[];return s={},d("next"),d("throw"),d("return"),s[Symbol.asyncIterator]=function(){return this},s;function d(q){r[q]&&(s[q]=function(te){return new Promise(function(le,ve){c.push([q,te,le,ve])>1||_(q,te)})})}function _(q,te){try{!function w(q){q.value instanceof Jt?Promise.resolve(q.value.v).then(C,M):z(c[0][2],q)}(r[q](te))}catch(le){z(c[0][3],le)}}function C(q){_("next",q)}function M(q){_("throw",q)}function z(q,te){q(te),c.shift(),c.length&&_(c[0][0],c[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:s}=yield Jt(n.read());if(s)return yield Jt(void 0);yield yield Jt(r)}}finally{n.releaseLock()}})}function Ii(e){return an(e?.getReader)}function ni(e){if(e instanceof rn)return e;if(null!=e){if(to(e))return function Gs(e){return new rn(t=>{const n=e[tt]();if(an(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Vo(e))return function qs(e){return new rn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Ei(e))return function G(e){return new rn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,zt)})}(e);if(qn(e))return L(e);if(Jn(e))return function P(e){return new rn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Ii(e))return function $(e){return L(Si(e))}(e)}throw hn(e)}function L(e){return new rn(t=>{(function W(e,t){var n,r,s,c;return function Wt(e,t,n,r){return new(n||(n=Promise))(function(c,d){function _(M){try{C(r.next(M))}catch(z){d(z)}}function w(M){try{C(r.throw(M))}catch(z){d(z)}}function C(M){M.done?c(M.value):function s(c){return c instanceof n?c:new n(function(d){d(c)})}(M.value).then(_,w)}C((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=rs(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(d){s={error:d}}finally{try{r&&!r.done&&(c=n.return)&&(yield c.call(n))}finally{if(s)throw s.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Z(e,t,n,r=0,s=!1){const c=t.schedule(function(){n(),s?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(c),!s)return c}function Y(e,t,n=1/0){return an(t)?Y((r,s)=>Nt((c,d)=>t(r,c,s,d))(ni(e(r,s))),n):("number"==typeof t&&(n=t),wn((r,s)=>function ie(e,t,n,r,s,c,d,_){const w=[];let C=0,M=0,z=!1;const q=()=>{z&&!w.length&&!C&&t.complete()},te=ve=>C<r?le(ve):w.push(ve),le=ve=>{c&&t.next(ve),C++;let Ce=!1;ni(n(ve,M++)).subscribe(On(t,Te=>{s?.(Te),c?te(Te):t.next(Te)},()=>{Ce=!0},void 0,()=>{if(Ce)try{for(C--;w.length&&C<r;){const Te=w.shift();d?Z(t,d,()=>le(Te)):le(Te)}q()}catch(Te){t.error(Te)}}))};return e.subscribe(On(t,te,()=>{z=!0,q()})),()=>{_?.()}}(r,s,e,n)))}function ne(e=1/0){return Y(Gn,e)}const re=new rn(e=>e.complete());function We(e){return e[e.length-1]}function Xe(e){return function pe(e){return e&&an(e.schedule)}(We(e))?e.pop():void 0}function Xt(e,t=0){return wn((n,r)=>{n.subscribe(On(r,s=>Z(r,e,()=>r.next(s),t),()=>Z(r,e,()=>r.complete(),t),s=>Z(r,e,()=>r.error(s),t)))})}function Lt(e,t=0){return wn((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function zn(e,t){if(!e)throw new Error("Iterable cannot be null");return new rn(n=>{Z(n,t,()=>{const r=e[Symbol.asyncIterator]();Z(n,t,()=>{r.next().then(s=>{s.done?n.complete():n.next(s.value)})},0,!0)})})}function Zn(e,t){return t?function Sr(e,t){if(null!=e){if(to(e))return function Mt(e,t){return ni(e).pipe(Lt(t),Xt(t))}(e,t);if(Vo(e))return function vt(e,t){return new rn(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Ei(e))return function bt(e,t){return ni(e).pipe(Lt(t),Xt(t))}(e,t);if(qn(e))return zn(e,t);if(Jn(e))return function Wn(e,t){return new rn(n=>{let r;return Z(n,t,()=>{r=e[$o](),Z(n,t,()=>{let s,c;try{({value:s,done:c}=r.next())}catch(d){return void n.error(d)}c?n.complete():n.next(s)},0,!0)}),()=>an(r?.return)&&r.return()})}(e,t);if(Ii(e))return function fr(e,t){return zn(Si(e),t)}(e,t)}throw hn(e)}(e,t):ni(e)}function oc(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new Yn({next:()=>{r.unsubscribe(),e()}});return t(...n).subscribe(r)}function dn(e){for(let t in e)if(e[t]===dn)return t;throw Error("Could not find renamed property on target object.")}function yn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(yn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function sl(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ac=dn({__forward_ref__:dn});function xa(e){return e.__forward_ref__=xa,e.toString=function(){return yn(this())},e}function ut(e){return al(e)?e():e}function al(e){return"function"==typeof e&&e.hasOwnProperty(ac)&&e.__forward_ref__===xa}function ll(e){return e&&!!e.\u0275providers}class ze extends Error{constructor(t,n){super(jo(t,n)),this.code=t}}function jo(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}function tn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function gt(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function Nn(e,t){throw new ze(-201,!1)}function St(e,t){null==e&&function un(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function it(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function no(e){return{providers:e.providers||[],imports:e.imports||[]}}function is(e){return hl(e,os)||hl(e,fc)}function hl(e,t){return e.hasOwnProperty(t)?e[t]:null}function fl(e){return e&&(e.hasOwnProperty(pl)||e.hasOwnProperty(Zs))?e[pl]:null}const os=dn({\u0275prov:dn}),pl=dn({\u0275inj:dn}),fc=dn({ngInjectableDef:dn}),Zs=dn({ngInjectorDef:dn});var ft=(()=>((ft=ft||{})[ft.Default=0]="Default",ft[ft.Host=1]="Host",ft[ft.Self=2]="Self",ft[ft.SkipSelf=4]="SkipSelf",ft[ft.Optional=8]="Optional",ft))();let pc;function Ti(e){const t=pc;return pc=e,t}function yu(e,t,n){const r=is(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&ft.Optional?null:void 0!==t?t:void Nn(yn(e))}const xn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Xs={},Ca="__NG_DI_FLAG__",ro="ngTempTokenPath",vu="ngTokenPath",ss=/\n/gm,Ks="\u0275",mc="__source";let as;function ht(e){const t=as;return as=e,t}function ml(e,t=ft.Default){if(void 0===as)throw new ze(-203,!1);return null===as?yu(e,void 0,t):as.get(e,t&ft.Optional?null:void 0,t)}function Fe(e,t=ft.Default){return(function Zh(){return pc}()||ml)(ut(e),t)}function ot(e,t=ft.Default){return Fe(e,Mn(t))}function Mn(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Ys(e){const t=[];for(let n=0;n<e.length;n++){const r=ut(e[n]);if(Array.isArray(r)){if(0===r.length)throw new ze(900,!1);let s,c=ft.Default;for(let d=0;d<r.length;d++){const _=r[d],w=Kh(_);"number"==typeof w?-1===w?s=_.token:c|=w:s=_}t.push(Fe(s,c))}else t.push(Fe(r))}return t}function ls(e,t){return e[Ca]=t,e.prototype[Ca]=t,e}function Kh(e){return e[Ca]}function Vi(e){return{toString:e}.toString()}var ri=(()=>((ri=ri||{})[ri.OnPush=0]="OnPush",ri[ri.Default=1]="Default",ri))(),jr=(()=>{return(e=jr||(jr={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",jr;var e})();const Mi={},At=[],Ia=dn({\u0275cmp:dn}),yl=dn({\u0275dir:dn}),_l=dn({\u0275pipe:dn}),cs=dn({\u0275mod:dn}),Ai=dn({\u0275fac:dn}),us=dn({__NG_ELEMENT_ID__:dn});let bu=0;function hs(e){return Vi(()=>{const n=!0===e.standalone,r={},s={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===ri.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||At,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||jr.Emulated,id:"c"+bu++,styles:e.styles||At,_:null,setInput:null,schemas:e.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},c=e.dependencies,d=e.features;return s.inputs=Ta(e.inputs,r),s.outputs=Ta(e.outputs),d&&d.forEach(_=>_(s)),s.directiveDefs=c?()=>("function"==typeof c?c():c).map(_c).filter(Js):null,s.pipeDefs=c?()=>("function"==typeof c?c():c).map(Lr).filter(Js):null,s})}function _c(e){return cn(e)||er(e)}function Js(e){return null!==e}function Ho(e){return Vi(()=>({type:e.type,bootstrap:e.bootstrap||At,declarations:e.declarations||At,imports:e.imports||At,exports:e.exports||At,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Ta(e,t){if(null==e)return Mi;const n={};for(const r in e)if(e.hasOwnProperty(r)){let s=e[r],c=s;Array.isArray(s)&&(c=s[1],s=s[0]),n[s]=r,t&&(t[s]=c)}return n}const Qn=hs;function cn(e){return e[Ia]||null}function er(e){return e[yl]||null}function Lr(e){return e[_l]||null}function ii(e,t){const n=e[cs]||null;if(!n&&!0===t)throw new Error(`Type ${yn(e)} does not have '\u0275mod' property.`);return n}const oi=0,Ye=1,wt=2,Dn=3,Bn=4,tr=5,Fr=6,Pi=7,$n=8,xo=9,io=10,Ft=11,Ma=12,Aa=13,vc=14,Ri=15,Xn=16,je=17,Go=18,si=19,$i=20,Qs=21,Me=22,bl=1,Du=2,qo=7,Pa=8,fs=9,Hr=10;function Or(e){return Array.isArray(e)&&"object"==typeof e[bl]}function fi(e){return Array.isArray(e)&&!0===e[bl]}function Ra(e){return 0!=(4&e.flags)}function ps(e){return e.componentOffset>-1}function mr(e){return null!==e.template}function Eu(e){return 0!=(256&e[wt])}function pi(e,t){return e.hasOwnProperty(Ai)?e[Ai]:null}class ai{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function ms(){return na}function na(e){return e.type.prototype.ngOnChanges&&(e.setInput=lr),En}function En(){const e=gs(this),t=e?.current;if(t){const n=e.previous;if(n===Mi)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function lr(e,t,n,r){const s=this.declaredInputs[n],c=gs(e)||function ka(e,t){return e[Cc]=t}(e,{previous:Mi,current:null}),d=c.current||(c.current={}),_=c.previous,w=_[s];d[s]=new ai(w&&w.currentValue,t,_===Mi),e[r]=t}ms.ngInherit=!0;const Cc="__ngSimpleChanges__";function gs(e){return e[Cc]||null}const u=function(e,t,n){};function b(e){for(;Array.isArray(e);)e=e[oi];return e}function T(e,t){return b(t[e.index])}function j(e,t){const n=t[e];return Or(n)?n:n[oi]}function H(e){return 64==(64&e[wt])}function oe(e,t){return null==t?null:e[t]}function se(e){e[Go]=0}function ce(e,t){e[tr]+=t;let n=e,r=e[Dn];for(;null!==r&&(1===t&&1===n[tr]||-1===t&&0===n[tr]);)r[tr]+=t,n=r,r=r[Dn]}const J={lFrame:Gi(null),bindingsEnabled:!0};function be(){return J.bindingsEnabled}function he(){return J.lFrame.lView}function Ke(){return J.lFrame.tView}function Bt(){let e=pt();for(;null!==e&&64===e.type;)e=e.parent;return e}function pt(){return J.lFrame.currentTNode}function Ht(e,t){const n=J.lFrame;n.currentTNode=e,n.isParent=t}function cr(){return J.lFrame.isParent}function qr(e,t){const n=J.lFrame;n.bindingIndex=n.bindingRootIndex=e,Do(t)}function Do(e){J.lFrame.currentDirectiveIndex=e}function La(){return J.lFrame.currentQueryIndex}function Fa(e){J.lFrame.currentQueryIndex=e}function Dl(e){const t=e[Ye];return 2===t.type?t.declTNode:1===t.type?e[Fr]:null}function Sc(e,t,n){if(n&ft.SkipSelf){let s=t,c=e;for(;!(s=s.parent,null!==s||n&ft.Host||(s=Dl(c),null===s||(c=c[Ri],10&s.type))););if(null===s)return!1;t=s,e=c}const r=J.lFrame=Oa();return r.currentTNode=t,r.lView=e,!0}function Eo(e){const t=Oa(),n=e[Ye];J.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Oa(){const e=J.lFrame,t=null===e?null:e.child;return null===t?Gi(e):t}function Gi(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function ys(){const e=J.lFrame;return J.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Qh=ys;function Tu(){const e=ys();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function oo(e){J.lFrame.selectedIndex=e}function jn(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:w,ngAfterViewChecked:C,ngOnDestroy:M}=c;d&&(e.contentHooks||(e.contentHooks=[])).push(-n,d),_&&((e.contentHooks||(e.contentHooks=[])).push(n,_),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,_)),w&&(e.viewHooks||(e.viewHooks=[])).push(-n,w),C&&((e.viewHooks||(e.viewHooks=[])).push(n,C),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,C)),null!=M&&(e.destroyHooks||(e.destroyHooks=[])).push(n,M)}}function El(e,t,n){ia(e,t,3,n)}function Ic(e,t,n,r){(3&e[wt])===n&&ia(e,t,n,r)}function _s(e,t){let n=e[wt];(3&n)===t&&(n&=2047,n+=1,e[wt]=n)}function ia(e,t,n,r){const c=r??-1,d=t.length-1;let _=0;for(let w=void 0!==r?65535&e[Go]:0;w<d;w++)if("number"==typeof t[w+1]){if(_=t[w],null!=r&&_>=r)break}else t[w]<0&&(e[Go]+=65536),(_<c||-1==c)&&(Mu(e,n,t,w),e[Go]=(4294901760&e[Go])+w+2),w++}function Mu(e,t,n,r){const s=n[r]<0,c=n[r+1],_=e[s?-n[r]:n[r]];if(s){if(e[wt]>>11<e[Go]>>16&&(3&e[wt])===t){e[wt]+=2048,u(4,_,c);try{c.call(_)}finally{u(5,_,c)}}}else{u(4,_,c);try{c.call(_)}finally{u(5,_,c)}}}const oa=-1;class Cl{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function sa(e,t,n){let r=0;for(;r<n.length;){const s=n[r];if("number"==typeof s){if(0!==s)break;r++;const c=n[r++],d=n[r++],_=n[r++];e.setAttribute(t,d,_,c)}else{const c=s,d=n[++r];Sl(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),r++}}return r}function kf(e){return 3===e||4===e||6===e}function Sl(e){return 64===e.charCodeAt(0)}function aa(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const s=t[r];"number"==typeof s?n=s:0===n||Tc(e,n,s,null,-1===n||2===n?t[++r]:null)}}return e}function Tc(e,t,n,r,s){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n){if(null===r)return void(null!==s&&(e[c+1]=s));if(r===e[c+1])return void(e[c+2]=s)}c++,null!==r&&c++,null!==s&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==r&&e.splice(c++,0,r),null!==s&&e.splice(c++,0,s)}function Lf(e){return e!==oa}function Au(e){return 32767&e}function Tl(e,t){let n=function Il(e){return e>>16}(e),r=t;for(;n>0;)r=r[Ri],n--;return r}let Pu=!0;function la(e){const t=Pu;return Pu=e,t}const Mc=255,rd=5;let Ff=0;const Zo={};function Ac(e,t){const n=Ml(e,t);if(-1!==n)return n;const r=t[Ye];r.firstCreatePass&&(e.injectorIndex=t.length,Pc(r.data,e),Pc(t,null),Pc(r.blueprint,null));const s=mi(e,t),c=e.injectorIndex;if(Lf(s)){const d=Au(s),_=Tl(s,t),w=_[Ye].data;for(let C=0;C<8;C++)t[c+C]=_[d+C]|w[d+C]}return t[c+8]=s,c}function Pc(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Ml(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function mi(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,s=t;for(;null!==s;){if(r=$f(s),null===r)return oa;if(n++,s=s[Ri],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return oa}function Ru(e,t,n){!function id(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(us)&&(r=n[us]),null==r&&(r=n[us]=Ff++);const s=r&Mc;t.data[e+(s>>rd)]|=1<<s}(e,t,n)}function Of(e,t,n){if(n&ft.Optional||void 0!==e)return e;Nn()}function zf(e,t,n,r){if(n&ft.Optional&&void 0===r&&(r=null),!(n&(ft.Self|ft.Host))){const s=e[xo],c=Ti(void 0);try{return s?s.get(t,r,n&ft.Optional):yu(t,r,n&ft.Optional)}finally{Ti(c)}}return Of(r,0,n)}function ku(e,t,n,r=ft.Default,s){if(null!==e){if(1024&t[wt]){const d=function sd(e,t,n,r,s){let c=e,d=t;for(;null!==c&&null!==d&&1024&d[wt]&&!(256&d[wt]);){const _=Rc(c,d,n,r|ft.Self,Zo);if(_!==Zo)return _;let w=c.parent;if(!w){const C=d[Qs];if(C){const M=C.get(n,Zo,r);if(M!==Zo)return M}w=$f(d),d=d[Ri]}c=w}return s}(e,t,n,r,Zo);if(d!==Zo)return d}const c=Rc(e,t,n,r,Zo);if(c!==Zo)return c}return zf(t,n,r,s)}function Rc(e,t,n,r,s){const c=function Km(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(us)?e[us]:void 0;return"number"==typeof t?t>=0?t&Mc:Ym:t}(n);if("function"==typeof c){if(!Sc(t,e,r))return r&ft.Host?Of(s,0,r):zf(t,n,r,s);try{const d=c(r);if(null!=d||r&ft.Optional)return d;Nn()}finally{Qh()}}else if("number"==typeof c){let d=null,_=Ml(e,t),w=oa,C=r&ft.Host?t[Xn][Fr]:null;for((-1===_||r&ft.SkipSelf)&&(w=-1===_?mi(e,t):t[_+8],w!==oa&&Uf(r,!1)?(d=t[Ye],_=Au(w),t=Tl(w,t)):_=-1);-1!==_;){const M=t[Ye];if(Bf(c,_,M.data)){const z=Nf(_,t,n,d,r,C);if(z!==Zo)return z}w=t[_+8],w!==oa&&Uf(r,t[Ye].data[_+8]===C)&&Bf(c,_,t)?(d=M,_=Au(w),t=Tl(w,t)):_=-1}}return s}function Nf(e,t,n,r,s,c){const d=t[Ye],_=d.data[e+8],M=So(_,d,n,null==r?ps(_)&&Pu:r!=d&&0!=(3&_.type),s&ft.Host&&c===_);return null!==M?Io(t,d,M,_):Zo}function So(e,t,n,r,s){const c=e.providerIndexes,d=t.data,_=1048575&c,w=e.directiveStart,M=c>>20,q=s?_+M:e.directiveEnd;for(let te=r?_:_+M;te<q;te++){const le=d[te];if(te<w&&n===le||te>=w&&le.type===n)return te}if(s){const te=d[w];if(te&&mr(te)&&te.type===n)return w}return null}function Io(e,t,n,r){let s=e[n];const c=t.data;if(function Hm(e){return e instanceof Cl}(s)){const d=s;d.resolving&&function wa(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new ze(-200,`Circular dependency in DI detected for ${e}${n}`)}(tn(c[n]));const _=la(d.canSeeViewProviders);d.resolving=!0;const w=d.injectImpl?Ti(d.injectImpl):null;Sc(e,r,ft.Default);try{s=e[n]=d.factory(void 0,c,e,r),t.firstCreatePass&&n>=r.directiveStart&&function Pf(e,t,n){const{ngOnChanges:r,ngOnInit:s,ngDoCheck:c}=t.type.prototype;if(r){const d=na(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d)}s&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,s),c&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,c),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,c))}(n,c[n],t)}finally{null!==w&&Ti(w),la(_),d.resolving=!1,Qh()}}return s}function Bf(e,t,n){return!!(n[t+(e>>rd)]&1<<e)}function Uf(e,t){return!(e&ft.Self||e&ft.Host&&t)}class Al{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return ku(this._tNode,this._lView,t,Mn(r),n)}}function Ym(){return new Al(Bt(),he())}function od(e){return al(e)?()=>{const t=od(ut(e));return t&&t()}:pi(e)}function $f(e){const t=e[Ye],n=t.type;return 2===n?t.declTNode:1===n?e[Fr]:null}const Cn="__parameters__";function bs(e,t,n){return Vi(()=>{const r=function Rl(e){return function(...n){if(e){const r=e(...n);for(const s in r)this[s]=r[s]}}}(t);function s(...c){if(this instanceof s)return r.apply(this,c),this;const d=new s(...c);return _.annotation=d,_;function _(w,C,M){const z=w.hasOwnProperty(Cn)?w[Cn]:Object.defineProperty(w,Cn,{value:[]})[Cn];for(;z.length<=M;)z.push(null);return(z[M]=z[M]||[]).push(d),w}}return n&&(s.prototype=Object.create(n.prototype)),s.prototype.ngMetadataName=e,s.annotationCls=s,s})}class mt{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=it({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ba(e,t){e.forEach(n=>Array.isArray(n)?Ba(n,t):t(n))}function Wf(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function To(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const kl=ls(bs("Optional"),8),Nc=ls(bs("SkipSelf"),4);var Fi=(()=>((Fi=Fi||{})[Fi.Important=1]="Important",Fi[Fi.DashCase=2]="DashCase",Fi))();const $u=new Map;let ju=0;const qu="__ngContext__";function Wr(e,t){Or(t)?(e[qu]=t[$i],function Fl(e){$u.set(e[$i],e)}(t)):e[qu]=t}let Zu;function xd(e,t){return Zu(e,t)}function Ol(e){const t=e[Dn];return fi(t)?t[Dn]:t}function zl(e){return Gc(e[Aa])}function Xu(e){return Gc(e[Bn])}function Gc(e){for(;null!==e&&!fi(e);)e=e[Bn];return e}function Es(e,t,n,r,s){if(null!=r){let c,d=!1;fi(r)?c=r:Or(r)&&(d=!0,r=r[oi]);const _=b(r);0===e&&null!==n?null==s?Ju(t,n,_):Ga(t,n,_,s||null,!0):1===e&&null!==n?Ga(t,n,_,s||null,!0):2===e?function Ss(e,t,n){const r=Vl(e,t);r&&function Ul(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function _p(e,t,n,r,s){const c=n[qo];c!==b(n)&&Es(t,e,r,c,s);for(let _=Hr;_<n.length;_++){const w=n[_];$l(w[Ye],w,e,t,r,c)}}(t,e,c,n,s)}}function bd(e,t,n){return e.createElement(t,n)}function Cs(e,t){const n=e[fs],r=n.indexOf(t),s=t[Dn];512&t[wt]&&(t[wt]&=-513,ce(s,-1)),n.splice(r,1)}function Ku(e,t){if(e.length<=Hr)return;const n=Hr+t,r=e[n];if(r){const s=r[je];null!==s&&s!==e&&Cs(s,r),t>0&&(e[n-1][Bn]=r[Bn]);const c=To(e,Hr+t);!function vg(e,t){$l(e,t,t[Ft],2,null,null),t[oi]=null,t[Fr]=null}(r[Ye],r);const d=c[si];null!==d&&d.detachView(c[Ye]),r[Dn]=null,r[Bn]=null,r[wt]&=-65}return r}function Ed(e,t){if(!(128&t[wt])){const n=t[Ft];n.destroyNode&&$l(e,t,n,3,null,null),function fp(e){let t=e[Aa];if(!t)return Cd(e[Ye],e);for(;t;){let n=null;if(Or(t))n=t[Aa];else{const r=t[Hr];r&&(n=r)}if(!n){for(;t&&!t[Bn]&&t!==e;)Or(t)&&Cd(t[Ye],t),t=t[Dn];null===t&&(t=e),Or(t)&&Cd(t[Ye],t),n=t&&t[Bn]}t=n}}(t)}}function Cd(e,t){if(!(128&t[wt])){t[wt]&=-65,t[wt]|=128,function wg(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const s=t[n[r]];if(!(s instanceof Cl)){const c=n[r+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=s[c[d]],w=c[d+1];u(4,_,w);try{w.call(_)}finally{u(5,_,w)}}else{u(4,s,c);try{c.call(s)}finally{u(5,s,c)}}}}}(e,t),function bg(e,t){const n=e.cleanup,r=t[Pi];let s=-1;if(null!==n)for(let c=0;c<n.length-1;c+=2)if("string"==typeof n[c]){const d=n[c+3];d>=0?r[s=d]():r[s=-d].unsubscribe(),c+=2}else{const d=r[s=n[c+1]];n[c].call(d)}if(null!==r){for(let c=s+1;c<r.length;c++)(0,r[c])();t[Pi]=null}}(e,t),1===t[Ye].type&&t[Ft].destroy();const n=t[je];if(null!==n&&fi(t[Dn])){n!==t[Dn]&&Cs(n,t);const r=t[si];null!==r&&r.detachView(e)}!function Hu(e){$u.delete(e[$i])}(t)}}function qc(e,t,n){return function Yu(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[oi];{const{componentOffset:s}=r;if(s>-1){const{encapsulation:c}=e.data[r.directiveStart+s];if(c===jr.None||c===jr.Emulated)return null}return T(r,n)}}(e,t.parent,n)}function Ga(e,t,n,r,s){e.insertBefore(t,n,r,s)}function Ju(e,t,n){e.appendChild(t,n)}function Qu(e,t,n,r,s){null!==r?Ga(e,t,n,r,s):Ju(e,t,n)}function Vl(e,t){return e.parentNode(t)}let Sd,sh,mp=function eh(e,t,n){return 40&e.type?T(e,n):null};function th(e,t,n,r){const s=qc(e,r,t),c=t[Ft],_=function Wc(e,t,n){return mp(e,t,n)}(r.parent||t[Fr],r,t);if(null!=s)if(Array.isArray(n))for(let w=0;w<n.length;w++)Qu(c,s,n[w],_,!1);else Qu(c,s,n,_,!1);void 0!==Sd&&Sd(c,r,t,n,s)}function nh(e,t){if(null!==t){const n=t.type;if(3&n)return T(t,e);if(4&n)return Ln(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return nh(e,r);{const s=e[t.index];return fi(s)?Ln(-1,s):b(s)}}if(32&n)return xd(t,e)()||b(e[t.index]);{const r=Id(e,t);return null!==r?Array.isArray(r)?r[0]:nh(Ol(e[Xn]),r):nh(e,t.next)}}return null}function Id(e,t){return null!==t?e[Xn][Fr].projection[t.projection]:null}function Ln(e,t){const n=Hr+e+1;if(n<t.length){const r=t[n],s=r[Ye].firstChild;if(null!==s)return nh(r,s)}return t[qo]}function rh(e,t,n,r,s,c,d){for(;null!=n;){const _=r[n.index],w=n.type;if(d&&0===t&&(_&&Wr(b(_),r),n.flags|=2),32!=(32&n.flags))if(8&w)rh(e,t,n.child,r,s,c,!1),Es(t,e,s,_,c);else if(32&w){const C=xd(n,r);let M;for(;M=C();)Es(t,e,s,M,c);Es(t,e,s,_,c)}else 16&w?Td(e,t,r,n,s,c):Es(t,e,s,_,c);n=d?n.projectionNext:n.next}}function $l(e,t,n,r,s,c){rh(n,r,e.firstChild,t,s,c,!1)}function Td(e,t,n,r,s,c){const d=n[Xn],w=d[Fr].projection[r.projection];if(Array.isArray(w))for(let C=0;C<w.length;C++)Es(t,e,s,w[C],c);else rh(e,t,w,d[Dn],s,c,!0)}function Ad(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function oh(e,t,n){const{mergedAttrs:r,classes:s,styles:c}=n;null!==r&&sa(e,t,r),null!==s&&Ad(e,t,s),null!==c&&function ih(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}const vr=new mt("ENVIRONMENT_INITIALIZER"),Zi=new mt("INJECTOR",-1),ao=new mt("INJECTOR_DEF_TYPES");class lo{get(t,n=Xs){if(n===Xs){const r=new Error(`NullInjectorError: No provider for ${yn(t)}!`);throw r.name="NullInjectorError",r}return n}}function co(...e){return{\u0275providers:zi(0,e),\u0275fromNgModule:!0}}function zi(e,...t){const n=[],r=new Set;let s;return Ba(t,c=>{const d=c;Ao(d,n,[],r)&&(s||(s=[]),s.push(d))}),void 0!==s&&ci(s,n),n}function ci(e,t){for(let n=0;n<e.length;n++){const{providers:s}=e[n];ch(s,c=>{t.push(c)})}}function Ao(e,t,n,r){if(!(e=ut(e)))return!1;let s=null,c=fl(e);const d=!c&&cn(e);if(c||d){if(d&&!d.standalone)return!1;s=e}else{const w=e.ngModule;if(c=fl(w),!c)return!1;s=w}const _=r.has(s);if(d){if(_)return!1;if(r.add(s),d.dependencies){const w="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const C of w)Ao(C,t,n,r)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let C;r.add(s);try{Ba(c.imports,M=>{Ao(M,t,n,r)&&(C||(C=[]),C.push(M))})}finally{}void 0!==C&&ci(C,t)}if(!_){const C=pi(s)||(()=>new s);t.push({provide:s,useFactory:C,deps:At},{provide:ao,useValue:s,multi:!0},{provide:vr,useValue:()=>Fe(s),multi:!0})}const w=c.providers;null==w||_||ch(w,M=>{t.push(M)})}}return s!==e&&void 0!==e.providers}function ch(e,t){for(let n of e)ll(n)&&(n=n.\u0275providers),Array.isArray(n)?ch(n,t):t(n)}const Pd=dn({provide:String,useValue:dn});function Xc(e){return null!==e&&"object"==typeof e&&Pd in e}function Is(e){return"function"==typeof e}const uh=new mt("Set Injector scope."),hh={},Eg={};let Ld;function dh(){return void 0===Ld&&(Ld=new lo),Ld}class Ts{}class Cp extends Ts{get destroyed(){return this._destroyed}constructor(t,n,r,s){super(),this.parent=n,this.source=r,this.scopes=s,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Wa(t,d=>this.processProvider(d)),this.records.set(Zi,qa(void 0,this)),s.has("environment")&&this.records.set(Ts,qa(void 0,this));const c=this.records.get(uh);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(ao.multi,At,ft.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=ht(this),r=Ti(void 0);try{return t()}finally{ht(n),Ti(r)}}get(t,n=Xs,r=ft.Default){this.assertNotDestroyed(),r=Mn(r);const s=ht(this),c=Ti(void 0);try{if(!(r&ft.SkipSelf)){let _=this.records.get(t);if(void 0===_){const w=function Yc(e){return"function"==typeof e||"object"==typeof e&&e instanceof mt}(t)&&is(t);_=w&&this.injectableDefInScope(w)?qa(Fd(t),hh):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(r&ft.Self?dh():this.parent).get(t,n=r&ft.Optional&&n===Xs?null:n)}catch(d){if("NullInjectorError"===d.name){if((d[ro]=d[ro]||[]).unshift(yn(t)),s)throw d;return function gc(e,t,n,r){const s=e[ro];throw t[mc]&&s.unshift(t[mc]),e.message=function gl(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&e.charAt(1)==Ks?e.slice(2):e;let s=yn(t);if(Array.isArray(t))s=t.map(yn).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):yn(_)))}s=`{${c.join(", ")}}`}return`${n}${r?"("+r+")":""}[${s}]: ${e.replace(ss,"\n  ")}`}("\n"+e.message,s,n,r),e[vu]=s,e[ro]=null,e}(d,t,"R3InjectorError",this.source)}throw d}finally{Ti(c),ht(s)}}resolveInjectorInitializers(){const t=ht(this),n=Ti(void 0);try{const r=this.get(vr.multi,At,ft.Self);for(const s of r)s()}finally{ht(t),Ti(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(yn(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ze(205,!1)}processProvider(t){let n=Is(t=ut(t))?t:ut(t&&t.provide);const r=function Po(e){return Xc(e)?qa(void 0,e.useValue):qa(function Kc(e,t,n){let r;if(Is(e)){const s=ut(e);return pi(s)||Fd(s)}if(Xc(e))r=()=>ut(e.useValue);else if(function Rd(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Ys(e.deps||[]));else if(function Ko(e){return!(!e||!e.useExisting)}(e))r=()=>Fe(ut(e.useExisting));else{const s=ut(e&&(e.useClass||e.provide));if(!function xi(e){return!!e.deps}(e))return pi(s)||Fd(s);r=()=>new s(...Ys(e.deps))}return r}(e),hh)}(t);if(Is(t)||!0!==t.multi)this.records.get(n);else{let s=this.records.get(n);s||(s=qa(void 0,hh,!0),s.factory=()=>Ys(s.multi),this.records.set(n,s)),n=t,s.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===hh&&(n.value=Eg,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Yo(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=ut(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function Fd(e){const t=is(e),n=null!==t?t.factory:pi(e);if(null!==n)return n;if(e instanceof mt)throw new ze(204,!1);if(e instanceof Function)return function Cg(e){const t=e.length;if(t>0)throw function Fc(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new ze(204,!1);const n=function dl(e){const t=e&&(e[os]||e[fc]);return t?(function dc(e){if(e.hasOwnProperty("name"))return e.name;(""+e).match(/^function\s*([^\s(]+)/)}(e),t):null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new ze(204,!1)}function qa(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Wa(e,t){for(const n of e)Array.isArray(n)?Wa(n,t):n&&ll(n)?Wa(n.\u0275providers,t):t(n)}class Sp{}class ha{}class AD{resolveComponentFactory(t){throw function MD(e){const t=Error(`No component factory found for ${yn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Od=(()=>{class e{}return e.NULL=new AD,e})();function PD(){return fh(Bt(),he())}function fh(e,t){return new ql(T(e,t))}let ql=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=PD,e})();function RD(e){return e instanceof ql?e.nativeElement:e}class xv{}let LD=(()=>{class e{}return e.\u0275prov=it({token:e,providedIn:"root",factory:()=>null}),e})();class Tp{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const FD=new Tp("15.2.1"),Sg={},Ig="ngOriginalError";function Tg(e){return e[Ig]}class ph{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Tg(t);for(;n&&Tg(n);)n=Tg(n);return n||null}}function Za(e){return e instanceof Function?e():e}function wv(e,t,n){let r=e.length;for(;;){const s=e.indexOf(t,n);if(-1===s)return s;if(0===s||e.charCodeAt(s-1)<=32){const c=t.length;if(s+c===r||e.charCodeAt(s+c)<=32)return s}n=s+1}}const Dv="ng-template";function qD(e,t,n){let r=0;for(;r<e.length;){let s=e[r++];if(n&&"class"===s){if(s=e[r],-1!==wv(s.toLowerCase(),t,0))return!0}else if(1===s){for(;r<e.length&&"string"==typeof(s=e[r++]);)if(s.toLowerCase()===t)return!0;return!1}}return!1}function Ev(e){return 4===e.type&&e.value!==Dv}function WD(e,t,n){return t===(4!==e.type||n?e.value:Dv)}function ZD(e,t,n){let r=4;const s=e.attrs||[],c=function YD(e){for(let t=0;t<e.length;t++)if(kf(e[t]))return t;return e.length}(s);let d=!1;for(let _=0;_<t.length;_++){const w=t[_];if("number"!=typeof w){if(!d)if(4&r){if(r=2|1&r,""!==w&&!WD(e,w,n)||""===w&&1===t.length){if(Ms(r))return!1;d=!0}}else{const C=8&r?w:t[++_];if(8&r&&null!==e.attrs){if(!qD(e.attrs,C,n)){if(Ms(r))return!1;d=!0}continue}const z=XD(8&r?"class":w,s,Ev(e),n);if(-1===z){if(Ms(r))return!1;d=!0;continue}if(""!==C){let q;q=z>c?"":s[z+1].toLowerCase();const te=8&r?q:null;if(te&&-1!==wv(te,C,0)||2&r&&C!==q){if(Ms(r))return!1;d=!0}}}}else{if(!d&&!Ms(r)&&!Ms(w))return!1;if(d&&Ms(w))continue;d=!1,r=w|1&r}}return Ms(r)||d}function Ms(e){return 0==(1&e)}function XD(e,t,n,r){if(null===t)return-1;let s=0;if(r||!n){let c=!1;for(;s<t.length;){const d=t[s];if(d===e)return s;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++s];for(;"string"==typeof _;)_=t[++s];continue}if(4===d)break;if(0===d){s+=4;continue}}s+=c?1:2}return-1}return function JD(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Cv(e,t,n=!1){for(let r=0;r<t.length;r++)if(ZD(e,t[r],n))return!0;return!1}function Sv(e,t){return e?":not("+t.trim()+")":t}function eE(e){let t=e[0],n=1,r=2,s="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&r){const _=e[++n];s+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&r?s+="."+d:4&r&&(s+=" "+d);else""!==s&&!Ms(d)&&(t+=Sv(c,s),s=""),r=d,c=c||!Ms(r);n++}return""!==s&&(t+=Sv(c,s)),t}const Ot={};function Pv(e,t=null,n=null,r){const s=Rv(e,t,n,r);return s.resolveInjectorInitializers(),s}function Rv(e,t=null,n=null,r,s=new Set){const c=[n||At,co(e)];return r=r||("object"==typeof e?void 0:yn(e)),new Cp(c,t||dh(),r||null,s)}let da=(()=>{class e{static create(n,r){if(Array.isArray(n))return Pv({name:""},r,n,"");{const s=n.name??"";return Pv({name:s},n.parent,n.providers,s)}}}return e.THROW_IF_NOT_FOUND=Xs,e.NULL=new lo,e.\u0275prov=it({token:e,providedIn:"any",factory:()=>Fe(Zi)}),e.__NG_ELEMENT_ID__=-1,e})();function xt(e,t=ft.Default){const n=he();return null===n?Fe(e,t):ku(Bt(),n,ut(e),t)}function Uv(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const c=n[r+1];if(-1!==c){const d=e.data[c];Fa(n[r]),d.contentQueries(2,t[c],c)}}}function Ap(e,t,n,r,s,c,d,_,w,C,M){const z=t.blueprint.slice();return z[oi]=s,z[wt]=76|r,(null!==M||e&&1024&e[wt])&&(z[wt]|=1024),se(z),z[Dn]=z[Ri]=e,z[$n]=n,z[io]=d||e&&e[io],z[Ft]=_||e&&e[Ft],z[Ma]=w||e&&e[Ma]||null,z[xo]=C||e&&e[xo]||null,z[Fr]=c,z[$i]=function jc(){return ju++}(),z[Qs]=M,z[Xn]=2==t.type?e[Xn]:z,z}function yh(e,t,n,r,s){let c=e.data[t];if(null===c)c=function kg(e,t,n,r,s){const c=pt(),d=cr(),w=e.data[t]=function IE(e,t,n,r,s,c){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,r,s);return null===e.firstChild&&(e.firstChild=w),null!==c&&(d?null==c.child&&null!==w.parent&&(c.child=w):null===c.next&&(c.next=w,w.prev=c)),w}(e,t,n,r,s),function on(){return J.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=r,c.attrs=s;const d=function jt(){const e=J.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return Ht(c,!0),c}function zd(e,t,n,r){if(0===n)return-1;const s=t.length;for(let c=0;c<n;c++)t.push(r),e.blueprint.push(r),e.data.push(null);return s}function Lg(e,t,n){Eo(t);try{const r=e.viewQuery;null!==r&&Hg(1,r,n);const s=e.template;null!==s&&Vv(e,t,s,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Uv(e,t),e.staticViewQueries&&Hg(2,e.viewQuery,n);const c=e.components;null!==c&&function EE(e,t){for(let n=0;n<t.length;n++)qE(e,t[n])}(t,c)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[wt]&=-5,Tu()}}function Pp(e,t,n,r){const s=t[wt];if(128!=(128&s)){Eo(t);try{se(t),function Wo(e){return J.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Vv(e,t,n,2,r);const d=3==(3&s);if(d){const C=e.preOrderCheckHooks;null!==C&&El(t,C,null)}else{const C=e.preOrderHooks;null!==C&&Ic(t,C,0,null),_s(t,0)}if(function HE(e){for(let t=zl(e);null!==t;t=Xu(t)){if(!t[Du])continue;const n=t[fs];for(let r=0;r<n.length;r++){const s=n[r];512&s[wt]||ce(s[Dn],1),s[wt]|=512}}}(t),function jE(e){for(let t=zl(e);null!==t;t=Xu(t))for(let n=Hr;n<t.length;n++){const r=t[n],s=r[Ye];H(r)&&Pp(s,r,s.template,r[$n])}}(t),null!==e.contentQueries&&Uv(e,t),d){const C=e.contentCheckHooks;null!==C&&El(t,C)}else{const C=e.contentHooks;null!==C&&Ic(t,C,1),_s(t,1)}!function wE(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const s=n[r];if(s<0)oo(~s);else{const c=s,d=n[++r],_=n[++r];qr(d,c),_(2,t[c])}}}finally{oo(-1)}}(e,t);const _=e.components;null!==_&&function DE(e,t){for(let n=0;n<t.length;n++)GE(e,t[n])}(t,_);const w=e.viewQuery;if(null!==w&&Hg(2,w,r),d){const C=e.viewCheckHooks;null!==C&&El(t,C)}else{const C=e.viewHooks;null!==C&&Ic(t,C,2),_s(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[wt]&=-41,512&t[wt]&&(t[wt]&=-513,ce(t[Dn],-1))}finally{Tu()}}}function Vv(e,t,n,r,s){const c=function Mr(){return J.lFrame.selectedIndex}(),d=2&r;try{oo(-1),d&&t.length>Me&&function Iv(e,t,n,r){if(!r)if(3==(3&t[wt])){const c=e.preOrderCheckHooks;null!==c&&El(t,c,n)}else{const c=e.preOrderHooks;null!==c&&Ic(t,c,0,n)}oo(n)}(e,t,Me,!1),u(d?2:0,s),n(r,s)}finally{oo(c),u(d?3:1,s)}}function Fg(e,t,n){if(Ra(t)){const s=t.directiveEnd;for(let c=t.directiveStart;c<s;c++){const d=e.data[c];d.contentQueries&&d.contentQueries(1,n[c],c)}}}function $v(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Ng(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Ng(e,t,n,r,s,c,d,_,w,C){const M=Me+r,z=M+s,q=function CE(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Ot);return n}(M,z),te="function"==typeof C?C():C;return q[Ye]={type:e,blueprint:q,template:n,queries:null,viewQuery:_,declTNode:t,data:q.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:z,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:w,consts:te,incompleteFirstPass:!1}}function jv(e,t,n,r){const s=function Kv(e){return e[Pi]||(e[Pi]=[])}(t);null===n?s.push(r):(s.push(n),e.firstCreatePass&&function Yv(e){return e.cleanup||(e.cleanup=[])}(e).push(r,s.length-1))}function Hv(e,t,n,r){for(let s in e)if(e.hasOwnProperty(s)){n=null===n?{}:n;const c=e[s];null===r?Gv(n,t,s,c):r.hasOwnProperty(s)&&Gv(n,t,r[s],c)}return n}function Gv(e,t,n,r){e.hasOwnProperty(n)?e[n].push(t,r):e[n]=[t,r]}function Wv(e,t,n,r,s,c){for(let C=0;C<r.length;C++)Ru(Ac(n,t),e,r[C].type);!function NE(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let C=0;C<r.length;C++){const M=r[C];M.providersResolver&&M.providersResolver(M)}let d=!1,_=!1,w=zd(e,t,r.length,null);for(let C=0;C<r.length;C++){const M=r[C];n.mergedAttrs=aa(n.mergedAttrs,M.hostAttrs),BE(e,n,t,w,M),zE(w,M,s),null!==M.contentQueries&&(n.flags|=4),(null!==M.hostBindings||null!==M.hostAttrs||0!==M.hostVars)&&(n.flags|=64);const z=M.type.prototype;!d&&(z.ngOnChanges||z.ngOnInit||z.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),d=!0),!_&&(z.ngOnChanges||z.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),_=!0),w++}!function TE(e,t,n){const s=t.directiveEnd,c=e.data,d=t.attrs,_=[];let w=null,C=null;for(let M=t.directiveStart;M<s;M++){const z=c[M],q=n?n.get(z):null,le=q?q.outputs:null;w=Hv(z.inputs,M,w,q?q.inputs:null),C=Hv(z.outputs,M,C,le);const ve=null===w||null===d||Ev(t)?null:$E(w,M,d);_.push(ve)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=8),w.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=_,t.inputs=w,t.outputs=C}(e,n,c)}function Zv(e,t,n){const r=n.directiveStart,s=n.directiveEnd,c=n.index,d=function An(){return J.lFrame.currentDirectiveIndex}();try{oo(c);for(let _=r;_<s;_++){const w=e.data[_],C=t[_];Do(_),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&LE(w,C)}}finally{oo(-1),Do(d)}}function LE(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Ug(e,t,n){t.componentOffset=n,(e.components||(e.components=[])).push(t.index)}function zE(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;mr(t)&&(n[""]=e)}}function BE(e,t,n,r,s){e.data[r]=s;const c=s.factory||(s.factory=pi(s.type)),d=new Cl(c,mr(s),xt);e.blueprint[r]=d,n[r]=d,function PE(e,t,n,r,s){const c=s.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function RE(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,r,c)}}(e,t,r,zd(e,n,s.hostVars,Ot),s)}function VE(e,t,n,r,s,c){const d=c[t];if(null!==d){const _=r.setInput;for(let w=0;w<d.length;){const C=d[w++],M=d[w++],z=d[w++];null!==_?r.setInput(n,z,C,M):n[M]=z}}}function $E(e,t,n){let r=null,s=0;for(;s<n.length;){const c=n[s];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===r&&(r=[]);const d=e[c];for(let _=0;_<d.length;_+=2)if(d[_]===t){r.push(c,d[_+1],n[s+1]);break}}s+=2}else s+=2;else s+=4}return r}function GE(e,t){const n=j(t,e);if(H(n)){const r=n[Ye];48&n[wt]?Pp(r,n,r.template,n[$n]):n[tr]>0&&$g(n)}}function $g(e){for(let r=zl(e);null!==r;r=Xu(r))for(let s=Hr;s<r.length;s++){const c=r[s];if(H(c))if(512&c[wt]){const d=c[Ye];Pp(d,c,d.template,c[$n])}else c[tr]>0&&$g(c)}const n=e[Ye].components;if(null!==n)for(let r=0;r<n.length;r++){const s=j(n[r],e);H(s)&&s[tr]>0&&$g(s)}}function qE(e,t){const n=j(t,e),r=n[Ye];(function WE(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Lg(r,n,n[$n])}function Rp(e,t){return e[Aa]?e[vc][Bn]=t:e[Aa]=t,e[vc]=t,t}function kp(e,t,n,r=!0){const s=t[io];s.begin&&s.begin();try{Pp(e,t,e.template,n)}catch(d){throw r&&function Qv(e,t){const n=e[xo],r=n?n.get(ph,null):null;r&&r.handleError(t)}(t,d),d}finally{s.end&&s.end()}}function Hg(e,t,n){Fa(0),t(e,n)}function Gg(e,t,n,r,s){for(let c=0;c<n.length;){const d=n[c++],_=n[c++],w=t[d],C=e.data[d];null!==C.setInput?C.setInput(w,s,r,_):w[_]=s}}function Lp(e,t,n){let r=n?e.styles:null,s=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?s=sl(s,_):2==c&&(r=sl(r,_+": "+t[++d]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=s:e.classesWithoutHost=s}function Fp(e,t,n,r,s=!1){for(;null!==n;){const c=t[n.index];if(null!==c&&r.push(b(c)),fi(c))for(let _=Hr;_<c.length;_++){const w=c[_],C=w[Ye].firstChild;null!==C&&Fp(w[Ye],w,C,r)}const d=n.type;if(8&d)Fp(e,t,n.child,r);else if(32&d){const _=xd(n,t);let w;for(;w=_();)r.push(w)}else if(16&d){const _=Id(t,n);if(Array.isArray(_))r.push(..._);else{const w=Ol(t[Xn]);Fp(w[Ye],w,_,r,!0)}}n=s?n.projectionNext:n.next}return r}class Nd{get rootNodes(){const t=this._lView,n=t[Ye];return Fp(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[$n]}set context(t){this._lView[$n]=t}get destroyed(){return 128==(128&this._lView[wt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Dn];if(fi(t)){const n=t[Pa],r=n?n.indexOf(this):-1;r>-1&&(Ku(t,r),To(n,r))}this._attachedToViewContainer=!1}Ed(this._lView[Ye],this._lView)}onDestroy(t){jv(this._lView[Ye],this._lView,null,t)}markForCheck(){!function jg(e){for(;e;){e[wt]|=32;const t=Ol(e);if(Eu(e)&&!t)return e;e=t}return null}(this._cdRefInjectingView||this._lView)}detach(){this._lView[wt]&=-65}reattach(){this._lView[wt]|=64}detectChanges(){kp(this._lView[Ye],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ze(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function wd(e,t){$l(e,t,t[Ft],2,null,null)}(this._lView[Ye],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ze(902,!1);this._appRef=t}}class ZE extends Nd{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;kp(t[Ye],t,t[$n],!1)}checkNoChanges(){}get context(){return null}}class e0 extends Od{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=cn(t);return new Bd(n,this.ngModule)}}function t0(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class KE{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=Mn(r);const s=this.injector.get(t,Sg,r);return s!==Sg||n===Sg?s:this.parentInjector.get(t,n,r)}}class Bd extends ha{get inputs(){return t0(this.componentDef.inputs)}get outputs(){return t0(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function tE(e){return e.map(eE).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,r,s){let c=(s=s||this.ngModule)instanceof Ts?s:s?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const d=c?new KE(t,c):t,_=d.get(xv,null);if(null===_)throw new ze(407,!1);const w=d.get(LD,null),C=_.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",z=r?function SE(e,t,n){return e.selectRootElement(t,n===jr.ShadowDom)}(C,r,this.componentDef.encapsulation):bd(C,M,function XE(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(M)),q=this.componentDef.onPush?288:272,te=Ng(0,null,null,1,0,null,null,null,null,null),le=Ap(null,te,null,q,null,null,_,C,w,d,null);let ve,Ce;Eo(le);try{const Te=this.componentDef;let qe,Ee=null;Te.findHostDirectiveDefs?(qe=[],Ee=new Map,Te.findHostDirectiveDefs(Te,qe,Ee),qe.push(Te)):qe=[Te];const lt=function JE(e,t){const n=e[Ye],r=Me;return e[r]=t,yh(n,r,2,"#host",null)}(le,z),Rt=function QE(e,t,n,r,s,c,d,_){const w=s[Ye];!function eC(e,t,n,r){for(const s of e)t.mergedAttrs=aa(t.mergedAttrs,s.hostAttrs);null!==t.mergedAttrs&&(Lp(t,t.mergedAttrs,!0),null!==n&&oh(r,n,t))}(r,e,t,d);const C=c.createRenderer(t,n),M=Ap(s,$v(n),null,n.onPush?32:16,s[e.index],e,c,C,_||null,null,null);return w.firstCreatePass&&Ug(w,e,r.length-1),Rp(s,M),s[e.index]=M}(lt,z,Te,qe,le,_,C);Ce=function O(e,t){return e.data[t]}(te,Me),z&&function nC(e,t,n,r){if(r)sa(e,n,["ng-version",FD.full]);else{const{attrs:s,classes:c}=function nE(e){const t=[],n=[];let r=1,s=2;for(;r<e.length;){let c=e[r];if("string"==typeof c)2===s?""!==c&&t.push(c,e[++r]):8===s&&n.push(c);else{if(!Ms(s))break;s=c}r++}return{attrs:t,classes:n}}(t.selectors[0]);s&&sa(e,n,s),c&&c.length>0&&Ad(e,n,c.join(" "))}}(C,Te,z,r),void 0!==n&&function rC(e,t,n){const r=e.projection=[];for(let s=0;s<t.length;s++){const c=n[s];r.push(null!=c?Array.from(c):null)}}(Ce,this.ngContentSelectors,n),ve=function tC(e,t,n,r,s,c){const d=Bt(),_=s[Ye],w=T(d,s);Wv(_,s,d,n,null,r);for(let M=0;M<n.length;M++)Wr(Io(s,_,d.directiveStart+M,d),s);Zv(_,s,d),w&&Wr(w,s);const C=Io(s,_,d.directiveStart+d.componentOffset,d);if(e[$n]=s[$n]=C,null!==c)for(const M of c)M(C,t);return Fg(_,d,e),C}(Rt,Te,qe,Ee,le,[iC]),Lg(te,le,null)}finally{Tu()}return new YE(this.componentType,ve,fh(Ce,le),le,Ce)}}class YE extends Sp{constructor(t,n,r,s,c){super(),this.location=r,this._rootLView=s,this._tNode=c,this.instance=n,this.hostView=this.changeDetectorRef=new ZE(s),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let s;if(null!==r&&(s=r[t])){const c=this._rootLView;Gg(c[Ye],c,s,t,n),function qv(e,t){const n=j(t,e);16&n[wt]||(n[wt]|=32)}(c,this._tNode.index)}}get injector(){return new Al(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function iC(){const e=Bt();jn(he()[Ye],e)}function Xg(e,t,n,r,s){const d=s?"class":"style";Gg(e,n,t.inputs[d],d,r)}function Kg(e,t,n,r){const s=he(),c=Ke(),d=Me+e,_=s[Ft],w=c.firstCreatePass?function wC(e,t,n,r,s,c){const d=t.consts,w=yh(t,e,2,r,oe(d,s));return function Bg(e,t,n,r){if(be()){const s=null===r?null:{"":-1},c=function FE(e,t){const n=e.directiveRegistry;let r=null,s=null;if(n)for(let c=0;c<n.length;c++){const d=n[c];if(Cv(t,d.selectors,!1))if(r||(r=[]),mr(d))if(null!==d.findHostDirectiveDefs){const _=[];s=s||new Map,d.findHostDirectiveDefs(d,_,s),r.unshift(..._,d),Ug(e,t,_.length)}else r.unshift(d),Ug(e,t,0);else s=s||new Map,d.findHostDirectiveDefs?.(d,r,s),r.push(d)}return null===r?null:[r,s]}(e,n);let d,_;null===c?d=_=null:[d,_]=c,null!==d&&Wv(e,t,n,d,s,_),s&&function OE(e,t,n){if(t){const r=e.localNames=[];for(let s=0;s<t.length;s+=2){const c=n[t[s+1]];if(null==c)throw new ze(-301,!1);r.push(t[s],c)}}}(n,r,s)}n.mergedAttrs=aa(n.mergedAttrs,n.attrs)}(t,n,w,oe(d,c)),null!==w.attrs&&Lp(w,w.attrs,!1),null!==w.mergedAttrs&&Lp(w,w.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,w),w}(d,c,s,t,n,r):c.data[d],C=s[d]=bd(_,t,function jm(){return J.lFrame.currentNamespace}()),M=function Tr(e){return 1==(1&e.flags)}(w);return Ht(w,!0),oh(_,C,w),32!=(32&w.flags)&&th(c,s,C,w),0===function _e(){return J.lFrame.elementDepthCount}()&&Wr(C,s),function Ae(){J.lFrame.elementDepthCount++}(),M&&(function Og(e,t,n){be()&&(function kE(e,t,n,r){const s=n.directiveStart,c=n.directiveEnd;ps(n)&&function UE(e,t,n){const r=T(t,e),s=$v(n),c=e[io],d=Rp(e,Ap(e,s,null,n.onPush?32:16,r,t,c,c.createRenderer(r,n),null,null,null));e[t.index]=d}(t,n,e.data[s+n.componentOffset]),e.firstCreatePass||Ac(n,t),Wr(r,t);const d=n.initialInputs;for(let _=s;_<c;_++){const w=e.data[_],C=Io(t,e,_,n);Wr(C,t),null!==d&&VE(0,_-s,C,w,0,d),mr(w)&&(j(n.index,t)[$n]=Io(t,e,_,n))}}(e,t,n,T(n,t)),64==(64&n.flags)&&Zv(e,t,n))}(c,s,w),Fg(c,w,s)),null!==r&&function zg(e,t,n=T){const r=t.localNames;if(null!==r){let s=t.index+1;for(let c=0;c<r.length;c+=2){const d=r[c+1],_=-1===d?n(t,e):e[d];e[s++]=_}}}(s,w),Kg}function Yg(){let e=Bt();cr()?function Gr(){J.lFrame.isParent=!1}():(e=e.parent,Ht(e,!1));const t=e;!function Re(){J.lFrame.elementDepthCount--}();const n=Ke();return n.firstCreatePass&&(jn(n,e),Ra(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function qm(e){return 0!=(8&e.flags)}(t)&&Xg(n,t,he(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function nd(e){return 0!=(16&e.flags)}(t)&&Xg(n,t,he(),t.stylesWithoutHost,!1),Yg}function Np(e,t,n,r){return Kg(e,t,n,r),Yg(),Np}function Bp(e){return!!e&&"function"==typeof e.then}const x0=function v0(e){return!!e&&"function"==typeof e.subscribe},Mh="en-US";let yx=Mh;class Ah{}class jx{}class Hx extends Ah{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new e0(this);const r=ii(t);this._bootstrapComponents=Za(r.bootstrap),this._r3Injector=Rv(t,n,[{provide:Ah,useValue:this},{provide:Od,useValue:this.componentFactoryResolver}],yn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class fy extends jx{constructor(t){super(),this.moduleType=t}create(t){return new Hx(this.moduleType,t)}}class _I extends Ah{constructor(t,n,r){super(),this.componentFactoryResolver=new e0(this),this.instance=null;const s=new Cp([...t,{provide:Ah,useValue:this},{provide:Od,useValue:this.componentFactoryResolver}],n||dh(),r,new Set(["environment"]));this.injector=s,s.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function qp(e,t,n=null){return new _I(e,t,n).injector}let vI=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=zi(0,n.type),s=r.length>0?qp([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,s)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=it({token:e,providedIn:"environment",factory:()=>new e(Fe(Ts))}),e})();function Gx(e){e.getStandaloneInjector=t=>t.get(vI).getOrCreateStandaloneInjector(e)}function my(e){return t=>{setTimeout(e,void 0,t)}}const Ki=class GI extends $r{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let s=t,c=n||(()=>null),d=r;if(t&&"object"==typeof t){const w=t;s=w.next?.bind(w),c=w.error?.bind(w),d=w.complete?.bind(w)}this.__isAsync&&(c=my(c),s&&(s=my(s)),d&&(d=my(d)));const _=super.subscribe({next:s,error:c,complete:d});return t instanceof pn&&t.add(_),_}};function qI(){return this._results[Symbol.iterator]()}class gy{get changes(){return this._changes||(this._changes=new Ki)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=gy.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=qI)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const s=function so(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function eg(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],c=t[r];if(n&&(s=n(s),c=n(c)),c!==s)return!1}return!0}(r._results,s,n))&&(r._results=s,r.length=s.length,r.last=s[this.length-1],r.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Ka=(()=>{class e{}return e.__NG_ELEMENT_ID__=XI,e})();const WI=Ka,ZI=class extends WI{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,s=Ap(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);s[je]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[si];return null!==d&&(s[si]=d.createEmbeddedView(r)),Lg(r,s,t),new Nd(s)}};function XI(){return Wp(Bt(),he())}function Wp(e,t){return 4&e.type?new ZI(t,e,fh(e,t)):null}let Rs=(()=>{class e{}return e.__NG_ELEMENT_ID__=KI,e})();function KI(){return ob(Bt(),he())}const YI=Rs,rb=class extends YI{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return fh(this._hostTNode,this._hostLView)}get injector(){return new Al(this._hostTNode,this._hostLView)}get parentInjector(){const t=mi(this._hostTNode,this._hostLView);if(Lf(t)){const n=Tl(t,this._hostLView),r=Au(t);return new Al(n[Ye].data[r+8],n)}return new Al(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=ib(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-Hr}createEmbeddedView(t,n,r){let s,c;"number"==typeof r?s=r:null!=r&&(s=r.index,c=r.injector);const d=t.createEmbeddedView(n||{},c);return this.insert(d,s),d}createComponent(t,n,r,s,c){const d=t&&!function Na(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const z=n||{};_=z.index,r=z.injector,s=z.projectableNodes,c=z.environmentInjector||z.ngModuleRef}const w=d?t:new Bd(cn(t)),C=r||this.parentInjector;if(!c&&null==w.ngModule){const q=(d?C:this.parentInjector).get(Ts,null);q&&(c=q)}const M=w.create(C,s,void 0,c);return this.insert(M.hostView,_),M}insert(t,n){const r=t._lView,s=r[Ye];if(function X(e){return fi(e[Dn])}(r)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const z=r[Dn],q=new rb(z,z[Fr],z[Dn]);q.detach(q.indexOf(t))}}const c=this._adjustIndex(n),d=this._lContainer;!function Dd(e,t,n,r){const s=Hr+r,c=n.length;r>0&&(n[s-1][Bn]=t),r<c-Hr?(t[Bn]=n[s],Wf(n,Hr+r,t)):(n.push(t),t[Bn]=null),t[Dn]=n;const d=t[je];null!==d&&n!==d&&function xg(e,t){const n=e[fs];t[Xn]!==t[Dn][Dn][Xn]&&(e[Du]=!0),null===n?e[fs]=[t]:n.push(t)}(d,t);const _=t[si];null!==_&&_.insertView(e),t[wt]|=64}(s,r,d,c);const _=Ln(c,d),w=r[Ft],C=Vl(w,d[qo]);return null!==C&&function Bl(e,t,n,r,s,c){r[oi]=s,r[Fr]=t,$l(e,r,n,1,s,c)}(s,d[Fr],w,r,C,_),t.attachToViewContainerRef(),Wf(yy(d),c,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=ib(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=Ku(this._lContainer,n);r&&(To(yy(this._lContainer),n),Ed(r[Ye],r))}detach(t){const n=this._adjustIndex(t,-1),r=Ku(this._lContainer,n);return r&&null!=To(yy(this._lContainer),n)?new Nd(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function ib(e){return e[Pa]}function yy(e){return e[Pa]||(e[Pa]=[])}function ob(e,t){let n;const r=t[e.index];if(fi(r))n=r;else{let s;if(8&e.type)s=b(r);else{const c=t[Ft];s=c.createComment("");const d=T(e,t);Ga(c,Vl(c,d),s,function pp(e,t){return e.nextSibling(t)}(c,d),!1)}t[e.index]=n=function Xv(e,t,n,r){return[e,!0,!1,t,null,0,r,n,null,null]}(r,t,s,e),Rp(t,n)}return new rb(n,e,t)}class _y{constructor(t){this.queryList=t,this.matches=null}clone(){return new _y(this.queryList)}setDirty(){this.queryList.setDirty()}}class vy{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,s=[];for(let c=0;c<r;c++){const d=n.getByIndex(c);s.push(this.queries[d.indexInDeclarationView].clone())}return new vy(s)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==db(t,n).matches&&this.queries[n].setDirty()}}class sb{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class xy{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const s=null!==n?n.length:0,c=this.getByIndex(r).embeddedTView(t,s);c&&(c.indexInDeclarationView=r,null!==n?n.push(c):n=[c])}return null!==n?new xy(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class by{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new by(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){const c=r[s];this.matchTNodeWithReadOption(t,n,JI(n,c)),this.matchTNodeWithReadOption(t,n,So(n,t,c,!1,!1))}else r===Ka?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,So(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const s=this.metadata.read;if(null!==s)if(s===ql||s===Rs||s===Ka&&4&n.type)this.addMatch(n.index,-2);else{const c=So(n,t,s,!1,!1);null!==c&&this.addMatch(n.index,c)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function JI(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function eT(e,t,n,r){return-1===n?function QI(e,t){return 11&e.type?fh(e,t):4&e.type?Wp(e,t):null}(t,e):-2===n?function tT(e,t,n){return n===ql?fh(t,e):n===Ka?Wp(t,e):n===Rs?ob(t,e):void 0}(e,t,r):Io(e,e[Ye],n,t)}function ab(e,t,n,r){const s=t[si].queries[r];if(null===s.matches){const c=e.data,d=n.matches,_=[];for(let w=0;w<d.length;w+=2){const C=d[w];_.push(C<0?null:eT(t,c[C],d[w+1],n.metadata.read))}s.matches=_}return s.matches}function wy(e,t,n,r){const s=e.queries.getByIndex(n),c=s.matches;if(null!==c){const d=ab(e,t,s,n);for(let _=0;_<c.length;_+=2){const w=c[_];if(w>0)r.push(d[_/2]);else{const C=c[_+1],M=t[-w];for(let z=Hr;z<M.length;z++){const q=M[z];q[je]===q[Dn]&&wy(q[Ye],q,C,r)}if(null!==M[fs]){const z=M[fs];for(let q=0;q<z.length;q++){const te=z[q];wy(te[Ye],te,C,r)}}}}}return r}function Dy(e){const t=he(),n=Ke(),r=La();Fa(r+1);const s=db(n,r);if(e.dirty&&function K(e){return 4==(4&e[wt])}(t)===(2==(2&s.metadata.flags))){if(null===s.matches)e.reset([]);else{const c=s.crossesNgTemplate?wy(n,t,r,[]):ab(n,t,s,r);e.reset(c,RD),e.notifyOnChanges()}return!0}return!1}function lb(e,t,n){const r=Ke();r.firstCreatePass&&(function hb(e,t,n){null===e.queries&&(e.queries=new xy),e.queries.track(new by(t,n))}(r,new sb(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function ub(e,t,n){const r=new gy(4==(4&n));jv(e,t,r,r.destroy),null===t[si]&&(t[si]=new vy),t[si].queries.push(new _y(r))}(r,he(),t)}function db(e,t){return e.queries.getByIndex(t)}function Xp(...e){}const Kp=new mt("Application Initializer");let Yp=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Xp,this.reject=Xp,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,s)=>{this.resolve=r,this.reject=s})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const c=this.appInits[s]();if(Bp(c))n.push(c);else if(x0(c)){const d=new Promise((_,w)=>{c.subscribe({complete:_,error:w})});n.push(d)}}Promise.all(n).then(()=>{r()}).catch(s=>{this.reject(s)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Fe(Kp,8))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Kd=new mt("AppId",{providedIn:"root",factory:function Ab(){return`${Ay()}${Ay()}${Ay()}`}});function Ay(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Pb=new mt("Platform Initializer"),Rb=new mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),kb=new mt("appBootstrapListener");let ET=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Ya=new mt("LocaleId",{providedIn:"root",factory:()=>ot(Ya,ft.Optional|ft.SkipSelf)||function CT(){return typeof $localize<"u"&&$localize.locale||Mh}()});class IT{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Lb=(()=>{class e{compileModuleSync(n){return new fy(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),c=Za(ii(n).declarations).reduce((d,_)=>{const w=cn(_);return w&&d.push(new Bd(w)),d},[]);return new IT(r,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const AT=(()=>Promise.resolve(0))();function Py(e){typeof Zone>"u"?AT.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class br{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ki(!1),this.onMicrotaskEmpty=new Ki(!1),this.onStable=new Ki(!1),this.onError=new Ki(!1),typeof Zone>"u")throw new ze(908,!1);Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&n,s.shouldCoalesceRunChangeDetection=r,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function PT(){let e=xn.requestAnimationFrame,t=xn.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function LT(e){const t=()=>{!function kT(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(xn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,ky(e),e.isCheckStableRunning=!0,Ry(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),ky(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,s,c,d,_)=>{try{return zb(e),n.invokeTask(s,c,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),Nb(e)}},onInvoke:(n,r,s,c,d,_,w)=>{try{return zb(e),n.invoke(s,c,d,_,w)}finally{e.shouldCoalesceRunChangeDetection&&t(),Nb(e)}},onHasTask:(n,r,s,c)=>{n.hasTask(s,c),r===s&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,ky(e),Ry(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(n,r,s,c)=>(n.handleError(s,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(s)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!br.isInAngularZone())throw new ze(909,!1)}static assertNotInAngularZone(){if(br.isInAngularZone())throw new ze(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,s){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+s,t,RT,Xp,Xp);try{return c.runTask(d,n,r)}finally{c.cancelTask(d)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const RT={};function Ry(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function ky(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function zb(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Nb(e){e._nesting--,Ry(e)}class FT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ki,this.onMicrotaskEmpty=new Ki,this.onStable=new Ki,this.onError=new Ki}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,s){return t.apply(n,r)}}const Bb=new mt(""),Jp=new mt("");let Oy,Ly=(()=>{class e{constructor(n,r,s){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Oy||(function OT(e){Oy=e}(s),s.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{br.assertNotInAngularZone(),Py(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Py(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,s){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==c),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:c,updateCb:s})}whenStable(n,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,s){return[]}}return e.\u0275fac=function(n){return new(n||e)(Fe(br),Fe(Fy),Fe(Jp))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})(),Fy=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return Oy?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Zl=null;const Ub=new mt("AllowMultipleToken"),zy=new mt("PlatformDestroyListeners"),Ja=!1;class Vb{constructor(t,n){this.name=t,this.token=n}}function jb(e,t,n=[]){const r=`Platform: ${t}`,s=new mt(r);return(c=[])=>{let d=Ny();if(!d||d.injector.get(Ub,!1)){const _=[...n,...c,{provide:s,useValue:!0}];e?e(_):function BT(e){if(Zl&&!Zl.get(Ub,!1))throw new ze(400,!1);Zl=e;const t=e.get(Gb);(function $b(e){const t=e.get(Pb,null);t&&t.forEach(n=>n())})(e)}(function Hb(e=[],t){return da.create({name:t,providers:[{provide:uh,useValue:"platform"},{provide:zy,useValue:new Set([()=>Zl=null])},...e]})}(_,r))}return function VT(e){const t=Ny();if(!t)throw new ze(401,!1);return t}()}}function Ny(){return Zl?.get(Gb)??null}let Gb=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const s=function Wb(e,t){let n;return n="noop"===e?new FT:("zone.js"===e?void 0:e)||new br(t),n}(r?.ngZone,function qb(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),c=[{provide:br,useValue:s}];return s.run(()=>{const d=da.create({providers:c,parent:this.injector,name:n.moduleType.name}),_=n.create(d),w=_.injector.get(ph,null);if(!w)throw new ze(402,!1);return s.runOutsideAngular(()=>{const C=s.onError.subscribe({next:M=>{w.handleError(M)}});_.onDestroy(()=>{em(this._modules,_),C.unsubscribe()})}),function Zb(e,t,n){try{const r=n();return Bp(r)?r.catch(s=>{throw t.runOutsideAngular(()=>e.handleError(s)),s}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(w,s,()=>{const C=_.injector.get(Yp);return C.runInitializers(),C.donePromise.then(()=>(function _x(e){St(e,"Expected localeId to be defined"),"string"==typeof e&&(yx=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(Ya,Mh)||Mh),this._moduleDoBootstrap(_),_))})})}bootstrapModule(n,r=[]){const s=Xb({},r);return function zT(e,t,n){const r=new fy(n);return Promise.resolve(r)}(0,0,n).then(c=>this.bootstrapModuleFactory(c,s))}_moduleDoBootstrap(n){const r=n.injector.get(Qp);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!n.instance.ngDoBootstrap)throw new ze(-403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ze(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(zy,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Fe(da))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function Xb(e,t){return Array.isArray(t)?t.reduce(Xb,e):{...e,...t}}let Qp=(()=>{class e{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(n,r,s){this._zone=n,this._injector=r,this._exceptionHandler=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const c=new rn(_=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{_.next(this._stable),_.complete()})}),d=new rn(_=>{let w;this._zone.runOutsideAngular(()=>{w=this._zone.onStable.subscribe(()=>{br.assertNotInAngularZone(),Py(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,_.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{br.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{_.next(!1)}))});return()=>{w.unsubscribe(),C.unsubscribe()}});this.isStable=function ic(...e){const t=Xe(e),n=function at(e,t){return"number"==typeof We(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?ni(r[0]):ne(n)(Zn(r,t)):re}(c,d.pipe(function gn(e={}){const{connector:t=(()=>new $r),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:s=!0}=e;return c=>{let d,_,w,C=0,M=!1,z=!1;const q=()=>{_?.unsubscribe(),_=void 0},te=()=>{q(),d=w=void 0,M=z=!1},le=()=>{const ve=d;te(),ve?.unsubscribe()};return wn((ve,Ce)=>{C++,!z&&!M&&q();const Te=w=w??t();Ce.add(()=>{C--,0===C&&!z&&!M&&(_=oc(le,s))}),Te.subscribe(Ce),!d&&C>0&&(d=new Yn({next:qe=>Te.next(qe),error:qe=>{z=!0,q(),_=oc(te,n,qe),Te.error(qe)},complete:()=>{M=!0,q(),_=oc(te,r),Te.complete()}}),ni(ve).subscribe(d))})(c)}}()))}bootstrap(n,r){const s=n instanceof ha;if(!this._injector.get(Yp).done){!s&&function ds(e){const t=cn(e)||er(e)||Lr(e);return null!==t&&t.standalone}(n);throw new ze(405,Ja)}let d;d=s?n:this._injector.get(Od).resolveComponentFactory(n),this.componentTypes.push(d.componentType);const _=function NT(e){return e.isBoundToModule}(d)?void 0:this._injector.get(Ah),C=d.create(da.NULL,[],r||d.selector,_),M=C.location.nativeElement,z=C.injector.get(Bb,null);return z?.registerApplication(M),C.onDestroy(()=>{this.detachView(C.hostView),em(this.components,C),z?.unregisterApplication(M)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new ze(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;em(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(kb,[]);r.push(...this._bootstrapListeners),r.forEach(s=>s(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>em(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new ze(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Fe(br),Fe(Ts),Fe(ph))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function em(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let By=(()=>{class e{}return e.__NG_ELEMENT_ID__=jT,e})();function jT(e){return function HT(e,t,n){if(ps(e)&&!n){const r=j(e.index,t);return new Nd(r,r)}return 47&e.type?new Nd(t[Xn],t):null}(Bt(),he(),16==(16&e))}const rM=jb(null,"core",[]);let iM=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Fe(Qp))},e.\u0275mod=Ho({type:e}),e.\u0275inj=no({}),e})(),Gy=null;function nu(){return Gy}class aM{}const uo=new mt("DocumentToken");let qy=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return function lM(){return Fe(sw)}()},providedIn:"platform"}),e})();const cM=new mt("Location Initialized");let sw=(()=>{class e extends qy{constructor(n){super(),this._doc=n,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return nu().getBaseHref(this._doc)}onPopState(n){const r=nu().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=nu().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,s){aw()?this._history.pushState(n,r,s):this._location.hash=s}replaceState(n,r,s){aw()?this._history.replaceState(n,r,s):this._location.hash=s}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Fe(uo))},e.\u0275prov=it({token:e,factory:function(){return function uM(){return new sw(Fe(uo))}()},providedIn:"platform"}),e})();function aw(){return!!window.history.pushState}function Wy(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function lw(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Qa(e){return e&&"?"!==e[0]?"?"+e:e}let ru=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return ot(uw)},providedIn:"root"}),e})();const cw=new mt("appBaseHref");let uw=(()=>{class e extends ru{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ot(uo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Wy(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Qa(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${r}${s}`:r}pushState(n,r,s,c){const d=this.prepareExternalUrl(s+Qa(c));this._platformLocation.pushState(n,r,d)}replaceState(n,r,s,c){const d=this.prepareExternalUrl(s+Qa(c));this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Fe(qy),Fe(cw,8))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),hM=(()=>{class e extends ru{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=Wy(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,s,c){let d=this.prepareExternalUrl(s+Qa(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(n,r,d)}replaceState(n,r,s,c){let d=this.prepareExternalUrl(s+Qa(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Fe(qy),Fe(cw,8))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})(),Zy=(()=>{class e{constructor(n){this._subject=new Ki,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function pM(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(lw(hw(r))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Qa(r))}normalize(n){return e.stripTrailingSlash(function fM(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,hw(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",s=null){this._locationStrategy.pushState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qa(r)),s)}replaceState(n,r="",s=null){this._locationStrategy.replaceState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qa(r)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(s=>s(n,r))}subscribe(n,r,s){return this._subject.subscribe({next:n,error:r,complete:s})}}return e.normalizeQueryParams=Qa,e.joinWithSlash=Wy,e.stripTrailingSlash=lw,e.\u0275fac=function(n){return new(n||e)(Fe(ru))},e.\u0275prov=it({token:e,factory:function(){return function dM(){return new Zy(Fe(ru))}()},providedIn:"root"}),e})();function hw(e){return e.replace(/\/index.html$/,"")}let MA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ho({type:e}),e.\u0275inj=no({}),e})();let kA=(()=>{class e{}return e.\u0275prov=it({token:e,providedIn:"root",factory:()=>new LA(Fe(uo),window)}),e})();class LA{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function FA(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let s=r.currentNode;for(;s;){const c=s.shadowRoot;if(c){const d=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(d)return d}s=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,s=n.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],s-c[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Tw(this.window.history)||Tw(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Tw(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class c2 extends aM{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class h_ extends c2{static makeCurrent(){!function sM(e){Gy||(Gy=e)}(new h_)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function u2(){return tf=tf||document.querySelector("base"),tf?tf.getAttribute("href"):null}();return null==n?null:function h2(e){mm=mm||document.createElement("a"),mm.setAttribute("href",e);const t=mm.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){tf=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function YM(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[s,c]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(s.trim()===t)return decodeURIComponent(c)}return null}(document.cookie,t)}}let mm,tf=null;const kw=new mt("TRANSITION_ID"),f2=[{provide:Kp,useFactory:function d2(e,t,n){return()=>{n.get(Yp).donePromise.then(()=>{const r=nu(),s=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let c=0;c<s.length;c++)r.remove(s[c])})}},deps:[kw,uo,da],multi:!0}];let m2=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();const gm=new mt("EventManagerPlugins");let ym=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(s=>s.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,s){return this._findPluginFor(r).addEventListener(n,r,s)}addGlobalEventListener(n,r,s){return this._findPluginFor(r).addGlobalEventListener(n,r,s)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const s=this._plugins;for(let c=0;c<s.length;c++){const d=s[c];if(d.supports(n))return this._eventNameToPlugin.set(n,d),d}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Fe(gm),Fe(br))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();class Lw{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const s=nu().getGlobalEventTarget(this._doc,t);if(!s)throw new Error(`Unsupported event target ${s} for event ${n}`);return this.addEventListener(s,n,r)}}let Fw=(()=>{class e{constructor(){this.usageCount=new Map}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(n){}onStyleAdded(n){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(n,r){const s=this.usageCount;let c=s.get(n)??0;return c+=r,c>0?s.set(n,c):s.delete(n),c}ngOnDestroy(){for(const n of this.getAllStyles())this.onStyleRemoved(n);this.usageCount.clear()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})(),nf=(()=>{class e extends Fw{constructor(n){super(),this.doc=n,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.forEach(c=>c.remove()),r.delete(n)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}addStyleToHost(n,r){const s=this.doc.createElement("style");s.textContent=r,n.appendChild(s);const c=this.styleRef.get(r);c?c.push(s):this.styleRef.set(r,[s])}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(Fe(uo))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();const d_={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},f_=/%COMP%/g,Nw=new mt("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function Bw(e,t){return t.flat(100).map(n=>n.replace(f_,e))}function Uw(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let p_=(()=>{class e{constructor(n,r,s,c){this.eventManager=n,this.sharedStylesHost=r,this.appId=s,this.removeStylesOnCompDestory=c,this.rendererByCompId=new Map,this.defaultRenderer=new m_(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;const s=this.getOrCreateRenderer(n,r);return s instanceof jw?s.applyToHost(n):s instanceof g_&&s.applyStyles(),s}getOrCreateRenderer(n,r){const s=this.rendererByCompId;let c=s.get(r.id);if(!c){const d=this.eventManager,_=this.sharedStylesHost,w=this.removeStylesOnCompDestory;switch(r.encapsulation){case jr.Emulated:c=new jw(d,_,r,this.appId,w);break;case jr.ShadowDom:return new w2(d,_,n,r);default:c=new g_(d,_,r,w)}c.onDestroy=()=>s.delete(r.id),s.set(r.id,c)}return c}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Fe(ym),Fe(nf),Fe(Kd),Fe(Nw))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();class m_{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(d_[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){($w(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&($w(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,s){if(s){n=s+":"+n;const c=d_[s];c?t.setAttributeNS(c,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const s=d_[r];s?t.removeAttributeNS(s,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,s){s&(Fi.DashCase|Fi.Important)?t.style.setProperty(n,r,s&Fi.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&Fi.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,Uw(r)):this.eventManager.addEventListener(t,n,Uw(r))}}function $w(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class w2 extends m_{constructor(t,n,r,s){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=Bw(s.id,s.styles);for(const d of c){const _=document.createElement("style");_.textContent=d,this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class g_ extends m_{constructor(t,n,r,s,c=r.id){super(t),this.sharedStylesHost=n,this.removeStylesOnCompDestory=s,this.rendererUsageCount=0,this.styles=Bw(c,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class jw extends g_{constructor(t,n,r,s,c){const d=s+"-"+r.id;super(t,n,r,c,d),this.contentAttr=function v2(e){return"_ngcontent-%COMP%".replace(f_,e)}(d),this.hostAttr=function x2(e){return"_nghost-%COMP%".replace(f_,e)}(d)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}let D2=(()=>{class e extends Lw{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,s){return n.addEventListener(r,s,!1),()=>this.removeEventListener(n,r,s)}removeEventListener(n,r,s){return n.removeEventListener(r,s)}}return e.\u0275fac=function(n){return new(n||e)(Fe(uo))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();const Hw=["alt","control","meta","shift"],E2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},C2={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let S2=(()=>{class e extends Lw{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,s){const c=e.parseEventName(r),d=e.eventCallback(c.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>nu().onAndCancel(n,c.domEventName,d))}static parseEventName(n){const r=n.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const c=e._normalizeKey(r.pop());let d="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),d="code."),Hw.forEach(C=>{const M=r.indexOf(C);M>-1&&(r.splice(M,1),d+=C+".")}),d+=c,0!=r.length||0===c.length)return null;const w={};return w.domEventName=s,w.fullKey=d,w}static matchEventFullKeyCode(n,r){let s=E2[n.key]||n.key,c="";return r.indexOf("code.")>-1&&(s=n.code,c="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),Hw.forEach(d=>{d!==s&&(0,C2[d])(n)&&(c+=d+".")}),c+=s,c===r)}static eventCallback(n,r,s){return c=>{e.matchEventFullKeyCode(c,n)&&s.runGuarded(()=>r(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Fe(uo))},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();const A2=jb(rM,"browser",[{provide:Rb,useValue:"browser"},{provide:Pb,useValue:function I2(){h_.makeCurrent()},multi:!0},{provide:uo,useFactory:function M2(){return function wp(e){sh=e}(document),document},deps:[]}]),Ww=new mt(""),Zw=[{provide:Jp,useClass:class p2{addToWindow(t){xn.getAngularTestability=(r,s=!0)=>{const c=t.findTestabilityInTree(r,s);if(null==c)throw new Error("Could not find testability for element.");return c},xn.getAllAngularTestabilities=()=>t.getAllTestabilities(),xn.getAllAngularRootElements=()=>t.getAllRootElements(),xn.frameworkStabilizers||(xn.frameworkStabilizers=[]),xn.frameworkStabilizers.push(r=>{const s=xn.getAllAngularTestabilities();let c=s.length,d=!1;const _=function(w){d=d||w,c--,0==c&&r(d)};s.forEach(function(w){w.whenStable(_)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?nu().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:Bb,useClass:Ly,deps:[br,Fy,Jp]},{provide:Ly,useClass:Ly,deps:[br,Fy,Jp]}],Xw=[{provide:uh,useValue:"root"},{provide:ph,useFactory:function T2(){return new ph},deps:[]},{provide:gm,useClass:D2,multi:!0,deps:[uo,br,Rb]},{provide:gm,useClass:S2,multi:!0,deps:[uo]},{provide:p_,useClass:p_,deps:[ym,nf,Kd,Nw]},{provide:xv,useExisting:p_},{provide:Fw,useExisting:nf},{provide:nf,useClass:nf,deps:[uo]},{provide:ym,useClass:ym,deps:[gm,br]},{provide:class OA{},useClass:m2,deps:[]},[]];let P2=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Kd,useValue:n.appId},{provide:kw,useExisting:Kd},f2]}}}return e.\u0275fac=function(n){return new(n||e)(Fe(Ww,12))},e.\u0275mod=Ho({type:e}),e.\u0275inj=no({providers:[...Xw,...Zw],imports:[MA,iM]}),e})(),Kw=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Fe(uo))},e.\u0275prov=it({token:e,factory:function(n){let r=null;return r=n?new n:function k2(){return new Kw(Fe(uo))}(),r},providedIn:"root"}),e})();function Qw(e,t,n,r,s,c,d){try{var _=e[c](d),w=_.value}catch(C){return void n(C)}_.done?t(w):Promise.resolve(w).then(r,s)}function iu(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var c=e.apply(t,n);function d(w){Qw(c,r,s,d,_,"next",w)}function _(w){Qw(c,r,s,d,_,"throw",w)}d(void 0)})}}typeof window<"u"&&window;var Kl=ar(943);class e1{constructor(){this.callbacks={}}fire(t,n){this.getEventCallbacks(t).forEach(r=>{try{r(n)}catch(s){console.error(s)}})}on(t,n){this.callbacks[t]=[...this.getEventCallbacks(t),n]}off(t,n){this.callbacks[t]=this.getEventCallbacks(t).filter(r=>r!==n)}getEventCallbacks(t){return this.callbacks[t]||[]}}function t1(e,t){return e.lat===t.lat&&e.lng===t.lng}class _m{static isChanged(t){return!this.isPositionChanged(t)||!this.isMappedPositionChanged(t)}static isPositionChanged(t){return!t1(t.originalPosition,t.position)}static isMappedPositionChanged(t){return!!t.originalMappedPosition&&!!t.mappedPosition&&!t1(t.originalMappedPosition,t.mappedPosition)}static fromWaypoint(t,n){return{index:n.index,originalPosition:t.position,position:t.position,originalMappedPosition:t.mappedPosition,mappedPosition:t.mappedPosition,properties:{...n,...t.properties||{}}}}}function ou(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function tl(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function b_(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}class W2{get options(){return this._options}get data(){return this._state.data}get state(){return this._state}get dataProvider(){return this.options.dataProvider}get selectedRouteId(){return this._state.selectedRouteId}get waypoints(){return this._state.waypoints}constructor(t){this.dispatcher=new e1,this._plugins=[],this._initialState={waypoints:[],data:void 0,loading:!1,selectedRouteId:void 0,mode:"default",routesShapeGeojson:void 0},this._state={...this._initialState},this._options={uniqueKey:(Math.random()+1).toString(36).substring(7),...t},this._plugins=t.plugins??[]}initialize(){this.initPlugins()}onRemove(){this.detachPlugins(),this.options.dataProvider?.destroy()}setMode(t){this._patchState({mode:t})}setWaypoints(t){const n=this.transformToInternalWaypoints(t);this._patchState({waypoints:n}),this.fire("waypointsChanged",{waypoints:this.state.waypoints})}getWaypoint(t){return this._state.waypoints[t]}recalculateRoute(t={}){var n=this;return iu(function*(){if(n.waypoints.length<2)return;if(!n.options.dataProvider)throw new Error("No data provider");n.fire("calculationStarted",{mode:n.state.mode,waypoints:n.waypoints,recalculateOptions:t}),t.dropPendingRequests&&(yield n.options.dataProvider.abortAllRequests());let r={};n._state.loading||(r={...r,loading:!0}),n._patchState(r),"loading"in r&&n.fire("loadingChanged",{loading:!0});try{const s=yield n.options.dataProvider.request(n._state.waypoints,{mode:n.state.mode});let c={data:s,selectedRouteId:s.selectedRouteId,routesShapeGeojson:s.routesShapeGeojson},d=!1;if(!1!==t.syncWaypoints&&"toPath"===n.options.waypointsSyncStrategy){const _=n.syncWaypointsPositions(s.routes[0].waypoints);c={...c,waypoints:_},d=!0}return n._patchState(c),n.fire("routesFound",{mode:n.state.mode,waypoints:n._state.waypoints,data:s,recalculateOptions:t}),d&&n.fire("waypointsChanged",{waypoints:n.state.waypoints}),n._state.data}catch(s){throw n.fire("calculationError",{error:s,recalculateOptions:t}),s}finally{n._state.loading&&(n.data?.latest||!(yield n.dataProvider.hasPendingRequests()))&&(n._patchState({loading:!1}),n.fire("loadingChanged",{loading:!1}))}})()}on(t,n){this.dispatcher.on(t,n)}off(t,n){this.dispatcher.off(t,n)}selectRoute(t){if(!this.data)return;const n=this.data.routesShapeGeojson.features.map(r=>({...r,properties:{...r.properties,selected:r.properties.routeId===t}}));this._patchState({selectedRouteId:t,data:{...this._state.data,routesShapeGeojson:tl(n),selectedRouteId:t},routesShapeGeojson:tl(n)}),this.fire("routeSelected",{route:this.data.routes[t],routeId:t})}reset(){this._setState({...this._initialState},"external")}getUniqueName(t){return`${t}-${this.options.uniqueKey}`}syncWaypointsPositions(t){return t.map((r,s)=>({...this._state.waypoints[s],position:this._state.waypoints[s].position,mappedPosition:r,properties:this._state.waypoints[s].properties}))}setState({waypoints:t,data:n,routesShapeGeojson:r,selectedRouteId:s}){let c={...this._state};if(t){const d=this.transformToInternalWaypoints(t);c={...c,waypoints:d}}r&&(c={...c,routesShapeGeojson:r}),n&&(c={...c,data:n,routesShapeGeojson:n.routesShapeGeojson}),null!=s&&(c={...c,selectedRouteId:s}),(n||t||r||null!=s)&&this._setState(c,"external")}initPlugins(){this._plugins.forEach(t=>this.resolvePlugin(t).onAdd(this))}detachPlugins(){this._plugins.forEach(t=>this.resolvePlugin(t).onRemove(this))}resolvePlugin(t){return"function"==typeof t?new t({}):t}_setState(t,n="internal",r){this._state=t,this.fire("stateUpdated",{source:n,updatedProperties:r??Object.keys(this.state)})}_patchState(t,n="internal"){0!==Object.keys(t).length&&this._setState({...this._state,...t},n,Object.keys(t))}transformToInternalWaypoints(t){return t.map((n,r)=>_m.fromWaypoint(n,{index:r,isFirst:0===r,isLast:r===t.length-1}))}fire(t,n){this.dispatcher.fire(t,{...n,state:this.state,eventName:t})}}class Z2{constructor(t){this.response=t,this.code=401,this.message="Unauthorized"}}class X2{constructor(){this.latestResponseId=0,this.lastResponseId=0,this.buffer=[],this.maxBuffer=4,this.pending=!1}get hasPendingRequests(){return this.pending}request(t,n){var r=this;return iu(function*(){const s=new AbortController,c=Date.now();r.lastResponseId=c,r.pending=!0,r.buffer.length>r.maxBuffer&&(r.buffer[0].abort(),r.buffer.splice(0,1)),r.buffer.push(s);const d=yield fetch(t,{...n,signal:s.signal});if(r.cleanBuffer(s),200!==d.status)throw d;if(r.latestResponseId>c)throw new Error("Prev response");return r.pending=r.lastResponseId!==c,r.latestResponseId=c,yield d.json()})()}abortAllRequests(){this.buffer.forEach(t=>t.abort())}cleanBuffer(t){this.buffer=this.buffer.filter(n=>n!==t)}}const s1=Symbol("Comlink.proxy"),K2=Symbol("Comlink.endpoint"),Y2=Symbol("Comlink.releaseProxy"),w_=Symbol("Comlink.thrown"),a1=e=>"object"==typeof e&&null!==e||"function"==typeof e,l1=new Map([["proxy",{canHandle:e=>a1(e)&&e[s1],serialize(e){const{port1:t,port2:n}=new MessageChannel;return c1(e,t),[n,[n]]},deserialize:e=>(e.start(),D_(e))}],["throw",{canHandle:e=>a1(e)&&w_ in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}}]]);function c1(e,t=self){t.addEventListener("message",function n(r){if(!r||!r.data)return;const{id:s,type:c,path:d}=Object.assign({path:[]},r.data),_=(r.data.argumentList||[]).map(su);let w;try{const C=d.slice(0,-1).reduce((z,q)=>z[q],e),M=d.reduce((z,q)=>z[q],e);switch(c){case"GET":w=M;break;case"SET":C[d.slice(-1)[0]]=su(r.data.value),w=!0;break;case"APPLY":w=M.apply(C,_);break;case"CONSTRUCT":w=function rP(e){return Object.assign(e,{[s1]:!0})}(new M(..._));break;case"ENDPOINT":{const{port1:z,port2:q}=new MessageChannel;c1(e,q),w=function nP(e,t){return d1.set(e,t),e}(z,[z])}break;case"RELEASE":w=void 0;break;default:return}}catch(C){w={value:C,[w_]:0}}Promise.resolve(w).catch(C=>({value:C,[w_]:0})).then(C=>{const[M,z]=C_(C);t.postMessage(Object.assign(Object.assign({},M),{id:s}),z),"RELEASE"===c&&(t.removeEventListener("message",n),u1(t))})}),t.start&&t.start()}function u1(e){(function eP(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function D_(e,t){return E_(e,[],t)}function vm(e){if(e)throw new Error("Proxy has been released and is not useable")}function E_(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(c,d){if(vm(r),d===Y2)return()=>kh(e,{type:"RELEASE",path:t.map(_=>_.toString())}).then(()=>{u1(e),r=!0});if("then"===d){if(0===t.length)return{then:()=>s};const _=kh(e,{type:"GET",path:t.map(w=>w.toString())}).then(su);return _.then.bind(_)}return E_(e,[...t,d])},set(c,d,_){vm(r);const[w,C]=C_(_);return kh(e,{type:"SET",path:[...t,d].map(M=>M.toString()),value:w},C).then(su)},apply(c,d,_){vm(r);const w=t[t.length-1];if(w===K2)return kh(e,{type:"ENDPOINT"}).then(su);if("bind"===w)return E_(e,t.slice(0,-1));const[C,M]=h1(_);return kh(e,{type:"APPLY",path:t.map(z=>z.toString()),argumentList:C},M).then(su)},construct(c,d){vm(r);const[_,w]=h1(d);return kh(e,{type:"CONSTRUCT",path:t.map(C=>C.toString()),argumentList:_},w).then(su)}});return s}function tP(e){return Array.prototype.concat.apply([],e)}function h1(e){const t=e.map(C_);return[t.map(n=>n[0]),tP(t.map(n=>n[1]))]}const d1=new WeakMap;function C_(e){for(const[t,n]of l1)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},d1.get(e)||[]]}function su(e){switch(e.type){case"HANDLER":return l1.get(e.name).deserialize(e.value);case"RAW":return e.value}}function kh(e,t,n){return new Promise(r=>{const s=function iP(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}();e.addEventListener("message",function c(d){!d.data||!d.data.id||d.data.id!==s||(e.removeEventListener("message",c),r(d.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)})}var oP=ar(69),sP=ar(572);function rf(e,t,n){if(null!==e)for(var r,s,c,d,_,w,C,q,M=0,z=0,te=e.type,le="FeatureCollection"===te,ve="Feature"===te,Ce=le?e.features.length:1,Te=0;Te<Ce;Te++){_=(q=!!(C=le?e.features[Te].geometry:ve?e.geometry:e)&&"GeometryCollection"===C.type)?C.geometries.length:1;for(var qe=0;qe<_;qe++){var Ee=0,lt=0;if(null!==(d=q?C.geometries[qe]:C)){w=d.coordinates;var Rt=d.type;switch(M=!n||"Polygon"!==Rt&&"MultiPolygon"!==Rt?0:1,Rt){case null:break;case"Point":if(!1===t(w,z,Te,Ee,lt))return!1;z++,Ee++;break;case"LineString":case"MultiPoint":for(r=0;r<w.length;r++){if(!1===t(w[r],z,Te,Ee,lt))return!1;z++,"MultiPoint"===Rt&&Ee++}"LineString"===Rt&&Ee++;break;case"Polygon":case"MultiLineString":for(r=0;r<w.length;r++){for(s=0;s<w[r].length-M;s++){if(!1===t(w[r][s],z,Te,Ee,lt))return!1;z++}"MultiLineString"===Rt&&Ee++,"Polygon"===Rt&&lt++}"Polygon"===Rt&&Ee++;break;case"MultiPolygon":for(r=0;r<w.length;r++){for(lt=0,s=0;s<w[r].length;s++){for(c=0;c<w[r][s].length-M;c++){if(!1===t(w[r][s][c],z,Te,Ee,lt))return!1;z++}lt++}Ee++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===rf(d.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function I_(e){var t=[1/0,1/0,-1/0,-1/0];return rf(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}I_.default=I_;const T_=I_;class dP{constructor(){this.requester=new X2}request(t){var n=this;return iu(function*(){try{const r=yield n.requester.request(t.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({}),...t.requestParams});if(!r.routes||0===r.routes.length||t.routeExcludeNotice&&pP(r,t.routeExcludeNotice))throw new Error("No routes found");const s=r.routes.map((w,C)=>fP(w,C,t.shapePolylinePrecision)),c=function hP(e,t){return"fastest"===t?e.reduce(function(r,s){return r?.arriveTime.valueOf()<s?.arriveTime.valueOf()?r:s})?.id:"shortest"===t?e.reduce(function(r,s){return r?.distance<s?.distance?r:s})?.id:"cheapest"===t?e.filter(r=>null!=r.cost).reduce(function(r,s){return r?.cost<s?.cost?r:s})?.id:"none"===t?null:0}(s,t.selectRouteStrategy),_=tl(s.reduce((w,C)=>[...w,...C.shape.features.map(M=>({...M,properties:{...M.properties,selected:c===M.properties.routeId}}))],[]));return{routesShapeBounds:T_(_),rawResponse:r,routes:s,selectedRouteId:c,routesShapeGeojson:_,version:performance.now(),latest:!n.requester.hasPendingRequests,mode:t.mode}}catch(r){if(r instanceof Response){const s=r,c=yield s.json();if(401===s.status)throw new Z2(c)}throw r}})()}hasPendingRequests(){return this.requester.hasPendingRequests}abortAllRequests(){this.requester.abortAllRequests()}}const fP=(e,t,n)=>{const{distance:r,cost:s,durationTime:c,waypoints:d,path:_,shape:w,shapePath:C,turnByTurnActions:M}=e.sections.reduce((z,q,te)=>{const le=(q.tolls||[]).reduce((Rt,kt)=>(kt.fares||[]).forEach(fo=>Rt+=(fo.convertedPrice||fo.price).value),0),ve=q.summary?.duration||0,Ce=[];q.departure.place.originalLocation&&Ce.push(q.departure.place.location),q.arrival.place.originalLocation&&(e.sections.length>=2&&te===e.sections.length-1||1===e.sections.length)&&Ce.push(q.arrival.place.location);const Te=function mP(e){return(0,oP.decode)(e).polyline}(q.polyline),qe=function gP(e,t){return sP(e.map(([n,r])=>({x:n,y:r})),t,!0).map(n=>[+n.y.toFixed(6),+n.x.toFixed(6)])}(Te,n),Ee=(q.turnByTurnActions||[]).map(Rt=>{const[kt,fo]=Te[Rt.offset];return{...Rt,position:{lat:kt,lng:fo}}}),lt=function x_(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return ou({type:"LineString",coordinates:e},t,n)}(qe,{waypoint:z.waypointIndex,routeId:t});return{distance:z.distance+q.summary?.length||0,durationTime:z.durationTime+ve,cost:z.cost+le,waypoints:[...z.waypoints,...Ce],path:[...z.path,...Te],turnByTurnActions:Ee,shape:tl([...z.shape?.features||[],lt]),shapePath:[...z.shapePath,...qe],waypointIndex:"vehicle"===q.type&&e.sections[te+1]&&"vehicle"===e.sections[te+1].type?z.waypointIndex+1:z.waypointIndex}},{distance:0,cost:0,waypoints:[],path:[],durationTime:0,turnByTurnActions:[],shape:null,shapePath:[],waypointIndex:0});return{durationTime:c,distance:r,cost:s,path:_,arriveTime:new Date(e.sections[e.sections.length-1].arrival.time),departureTime:new Date(e.sections[0].departure.time),id:t,waypoints:d,label:e.routeLabels?e.routeLabels.map(z=>z.name.value).join(", "):void 0,shape:w,turnByTurnActions:M,shapePath:C,rawRoute:e}},pP=(e,t)=>!!p1(e.notices||[],t)||(e.routes||[]).some(n=>(n.sections||[]).some(r=>p1(r.notices||[],t))),p1=(e,t)=>e.some(n=>{const r=t[n.severity];return r&&("all"===r||r.includes(n.code))}),yP={baseUrl:"https://router.hereapi.com/v8/routes",transportMode:"car",worker:!0,alternatives:2,shapePolylinePrecision:65e-7,generateRouteName:!1,routeExcludeNotice:{critical:"all"}};class _P{constructor(t){this.options={...yP,...t},!0===this.options.worker?(this.worker=new Worker(ar.tu(new URL(ar.p+ar.u(942),ar.b)),{type:void 0}),this.executorAPI=D_(this.worker)):this.executorAPI=new dP}destroy(){this.worker&&this.worker.terminate()}request(t,n){const r=this.buildUrl(t,{...this.options,...n});return this.executorAPI.request({url:r,...this.options,...n})}abortAllRequests(){return this.executorAPI.abortAllRequests()}setOption(t,n){this.options[t]=n}hasPendingRequests(){var t=this;return iu(function*(){return t.executorAPI.hasPendingRequests()})()}buildUrl(t,n){const r=t[0].position,s=t[t.length-1].position,c=this.options.spans?this.options.spans.join(","):null,d="drag"===n.mode?"polyline,summary":[...this.options.return||[],"polyline","summary","routeLabels"].join(","),_={apiKey:this.options.apiKey,origin:this.formatWp(r),destination:this.formatWp(s),transportMode:this.options.transportMode||"",spans:c,return:d,alternatives:"default"===n.mode?n?.alternatives??0:0,currency:this.options.currency||void 0,...this.options.queryParams};"cheapest"===this.options.selectRouteStrategy&&!_.return.includes("tolls")&&(_.return+=",tolls");const w=Object.keys(_).reduce((z,q)=>(_[q]&&(z[q]=_[q]),z),{});let C=new URLSearchParams(w).toString();t.length>2&&(C+=`&${this.serializeWaypoints(t)}`);const M=`${this.options.baseUrl}?${C}`;return this.options.buildUrl?this.options.buildUrl({waypoints:t,options:n},M):M}serializeWaypoints(t){return t.slice(1,t.length-1).map(n=>`via=${this.formatWp(n.position)}`).join("&")}formatWp({lat:t,lng:n}){return`${t},${n}`}}const vP=Math.max,xP=Math.min;class wP{get waypointsMarkers(){return this._waypointsMarkers}get routesLayerIds(){return this._routesLayerIds}get isEditable(){return this._canAddWaypoints||this._canDragWaypoints}get waypoints(){return this.routing.state.waypoints}constructor(t){this.dispatcher=new e1,this.addWaypointMarker=new Kl.Marker,this._waypointsMarkers=[],this._canAddWaypoints=!0,this._canDragWaypoints=!0,this._canSelectRoute=!0,this._maxWaypoints=1/0,this.routeClickHandler=this.onRouteClick.bind(this),this.routeHoverHandler=this.onRouteHover.bind(this),this.routeHoverOutHandler=this.onRouteHoverOut.bind(this),this.routeMouseDownHandler=this.onRouteMouseDown.bind(this),this.routeMoveHandler=this.onRouteMove.bind(this),this._routesLayerIds=[],this.layers=[],this.options={maxWaypoints:1/0,canAddWaypoints:!0,canDragWaypoints:!0,canSelectRoute:!0,routesWhileDragging:!0,waypointDragCommitDebounceTime:150,...t},this.map=t.map,this._maxWaypoints=this.options.maxWaypoints??1/0,this._sourceId=t.routesSourceId||"",this.dragCommitHandler=function bP(e,t,n){let r,s,c,d,_,w,C=0,M=!1,z=!1,q=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function te(kt){const fo=r,Ef=s;return r=s=void 0,C=kt,d=e.apply(Ef,fo),d}function Ce(kt){const fo=kt-w;return void 0===w||fo>=t||fo<0||z&&kt-C>=c}function Te(){const kt=Date.now();if(Ce(kt))return qe(kt);_=setTimeout(Te,function ve(kt){const ID=t-(kt-w);return z?xP(ID,c-(kt-C)):ID}(kt))}function qe(kt){return _=void 0,q&&r?te(kt):(r=s=void 0,d)}function Rt(){const kt=Date.now(),fo=Ce(kt);if(r=arguments,s=this,w=kt,fo){if(void 0===_)return function le(kt){return C=kt,_=setTimeout(Te,t),M?te(kt):d}(w);if(z)return _=setTimeout(Te,t),te(w)}return void 0===_&&(_=setTimeout(Te,t)),d}return t=Number(t)||0,"object"==typeof n&&(M=!!n.leading,z="maxWait"in n,c=z?vP(Number(n.maxWait)||0,t):c,q="trailing"in n?!!n.trailing:q),Rt.cancel=function Ee(){void 0!==_&&clearTimeout(_),C=0,r=w=s=_=void 0},Rt.flush=function lt(){return void 0===_?d:qe(Date.now())},Rt}((n,r)=>{this.dispatcher.fire("waypointDragCommit",{waypoint:n[r]}),this.setAndRecalculate(n,"drag")},50,{maxWait:this.options.waypointDragCommitDebounceTime})}projectRoute(t){this.map?.getSource(this._sourceId)?.setData(t),this.dispatcher.fire("routesProjected",{routesShapeGeojson:t})}onAdd(t){this.routing=t,this._sourceId=this.options.routesSourceId??this.routing.getUniqueName("any-routing-maplibre-projector"),this.map.addSource(this._sourceId,{data:null,type:"geojson",lineMetrics:!0}),this.setLayers(this.options.routeLayersFactory||[]),this.setCanAddWaypoints(this.options.editable??!!this.options.canAddWaypoints),this.setCanSelectRoute(this.options.editable??!!this.options.canSelectRoute),this.setCanDragWaypoint(this.options.editable??!!this.options.canDragWaypoints),this.bindLayerEvents(),this.routing.on("waypointsChanged",n=>{"drag"!==n.state.mode&&this.projectWaypoints(n.waypoints)}),this.routing.on("routesFound",n=>{n.state.routesShapeGeojson&&(this.projectRoute(n.state.routesShapeGeojson),"default"===n.state.mode&&this.projectWaypoints(n.state.waypoints),n.recalculateOptions.fitViewToData&&this.fitViewToData())}),this.routing.on("routeSelected",n=>{n.state.routesShapeGeojson&&this.projectRoute(n.state.routesShapeGeojson)}),this.routing.on("calculationStarted",n=>{n.recalculateOptions.clearMap&&this.clearRoutes()}),this.routing.on("stateUpdated",n=>{"external"===n.source&&(n.updatedProperties.includes("routesShapeGeojson")||n.updatedProperties.includes("waypoints"))&&(n.state.routesShapeGeojson&&this.projectRoute(n.state.routesShapeGeojson),this.projectWaypoints(n.state.waypoints))})}onRemove(){this.destroy()}projectWaypoints(t){this._waypointsMarkers.forEach(n=>n.remove()),this._waypointsMarkers=t.map((n,r)=>{const s=this.options.markerFactory({waypoint:n});s.setDraggable(this._canDragWaypoints).setLngLat(n.mappedPosition?[n.mappedPosition.lng,n.mappedPosition.lat]:[n.position.lng,n.position.lat]).addTo(this.map);const c=d=>{const _=[...this.waypoints];_[r]={..._[r],position:{lat:d.target._lngLat.lat,lng:d.target._lngLat.lng}},this.dispatcher.fire("waypointDrag",{waypoint:_[r]}),this.dragCommitHandler(_,r)};return this.options.routesWhileDragging&&s.on("drag",c),s.on("dragend",d=>{this.dragCommitHandler.cancel(),s.off("drag",c);const _=[...this.routing.state.waypoints];_[r]={..._[r],position:{lat:d.target._lngLat.lat,lng:d.target._lngLat.lng}},this.dispatcher.fire("waypointDragEnd",{waypoint:_[r]}),this.setAndRecalculate(_,"default")}),s})}destroy(){this.layers.forEach(t=>this.map.removeLayer(t.specification.id)),this.map?.removeSource(this._sourceId),this._waypointsMarkers?.forEach(t=>t.remove()),this.unbindLayerEvents()}setLayers(t){this.destroyLayers(),this.layers=t.map(n=>n({routing:this.routing,sourceId:this._sourceId})),this._routesLayerIds=this.layers.map(({specification:{id:n}})=>n),this.layers.forEach(n=>this.map.addLayer(n.specification,n.addBefore))}destroyLayers(){this.layers.forEach(t=>this.map.removeLayer(t.specification.id)),this.layers=[],this._routesLayerIds=[]}clearRoutes(){this.map?.getSource(this._sourceId)?.setData(tl([]))}fitViewToData(t={}){const n=this.routing.state;let r;if(n.routesShapeGeojson||n.data?.routesShapeBounds)r=new Kl.LngLatBounds(n.data?.routesShapeBounds?n.data.routesShapeBounds:T_(n.routesShapeGeojson));else{if(!(n.waypoints.length>0))return;r=new Kl.LngLatBounds,n.waypoints.forEach(s=>r.extend([s.position.lng,s.position.lat]))}this.map.fitBounds(r,{padding:40,...t})}on(t,n){this.dispatcher.on(t,n)}off(t,n){this.dispatcher.off(t,n)}onRouteClick(t){if(!t.features[0].properties?.selected&&null!=t.features[0].properties?.routeId&&this._canSelectRoute&&!this.eventIsCancelled(t)){this.stopEventPropagation(t);const n=t.features[0].properties.routeId;this.routing.selectRoute(n),this.dispatcher.fire("routeClick",{routeId:n})}}onRouteHover(t){this.map.getCanvas().style.cursor="pointer",t.originalEvent.target===this.map.getCanvas()&&t.features[0].properties?.selected&&null!=t.features[0].properties?.routeId&&this._canAddWaypoints&&this.waypoints.length<this._maxWaypoints&&!this.eventIsCancelled(t)&&(this.stopEventPropagation(t),this.addWaypointMarker?.remove(),this.addWaypointMarker=this.options.markerFactory({routeHover:t.features[0]}),this.addWaypointMarker.setLngLat(t.lngLat).addTo(this.map),this.addWaypointMarker.getElement().style.pointerEvents="none")}onRouteHoverOut(){this.map.getCanvas().style.cursor="",this.addWaypointMarker.remove()}onRouteMouseDown(t){if(t.originalEvent.target!==this.map.getCanvas()||!t.features||null==t.features[0]||null==t.features[0].properties?.waypoint||!t.features[0].properties?.selected||!this._canAddWaypoints||this.waypoints.length>=this._maxWaypoints||this.eventIsCancelled(t)||t.originalEvent.target.closest(".marker"))return;t.preventDefault(),this.stopEventPropagation(t);const n=t.features[0].properties.waypoint+1,r=_m.fromWaypoint({position:{lat:t.lngLat.lat,lng:t.lngLat.lng}},{isFirst:!1,isLast:!1,index:n}),s=this.options.markerFactory({waypoint:r}).setLngLat(t.lngLat).addTo(this.map),c=[...this.waypoints];c.splice(n,0,r),this.dispatcher.fire("waypointAdded",{waypoint:r}),this.setAndRecalculate(c,"drag");const d=_=>{s.setLngLat(_.lngLat);const w=[...this.waypoints],C=_m.fromWaypoint({position:{lat:_.lngLat.lat,lng:_.lngLat.lng}},{isFirst:!1,isLast:!1,index:n});w[n]=C,this.dispatcher.fire("waypointDrag",{waypoint:w[n]}),this.options.routesWhileDragging&&this.dragCommitHandler(w,n)};this.map.on("mousemove",d),this.map.once("mouseup",_=>{this.map.off("mousemove",d),this.dragCommitHandler.cancel();const w=[...this.waypoints],C=_m.fromWaypoint({position:{lat:_.lngLat.lat,lng:_.lngLat.lng}},{isFirst:!1,isLast:!1,index:n});w[n]=C,this.projectWaypoints(w),s.remove(),this.dispatcher.fire("waypointDragEnd",{waypoint:w[n]}),this.setAndRecalculate(w,"default")})}setAndRecalculate(t,n){this.routing.setMode(n),this.routing.setWaypoints(t.map(r=>({...r,mappedPosition:void 0}))),this.routing.recalculateRoute({clearMap:!1,dropPendingRequests:"default"===n,fitViewToData:!1,syncWaypoints:"default"===n}).catch(()=>this.clearRoutes())}onRouteMove(t){!this._canAddWaypoints||this.waypoints.length>=this._maxWaypoints||this.eventIsCancelled(t)||t.originalEvent.target===this.map.getCanvas()&&t.features[0].properties?.selected&&null!=t.features[0].properties?.routeId&&(this.stopEventPropagation(t),this.addWaypointMarker.setLngLat(t.lngLat).addTo(this.map),this.addWaypointMarker.getElement().style.pointerEvents="none")}setEditable(t){this.setCanAddWaypoints(t),this.setCanSelectRoute(t),this.setCanDragWaypoint(t)}setCanDragWaypoint(t){this._canDragWaypoints=t,this.addWaypointMarker?.remove(),this.waypointsMarkers.forEach(n=>n.setDraggable(t))}setCanSelectRoute(t){this._canSelectRoute=t}setCanAddWaypoints(t){this._canAddWaypoints=t,t||this.addWaypointMarker?.remove()}setMaxWaypoints(t){this._maxWaypoints=t}bindLayerEvents(){this.routesLayerIds.forEach(t=>{this.map.on("click",t,this.routeClickHandler),this.map.on("mouseenter",t,this.routeHoverHandler),this.map.on("mouseleave",t,this.routeHoverOutHandler),this.map.on("mousedown",t,this.routeMouseDownHandler),this.map.on("mousemove",t,this.routeMoveHandler)})}unbindLayerEvents(){this.routesLayerIds.forEach(t=>{this.map.off("click",t,this.routeClickHandler),this.map.off("mouseenter",t,this.routeHoverHandler),this.map.off("mouseleave",t,this.routeHoverOutHandler),this.map.off("mousedown",t,this.routeMoveHandler),this.map.off("mousemove",t,this.routeMoveHandler)})}eventIsCancelled(t){return!!t.originalEvent.handledFor&&!!t.originalEvent.handledFor.includes(t.type)}stopEventPropagation(t){t.originalEvent.handledFor=[...t.originalEvent.handledFor||[],t.type]}}const DP={routeLayersFactory:[({sourceId:e,routing:t})=>({specification:{id:t.getUniqueName("base-route"),type:"line",source:e,minzoom:1,maxzoom:17,layout:{"line-join":"round","line-cap":"round","line-sort-key":["case",["==",["get","selected"],!0],1,0]},paint:{"line-color":["case",["==",["get","selected"],!0],"#e207ff","#33C9EB"],"line-width":4}}})],markerFactory:({waypoint:e,routeHover:t})=>{if(e&&!e.properties.isFirst&&!e.properties.isLast||t){const n=document.createElement("div"),r=e?16:12,s=e?16:12;return n.className="marker",n.style.backgroundImage="url(https://upload.wikimedia.org/wikipedia/commons/6/64/Blue_dot_with_stroke.svg)",n.style.width=`${r}px`,n.style.height=`${s}px`,n.style.backgroundSize="100%",new Kl.Marker(n)}return new Kl.Marker},routesSourceId:"routes"};class IP{constructor(t,n,r){this.routeId=t,this.ctx=r,this.routeSelectedHandler=this.routeSelected.bind(this),this.container=document.createElement("div"),this.container.onclick=()=>{r.selectRoute(t)},r.on("routeSelected",this.routeSelectedHandler),this.render(t,n)}render(t,n){this.container.style.padding="4px 5px",this.container.style.display="flex",this.container.style.cursor="pointer",this.container.innerHTML=`\n      <svg  width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="car" class="svg-inline--fa fa-car fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="car" fill="#40abf7" d="M499.99 176h-59.87l-16.64-41.6C406.38 91.63 365.57 64 319.5 64h-127c-46.06 0-86.88 27.63-103.99 70.4L71.87 176H12.01C4.2 176-1.53 183.34.37 190.91l6 24C7.7 220.25 12.5 224 18.01 224h20.07C24.65 235.73 16 252.78 16 272v48c0 16.12 6.16 30.67 16 41.93V416c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-32h256v32c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-54.07c9.84-11.25 16-25.8 16-41.93v-48c0-19.22-8.65-36.27-22.07-48H494c5.51 0 10.31-3.75 11.64-9.09l6-24c1.89-7.57-3.84-14.91-11.65-14.91zm-352.06-17.83c7.29-18.22 24.94-30.17 44.57-30.17h127c19.63 0 37.28 11.95 44.57 30.17L384 208H128l19.93-49.83zM96 319.8c-19.2 0-32-12.76-32-31.9S76.8 256 96 256s48 28.71 48 47.85-28.8 15.95-48 15.95zm320 0c-19.2 0-48 3.19-48-15.95S396.8 256 416 256s32 12.76 32 31.9-12.8 31.9-32 31.9z"></path></svg>\n      <div style="display: inline-block;  line-height: initial;">\n        <div style="margin-left: 8px; font-size: .9rem">${function CP(e){const{days:t,seconds:n,minutes:r,hours:s}=function EP(e){if("number"!=typeof e)throw new TypeError("Expected a number");const t=e>0?Math.floor:Math.ceil;return{days:t(e/864e5),hours:t(e/36e5)%24,minutes:t(e/6e4)%60,seconds:t(e/1e3)%60,milliseconds:t(e)%1e3,microseconds:t(1e3*e)%1e3,nanoseconds:t(1e6*e)%1e3}}(e);return 0===t&&0===s&&0===r?`${n}s`:0===t&&0===s?`${r}m ${n} s`:0===t?`${s}h ${r}m`:`${24*t+s}h`}(1e3*n.routes[t]?.durationTime)}</div>\n        <span style="margin-left: 8px; font-size: .7rem;">${(n.routes[t]?.distance/1e3).toFixed(1)} km</span>\n      </div>\n    `,this.applyColor()}destroy(){this.ctx.off("routeSelected",this.routeSelectedHandler)}routeSelected(){this.applyColor()}applyColor(){const t=this.ctx.selectedRouteId===this.routeId?"#e207ff":"#33C9EB";this.container.querySelector("svg #car")?.setAttribute("fill",t)}}const TP={calculatePopupOnFly:!0,componentFactory:(e,t,n)=>new IP(e,t,n)};class MP{constructor(t){this.popups=[],this.allInBbox=!1,this.components=[],this.clearMapHandler=()=>{this.data=void 0,this.destroyView()},this.routeCalculatedHandler=this.routeCalculated.bind(this),this.mapMoveEndHandler=this.recalculate.bind(this),this.options={...TP,...t},this.worker=new Worker(ar.tu(new URL(ar.p+ar.u(898),ar.b)),{type:void 0}),this.map=this.options.map,this.workerApi=D_(this.worker)}onAdd(t){this.ctx=t,this.ctx.on("routesFound",this.routeCalculatedHandler),this.ctx.on("calculationStarted",this.clearMapHandler),this.map.on(this.options.calculatePopupOnFly?"render":"idle",this.mapMoveEndHandler)}onRemove(){this.ctx.off("routesFound",this.routeCalculatedHandler),this.ctx.off("calculationStarted",this.clearMapHandler),this.worker.terminate(),this.destroyView()}routeCalculated(){var t=this;return iu(function*(){const n=t.ctx.data;n&&(t.data?.version===n.version||!n.latest||(t.data=n,t.destroyView(),t.ctx.state.data?.latest&&(yield t.workerApi.createChunks(t.data),yield t.recalculate(!0))))})()}recalculate(t=!1){var n=this;return iu(function*(){if(n.mapBounds=n.map.getBounds(),!n.data||n.bounds&&4===n.bounds.length&&n.mapBounds.contains([n.bounds[0],n.bounds[1]])&&n.mapBounds.contains([n.bounds[2],n.bounds[3]])&&n.allInBbox&&!t)return;const r=n.mapBounds.getSouthWest(),s=n.mapBounds.getNorthEast(),{points:c,allInBbox:d}=yield n.workerApi.recalculatePos({bbox:{sw:r,ne:s}});c.length&&(n.bounds&&4===n.bounds.length&&n.mapBounds.contains([n.bounds[0],n.bounds[1]])&&n.mapBounds.contains([n.bounds[2],n.bounds[3]])&&!t||(n.destroyView(),n.allInBbox=d,n.bounds=T_(tl(c.map(_=>function v_(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!b_(e[0])||!b_(e[1]))throw new Error("coordinates must contain numbers");return ou({type:"Point",coordinates:e},t,n)}(_.lngLat)))),n.components=[],c.forEach(_=>{const w=n.options.componentFactory(_.properties.routeId,n.data,n.ctx),C=new Kl.Popup({closeButton:!1,closeOnClick:!1,className:"no-mouse-events"}).setLngLat(_.lngLat).setDOMContent(w.container).addTo(n.map);"onAttach"in w&&w.onAttach(C),C.getElement().querySelector(".maplibregl-popup-content").style.padding="0",n.components.push(w),n.popups.push(C)})))})()}destroyView(){this.allInBbox=!1,this.components.forEach(t=>t.destroy()),this.popups.forEach(t=>t.remove()),this.popups=[],this.components=[]}}const M__hereApiKey="WMRvf7QXKJQhmlw1nEdkL2UjXKSdNY4NryQ5_6tGudc",AP=["mapContainer"];class sf{constructor(t){this.zone=t}ngAfterViewInit(){this.zone.runOutsideAngular(()=>{const t=new Kl.Map({container:this.mapContainer.nativeElement,center:[13,51],zoom:4,style:`https://assets.vector.hereapi.com/styles/berlin/base/mapbox/tilezen?apikey=${M__hereApiKey}`}),n=new _P({apiKey:M__hereApiKey,transportMode:"truck",return:["routeLabels","turnByTurnActions"]}),r=new wP({...DP,map:t}),s=new W2({dataProvider:n,plugins:[r,new MP({map:t})],waypointsSyncStrategy:"toPath"});t.on("load",iu(function*(){s.initialize(),s.setWaypoints([{position:{lat:49.9539315,lng:18.8531001},properties:{label:"A"}},{position:{lng:21.01178,lat:52.22977},properties:{label:"B"}}]),s.recalculateRoute({fitViewToData:!0})}))})}}function _t(...e){return Zn(e,Xe(e))}sf.\u0275fac=function(t){return new(t||sf)(xt(br))},sf.\u0275cmp=hs({type:sf,selectors:[["libre-routing-root"]],viewQuery:function(t,n){if(1&t&&lb(AP,5),2&t){let r;Dy(r=function Ey(){return function nT(e,t){return e[si].queries[t].queryList}(he(),La())}())&&(n.mapContainer=r.first)}},decls:2,vars:0,consts:[["id","map"],["mapContainer",""]],template:function(t,n){1&t&&Np(0,"div",0,1)},styles:["#map[_ngcontent-%COMP%]{display:block;width:100vw;height:100vh}"]});class Os extends $r{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const xm=Oo(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:PP}=Array,{getPrototypeOf:RP,prototype:kP,keys:LP}=Object;const{isArray:zP}=Array;function m1(...e){const t=Xe(e),n=function $e(e){return an(We(e))?e.pop():void 0}(e),{args:r,keys:s}=function FP(e){if(1===e.length){const t=e[0];if(PP(t))return{args:t,keys:null};if(function OP(e){return e&&"object"==typeof e&&RP(e)===kP}(t)){const n=LP(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Zn([],t);const c=new rn(function VP(e,t,n=Gn){return r=>{g1(t,()=>{const{length:s}=e,c=new Array(s);let d=s,_=s;for(let w=0;w<s;w++)g1(t,()=>{const C=Zn(e[w],t);let M=!1;C.subscribe(On(r,z=>{c[w]=z,M||(M=!0,_--),_||r.next(n(c.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,t,s?d=>function UP(e,t){return e.reduce((n,r,s)=>(n[r]=t[s],n),{})}(s,d):Gn));return n?c.pipe(function BP(e){return Nt(t=>function NP(e,t){return zP(t)?e(...t):e(t)}(e,t))}(n)):c}function g1(e,t,n){e?Z(n,e,t):t()}function A_(...e){return function $P(){return ne(1)}()(Zn(e,Xe(e)))}function y1(e){return new rn(t=>{ni(e()).subscribe(t)})}function af(e,t){const n=an(e)?e:()=>e,r=s=>s.error(n());return new rn(t?s=>t.schedule(r,0,s):r)}function P_(){return wn((e,t)=>{let n=null;e._refCount++;const r=On(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const s=e._connection,c=n;n=null,s&&(!c||s===c)&&s.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class _1 extends rn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Qi(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new pn;const n=this.getSubject();t.add(this.source.subscribe(On(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=pn.EMPTY)}return t}refCount(){return P_()(this)}}function ya(e,t){return wn((n,r)=>{let s=null,c=0,d=!1;const _=()=>d&&!s&&r.complete();n.subscribe(On(r,w=>{s?.unsubscribe();let C=0;const M=c++;ni(e(w,M)).subscribe(s=On(r,z=>r.next(t?t(w,z,M,C++):z),()=>{s=null,_()}))},()=>{d=!0,_()}))})}function lf(e){return e<=0?()=>re:wn((t,n)=>{let r=0;t.subscribe(On(n,s=>{++r<=e&&(n.next(s),e<=r&&n.complete())}))})}function Yl(e,t){return wn((n,r)=>{let s=0;n.subscribe(On(r,c=>e.call(t,c,s++)&&r.next(c)))})}function bm(e){return wn((t,n)=>{let r=!1;t.subscribe(On(n,s=>{r=!0,n.next(s)},()=>{r||n.next(e),n.complete()}))})}function v1(e=HP){return wn((t,n)=>{let r=!1;t.subscribe(On(n,s=>{r=!0,n.next(s)},()=>r?n.complete():n.error(e())))})}function HP(){return new xm}function Jl(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Yl((s,c)=>e(s,c,r)):Gn,lf(1),n?bm(t):v1(()=>new xm))}function au(e,t){return an(t)?Y(e,t,1):Y(e,1)}function Bi(e,t,n){const r=an(e)||t||n?{next:e,error:t,complete:n}:e;return r?wn((s,c)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let _=!0;s.subscribe(On(c,w=>{var C;null===(C=r.next)||void 0===C||C.call(r,w),c.next(w)},()=>{var w;_=!1,null===(w=r.complete)||void 0===w||w.call(r),c.complete()},w=>{var C;_=!1,null===(C=r.error)||void 0===C||C.call(r,w),c.error(w)},()=>{var w,C;_&&(null===(w=r.unsubscribe)||void 0===w||w.call(r)),null===(C=r.finalize)||void 0===C||C.call(r)}))}):Gn}function Ql(e){return wn((t,n)=>{let c,r=null,s=!1;r=t.subscribe(On(n,void 0,void 0,d=>{c=ni(e(d,Ql(e)(t))),r?(r.unsubscribe(),r=null,c.subscribe(n)):s=!0})),s&&(r.unsubscribe(),r=null,c.subscribe(n))})}function x1(e,t){return wn(function GP(e,t,n,r,s){return(c,d)=>{let _=n,w=t,C=0;c.subscribe(On(d,M=>{const z=C++;w=_?e(w,M,z):(_=!0,M),r&&d.next(w)},s&&(()=>{_&&d.next(w),d.complete()})))}}(e,t,arguments.length>=2,!0))}function R_(e){return e<=0?()=>re:wn((t,n)=>{let r=[];t.subscribe(On(n,s=>{r.push(s),e<r.length&&r.shift()},()=>{for(const s of r)n.next(s);n.complete()},void 0,()=>{r=null}))})}function b1(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Yl((s,c)=>e(s,c,r)):Gn,R_(1),n?bm(t):v1(()=>new xm))}function k_(e){return wn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const Vt="primary",cf=Symbol("RouteTitle");class ZP{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Lh(e){return new ZP(e)}function XP(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const s={};for(let c=0;c<r.length;c++){const d=r[c],_=e[c];if(d.startsWith(":"))s[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,r.length),posParams:s}}function _a(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let s;for(let c=0;c<n.length;c++)if(s=n[c],!w1(e[s],t[s]))return!1;return!0}function w1(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((s,c)=>r[c]===s)}return e===t}function D1(e){return Array.prototype.concat.apply([],e)}function E1(e){return e.length>0?e[e.length-1]:null}function bi(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function ec(e){return x0(e)?e:Bp(e)?Zn(Promise.resolve(e)):_t(e)}const wm=!1,YP={exact:function I1(e,t,n){if(!lu(e.segments,t.segments)||!Dm(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!I1(e.children[r],t.children[r],n))return!1;return!0},subset:T1},C1={exact:function JP(e,t){return _a(e,t)},subset:function QP(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>w1(e[n],t[n]))},ignored:()=>!0};function S1(e,t,n){return YP[n.paths](e.root,t.root,n.matrixParams)&&C1[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function T1(e,t,n){return M1(e,t,t.segments,n)}function M1(e,t,n,r){if(e.segments.length>n.length){const s=e.segments.slice(0,n.length);return!(!lu(s,n)||t.hasChildren()||!Dm(s,n,r))}if(e.segments.length===n.length){if(!lu(e.segments,n)||!Dm(e.segments,n,r))return!1;for(const s in t.children)if(!e.children[s]||!T1(e.children[s],t.children[s],r))return!1;return!0}{const s=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!(lu(e.segments,s)&&Dm(e.segments,s,r)&&e.children[Vt])&&M1(e.children[Vt],t,c,r)}}function Dm(e,t,n){return t.every((r,s)=>C1[n](e[s].parameters,r.parameters))}class tc{constructor(t=new en([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lh(this.queryParams)),this._queryParamMap}toString(){return nR.serialize(this)}}class en{constructor(t,n){this.segments=t,this.children=n,this.parent=null,bi(n,(r,s)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Em(this)}}class uf{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Lh(this.parameters)),this._parameterMap}toString(){return R1(this)}}function lu(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let hf=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return new L_},providedIn:"root"}),e})();class L_{parse(t){const n=new hR(t);return new tc(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${df(t.root,!0)}`,r=function oR(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(s=>`${Cm(n)}=${Cm(s)}`).join("&"):`${Cm(n)}=${Cm(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function rR(e){return encodeURI(e)}(t.fragment)}`:""}`}}const nR=new L_;function Em(e){return e.segments.map(t=>R1(t)).join("/")}function df(e,t){if(!e.hasChildren())return Em(e);if(t){const n=e.children[Vt]?df(e.children[Vt],!1):"",r=[];return bi(e.children,(s,c)=>{c!==Vt&&r.push(`${c}:${df(s,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function tR(e,t){let n=[];return bi(e.children,(r,s)=>{s===Vt&&(n=n.concat(t(r,s)))}),bi(e.children,(r,s)=>{s!==Vt&&(n=n.concat(t(r,s)))}),n}(e,(r,s)=>s===Vt?[df(e.children[Vt],!1)]:[`${s}:${df(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Vt]?`${Em(e)}/${n[0]}`:`${Em(e)}/(${n.join("//")})`}}function A1(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Cm(e){return A1(e).replace(/%3B/gi,";")}function F_(e){return A1(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Sm(e){return decodeURIComponent(e)}function P1(e){return Sm(e.replace(/\+/g,"%20"))}function R1(e){return`${F_(e.path)}${function iR(e){return Object.keys(e).map(t=>`;${F_(t)}=${F_(e[t])}`).join("")}(e.parameters)}`}const sR=/^[^\/()?;=#]+/;function Im(e){const t=e.match(sR);return t?t[0]:""}const aR=/^[^=?&#]+/,cR=/^[^&#]+/;class hR{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new en([],{}):new en([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[Vt]=new en(t,n)),r}parseSegment(){const t=Im(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new ze(4009,wm);return this.capture(t),new uf(Sm(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=Im(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const s=Im(this.remaining);s&&(r=s,this.capture(r))}t[Sm(n)]=Sm(r)}parseQueryParam(t){const n=function lR(e){const t=e.match(aR);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const d=function uR(e){const t=e.match(cR);return t?t[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const s=P1(n),c=P1(r);if(t.hasOwnProperty(s)){let d=t[s];Array.isArray(d)||(d=[d],t[s]=d),d.push(c)}else t[s]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Im(this.remaining),s=this.remaining[r.length];if("/"!==s&&")"!==s&&";"!==s)throw new ze(4010,wm);let c;r.indexOf(":")>-1?(c=r.slice(0,r.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=Vt);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[Vt]:new en([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new ze(4011,wm)}}function O_(e){return e.segments.length>0?new en([],{[Vt]:e}):e}function Tm(e){const t={};for(const r of Object.keys(e.children)){const c=Tm(e.children[r]);(c.segments.length>0||c.hasChildren())&&(t[r]=c)}return function dR(e){if(1===e.numberOfChildren&&e.children[Vt]){const t=e.children[Vt];return new en(e.segments.concat(t.segments),t.children)}return e}(new en(e.segments,t))}function cu(e){return e instanceof tc}const z_=!1;function fR(e,t,n,r,s){if(0===n.length)return Fh(t.root,t.root,t.root,r,s);const c=function z1(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new O1(!0,0,e);let t=0,n=!1;const r=e.reduce((s,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return bi(c.outlets,(w,C)=>{_[C]="string"==typeof w?w.split("/"):w}),[...s,{outlets:_}]}if(c.segmentPath)return[...s,c.segmentPath]}return"string"!=typeof c?[...s,c]:0===d?(c.split("/").forEach((_,w)=>{0==w&&"."===_||(0==w&&""===_?n=!0:".."===_?t++:""!=_&&s.push(_))}),s):[...s,c]},[]);return new O1(n,t,r)}(n);return c.toRoot()?Fh(t.root,t.root,new en([],{}),r,s):function d(w){const C=function mR(e,t,n,r){if(e.isAbsolute)return new Oh(t.root,!0,0);if(-1===r)return new Oh(n,n===t.root,0);return function N1(e,t,n){let r=e,s=t,c=n;for(;c>s;){if(c-=s,r=r.parent,!r)throw new ze(4005,z_&&"Invalid number of '../'");s=r.segments.length}return new Oh(r,!1,s-c)}(n,r+(ff(e.commands[0])?0:1),e.numberOfDoubleDots)}(c,t,e.snapshot?._urlSegment,w),M=C.processChildren?zh(C.segmentGroup,C.index,c.commands):N_(C.segmentGroup,C.index,c.commands);return Fh(t.root,C.segmentGroup,M,r,s)}(e.snapshot?._lastPathIndex)}function ff(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function pf(e){return"object"==typeof e&&null!=e&&e.outlets}function Fh(e,t,n,r,s){let d,c={};r&&bi(r,(w,C)=>{c[C]=Array.isArray(w)?w.map(M=>`${M}`):`${w}`}),d=e===t?n:F1(e,t,n);const _=O_(Tm(d));return new tc(_,c,s)}function F1(e,t,n){const r={};return bi(e.children,(s,c)=>{r[c]=s===t?n:F1(s,t,n)}),new en(e.segments,r)}class O1{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&ff(r[0]))throw new ze(4003,z_&&"Root segment cannot have matrix parameters");const s=r.find(pf);if(s&&s!==E1(r))throw new ze(4004,z_&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Oh{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function N_(e,t,n){if(e||(e=new en([],{})),0===e.segments.length&&e.hasChildren())return zh(e,t,n);const r=function yR(e,t,n){let r=0,s=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;s<e.segments.length;){if(r>=n.length)return c;const d=e.segments[s],_=n[r];if(pf(_))break;const w=`${_}`,C=r<n.length-1?n[r+1]:null;if(s>0&&void 0===w)break;if(w&&C&&"object"==typeof C&&void 0===C.outlets){if(!U1(w,C,d))return c;r+=2}else{if(!U1(w,{},d))return c;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}(e,t,n),s=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const c=new en(e.segments.slice(0,r.pathIndex),{});return c.children[Vt]=new en(e.segments.slice(r.pathIndex),e.children),zh(c,0,s)}return r.match&&0===s.length?new en(e.segments,{}):r.match&&!e.hasChildren()?B_(e,t,n):r.match?zh(e,0,s):B_(e,t,n)}function zh(e,t,n){if(0===n.length)return new en(e.segments,{});{const r=function gR(e){return pf(e[0])?e[0].outlets:{[Vt]:e}}(n),s={};return!r[Vt]&&e.children[Vt]&&1===e.numberOfChildren&&0===e.children[Vt].segments.length?zh(e.children[Vt],t,n):(bi(r,(c,d)=>{"string"==typeof c&&(c=[c]),null!==c&&(s[d]=N_(e.children[d],t,c))}),bi(e.children,(c,d)=>{void 0===r[d]&&(s[d]=c)}),new en(e.segments,s))}}function B_(e,t,n){const r=e.segments.slice(0,t);let s=0;for(;s<n.length;){const c=n[s];if(pf(c)){const w=_R(c.outlets);return new en(r,w)}if(0===s&&ff(n[0])){r.push(new uf(e.segments[t].path,B1(n[0]))),s++;continue}const d=pf(c)?c.outlets[Vt]:`${c}`,_=s<n.length-1?n[s+1]:null;d&&_&&ff(_)?(r.push(new uf(d,B1(_))),s+=2):(r.push(new uf(d,{})),s++)}return new en(r,{})}function _R(e){const t={};return bi(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=B_(new en([],{}),0,n))}),t}function B1(e){const t={};return bi(e,(n,r)=>t[r]=`${n}`),t}function U1(e,t,n){return e==n.path&&_a(t,n.parameters)}const mf="imperative";class va{constructor(t,n){this.id=t,this.url=n}}class U_ extends va{constructor(t,n,r="imperative",s=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class uu extends va{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Mm extends va{constructor(t,n,r,s){super(t,n),this.reason=r,this.code=s,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Am extends va{constructor(t,n,r,s){super(t,n),this.reason=r,this.code=s,this.type=16}}class V_ extends va{constructor(t,n,r,s){super(t,n),this.error=r,this.target=s,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class vR extends va{constructor(t,n,r,s){super(t,n),this.urlAfterRedirects=r,this.state=s,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xR extends va{constructor(t,n,r,s){super(t,n),this.urlAfterRedirects=r,this.state=s,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bR extends va{constructor(t,n,r,s,c){super(t,n),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class wR extends va{constructor(t,n,r,s){super(t,n),this.urlAfterRedirects=r,this.state=s,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class DR extends va{constructor(t,n,r,s){super(t,n),this.urlAfterRedirects=r,this.state=s,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ER{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class CR{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class SR{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class IR{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TR{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class MR{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class V1{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let RR=(()=>{class e{createUrlTree(n,r,s,c,d,_){return fR(n||r.root,s,c,d,_)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})(),LR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(t){return RR.\u0275fac(t)},providedIn:"root"}),e})();class $1{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=$_(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=$_(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=j_(t,this._root);return n.length<2?[]:n[n.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return j_(t,this._root).map(n=>n.value)}}function $_(e,t){if(e===t.value)return t;for(const n of t.children){const r=$_(e,n);if(r)return r}return null}function j_(e,t){if(e===t.value)return[t];for(const n of t.children){const r=j_(e,n);if(r.length)return r.unshift(t),r}return[]}class nl{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Nh(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class j1 extends $1{constructor(t,n){super(t),this.snapshot=n,H_(this,t)}toString(){return this.snapshot.toString()}}function H1(e,t){const n=function FR(e,t){const d=new Pm([],{},{},"",{},Vt,t,null,e.root,-1,{});return new q1("",new nl(d,[]))}(e,t),r=new Os([new uf("",{})]),s=new Os({}),c=new Os({}),d=new Os({}),_=new Os(""),w=new Bh(r,s,d,_,c,Vt,t,n.root);return w.snapshot=n.root,new j1(new nl(w,[]),n)}class Bh{constructor(t,n,r,s,c,d,_,w){this.url=t,this.params=n,this.queryParams=r,this.fragment=s,this.data=c,this.outlet=d,this.component=_,this.title=this.data?.pipe(Nt(C=>C[cf]))??_t(void 0),this._futureSnapshot=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Nt(t=>Lh(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Nt(t=>Lh(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function G1(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const s=n[r],c=n[r-1];if(s.routeConfig&&""===s.routeConfig.path)r--;else{if(c.component)break;r--}}return function OR(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Pm{get title(){return this.data?.[cf]}constructor(t,n,r,s,c,d,_,w,C,M,z){this.url=t,this.params=n,this.queryParams=r,this.fragment=s,this.data=c,this.outlet=d,this.component=_,this.routeConfig=w,this._urlSegment=C,this._lastPathIndex=M,this._resolve=z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Lh(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lh(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class q1 extends $1{constructor(t,n){super(n),this.url=t,H_(this,n)}toString(){return W1(this._root)}}function H_(e,t){t.value._routerState=e,t.children.forEach(n=>H_(e,n))}function W1(e){const t=e.children.length>0?` { ${e.children.map(W1).join(", ")} } `:"";return`${e.value}${t}`}function G_(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,_a(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),_a(t.params,n.params)||e.params.next(n.params),function KP(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!_a(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),_a(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function q_(e,t){const n=_a(e.params,t.params)&&function eR(e,t){return lu(e,t)&&e.every((n,r)=>_a(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||q_(e.parent,t.parent))}function gf(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const s=function NR(e,t,n){return t.children.map(r=>{for(const s of n.children)if(e.shouldReuseRoute(r.value,s.value.snapshot))return gf(e,r,s);return gf(e,r)})}(e,t,n);return new nl(r,s)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>gf(e,_)),d}}const r=function BR(e){return new Bh(new Os(e.url),new Os(e.params),new Os(e.queryParams),new Os(e.fragment),new Os(e.data),e.outlet,e.component,e)}(t.value),s=t.children.map(c=>gf(e,c));return new nl(r,s)}}const W_="ngNavigationCancelingError";function Z1(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=cu(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,s=X1(!1,0,t);return s.url=n,s.navigationBehaviorOptions=r,s}function X1(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[W_]=!0,r.cancellationCode=t,n&&(r.url=n),r}function K1(e){return Y1(e)&&cu(e.url)}function Y1(e){return e&&e[W_]}class UR{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new yf,this.attachRef=null}}let yf=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const s=this.getOrCreateContext(n);s.outlet=r,this.contexts.set(n,s)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new UR,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Rm=!1;let J1=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Vt,this.activateEvents=new Ki,this.deactivateEvents=new Ki,this.attachEvents=new Ki,this.detachEvents=new Ki,this.parentContexts=ot(yf),this.location=ot(Rs),this.changeDetector=ot(By),this.environmentInjector=ot(Ts)}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:s}=n.name;if(r)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ze(4012,Rm);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ze(4012,Rm);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ze(4012,Rm);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new ze(4013,Rm);this._activatedRoute=n;const s=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,w=new VR(n,_,s.injector);if(r&&function $R(e){return!!e.resolveComponentFactory}(r)){const C=r.resolveComponentFactory(d);this.activated=s.createComponent(C,s.length,w)}else this.activated=s.createComponent(d,{index:s.length,injector:w,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Qn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ms]}),e})();class VR{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===Bh?this.route:t===yf?this.childContexts:this.parent.get(t,n)}}let Z_=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=hs({type:e,selectors:[["ng-component"]],standalone:!0,features:[Gx],decls:1,vars:0,template:function(n,r){1&n&&Np(0,"router-outlet")},dependencies:[J1],encapsulation:2}),e})();function Q1(e,t){return e.providers&&!e._injector&&(e._injector=qp(e.providers,t,`Route: ${e.path}`)),e._injector??t}function K_(e){const t=e.children&&e.children.map(K_),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Vt&&(n.component=Z_),n}function ts(e){return e.outlet||Vt}function eD(e,t){const n=e.filter(r=>ts(r)===t);return n.push(...e.filter(r=>ts(r)!==t)),n}function _f(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class WR{constructor(t,n,r,s){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=s}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),G_(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const s=Nh(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,s[d],r),delete s[d]}),bi(s,(c,d)=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(t,n,r){const s=t.value,c=n?n.value:null;if(s===c)if(s.component){const d=r.getContext(s.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,r);else c&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),s=r&&t.value.component?r.children:n,c=Nh(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],s);if(r&&r.outlet){const d=r.outlet.detach(),_=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),s=r&&t.value.component?r.children:n,c=Nh(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],s);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const s=Nh(n);t.children.forEach(c=>{this.activateRoutes(c,s[c.value.outlet],r),this.forwardEvent(new MR(c.value.snapshot))}),t.children.length&&this.forwardEvent(new IR(t.value.snapshot))}activateRoutes(t,n,r){const s=t.value,c=n?n.value:null;if(G_(s),s===c)if(s.component){const d=r.getOrCreateContext(s.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,r);else if(s.component){const d=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const _=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),G_(_.route.value),this.activateChildRoutes(t,null,d.children)}else{const _=_f(s.snapshot),w=_?.get(Od)??null;d.attachRef=null,d.route=s,d.resolver=w,d.injector=_,d.outlet&&d.outlet.activateWith(s,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,r)}}class tD{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class km{constructor(t,n){this.component=t,this.route=n}}function ZR(e,t,n){const r=e._root;return vf(r,t?t._root:null,n,[r.value])}function Uh(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function hc(e){return null!==is(e)}(e)?t.get(e):e:r}function vf(e,t,n,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=Nh(t);return e.children.forEach(d=>{(function KR(e,t,n,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const w=function YR(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!lu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!lu(e.url,t.url)||!_a(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!q_(e,t)||!_a(e.queryParams,t.queryParams);default:return!q_(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);w?s.canActivateChecks.push(new tD(r)):(c.data=d.data,c._resolvedData=d._resolvedData),vf(e,t,c.component?_?_.children:null:n,r,s),w&&_&&_.outlet&&_.outlet.isActivated&&s.canDeactivateChecks.push(new km(_.outlet.component,d))}else d&&xf(t,_,s),s.canActivateChecks.push(new tD(r)),vf(e,null,c.component?_?_.children:null:n,r,s)})(d,c[d.value.outlet],n,r.concat([d.value]),s),delete c[d.value.outlet]}),bi(c,(d,_)=>xf(d,n.getContext(_),s)),s}function xf(e,t,n){const r=Nh(e),s=e.value;bi(r,(c,d)=>{xf(c,s.component?t?t.children.getContext(d):null:t,n)}),n.canDeactivateChecks.push(new km(s.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,s))}function bf(e){return"function"==typeof e}function Y_(e){return e instanceof xm||"EmptyError"===e?.name}const Lm=Symbol("INITIAL_VALUE");function Vh(){return ya(e=>m1(e.map(t=>t.pipe(lf(1),function jP(...e){const t=Xe(e);return wn((n,r)=>{(t?A_(e,n,t):A_(e,n)).subscribe(r)})}(Lm)))).pipe(Nt(t=>{for(const n of t)if(!0!==n){if(n===Lm)return Lm;if(!1===n||n instanceof tc)return n}return!0}),Yl(t=>t!==Lm),lf(1)))}function nD(e){return function di(...e){return Qr(e)}(Bi(t=>{if(cu(t))throw Z1(0,t)}),Nt(t=>!0===t))}const J_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rD(e,t,n,r,s){const c=Q_(e,t,n);return c.matched?function pk(e,t,n,r){const s=t.canMatch;return s&&0!==s.length?_t(s.map(d=>{const _=Uh(d,e);return ec(function rk(e){return e&&bf(e.canMatch)}(_)?_.canMatch(t,n):e.runInContext(()=>_(t,n)))})).pipe(Vh(),nD()):_t(!0)}(r=Q1(t,r),t,n).pipe(Nt(d=>!0===d?c:{...J_})):_t(c)}function Q_(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...J_}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const s=(t.matcher||XP)(n,e,t);if(!s)return{...J_};const c={};bi(s.posParams,(_,w)=>{c[w]=_.path});const d=s.consumed.length>0?{...c,...s.consumed[s.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:s.consumed,remainingSegments:n.slice(s.consumed.length),parameters:d,positionalParamSegments:s.posParams??{}}}function Fm(e,t,n,r){if(n.length>0&&function yk(e,t,n){return n.some(r=>Om(e,t,r)&&ts(r)!==Vt)}(e,n,r)){const c=new en(t,function gk(e,t,n,r){const s={};s[Vt]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const c of n)if(""===c.path&&ts(c)!==Vt){const d=new en([],{});d._sourceSegment=e,d._segmentIndexShift=t.length,s[ts(c)]=d}return s}(e,t,r,new en(n,e.children)));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:[]}}if(0===n.length&&function _k(e,t,n){return n.some(r=>Om(e,t,r))}(e,n,r)){const c=new en(e.segments,function mk(e,t,n,r,s){const c={};for(const d of r)if(Om(e,n,d)&&!s[ts(d)]){const _=new en([],{});_._sourceSegment=e,_._segmentIndexShift=t.length,c[ts(d)]=_}return{...s,...c}}(e,t,n,r,e.children));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:n}}const s=new en(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Om(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function iD(e,t,n,r){return!!(ts(e)===r||r!==Vt&&Om(t,n,e))&&("**"===e.path||Q_(t,e,n).matched)}function oD(e,t,n){return 0===t.length&&!e.children[n]}const zm=!1;class Nm{constructor(t){this.segmentGroup=t||null}}class sD{constructor(t){this.urlTree=t}}function wf(e){return af(new Nm(e))}function aD(e){return af(new sD(e))}class wk{constructor(t,n,r,s,c){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=s,this.config=c,this.allowRedirects=!0}apply(){const t=Fm(this.urlTree.root,[],[],this.config).segmentGroup,n=new en(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,Vt).pipe(Nt(c=>this.createUrlTree(Tm(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ql(c=>{if(c instanceof sD)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof Nm?this.noMatchError(c):c}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Vt).pipe(Nt(s=>this.createUrlTree(Tm(s),t.queryParams,t.fragment))).pipe(Ql(s=>{throw s instanceof Nm?this.noMatchError(s):s}))}noMatchError(t){return new ze(4002,zm)}createUrlTree(t,n,r){const s=O_(t);return new tc(s,n,r)}expandSegmentGroup(t,n,r,s){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(Nt(c=>new en([],c))):this.expandSegment(t,r,n,r.segments,s,!0)}expandChildren(t,n,r){const s=[];for(const c of Object.keys(r.children))"primary"===c?s.unshift(c):s.push(c);return Zn(s).pipe(au(c=>{const d=r.children[c],_=eD(n,c);return this.expandSegmentGroup(t,_,d,c).pipe(Nt(w=>({segment:w,outlet:c})))}),x1((c,d)=>(c[d.outlet]=d.segment,c),{}),b1())}expandSegment(t,n,r,s,c,d){return Zn(r).pipe(au(_=>this.expandSegmentAgainstRoute(t,n,r,_,s,c,d).pipe(Ql(C=>{if(C instanceof Nm)return _t(null);throw C}))),Jl(_=>!!_),Ql((_,w)=>{if(Y_(_))return oD(n,s,c)?_t(new en([],{})):wf(n);throw _}))}expandSegmentAgainstRoute(t,n,r,s,c,d,_){return iD(s,n,c,d)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(t,n,s,c,d):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,s,c,d):wf(n):wf(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,s,c,d){return"**"===s.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,s,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,s,c,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,s){const c=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?aD(c):this.lineralizeSegments(r,c).pipe(Y(d=>{const _=new en(d,{});return this.expandSegment(t,_,n,d,s,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,s,c,d){const{matched:_,consumedSegments:w,remainingSegments:C,positionalParamSegments:M}=Q_(n,s,c);if(!_)return wf(n);const z=this.applyRedirectCommands(w,s.redirectTo,M);return s.redirectTo.startsWith("/")?aD(z):this.lineralizeSegments(s,z).pipe(Y(q=>this.expandSegment(t,n,r,q.concat(C),d,!1)))}matchSegmentAgainstRoute(t,n,r,s,c){return"**"===r.path?(t=Q1(r,t),r.loadChildren?(r._loadedRoutes?_t({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(Nt(_=>(r._loadedRoutes=_.routes,r._loadedInjector=_.injector,new en(s,{})))):_t(new en(s,{}))):rD(n,r,s,t).pipe(ya(({matched:d,consumedSegments:_,remainingSegments:w})=>d?this.getChildConfig(t=r._injector??t,r,s).pipe(Y(M=>{const z=M.injector??t,q=M.routes,{segmentGroup:te,slicedSegments:le}=Fm(n,_,w,q),ve=new en(te.segments,te.children);if(0===le.length&&ve.hasChildren())return this.expandChildren(z,q,ve).pipe(Nt(Ee=>new en(_,Ee)));if(0===q.length&&0===le.length)return _t(new en(_,{}));const Ce=ts(r)===c;return this.expandSegment(z,ve,q,le,Ce?Vt:c,!0).pipe(Nt(qe=>new en(_.concat(qe.segments),qe.children)))})):wf(n)))}getChildConfig(t,n,r){return n.children?_t({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?_t({routes:n._loadedRoutes,injector:n._loadedInjector}):function fk(e,t,n,r){const s=t.canLoad;return void 0===s||0===s.length?_t(!0):_t(s.map(d=>{const _=Uh(d,e);return ec(function QR(e){return e&&bf(e.canLoad)}(_)?_.canLoad(t,n):e.runInContext(()=>_(t,n)))})).pipe(Vh(),nD())}(t,n,r).pipe(Y(s=>s?this.configLoader.loadChildren(t,n).pipe(Bi(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function xk(e){return af(X1(zm,3))}())):_t({routes:[],injector:t})}lineralizeSegments(t,n){let r=[],s=n.root;for(;;){if(r=r.concat(s.segments),0===s.numberOfChildren)return _t(r);if(s.numberOfChildren>1||!s.children[Vt])return t.redirectTo,af(new ze(4e3,zm));s=s.children[Vt]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,s){const c=this.createSegmentGroup(t,n.root,r,s);return new tc(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return bi(t,(s,c)=>{if("string"==typeof s&&s.startsWith(":")){const _=s.substring(1);r[c]=n[_]}else r[c]=s}),r}createSegmentGroup(t,n,r,s){const c=this.createSegments(t,n.segments,r,s);let d={};return bi(n.children,(_,w)=>{d[w]=this.createSegmentGroup(t,_,r,s)}),new en(c,d)}createSegments(t,n,r,s){return n.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,s):this.findOrReturn(c,r))}findPosParam(t,n,r){const s=r[n.path.substring(1)];if(!s)throw new ze(4001,zm);return s}findOrReturn(t,n){let r=0;for(const s of n){if(s.path===t.path)return n.splice(r),s;r++}return t}}class Ek{}class Ik{constructor(t,n,r,s,c,d,_){this.injector=t,this.rootComponentType=n,this.config=r,this.urlTree=s,this.url=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_}recognize(){const t=Fm(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Vt).pipe(Nt(n=>{if(null===n)return null;const r=new Pm([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Vt,this.rootComponentType,null,this.urlTree.root,-1,{}),s=new nl(r,n),c=new q1(this.url,s);return this.inheritParamsAndData(c._root),c}))}inheritParamsAndData(t){const n=t.value,r=G1(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(s=>this.inheritParamsAndData(s))}processSegmentGroup(t,n,r,s){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,s)}processChildren(t,n,r){return Zn(Object.keys(r.children)).pipe(au(s=>{const c=r.children[s],d=eD(n,s);return this.processSegmentGroup(t,d,c,s)}),x1((s,c)=>s&&c?(s.push(...c),s):null),function qP(e,t=!1){return wn((n,r)=>{let s=0;n.subscribe(On(r,c=>{const d=e(c,s++);(d||t)&&r.next(c),!d&&r.complete()}))})}(s=>null!==s),bm(null),b1(),Nt(s=>{if(null===s)return null;const c=cD(s);return function Tk(e){e.sort((t,n)=>t.value.outlet===Vt?-1:n.value.outlet===Vt?1:t.value.outlet.localeCompare(n.value.outlet))}(c),c}))}processSegment(t,n,r,s,c){return Zn(n).pipe(au(d=>this.processSegmentAgainstRoute(d._injector??t,d,r,s,c)),Jl(d=>!!d),Ql(d=>{if(Y_(d))return oD(r,s,c)?_t([]):_t(null);throw d}))}processSegmentAgainstRoute(t,n,r,s,c){if(n.redirectTo||!iD(n,r,s,c))return _t(null);let d;if("**"===n.path){const _=s.length>0?E1(s).parameters:{},w=hD(r)+s.length;d=_t({snapshot:new Pm(s,_,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,dD(n),ts(n),n.component??n._loadedComponent??null,n,uD(r),w,fD(n)),consumedSegments:[],remainingSegments:[]})}else d=rD(r,n,s,t).pipe(Nt(({matched:_,consumedSegments:w,remainingSegments:C,parameters:M})=>{if(!_)return null;const z=hD(r)+w.length;return{snapshot:new Pm(w,M,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,dD(n),ts(n),n.component??n._loadedComponent??null,n,uD(r),z,fD(n)),consumedSegments:w,remainingSegments:C}}));return d.pipe(ya(_=>{if(null===_)return _t(null);const{snapshot:w,consumedSegments:C,remainingSegments:M}=_;t=n._injector??t;const z=n._loadedInjector??t,q=function Mk(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:te,slicedSegments:le}=Fm(r,C,M,q.filter(Ce=>void 0===Ce.redirectTo));if(0===le.length&&te.hasChildren())return this.processChildren(z,q,te).pipe(Nt(Ce=>null===Ce?null:[new nl(w,Ce)]));if(0===q.length&&0===le.length)return _t([new nl(w,[])]);const ve=ts(n)===c;return this.processSegment(z,q,te,le,ve?Vt:c).pipe(Nt(Ce=>null===Ce?null:[new nl(w,Ce)]))}))}}function Ak(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function cD(e){const t=[],n=new Set;for(const r of e){if(!Ak(r)){t.push(r);continue}const s=t.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==s?(s.children.push(...r.children),n.add(s)):t.push(r)}for(const r of n){const s=cD(r.children);t.push(new nl(r.value,s))}return t.filter(r=>!n.has(r))}function uD(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function hD(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function dD(e){return e.data||{}}function fD(e){return e.resolve||{}}function pD(e){return"string"==typeof e.title||null===e.title}function ev(e){return ya(t=>{const n=e(t);return n?Zn(n).pipe(Nt(()=>t)):_t(t)})}const $h=new mt("ROUTES");let tv=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return _t(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=ec(n.loadComponent()).pipe(Nt(gD),Bi(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),k_(()=>{this.componentLoaders.delete(n)})),s=new _1(r,()=>new $r).pipe(P_());return this.componentLoaders.set(n,s),s}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return _t({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const c=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Nt(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let w,C,M=!1;Array.isArray(_)?C=_:(w=_.create(n).injector,C=D1(w.get($h,[],ft.Self|ft.Optional)));return{routes:C.map(K_),injector:w}}),k_(()=>{this.childrenLoaders.delete(r)})),d=new _1(c,()=>new $r).pipe(P_());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(n){return ec(n()).pipe(Nt(gD),Y(s=>s instanceof jx||Array.isArray(s)?_t(s):Zn(this.compiler.compileModuleAsync(s))))}}return e.\u0275fac=function(n){return new(n||e)(Fe(da),Fe(Lb))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function gD(e){return function Bk(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Um=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new $r,this.configLoader=ot(tv),this.environmentInjector=ot(Ts),this.urlSerializer=ot(hf),this.rootContexts=ot(yf),this.navigationId=0,this.afterPreactivation=()=>_t(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new CR(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new ER(s))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new Os({id:0,targetPageId:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:mf,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Yl(r=>0!==r.id),Nt(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),ya(r=>{let s=!1,c=!1;return _t(r).pipe(Bi(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ya(d=>{const _=n.browserUrlTree.toString(),w=!n.navigated||d.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(!w&&"reload"!==(d.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const M="";return this.events.next(new Am(d.id,n.serializeUrl(r.rawUrl),M,0)),n.rawUrlTree=d.rawUrl,d.resolve(null),re}if(n.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return yD(d.source)&&(n.browserUrlTree=d.extractedUrl),_t(d).pipe(ya(M=>{const z=this.transitions?.getValue();return this.events.next(new U_(M.id,this.urlSerializer.serialize(M.extractedUrl),M.source,M.restoredState)),z!==this.transitions?.getValue()?re:Promise.resolve(M)}),function Dk(e,t,n,r){return ya(s=>function bk(e,t,n,r,s){return new wk(e,t,n,r,s).apply()}(e,t,n,s.extractedUrl,r).pipe(Nt(c=>({...s,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,n.config),Bi(M=>{this.currentNavigation={...this.currentNavigation,finalUrl:M.urlAfterRedirects},r.urlAfterRedirects=M.urlAfterRedirects}),function Rk(e,t,n,r,s){return Y(c=>function Sk(e,t,n,r,s,c,d="emptyOnly"){return new Ik(e,t,n,r,s,d,c).recognize().pipe(ya(_=>null===_?function Ck(e){return new rn(t=>t.error(e))}(new Ek):_t(_)))}(e,t,n,c.urlAfterRedirects,r.serialize(c.urlAfterRedirects),r,s).pipe(Nt(d=>({...c,targetSnapshot:d}))))}(this.environmentInjector,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Bi(M=>{if(r.targetSnapshot=M.targetSnapshot,"eager"===n.urlUpdateStrategy){if(!M.extras.skipLocationChange){const q=n.urlHandlingStrategy.merge(M.urlAfterRedirects,M.rawUrl);n.setBrowserUrl(q,M)}n.browserUrlTree=M.urlAfterRedirects}const z=new vR(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(z)}));if(w&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:M,extractedUrl:z,source:q,restoredState:te,extras:le}=d,ve=new U_(M,this.urlSerializer.serialize(z),q,te);this.events.next(ve);const Ce=H1(z,this.rootComponentType).snapshot;return _t(r={...d,targetSnapshot:Ce,urlAfterRedirects:z,extras:{...le,skipLocationChange:!1,replaceUrl:!1}})}{const M="";return this.events.next(new Am(d.id,n.serializeUrl(r.extractedUrl),M,1)),n.rawUrlTree=d.rawUrl,d.resolve(null),re}}),Bi(d=>{const _=new xR(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),Nt(d=>r={...d,guards:ZR(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function ok(e,t){return Y(n=>{const{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?_t({...n,guardsResult:!0}):function sk(e,t,n,r){return Zn(e).pipe(Y(s=>function dk(e,t,n,r,s){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?_t(c.map(_=>{const w=_f(t)??s,C=Uh(_,w);return ec(function nk(e){return e&&bf(e.canDeactivate)}(C)?C.canDeactivate(e,t,n,r):w.runInContext(()=>C(e,t,n,r))).pipe(Jl())})).pipe(Vh()):_t(!0)}(s.component,s.route,n,t,r)),Jl(s=>!0!==s,!0))}(d,r,s,e).pipe(Y(_=>_&&function JR(e){return"boolean"==typeof e}(_)?function ak(e,t,n,r){return Zn(t).pipe(au(s=>A_(function ck(e,t){return null!==e&&t&&t(new SR(e)),_t(!0)}(s.route.parent,r),function lk(e,t){return null!==e&&t&&t(new TR(e)),_t(!0)}(s.route,r),function hk(e,t,n){const r=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function XR(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>y1(()=>_t(d.guards.map(w=>{const C=_f(d.node)??n,M=Uh(w,C);return ec(function tk(e){return e&&bf(e.canActivateChild)}(M)?M.canActivateChild(r,e):C.runInContext(()=>M(r,e))).pipe(Jl())})).pipe(Vh())));return _t(c).pipe(Vh())}(e,s.path,n),function uk(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return _t(!0);const s=r.map(c=>y1(()=>{const d=_f(t)??n,_=Uh(c,d);return ec(function ek(e){return e&&bf(e.canActivate)}(_)?_.canActivate(t,e):d.runInContext(()=>_(t,e))).pipe(Jl())}));return _t(s).pipe(Vh())}(e,s.route,n))),Jl(s=>!0!==s,!0))}(r,c,e,t):_t(_)),Nt(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),Bi(d=>{if(r.guardsResult=d.guardsResult,cu(d.guardsResult))throw Z1(0,d.guardsResult);const _=new bR(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),Yl(d=>!!d.guardsResult||(n.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),ev(d=>{if(d.guards.canActivateChecks.length)return _t(d).pipe(Bi(_=>{const w=new wR(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(w)}),ya(_=>{let w=!1;return _t(_).pipe(function kk(e,t){return Y(n=>{const{targetSnapshot:r,guards:{canActivateChecks:s}}=n;if(!s.length)return _t(n);let c=0;return Zn(s).pipe(au(d=>function Lk(e,t,n,r){const s=e.routeConfig,c=e._resolve;return void 0!==s?.title&&!pD(s)&&(c[cf]=s.title),function Fk(e,t,n,r){const s=function Ok(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===s.length)return _t({});const c={};return Zn(s).pipe(Y(d=>function zk(e,t,n,r){const s=_f(t)??r,c=Uh(e,s);return ec(c.resolve?c.resolve(t,n):s.runInContext(()=>c(t,n)))}(e[d],t,n,r).pipe(Jl(),Bi(_=>{c[d]=_}))),R_(1),function WP(e){return Nt(()=>e)}(c),Ql(d=>Y_(d)?re:af(d)))}(c,e,t,r).pipe(Nt(d=>(e._resolvedData=d,e.data=G1(e,n).resolve,s&&pD(s)&&(e.data[cf]=s.title),null)))}(d.route,r,e,t)),Bi(()=>c++),R_(1),Y(d=>c===s.length?_t(n):re))})}(n.paramsInheritanceStrategy,this.environmentInjector),Bi({next:()=>w=!0,complete:()=>{w||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2))}}))}),Bi(_=>{const w=new DR(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(w)}))}),ev(d=>{const _=w=>{const C=[];w.routeConfig?.loadComponent&&!w.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(w.routeConfig).pipe(Bi(M=>{w.component=M}),Nt(()=>{})));for(const M of w.children)C.push(..._(M));return C};return m1(_(d.targetSnapshot.root)).pipe(bm(),lf(1))}),ev(()=>this.afterPreactivation()),Nt(d=>{const _=function zR(e,t,n){const r=gf(e,t._root,n?n._root:void 0);return new j1(r,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:_}}),Bi(d=>{n.currentUrlTree=d.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),n.routerState=d.targetRouterState,"deferred"===n.urlUpdateStrategy&&(d.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,d),n.browserUrlTree=d.urlAfterRedirects)}),((e,t,n)=>Nt(r=>(new WR(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d)),Bi({next:d=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new uu(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{s=!0}}),k_(()=>{s||c||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Ql(d=>{if(c=!0,Y1(d)){K1(d)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new Mm(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(_),K1(d)){const w=n.urlHandlingStrategy.merge(d.url,n.rawUrlTree),C={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||yD(r.source)};n.scheduleNavigation(w,mf,null,C,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new V_(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(d))}catch(w){r.reject(w)}}return re}))}))}cancelNavigationTransition(n,r,s){const c=new Mm(n.id,this.urlSerializer.serialize(n.extractedUrl),r,s);this.events.next(c),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function yD(e){return e!==mf}let _D=(()=>{class e{buildTitle(n){let r,s=n.root;for(;void 0!==s;)r=this.getResolvedTitleForRoute(s)??r,s=s.children.find(c=>c.outlet===Vt);return r}getResolvedTitleForRoute(n){return n.data[cf]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return ot(Uk)},providedIn:"root"}),e})(),Uk=(()=>{class e extends _D{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(Fe(Kw))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Vk=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return ot(jk)},providedIn:"root"}),e})();class $k{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let jk=(()=>{class e extends $k{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function Vf(e){return Vi(()=>{const t=e.prototype.constructor,n=t[Ai]||od(t),r=Object.prototype;let s=Object.getPrototypeOf(e.prototype).constructor;for(;s&&s!==r;){const c=s[Ai]||od(s);if(c&&c!==n)return c;s=Object.getPrototypeOf(s)}return c=>new c})}(e)))(r||e)}}(),e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Vm=new mt("",{providedIn:"root",factory:()=>({})});let Gk=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:function(){return ot(qk)},providedIn:"root"}),e})(),qk=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Wk(e){throw e}function Zk(e,t,n){return t.parse("/")}const Xk={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Kk={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ko=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ot(ET),this.isNgZoneEnabled=!1,this.options=ot(Vm,{optional:!0})||{},this.errorHandler=this.options.errorHandler||Wk,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Zk,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ot(Gk),this.routeReuseStrategy=ot(Vk),this.urlCreationStrategy=ot(LR),this.titleStrategy=ot(_D),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=D1(ot($h,{optional:!0})??[]),this.navigationTransitions=ot(Um),this.urlSerializer=ot(hf),this.location=ot(Zy),this.isNgZoneEnabled=ot(br)instanceof br&&br.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new tc,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=H1(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),mf,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,r,n.state)},0)}))}navigateToSyncWithBrowser(n,r,s){const c={replaceUrl:!0},d=s?.navigationId?s:null;if(s){const w={...s};delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(c.state=w)}const _=this.parseUrl(n);this.scheduleNavigation(_,r,d,c)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(n){this.config=n.map(K_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:s,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:w}=r,C=w?this.currentUrlTree.fragment:d;let M=null;switch(_){case"merge":M={...this.currentUrlTree.queryParams,...c};break;case"preserve":M=this.currentUrlTree.queryParams;break;default:M=c||null}return null!==M&&(M=this.removeEmptyProps(M)),this.urlCreationStrategy.createUrlTree(s,this.routerState,this.currentUrlTree,n,M,C??null)}navigateByUrl(n,r={skipLocationChange:!1}){const s=cu(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(c,mf,null,r)}navigate(n,r={skipLocationChange:!1}){return function Yk(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new ze(4008,false)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(s){r=this.malformedUriErrorHandler(s,this.urlSerializer,n)}return r}isActive(n,r){let s;if(s=!0===r?{...Xk}:!1===r?{...Kk}:r,cu(n))return S1(this.currentUrlTree,n,s);const c=this.parseUrl(n);return S1(this.currentUrlTree,c,s)}removeEmptyProps(n){return Object.keys(n).reduce((r,s)=>{const c=n[s];return null!=c&&(r[s]=c),r},{})}scheduleNavigation(n,r,s,c,d){if(this.disposed)return Promise.resolve(!1);let _,w,C,M;return d?(_=d.resolve,w=d.reject,C=d.promise):C=new Promise((z,q)=>{_=z,w=q}),M="computed"===this.canceledNavigationResolution?s&&s.\u0275routerPageId?s.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:M,source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:w,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(z=>Promise.reject(z))}setBrowserUrl(n,r){const s=this.urlSerializer.serialize(n),c={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl?this.location.replaceState(s,"",c):this.location.go(s,"",c)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===s?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(s)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class vD{}let eL=(()=>{class e{constructor(n,r,s,c,d){this.router=n,this.injector=s,this.preloadingStrategy=c,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Yl(n=>n instanceof uu),au(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const s=[];for(const c of r){c.providers&&!c._injector&&(c._injector=qp(c.providers,n,`Route: ${c.path}`));const d=c._injector??n,_=c._loadedInjector??d;c.loadChildren&&!c._loadedRoutes&&void 0===c.canLoad||c.loadComponent&&!c._loadedComponent?s.push(this.preloadConfig(d,c)):(c.children||c._loadedRoutes)&&s.push(this.processRoutes(_,c.children??c._loadedRoutes))}return Zn(s).pipe(ne())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let s;s=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):_t(null);const c=s.pipe(Y(d=>null===d?_t(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??n,d.routes))));return r.loadComponent&&!r._loadedComponent?Zn([c,this.loader.loadComponent(r)]).pipe(ne()):c})}}return e.\u0275fac=function(n){return new(n||e)(Fe(ko),Fe(Lb),Fe(Ts),Fe(vD),Fe(tv))},e.\u0275prov=it({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const iv=new mt("");let xD=(()=>{class e{constructor(n,r,s,c,d={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=s,this.zone=c,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof U_?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof uu&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof V1&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new V1(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function Bv(){throw new Error("invalid")}()},e.\u0275prov=it({token:e,factory:e.\u0275fac}),e})();var Lo=(()=>((Lo=Lo||{})[Lo.COMPLETE=0]="COMPLETE",Lo[Lo.FAILED=1]="FAILED",Lo[Lo.REDIRECTING=2]="REDIRECTING",Lo))();const jh=!1;function nc(e,t){return{\u0275kind:e,\u0275providers:t}}const ov=new mt("",{providedIn:"root",factory:()=>!1});function wD(){const e=ot(da);return t=>{const n=e.get(Qp);if(t!==n.components[0])return;const r=e.get(ko),s=e.get(DD);1===e.get(sv)&&r.initialNavigation(),e.get(ED,null,ft.Optional)?.setUpPreloading(),e.get(iv,null,ft.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),s.closed||(s.next(),s.unsubscribe())}}const DD=new mt(jh?"bootstrap done indicator":"",{factory:()=>new $r}),sv=new mt(jh?"initial navigation":"",{providedIn:"root",factory:()=>1});function oL(){let e=[];return e=jh?[{provide:vr,multi:!0,useFactory:()=>{const t=ot(ko);return()=>t.events.subscribe(n=>{console.group?.(`Router Event: ${n.constructor.name}`),console.log(function AR(e){if(!("type"in e))return`Unknown Router Event: ${e.constructor.name}`;switch(e.type){case 14:return`ActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state}, shouldActivate: ${e.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 2:return`NavigationCancel(id: ${e.id}, url: '${e.url}')`;case 16:return`NavigationSkipped(id: ${e.id}, url: '${e.url}')`;case 1:return`NavigationEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${e.id}, url: '${e.url}', error: ${e.error})`;case 0:return`NavigationStart(id: ${e.id}, url: '${e.url}')`;case 6:return`ResolveEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 5:return`ResolveStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 10:return`RouteConfigLoadEnd(path: ${e.route.path})`;case 9:return`RouteConfigLoadStart(path: ${e.route.path})`;case 4:return`RoutesRecognized(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 15:return`Scroll(anchor: '${e.anchor}', position: '${e.position?`${e.position[0]}, ${e.position[1]}`:null}')`}}(n)),console.log(n),console.groupEnd?.()})}}]:[],nc(1,e)}const ED=new mt(jh?"router preloader":"");function sL(e){return nc(0,[{provide:ED,useExisting:eL},{provide:vD,useExisting:e}])}const Df=!1,CD=new mt(Df?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),aL=[Zy,{provide:hf,useClass:L_},ko,yf,{provide:Bh,useFactory:function bD(e){return e.routerState.root},deps:[ko]},tv,Df?{provide:ov,useValue:!0}:[]];function lL(){return new Vb("Router",ko)}let cL=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[aL,Df&&r?.enableTracing?oL().\u0275providers:[],{provide:$h,multi:!0,useValue:n},{provide:CD,useFactory:fL,deps:[[ko,new kl,new Nc]]},{provide:Vm,useValue:r||{}},r?.useHash?{provide:ru,useClass:hM}:{provide:ru,useClass:uw},{provide:iv,useFactory:()=>{const e=ot(kA),t=ot(br),n=ot(Vm),r=ot(Um),s=ot(hf);return n.scrollOffset&&e.setOffset(n.scrollOffset),new xD(s,r,e,t,n)}},r?.preloadingStrategy?sL(r.preloadingStrategy).\u0275providers:[],{provide:Vb,multi:!0,useFactory:lL},r?.initialNavigation?pL(r):[],[{provide:SD,useFactory:wD},{provide:kb,multi:!0,useExisting:SD}]]}}static forChild(n){return{ngModule:e,providers:[{provide:$h,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Fe(CD,8))},e.\u0275mod=Ho({type:e}),e.\u0275inj=no({imports:[Z_]}),e})();function fL(e){if(Df&&e)throw new ze(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function pL(e){return["disabled"===e.initialNavigation?nc(3,[{provide:Kp,multi:!0,useFactory:()=>{const t=ot(ko);return()=>{t.setUpLocationChangeListener()}}},{provide:sv,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?nc(2,[{provide:sv,useValue:0},{provide:Kp,multi:!0,deps:[da],useFactory:t=>{const n=t.get(cM,Promise.resolve());return()=>n.then(()=>new Promise(r=>{const s=t.get(ko),c=t.get(DD);(function tL(e,t){e.events.pipe(Yl(n=>n instanceof uu||n instanceof Mm||n instanceof V_||n instanceof Am),Nt(n=>n instanceof uu||n instanceof Am?Lo.COMPLETE:n instanceof Mm&&(0===n.code||1===n.code)?Lo.REDIRECTING:Lo.FAILED),Yl(n=>n!==Lo.REDIRECTING),lf(1)).subscribe(()=>{t()})})(s,()=>{r(!0)}),t.get(Um).afterPreactivation=()=>(r(!0),c.closed?_t(void 0):c),s.initialNavigation()}))}}]).\u0275providers:[]]}const SD=new mt(Df?"Router Initializer":"");class Hh{}Hh.\u0275fac=function(t){return new(t||Hh)},Hh.\u0275mod=Ho({type:Hh,bootstrap:[sf]}),Hh.\u0275inj=no({imports:[P2,cL.forRoot([],{initialNavigation:"enabledBlocking"})]}),A2().bootstrapModule(Hh).catch(e=>console.error(e))},572:(zs,Fo,ar)=>{var an;!function(){"use strict";function Oo(Je,ue){var Yt=Je.x-ue.x,zt=Je.y-ue.y;return Yt*Yt+zt*zt}function Ns(Je,ue,Yt){var zt=ue.x,Sn=ue.y,bn=Yt.x-zt,mn=Yt.y-Sn;if(0!==bn||0!==mn){var wr=((Je.x-zt)*bn+(Je.y-Sn)*mn)/(bn*bn+mn*mn);wr>1?(zt=Yt.x,Sn=Yt.y):wr>0&&(zt+=bn*wr,Sn+=mn*wr)}return(bn=Je.x-zt)*bn+(mn=Je.y-Sn)*mn}function pn(Je,ue,Yt,zt,Sn){for(var mn,bn=zt,wr=ue+1;wr<Yt;wr++){var ln=Ns(Je[wr],Je[ue],Je[Yt]);ln>bn&&(mn=wr,bn=ln)}bn>zt&&(mn-ue>1&&pn(Je,ue,mn,zt,Sn),Sn.push(Je[mn]),Yt-mn>1&&pn(Je,mn,Yt,zt,Sn))}function ui(Je,ue){var Yt=Je.length-1,zt=[Je[0]];return pn(Je,0,Yt,ue,zt),zt.push(Je[Yt]),zt}function hi(Je,ue,Yt){if(Je.length<=2)return Je;var zt=void 0!==ue?ue*ue:1;return Je=Yt?Je:function y(Je,ue){for(var Sn,Yt=Je[0],zt=[Yt],bn=1,mn=Je.length;bn<mn;bn++)Oo(Sn=Je[bn],Yt)>ue&&(zt.push(Sn),Yt=Sn);return Yt!==Sn&&zt.push(Sn),zt}(Je,zt),ui(Je,zt)}void 0!==(an=function(){return hi}.call(Fo,ar,Fo,zs))&&(zs.exports=an)}()},943:function(zs){zs.exports=function(){"use strict";var Fo,ar,an;function Oo(y,pn){if(Fo)if(ar){var ui="var sharedChunk = {}; ("+Fo+")(sharedChunk); ("+ar+")(sharedChunk);",hi={};Fo(hi),an=pn(hi),typeof window<"u"&&(an.workerUrl=window.URL.createObjectURL(new Blob([ui],{type:"text/javascript"})))}else ar=pn;else Fo=pn}return Oo(0,function(y){var pn=ui;function ui(a,i,l,h){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=i,this.p2x=l,this.p2y=h}function hi(a,i,l,h){const p=new pn(a,i,l,h);return function(v){return p.solve(v)}}ui.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,i){if(void 0===i&&(i=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,h=0;h<8;h++){var p=this.sampleCurveX(l)-a;if(Math.abs(p)<i)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=p/v}var x=0,D=1;for(l=a,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-a)<i));h++)a>p?x=l:D=l,l=.5*(D-x)+x;return l},solve:function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))}};const Je=hi(.25,.1,.25,1);function ue(a,i,l){return Math.min(l,Math.max(i,a))}function Yt(a,i,l){const h=l-i,p=((a-i)%h+h)%h+i;return p===i?l:p}function zt(a,...i){for(const l of i)for(const h in l)a[h]=l[h];return a}let Sn=1;function bn(a,i){a.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function mn(a,i,l){const h={};for(const p in a)h[p]=i.call(l||this,a[p],p,a);return h}function wr(a,i,l){const h={};for(const p in a)i.call(l||this,a[p],p,a)&&(h[p]=a[p]);return h}function ln(a){return Array.isArray(a)?a.map(ln):"object"==typeof a&&a?mn(a,ln):a}const Kr={};function Vn(a){Kr[a]||(typeof console<"u"&&console.warn(a),Kr[a]=!0)}function Kt(a,i,l){return(l.y-a.y)*(i.x-a.x)>(i.y-a.y)*(l.x-a.x)}function dt(a){let i=0;for(let l,h,p=0,v=a.length,x=v-1;p<v;x=p++)l=a[p],h=a[x],i+=(h.x-l.x)*(l.y+h.y);return i}function qt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function In(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,p,v)=>{const x=p||v;return i[h]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let Vr,Yn,Dr=null;function Yr(a){if(null==Dr){const i=a.navigator?a.navigator.userAgent:null;Dr=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Dr}function Er(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Jr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const i=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(a,i=0){const l=window.document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,h.drawImage(a,0,0,a.width,a.height),h.getImageData(-i,-i,a.width+2*i,a.height+2*i)},resolveURL:a=>(Vr||(Vr=document.createElement("a")),Vr.href=a,Vr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Yn&&(Yn=matchMedia("(prefers-reduced-motion: reduce)")),Yn.matches)}};var tt=Gn;function Gn(a,i){this.x=a,this.y=i}Gn.prototype={clone:function(){return new Gn(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,l=a.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),l=Math.sin(a),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround:function(a,i){var l=Math.cos(a),h=Math.sin(a),p=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gn.convert=function(a){return a instanceof Gn?a:Array.isArray(a)?new Gn(a[0],a[1]):a};const di={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Qr="mapbox-tiles";let rn,ns=500,po=50;function No(){typeof caches>"u"||rn||(rn=caches.open(Qr))}let $r=1/0;const wi={supported:!1,testSupport:function(a){!On&&wn&&(rl?Nt(a):Qi=a)}};let Qi,wn,On=!1,rl=!1;function Nt(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,wn),a.isContextLost())return;wi.supported=!0}catch{}a.deleteTexture(i),On=!0}typeof document<"u"&&(wn=document.createElement("img"),wn.onload=function(){Qi&&Nt(Qi),Qi=null,rl=!0},wn.onerror=function(){On=!0,Qi=null},wn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Bs);class Cr extends Error{constructor(i,l,h,p){super(`AJAXError: ${l} (${i}): ${h}`),this.status=i,this.statusText=l,this.url=h,this.body=p}}const mo=qt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function il(a,i){const l=new AbortController,h=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:mo(),signal:l.signal});let p=!1,v=!1;return"json"===a.type&&h.headers.set("Accept","application/json"),((x,D,S)=>{if(v)return;const A=Date.now();fetch(h).then(k=>{return k.ok?(F=k,null,A,void("arrayBuffer"===a.type?F.arrayBuffer():"json"===a.type?F.json():F.text()).then(V=>{v||(p=!0,i(null,V,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(V=>{v||i(new Error(V.message))})):k.blob().then(F=>i(new Cr(k.status,k.statusText,a.url,F)));var F}).catch(k=>{20!==k.code&&i(new Error(k.message))})})(),{cancel:()=>{v=!0,p||l.abort()}}}const Us=function(a,i){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(qt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i);if(!qt()){const h=a.url.substring(0,a.url.indexOf("://"));return(di.REGISTERED_PROTOCOLS[h]||il)(a,i)}}if(!(/^file:/.test(l=a.url)||/^file:/.test(mo())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return il(a,i);if(qt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var l;return function(h,p){const v=new XMLHttpRequest;v.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(v.responseType="arraybuffer");for(const x in h.headers)v.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials="include"===h.credentials,v.onerror=()=>{p(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||0===v.status)&&null!==v.response){let x=v.response;if("json"===h.type)try{x=JSON.parse(v.response)}catch(D){return p(D)}p(null,x,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const x=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});p(new Cr(v.status,v.statusText,h.url,x))}},v.send(h.body),{cancel:()=>v.abort()}}(a,i)},go=function(a,i){return Us(zt(a,{type:"arrayBuffer"}),i)};function rc(a){const i=window.document.createElement("a");return i.href=a,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}const Bo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let yo,_o;yo=[],_o=0;const ol=function(a,i){if(wi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),_o>=di.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return yo.push(v),v}_o++;let l=!1;const h=()=>{if(!l)for(l=!0,_o--;yo.length&&_o<di.MAX_PARALLEL_IMAGE_REQUESTS;){const v=yo.shift(),{requestParameters:x,callback:D,cancelled:S}=v;S||(v.cancel=ol(x,D).cancel)}},p=go(a,(v,x,D,S)=>{var A,k;h(),v?i(v):x&&(A=x,k=(A,k)=>{null!=A?i(A):null!=k&&i(null,k,{cacheControl:D,expires:S})},"function"==typeof createImageBitmap?function(F,N){const U=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(U).then(V=>{N(null,V)}).catch(V=>{N(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(A,k):function(F,N){const U=new Image;U.onload=()=>{N(null,U),URL.revokeObjectURL(U.src),U.onload=null,window.requestAnimationFrame(()=>{U.src=Bo})},U.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Blob([new Uint8Array(F)],{type:"image/png"});U.src=F.byteLength?URL.createObjectURL(V):Bo}(A,k))});return{cancel:()=>{p.cancel(),h()}}};function Wt(a,i,l){l[a]&&-1!==l[a].indexOf(i)||(l[a]=l[a]||[],l[a].push(i))}function Vs(a,i,l){if(l&&l[a]){const h=l[a].indexOf(i);-1!==h&&l[a].splice(h,1)}}class vo{constructor(i,l={}){zt(this,l),this.type=i}}class $s extends vo{constructor(i,l={}){super("error",zt({error:i},l))}}class js{on(i,l){return this._listeners=this._listeners||{},Wt(i,l,this._listeners),this}off(i,l){return Vs(i,l,this._listeners),Vs(i,l,this._oneTimeListeners),this}once(i,l){return this._oneTimeListeners=this._oneTimeListeners||{},Wt(i,l,this._oneTimeListeners),this}fire(i,l){"string"==typeof i&&(i=new vo(i,l||{}));const h=i.type;if(this.listens(h)){i.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const D of p)D.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const D of v)Vs(h,D,this._oneTimeListeners),D.call(this,i);const x=this._eventedParent;x&&(zt(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof $s&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Be{constructor(i,l,h,p){this.message=(i?`${i}: `:"")+h,p&&(this.identifier=p),null!=l&&l.__line__&&(this.line=l.__line__)}}function Hs(a){const i=a.value;return i?[new Be(a.key,i,"constants have been deprecated as of v8")]:[]}function Uo(a,...i){for(const l of i)for(const h in l)a[h]=l[h];return a}function Jt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Di(a){if(Array.isArray(a))return a.map(Di);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const l in a)i[l]=Di(a[l]);return i}return Jt(a)}class ei extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class rs{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(i){return new rs(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Tn={kind:"null"},Le={kind:"number"},Tt={kind:"string"},Et={kind:"boolean"},ti={kind:"color"},eo={kind:"object"},Ct={kind:"value"},Vo={kind:"collator"},Ei={kind:"formatted"},to={kind:"resolvedImage"};function qn(a,i){return{kind:"array",itemType:a,N:i}}function hn(a){if("array"===a.kind){const i=hn(a.itemType);return"number"==typeof a.N?`array<${i}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${i}>`}return a.kind}const Ci=[Tn,Le,Tt,Et,ti,Ei,eo,qn(Ct),to];function $o(a,i){if("error"===i.kind)return null;if("array"===a.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!$o(a.itemType,i.itemType))&&("number"!=typeof a.N||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if("value"===a.kind)for(const l of Ci)if(!$o(l,i))return null}return`Expected ${hn(a)} but found ${hn(i)} instead.`}function Jn(a,i){return i.some(l=>l.kind===a.kind)}function Si(a,i){return i.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Ii,ni={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Gs(a){return(a=Math.round(a))<0?0:a>255?255:a}function qs(a){return Gs("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function G(a){return(i="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:i>1?1:i;var i}function P(a,i,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(i-a)*l*6:2*l<1?i:3*l<2?a+(i-a)*(2/3-l)*6:a}try{Ii={}.parseCSSColor=function(a){var i,l=a.replace(/ /g,"").toLowerCase();if(l in ni)return ni[l].slice();if("#"===l[0])return 4===l.length?(i=parseInt(l.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===l.length&&(i=parseInt(l.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(-1!==h&&p+1===l.length){var v=l.substr(0,h),x=l.substr(h+1,p-(h+1)).split(","),D=1;switch(v){case"rgba":if(4!==x.length)return null;D=G(x.pop());case"rgb":return 3!==x.length?null:[qs(x[0]),qs(x[1]),qs(x[2]),D];case"hsla":if(4!==x.length)return null;D=G(x.pop());case"hsl":if(3!==x.length)return null;var S=(parseFloat(x[0])%360+360)%360/360,A=G(x[1]),k=G(x[2]),F=k<=.5?k*(A+1):k+A-k*A,N=2*k-F;return[Gs(255*P(N,F,S+1/3)),Gs(255*P(N,F,S)),Gs(255*P(N,F,S-1/3)),D];default:return null}}return null}}catch{}class L{constructor(i,l,h,p=1){this.r=i,this.g=l,this.b=h,this.a=p}static parse(i){if(!i)return;if(i instanceof L)return i;if("string"!=typeof i)return;const l=Ii(i);return l?new L(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,h,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r:i,g:l,b:h,a:p}=this;return 0===p?[0,0,0,0]:[255*i/p,255*l/p,255*h/p,p]}}L.black=new L(0,0,0,1),L.white=new L(1,1,1,1),L.transparent=new L(0,0,0,0),L.red=new L(1,0,0,1);class ${constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class W{constructor(i,l,h,p,v){this.text=i,this.image=l,this.scale=h,this.fontStack=p,this.textColor=v}}class Z{constructor(i){this.sections=i}static fromString(i){return new Z([new W(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof Z?i:Z.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(h)}return i}}class ie{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new ie({name:i,available:!1}):null}serialize(){return["image",this.name]}}function Y(a,i,l,h){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[a,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[a,i,l,h]:[a,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ne(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof L||a instanceof $||a instanceof Z||a instanceof ie)return!0;if(Array.isArray(a)){for(const i of a)if(!ne(i))return!1;return!0}if("object"==typeof a){for(const i in a)if(!ne(a[i]))return!1;return!0}return!1}function re(a){if(null===a)return Tn;if("string"==typeof a)return Tt;if("boolean"==typeof a)return Et;if("number"==typeof a)return Le;if(a instanceof L)return ti;if(a instanceof $)return Vo;if(a instanceof Z)return Ei;if(a instanceof ie)return to;if(Array.isArray(a)){const i=a.length;let l;for(const h of a){const p=re(h);if(l){if(l===p)continue;l=Ct;break}l=p}return qn(l||Ct,i)}return eo}function ye(a){const i=typeof a;return null===a?"":"string"===i||"number"===i||"boolean"===i?String(a):a instanceof L||a instanceof Z||a instanceof ie?a.toString():JSON.stringify(a)}class Se{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ne(i[1]))return l.error("invalid value");const h=i[1];let p=re(h);const v=l.expectedType;return"array"!==p.kind||0!==p.N||!v||"array"!==v.kind||"number"==typeof v.N&&0!==v.N||(p=v),new Se(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof L?["rgba"].concat(this.value.toArray()):this.value instanceof Z?this.value.serialize():this.value}}class pe{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const We={string:Tt,number:Le,boolean:Et,object:eo};class $e{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,p=1;const v=i[0];if("array"===v){let D,S;if(i.length>2){const A=i[1];if("string"!=typeof A||!(A in We)||"object"===A)return l.error('The item type argument of "array" must be one of string, number, boolean',1);D=We[A],p++}else D=Ct;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);S=i[2],p++}h=qn(D,S)}else h=We[v];const x=[];for(;p<i.length;p++){const D=l.parse(i[p],p,Ct);if(!D)return null;x.push(D)}return new $e(h,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!$o(this.type,re(h)))return h;if(l===this.args.length-1)throw new pe(`Expected value to be of type ${hn(this.type)}, but found ${hn(re(h))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if("array"===i.kind){const h=i.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const p=i.N;("number"==typeof p||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(h=>h.serialize()))}}class Xe{constructor(i){this.type=Ei,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const p=[];let v=!1;for(let x=1;x<=i.length-1;++x){const D=i[x];if(v&&"object"==typeof D&&!Array.isArray(D)){v=!1;let S=null;if(D["font-scale"]&&(S=l.parse(D["font-scale"],1,Le),!S))return null;let A=null;if(D["text-font"]&&(A=l.parse(D["text-font"],1,qn(Tt)),!A))return null;let k=null;if(D["text-color"]&&(k=l.parse(D["text-color"],1,ti),!k))return null;const F=p[p.length-1];F.scale=S,F.font=A,F.textColor=k}else{const S=l.parse(i[x],1,Ct);if(!S)return null;const A=S.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:S,scale:null,font:null,textColor:null})}}return new Xe(p)}evaluate(i){return new Z(this.sections.map(l=>{const h=l.content.evaluate(i);return re(h)===to?new W("",h,null,null,null):new W(ye(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),i.push(h)}return i}}class at{constructor(i){this.type=to,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,Tt);return h?new at(h):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),h=ie.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xt={"to-boolean":Et,"to-color":ti,"to-number":Le,"to-string":Tt};class Lt{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0];if(("to-boolean"===h||"to-string"===h)&&2!==i.length)return l.error("Expected one argument.");const p=Xt[h],v=[];for(let x=1;x<i.length;x++){const D=l.parse(i[x],x,Ct);if(!D)return null;v.push(D)}return new Lt(p,v)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,h;for(const p of this.args){if(l=p.evaluate(i),h=null,l instanceof L)return l;if("string"==typeof l){const v=i.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Y(l[0],l[1],l[2],l[3]),!h))return new L(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new pe(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(i),null===l)return 0;const p=Number(l);if(!isNaN(p))return p}throw new pe(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Z.fromString(ye(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?ie.fromString(ye(this.args[0].evaluate(i))):ye(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Xe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new at(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const Mt=["Unknown","Point","LineString","Polygon"];class bt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Mt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=L.parse(i)),l}}class vt{constructor(i,l,h,p){this.name=i,this.type=l,this._evaluate=h,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const h=i[0],p=vt.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,D=x.filter(([A])=>!Array.isArray(A)||A.length===i.length-1);let S=null;for(const[A,k]of D){S=new tn(l.registry,l.path,null,l.scope);const F=[];let N=!1;for(let U=1;U<i.length;U++){const V=i[U],Q=Array.isArray(A)?A[U-1]:A.type,ee=S.parse(V,1+F.length,Q);if(!ee){N=!0;break}F.push(ee)}if(!N)if(Array.isArray(A)&&A.length!==F.length)S.error(`Expected ${A.length} arguments, but found ${F.length} instead.`);else{for(let U=0;U<F.length;U++){const V=Array.isArray(A)?A[U]:A.type,Q=F[U];S.concat(U+1).checkSubtype(V,Q.type)}if(0===S.errors.length)return new vt(h,v,k,F)}}if(1===D.length)l.errors.push(...S.errors);else{const A=(D.length?D:x).map(([F])=>{return N=F,Array.isArray(N)?`(${N.map(hn).join(", ")})`:`(${hn(N.type)}...)`;var N}).join(" | "),k=[];for(let F=1;F<i.length;F++){const N=l.parse(i[F],1+k.length);if(!N)return null;k.push(hn(N.type))}l.error(`Expected arguments of type ${A}, but found (${k.join(", ")}) instead.`)}return null}static register(i,l){vt.definitions=l;for(const h in l)i[h]=vt}}class Wn{constructor(i,l,h){this.type=Vo,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const h=i[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,Et);if(!p)return null;const v=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,Et);if(!v)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,Tt),!x)?null:new Wn(p,v,x)}evaluate(i){return new $(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const zn=8192;function fr(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function Sr(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function Zn(a,i){const l=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(l*p*zn),Math.round(h*p*zn)]}function ic(a,i,l){const h=a[0]-i[0],p=a[1]-i[1],v=a[0]-l[0],x=a[1]-l[1];return h*x-v*p==0&&h*v<=0&&p*x<=0}function gn(a,i){let l=!1;for(let x=0,D=i.length;x<D;x++){const S=i[x];for(let A=0,k=S.length;A<k-1;A++){if(ic(a,S[A],S[A+1]))return!1;(p=S[A])[1]>(h=a)[1]!=(v=S[A+1])[1]>h[1]&&h[0]<(v[0]-p[0])*(h[1]-p[1])/(v[1]-p[1])+p[0]&&(l=!l)}}var h,p,v;return l}function oc(a,i){for(let l=0;l<i.length;l++)if(gn(a,i[l]))return!0;return!1}function dn(a,i,l,h){const p=h[0]-l[0],v=h[1]-l[1],x=(a[0]-l[0])*v-p*(a[1]-l[1]),D=(i[0]-l[0])*v-p*(i[1]-l[1]);return x>0&&D<0||x<0&&D>0}function sc(a,i,l){for(const A of l)for(let k=0;k<A.length-1;++k)if((D=[(x=A[k+1])[0]-(v=A[k])[0],x[1]-v[1]])[0]*(S=[(p=i)[0]-(h=a)[0],p[1]-h[1]])[1]-D[1]*S[0]!=0&&dn(h,p,v,x)&&dn(v,x,h,p))return!0;var h,p,v,x,D,S;return!1}function yn(a,i){for(let l=0;l<a.length;++l)if(!gn(a[l],i))return!1;for(let l=0;l<a.length-1;++l)if(sc(a[l],a[l+1],i))return!1;return!0}function sl(a,i){for(let l=0;l<i.length;l++)if(yn(a,i[l]))return!0;return!1}function ac(a,i,l){const h=[];for(let p=0;p<a.length;p++){const v=[];for(let x=0;x<a[p].length;x++){const D=Zn(a[p][x],l);fr(i,D),v.push(D)}h.push(v)}return h}function xa(a,i,l){const h=[];for(let p=0;p<a.length;p++){const v=ac(a[p],i,l);h.push(v)}return h}function ut(a,i,l,h){if(a[0]<l[0]||a[0]>l[2]){const p=.5*h;let v=a[0]-l[0]>p?-h:l[0]-a[0]>p?h:0;0===v&&(v=a[0]-l[2]>p?-h:l[2]-a[0]>p?h:0),a[0]+=v}fr(i,a)}function al(a,i,l,h){const p=Math.pow(2,h.z)*zn,v=[h.x*zn,h.y*zn],x=[];for(const D of a)for(const S of D){const A=[S.x+v[0],S.y+v[1]];ut(A,i,l,p),x.push(A)}return x}function ll(a,i,l,h){const p=Math.pow(2,h.z)*zn,v=[h.x*zn,h.y*zn],x=[];for(const S of a){const A=[];for(const k of S){const F=[k.x+v[0],k.y+v[1]];fr(i,F),A.push(F)}x.push(A)}if(i[2]-i[0]<=p/2){(D=i)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const S of x)for(const A of S)ut(A,i,l,p)}var D;return x}class Ws{constructor(i,l){this.type=Et,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ne(i[1])){const h=i[1];if("FeatureCollection"===h.type)for(let p=0;p<h.features.length;++p){const v=h.features[p].geometry.type;if("Polygon"===v||"MultiPolygon"===v)return new Ws(h,h.features[p].geometry)}else if("Feature"===h.type){const p=h.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Ws(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new Ws(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,h){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const D=ac(h.coordinates,v,x),S=al(l.geometry(),p,v,x);if(!Sr(p,v))return!1;for(const A of S)if(!gn(A,D))return!1}if("MultiPolygon"===h.type){const D=xa(h.coordinates,v,x),S=al(l.geometry(),p,v,x);if(!Sr(p,v))return!1;for(const A of S)if(!oc(A,D))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,h){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const D=ac(h.coordinates,v,x),S=ll(l.geometry(),p,v,x);if(!Sr(p,v))return!1;for(const A of S)if(!yn(A,D))return!1}if("MultiPolygon"===h.type){const D=xa(h.coordinates,v,x),S=ll(l.geometry(),p,v,x);if(!Sr(p,v))return!1;for(const A of S)if(!sl(A,D))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ba(a){if(a instanceof vt&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Ws)return!1;let i=!0;return a.eachChild(l=>{i&&!ba(l)&&(i=!1)}),i}function ze(a){if(a instanceof vt&&"feature-state"===a.name)return!1;let i=!0;return a.eachChild(l=>{i&&!ze(l)&&(i=!1)}),i}function jo(a,i){if(a instanceof vt&&i.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(h=>{l&&!jo(h,i)&&(l=!1)}),l}class gt{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new gt(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class tn{constructor(i,l=[],h,p=new rs,v=[]){this.registry=i,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=p,this.errors=v,this.expectedType=h}parse(i,l,h,p,v={}){return l?this.concat(l,h,p)._parse(i,v):this._parse(i,v)}_parse(i,l){function h(p,v,x){return"assert"===x?new $e(v,[p]):"coerce"===x?new Lt(v,[p]):p}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[p];if(v){let x=v.parse(i,this);if(!x)return null;if(this.expectedType){const D=this.expectedType,S=x.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==S.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==S.kind&&"string"!==S.kind){if(this.checkSubtype(D,S))return null}else x=h(x,D,l.typeAnnotation||"coerce");else x=h(x,D,l.typeAnnotation||"assert")}if(!(x instanceof Se)&&"resolvedImage"!==x.type.kind&&wa(x)){const D=new bt;try{x=new Se(x.type,x.evaluate(D))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){const p="number"==typeof i?this.path.concat(i):this.path,v=h?this.scope.concat(h):this.scope;return new tn(this.registry,p,l||null,v,this.errors)}error(i,...l){const h=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new ei(h,i))}checkSubtype(i,l){const h=$o(i,l);return h&&this.error(h),h}}function wa(a){if(a instanceof gt)return wa(a.boundExpression);if(a instanceof vt&&"error"===a.name||a instanceof Wn||a instanceof Ws)return!1;const i=a instanceof Lt||a instanceof $e;let l=!0;return a.eachChild(h=>{l=i?l&&wa(h):l&&h instanceof Se}),!!l&&ba(a)&&jo(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function lc(a,i){const l=a.length-1;let h,p,v=0,x=l,D=0;for(;v<=x;)if(D=Math.floor((v+x)/2),h=a[D],p=a[D+1],h<=i){if(D===l||i<p)return D;v=D+1}else{if(!(h>i))throw new pe("Input is not a number.");x=D-1}return 0}class Da{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[p,v]of h)this.labels.push(p),this.outputs.push(v)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,Le);if(!h)return null;const p=[];let v=null;l.expectedType&&"value"!==l.expectedType.kind&&(v=l.expectedType);for(let x=1;x<i.length;x+=2){const D=1===x?-1/0:i[x],S=i[x+1],A=x,k=x+1;if("number"!=typeof D)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=D)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const F=l.parse(S,k,v);if(!F)return null;v=v||F.type,p.push([D,F])}return new Da(v,h,p)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return h[0].evaluate(i);const v=l.length;return p>=l[v-1]?h[v-1].evaluate(i):h[lc(l,p)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}function Nn(a,i,l){return a*(1-l)+i*l}var Ir=Object.freeze({__proto__:null,number:Nn,color:function(a,i,l){return new L(Nn(a.r,i.r,l),Nn(a.g,i.g,l),Nn(a.b,i.b,l),Nn(a.a,i.a,l))},array:function(a,i,l){return a.map((h,p)=>Nn(h,i[p],l))}});const hu=.95047,du=1.08883,Gh=4/29,Ui=6/29,fu=3*Ui*Ui,Cf=Math.PI/180,Sf=180/Math.PI;function pu(a){return a>.008856451679035631?Math.pow(a,1/3):a/fu+Gh}function cc(a){return a>Ui?a*a*a:fu*(a-Gh)}function mu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function uc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function qh(a){const i=uc(a.r),l=uc(a.g),h=uc(a.b),p=pu((.4124564*i+.3575761*l+.1804375*h)/hu),v=pu((.2126729*i+.7151522*l+.072175*h)/1);return{l:116*v-16,a:500*(p-v),b:200*(v-pu((.0193339*i+.119192*l+.9503041*h)/du)),alpha:a.a}}function St(a){let i=(a.l+16)/116,l=isNaN(a.a)?i:i+a.a/500,h=isNaN(a.b)?i:i-a.b/200;return i=1*cc(i),l=hu*cc(l),h=du*cc(h),new L(mu(3.2404542*l-1.5371385*i-.4985314*h),mu(-.969266*l+1.8760108*i+.041556*h),mu(.0556434*l-.2040259*i+1.0572252*h),a.alpha)}function un(a,i,l){const h=i-a;return a+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const cl={forward:qh,reverse:St,interpolate:function(a,i,l){return{l:Nn(a.l,i.l,l),a:Nn(a.a,i.a,l),b:Nn(a.b,i.b,l),alpha:Nn(a.alpha,i.alpha,l)}}},ul={forward:function(a){const{l:i,a:l,b:h}=qh(a),p=Math.atan2(h,l)*Sf;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:i,alpha:a.a}},reverse:function(a){const i=a.h*Cf,l=a.c;return St({l:a.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:a.alpha})},interpolate:function(a,i,l){return{h:un(a.h,i.h,l),c:Nn(a.c,i.c,l),l:Nn(a.l,i.l,l),alpha:Nn(a.alpha,i.alpha,l)}}};var Wh=Object.freeze({__proto__:null,lab:cl,hcl:ul});class it{constructor(i,l,h,p,v){this.type=i,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[x,D]of v)this.labels.push(x),this.outputs.push(D)}static interpolationFactor(i,l,h,p){let v=0;if("exponential"===i.name)v=gu(l,i.base,h,p);else if("linear"===i.name)v=gu(l,1,h,p);else if("cubic-bezier"===i.name){const x=i.controlPoints;v=new pn(x[0],x[1],x[2],x[3]).solve(gu(l,1,h,p))}return v}static parse(i,l){let[h,p,v,...x]=i;if(!Array.isArray(p)||0===p.length)return l.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const A=p[1];if("number"!=typeof A)return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if("cubic-bezier"!==p[0])return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(4!==A.length||A.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,Le),!v)return null;const D=[];let S=null;"interpolate-hcl"===h||"interpolate-lab"===h?S=ti:l.expectedType&&"value"!==l.expectedType.kind&&(S=l.expectedType);for(let A=0;A<x.length;A+=2){const k=x[A],F=x[A+1],N=A+3,U=A+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(D.length&&D[D.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const V=l.parse(F,U,S);if(!V)return null;S=S||V.type,D.push([k,V])}return"number"===S.kind||"color"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new it(S,h,p,v,D):l.error(`Type ${hn(S)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return h[0].evaluate(i);const v=l.length;if(p>=l[v-1])return h[v-1].evaluate(i);const x=lc(l,p),D=it.interpolationFactor(this.interpolation,p,l[x],l[x+1]),S=h[x].evaluate(i),A=h[x+1].evaluate(i);return"interpolate"===this.operator?Ir[this.type.kind.toLowerCase()](S,A,D):"interpolate-hcl"===this.operator?ul.reverse(ul.interpolate(ul.forward(S),ul.forward(A),D)):cl.reverse(cl.interpolate(cl.forward(S),cl.forward(A),D))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function gu(a,i,l,h){const p=h-l,v=a-l;return 0===p?0:1===i?v/p:(Math.pow(i,v)-1)/(Math.pow(i,p)-1)}class no{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&"value"!==p.kind&&(h=p);const v=[];for(const D of i.slice(1)){const S=l.parse(D,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,v.push(S)}const x=p&&v.some(D=>$o(p,D.type));return new no(x?Ct:h,v)}evaluate(i){let l,h=null,p=0;for(const v of this.args)if(p++,h=v.evaluate(i),h&&h instanceof ie&&!h.available&&(l||(l=h.name),h=null,p===this.args.length&&(h=l)),null!==h)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class is{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let v=1;v<i.length-1;v+=2){const x=i[v];if("string"!=typeof x)return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const D=l.parse(i[v+1],v+1);if(!D)return null;h.push([x,D])}const p=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return p?new is(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,h]of this.bindings)i.push(l,h.serialize());return i.push(this.result.serialize()),i}}class hc{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Le),p=l.parse(i[2],2,qn(l.expectedType||Ct));return h&&p?new hc(p.type.itemType,h,p):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new pe(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new pe(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new pe(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class hl{constructor(i,l){this.type=Et,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Ct),p=l.parse(i[2],2,Ct);return h&&p?Jn(h.type,[Et,Tt,Le,Tn,Ct])?new hl(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Si(l,["boolean","string","number","null"]))throw new pe(`Expected first argument to be of type boolean, string, number or null, but found ${hn(re(l))} instead.`);if(!Si(h,["string","array"]))throw new pe(`Expected second argument to be of type array or string, but found ${hn(re(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class dl{constructor(i,l,h){this.type=Le,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Ct),p=l.parse(i[2],2,Ct);if(!h||!p)return null;if(!Jn(h.type,[Et,Tt,Le,Tn,Ct]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(h.type)} instead`);if(4===i.length){const v=l.parse(i[3],3,Le);return v?new dl(h,p,v):null}return new dl(h,p)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Si(l,["boolean","string","number","null"]))throw new pe(`Expected first argument to be of type boolean, string, number or null, but found ${hn(re(l))} instead.`);if(!Si(h,["string","array"]))throw new pe(`Expected second argument to be of type array or string, but found ${hn(re(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class dc{constructor(i,l,h,p,v,x){this.inputType=i,this.type=l,this.input=h,this.cases=p,this.outputs=v,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const v={},x=[];for(let A=2;A<i.length-1;A+=2){let k=i[A];const F=i[A+1];Array.isArray(k)||(k=[k]);const N=l.concat(A);if(0===k.length)return N.error("Expected at least one branch label.");for(const V of k){if("number"!=typeof V&&"string"!=typeof V)return N.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,re(V)))return null}else h=re(V);if(void 0!==v[String(V)])return N.error("Branch labels must be unique.");v[String(V)]=x.length}const U=l.parse(F,A,p);if(!U)return null;p=p||U.type,x.push(U)}const D=l.parse(i[1],1,Ct);if(!D)return null;const S=l.parse(i[i.length-1],i.length-1,p);return S?"value"!==D.type.kind&&l.concat(1).checkSubtype(h,D.type)?null:new dc(h,p,D,v,x,S):null}evaluate(i){const l=this.input.evaluate(i);return(re(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const x of l){const D=p[this.cases[x]];void 0===D?(p[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[D][1].push(x)}const v=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,D]of h)i.push(1===D.length?v(D[0]):D.map(v)),i.push(this.outputs[x].serialize());return i.push(this.otherwise.serialize()),i}}class fl{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const p=[];for(let x=1;x<i.length-1;x+=2){const D=l.parse(i[x],x,Et);if(!D)return null;const S=l.parse(i[x+1],x+1,h);if(!S)return null;p.push([D,S]),h=h||S.type}const v=l.parse(i[i.length-1],i.length-1,h);return v?new fl(h,p,v):null}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class os{constructor(i,l,h,p){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Ct),p=l.parse(i[2],2,Le);if(!h||!p)return null;if(!Jn(h.type,[qn(Ct),Tt,Ct]))return l.error(`Expected first argument to be of type array or string, but found ${hn(h.type)} instead`);if(4===i.length){const v=l.parse(i[3],3,Le);return v?new os(h.type,h,p,v):null}return new os(h.type,h,p)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!Si(l,["string","array"]))throw new pe(`Expected first argument to be of type array or string, but found ${hn(re(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return l.slice(h,p)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pl(a,i){return"=="===a||"!="===a?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function fc(a,i,l,h){return 0===h.compare(i,l)}function Zs(a,i,l){const h="=="!==a&&"!="!==a;return class TD{constructor(v,x,D){this.type=Et,this.lhs=v,this.rhs=x,this.collator=D,this.hasUntypedArgument="value"===v.type.kind||"value"===x.type.kind}static parse(v,x){if(3!==v.length&&4!==v.length)return x.error("Expected two or three arguments.");const D=v[0];let S=x.parse(v[1],1,Ct);if(!S)return null;if(!pl(D,S.type))return x.concat(1).error(`"${D}" comparisons are not supported for type '${hn(S.type)}'.`);let A=x.parse(v[2],2,Ct);if(!A)return null;if(!pl(D,A.type))return x.concat(2).error(`"${D}" comparisons are not supported for type '${hn(A.type)}'.`);if(S.type.kind!==A.type.kind&&"value"!==S.type.kind&&"value"!==A.type.kind)return x.error(`Cannot compare types '${hn(S.type)}' and '${hn(A.type)}'.`);h&&("value"===S.type.kind&&"value"!==A.type.kind?S=new $e(A.type,[S]):"value"!==S.type.kind&&"value"===A.type.kind&&(A=new $e(S.type,[A])));let k=null;if(4===v.length){if("string"!==S.type.kind&&"string"!==A.type.kind&&"value"!==S.type.kind&&"value"!==A.type.kind)return x.error("Cannot use collator to compare non-string types.");if(k=x.parse(v[3],3,Vo),!k)return null}return new TD(S,A,k)}evaluate(v){const x=this.lhs.evaluate(v),D=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const S=re(x),A=re(D);if(S.kind!==A.kind||"string"!==S.kind&&"number"!==S.kind)throw new pe(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=re(x),A=re(D);if("string"!==S.kind||"string"!==A.kind)return i(v,x,D)}return this.collator?l(v,x,D,this.collator.evaluate(v)):i(v,x,D)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[a];return this.eachChild(x=>{v.push(x.serialize())}),v}}}const ft=Zs("==",function(a,i,l){return i===l},fc),pc=Zs("!=",function(a,i,l){return i!==l},function(a,i,l,h){return!fc(0,i,l,h)}),Zh=Zs("<",function(a,i,l){return i<l},function(a,i,l,h){return h.compare(i,l)<0}),Ti=Zs(">",function(a,i,l){return i>l},function(a,i,l,h){return h.compare(i,l)>0}),yu=Zs("<=",function(a,i,l){return i<=l},function(a,i,l,h){return h.compare(i,l)<=0}),If=Zs(">=",function(a,i,l){return i>=l},function(a,i,l,h){return h.compare(i,l)>=0});class xn{constructor(i,l,h,p,v){this.type=Tt,this.number=i,this.locale=l,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,Le);if(!h)return null;const p=i[2];if("object"!=typeof p||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=l.parse(p.locale,1,Tt),!v))return null;let x=null;if(p.currency&&(x=l.parse(p.currency,1,Tt),!x))return null;let D=null;if(p["min-fraction-digits"]&&(D=l.parse(p["min-fraction-digits"],1,Le),!D))return null;let S=null;return p["max-fraction-digits"]&&(S=l.parse(p["max-fraction-digits"],1,Le),!S)?null:new xn(h,v,x,D,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class _u{constructor(i){this.type=Le,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${hn(h.type)} instead.`):new _u(h):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new pe(`Expected value to be of type string or array, but found ${hn(re(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const Ea={"==":ft,"!=":pc,">":Ti,"<":Zh,">=":If,"<=":yu,array:$e,at:hc,boolean:$e,case:fl,coalesce:no,collator:Wn,format:Xe,image:at,in:hl,"index-of":dl,interpolate:it,"interpolate-hcl":it,"interpolate-lab":it,length:_u,let:is,literal:Se,match:dc,number:$e,"number-format":xn,object:$e,slice:os,step:Da,string:$e,"to-boolean":Lt,"to-color":Lt,"to-number":Lt,"to-string":Lt,var:gt,within:Ws};function Xh(a,[i,l,h,p]){i=i.evaluate(a),l=l.evaluate(a),h=h.evaluate(a);const v=p?p.evaluate(a):1,x=Y(i,l,h,v);if(x)throw new pe(x);return new L(i/255*v,l/255*v,h/255*v,v)}function Xs(a,i){return a in i}function Ca(a,i){const l=i[a];return void 0===l?null:l}function ro(a){return{type:a}}function vu(a){return{result:"success",value:a}}function ss(a){return{result:"error",value:a}}function Ks(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function mc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function as(a){return!!a.expression&&a.expression.interpolated}function ht(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function ml(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Fe(a){return a}function Sa(a,i){const l="color"===i.type,h=a.stops&&"object"==typeof a.stops[0][0],p=h||!(h||void 0!==a.property),v=a.type||(as(i)?"exponential":"interval");if(l&&((a=Uo({},a)).stops&&(a.stops=a.stops.map(A=>[A[0],L.parse(A[1])])),a.default=L.parse(a.default?a.default:i.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Wh[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let x,D,S;if("exponential"===v)x=ls;else if("interval"===v)x=Ys;else if("categorical"===v){x=Mn,D=Object.create(null);for(const A of a.stops)D[A[0]]=A[1];S=typeof a.stops[0][0]}else{if("identity"!==v)throw new Error(`Unknown function type "${v}"`);x=Kh}if(h){const A={},k=[];for(let U=0;U<a.stops.length;U++){const V=a.stops[U],Q=V[0].zoom;void 0===A[Q]&&(A[Q]={zoom:Q,type:a.type,property:a.property,default:a.default,stops:[]},k.push(Q)),A[Q].stops.push([V[0].value,V[1]])}const F=[];for(const U of k)F.push([A[U].zoom,Sa(A[U],i)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:it.interpolationFactor.bind(void 0,N),zoomStops:F.map(U=>U[0]),evaluate:({zoom:U},V)=>ls({stops:F,base:a.base},i,U).evaluate(U,V)}}if(p){const A="exponential"===v?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:it.interpolationFactor.bind(void 0,A),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>x(a,i,k,D,S)}}return{kind:"source",evaluate(A,k){const F=k&&k.properties?k.properties[a.property]:void 0;return void 0===F?ot(a.default,i.default):x(a,i,F,D,S)}}}function ot(a,i,l){return void 0!==a?a:void 0!==i?i:void 0!==l?l:void 0}function Mn(a,i,l,h,p){return ot(typeof l===p?h[l]:void 0,a.default,i.default)}function Ys(a,i,l){if("number"!==ht(l))return ot(a.default,i.default);const h=a.stops.length;if(1===h||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const p=lc(a.stops.map(v=>v[0]),l);return a.stops[p][1]}function ls(a,i,l){const h=void 0!==a.base?a.base:1;if("number"!==ht(l))return ot(a.default,i.default);const p=a.stops.length;if(1===p||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const v=lc(a.stops.map(k=>k[0]),l),x=function(k,F,N,U){const V=U-N,Q=k-N;return 0===V?0:1===F?Q/V:(Math.pow(F,Q)-1)/(Math.pow(F,V)-1)}(l,h,a.stops[v][0],a.stops[v+1][0]),D=a.stops[v][1],S=a.stops[v+1][1];let A=Ir[i.type]||Fe;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=Wh[a.colorSpace];A=(F,N)=>k.reverse(k.interpolate(k.forward(F),k.forward(N),x))}return"function"==typeof D.evaluate?{evaluate(...k){const F=D.evaluate.apply(void 0,k),N=S.evaluate.apply(void 0,k);if(void 0!==F&&void 0!==N)return A(F,N,x)}}:A(D,S,x)}function Kh(a,i,l){return"color"===i.type?l=L.parse(l):"formatted"===i.type?l=Z.fromString(l.toString()):"resolvedImage"===i.type?l=ie.fromString(l.toString()):ht(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0),ot(l,a.default,i.default)}vt.register(Ea,{error:[{kind:"error"},[Tt],(a,[i])=>{throw new pe(i.evaluate(a))}],typeof:[Tt,[Ct],(a,[i])=>hn(re(i.evaluate(a)))],"to-rgba":[qn(Le,4),[ti],(a,[i])=>i.evaluate(a).toArray()],rgb:[ti,[Le,Le,Le],Xh],rgba:[ti,[Le,Le,Le,Le],Xh],has:{type:Et,overloads:[[[Tt],(a,[i])=>Xs(i.evaluate(a),a.properties())],[[Tt,eo],(a,[i,l])=>Xs(i.evaluate(a),l.evaluate(a))]]},get:{type:Ct,overloads:[[[Tt],(a,[i])=>Ca(i.evaluate(a),a.properties())],[[Tt,eo],(a,[i,l])=>Ca(i.evaluate(a),l.evaluate(a))]]},"feature-state":[Ct,[Tt],(a,[i])=>Ca(i.evaluate(a),a.featureState||{})],properties:[eo,[],a=>a.properties()],"geometry-type":[Tt,[],a=>a.geometryType()],id:[Ct,[],a=>a.id()],zoom:[Le,[],a=>a.globals.zoom],"heatmap-density":[Le,[],a=>a.globals.heatmapDensity||0],"line-progress":[Le,[],a=>a.globals.lineProgress||0],accumulated:[Ct,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Le,ro(Le),(a,i)=>{let l=0;for(const h of i)l+=h.evaluate(a);return l}],"*":[Le,ro(Le),(a,i)=>{let l=1;for(const h of i)l*=h.evaluate(a);return l}],"-":{type:Le,overloads:[[[Le,Le],(a,[i,l])=>i.evaluate(a)-l.evaluate(a)],[[Le],(a,[i])=>-i.evaluate(a)]]},"/":[Le,[Le,Le],(a,[i,l])=>i.evaluate(a)/l.evaluate(a)],"%":[Le,[Le,Le],(a,[i,l])=>i.evaluate(a)%l.evaluate(a)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(a,[i,l])=>Math.pow(i.evaluate(a),l.evaluate(a))],sqrt:[Le,[Le],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[Le,[Le],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[Le,[Le],(a,[i])=>Math.log(i.evaluate(a))],log2:[Le,[Le],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[Le,[Le],(a,[i])=>Math.sin(i.evaluate(a))],cos:[Le,[Le],(a,[i])=>Math.cos(i.evaluate(a))],tan:[Le,[Le],(a,[i])=>Math.tan(i.evaluate(a))],asin:[Le,[Le],(a,[i])=>Math.asin(i.evaluate(a))],acos:[Le,[Le],(a,[i])=>Math.acos(i.evaluate(a))],atan:[Le,[Le],(a,[i])=>Math.atan(i.evaluate(a))],min:[Le,ro(Le),(a,i)=>Math.min(...i.map(l=>l.evaluate(a)))],max:[Le,ro(Le),(a,i)=>Math.max(...i.map(l=>l.evaluate(a)))],abs:[Le,[Le],(a,[i])=>Math.abs(i.evaluate(a))],round:[Le,[Le],(a,[i])=>{const l=i.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Le,[Le],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[Le,[Le],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Et,[Tt,Ct],(a,[i,l])=>a.properties()[i.value]===l.value],"filter-id-==":[Et,[Ct],(a,[i])=>a.id()===i.value],"filter-type-==":[Et,[Tt],(a,[i])=>a.geometryType()===i.value],"filter-<":[Et,[Tt,Ct],(a,[i,l])=>{const h=a.properties()[i.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Et,[Ct],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[Et,[Tt,Ct],(a,[i,l])=>{const h=a.properties()[i.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[Et,[Ct],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[Et,[Tt,Ct],(a,[i,l])=>{const h=a.properties()[i.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Et,[Ct],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[Et,[Tt,Ct],(a,[i,l])=>{const h=a.properties()[i.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Et,[Ct],(a,[i])=>{const l=a.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[Et,[Ct],(a,[i])=>i.value in a.properties()],"filter-has-id":[Et,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Et,[qn(Tt)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Et,[qn(Ct)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Et,[Tt,qn(Ct)],(a,[i,l])=>l.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Et,[Tt,qn(Ct)],(a,[i,l])=>function(h,p,v,x){for(;v<=x;){const D=v+x>>1;if(p[D]===h)return!0;p[D]>h?x=D-1:v=D+1}return!1}(a.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Et,overloads:[[[Et,Et],(a,[i,l])=>i.evaluate(a)&&l.evaluate(a)],[ro(Et),(a,i)=>{for(const l of i)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Et,overloads:[[[Et,Et],(a,[i,l])=>i.evaluate(a)||l.evaluate(a)],[ro(Et),(a,i)=>{for(const l of i)if(l.evaluate(a))return!0;return!1}]]},"!":[Et,[Et],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Et,[Tt],(a,[i])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(i.evaluate(a))}],upcase:[Tt,[Tt],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[Tt,[Tt],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[Tt,ro(Ct),(a,i)=>i.map(l=>ye(l.evaluate(a))).join("")],"resolved-locale":[Tt,[Vo],(a,[i])=>i.evaluate(a).resolvedLocale()]});class gc{constructor(i,l){var h;this.expression=i,this._warningHistory={},this._evaluator=new bt,this._defaultValue=l?"color"===(h=l).type&&ml(h.default)?new L(0,0,0,0):"color"===h.type?L.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,h,p,v,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,p,v,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new pe(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function gl(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Ea}function Vi(a,i){const l=new tn(Ea,[],i?function(p){const v={color:ti,string:Tt,number:Le,enum:Tt,boolean:Et,formatted:Ei,resolvedImage:to};return"array"===p.type?qn(v[p.value]||Ct,p.length):v[p.type]}(i):void 0),h=l.parse(a,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return h?vu(new gc(h,i)):ss(l.errors)}class ri{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!ze(l.expression)}evaluateWithoutErrorHandling(i,l,h,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,p,v,x)}evaluate(i,l,h,p,v,x){return this._styleExpression.evaluate(i,l,h,p,v,x)}}class yc{constructor(i,l,h,p){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==i&&!ze(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,l,h,p,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,p,v,x)}evaluate(i,l,h,p,v,x){return this._styleExpression.evaluate(i,l,h,p,v,x)}interpolationFactor(i,l,h){return this.interpolationType?it.interpolationFactor(this.interpolationType,i,l,h):0}}function xu(a,i){const l=Vi(a,i);if("error"===l.result)return l;const h=l.value.expression,p=ba(h);if(!p&&!Ks(i))return ss([new ei("","data expressions not supported")]);const v=jo(h,["zoom"]);if(!v&&!mc(i))return ss([new ei("","zoom expressions not supported")]);const x=Mi(h);return x||v?x instanceof ei?ss([x]):x instanceof it&&!as(i)?ss([new ei("",'"interpolate" expressions cannot be used with this property')]):vu(x?new yc(p?"camera":"composite",l.value,x.labels,x instanceof it?x.interpolation:void 0):new ri(p?"constant":"source",l.value)):ss([new ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jr{constructor(i,l){this._parameters=i,this._specification=l,Uo(this,Sa(this._parameters,this._specification))}static deserialize(i){return new jr(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Mi(a){let i=null;if(a instanceof is)i=Mi(a.result);else if(a instanceof no){for(const l of a.args)if(i=Mi(l),i)break}else(a instanceof Da||a instanceof it)&&a.input instanceof vt&&"zoom"===a.input.name&&(i=a);return i instanceof ei||a.eachChild(l=>{const h=Mi(l);h instanceof ei?i=h:!i&&h?i=new ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function At(a){const i=a.key,l=a.value,h=a.valueSpec||{},p=a.objectElementValidators||{},v=a.style,x=a.styleSpec;let D=[];const S=ht(l);if("object"!==S)return[new Be(i,l,`object expected, ${S} found`)];for(const A in l){const k=A.split(".")[0],F=h[k]||h["*"];let N;if(p[k])N=p[k];else if(h[k])N=tr;else if(p["*"])N=p["*"];else{if(!h["*"]){D.push(new Be(i,l[A],`unknown property "${A}"`));continue}N=tr}D=D.concat(N({key:(i&&`${i}.`)+A,value:l[A],valueSpec:F,style:v,styleSpec:x,object:l,objectKey:A},l))}for(const A in h)p[A]||h[A].required&&void 0===h[A].default&&void 0===l[A]&&D.push(new Be(i,l,`missing required property "${A}"`));return D}function Ia(a){const i=a.value,l=a.valueSpec,h=a.style,p=a.styleSpec,v=a.key,x=a.arrayElementValidator||tr;if("array"!==ht(i))return[new Be(v,i,`array expected, ${ht(i)} found`)];if(l.length&&i.length!==l.length)return[new Be(v,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Be(v,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let D={type:l.value,values:l.values};p.$version<7&&(D.function=l.function),"object"===ht(l.value)&&(D=l.value);let S=[];for(let A=0;A<i.length;A++)S=S.concat(x({array:i,arrayIndex:A,value:i[A],valueSpec:D,style:h,styleSpec:p,key:`${v}[${A}]`}));return S}function yl(a){const i=a.key,l=a.value,h=a.valueSpec;let p=ht(l);return"number"===p&&l!=l&&(p="NaN"),"number"!==p?[new Be(i,l,`number expected, ${p} found`)]:"minimum"in h&&l<h.minimum?[new Be(i,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Be(i,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function _l(a){const i=a.valueSpec,l=Jt(a.value.type);let h,p,v,x={};const D="categorical"!==l&&void 0===a.value.property,S=!D,A="array"===ht(a.value.stops)&&"array"===ht(a.value.stops[0])&&"object"===ht(a.value.stops[0][0]),k=At({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(U){if("identity"===l)return[new Be(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const Q=U.value;return V=V.concat(Ia({key:U.key,value:Q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:F})),"array"===ht(Q)&&0===Q.length&&V.push(new Be(U.key,Q,"array must have at least one stop")),V},default:function(U){return tr({key:U.key,value:U.value,valueSpec:i,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===l&&D&&k.push(new Be(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new Be(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!as(a.valueSpec)&&k.push(new Be(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(S&&!Ks(a.valueSpec)?k.push(new Be(a.key,a.value,"property functions not supported")):D&&!mc(a.valueSpec)&&k.push(new Be(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!A||void 0!==a.value.property||k.push(new Be(a.key,a.value,'"property" property is required')),k;function F(U){let V=[];const Q=U.value,ee=U.key;if("array"!==ht(Q))return[new Be(ee,Q,`array expected, ${ht(Q)} found`)];if(2!==Q.length)return[new Be(ee,Q,`array length 2 expected, length ${Q.length} found`)];if(A){if("object"!==ht(Q[0]))return[new Be(ee,Q,`object expected, ${ht(Q[0])} found`)];if(void 0===Q[0].zoom)return[new Be(ee,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new Be(ee,Q,"object stop key must have value")];if(v&&v>Jt(Q[0].zoom))return[new Be(ee,Q[0].zoom,"stop zoom values must appear in ascending order")];Jt(Q[0].zoom)!==v&&(v=Jt(Q[0].zoom),p=void 0,x={}),V=V.concat(At({key:`${ee}[0]`,value:Q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:yl,value:N}}))}else V=V.concat(N({key:`${ee}[0]`,value:Q[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},Q));return gl(Di(Q[1]))?V.concat([new Be(`${ee}[1]`,Q[1],"expressions are not allowed in function stops.")]):V.concat(tr({key:`${ee}[1]`,value:Q[1],valueSpec:i,style:U.style,styleSpec:U.styleSpec}))}function N(U,V){const Q=ht(U.value),ee=Jt(U.value),ae=null!==U.value?U.value:V;if(h){if(Q!==h)return[new Be(U.key,ae,`${Q} stop domain type must match previous stop domain type ${h}`)]}else h=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new Be(U.key,ae,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==l){let fe=`number expected, ${Q} found`;return Ks(i)&&void 0===l&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(U.key,ae,fe)]}return"categorical"!==l||"number"!==Q||isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==l&&"number"===Q&&void 0!==p&&ee<p?[new Be(U.key,ae,"stop domain values must appear in ascending order")]:(p=ee,"categorical"===l&&ee in x?[new Be(U.key,ae,"stop domain values must be unique")]:(x[ee]=!0,[])):[new Be(U.key,ae,`integer expected, found ${ee}`)]}}function cs(a){const i=("property"===a.expressionContext?xu:Vi)(Di(a.value),a.valueSpec);if("error"===i.result)return i.value.map(h=>new Be(`${a.key}${h.key}`,a.value,h.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Be(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ze(l))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!ze(l))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!jo(l,["zoom","feature-state"]))return[new Be(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!ba(l))return[new Be(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ai(a){const i=a.key,l=a.value,h=a.valueSpec,p=[];return Array.isArray(h.values)?-1===h.values.indexOf(Jt(l))&&p.push(new Be(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(Jt(l))&&p.push(new Be(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function us(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!us(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const bu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function hs(a){if(null==a)return{filter:()=>!0,needGeometry:!1};us(a)||(a=Js(a));const i=Vi(a,bu);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,p)=>i.value.evaluate(l,h,{},p),needGeometry:_c(a)}}function vl(a,i){return a<i?-1:a>i?1:0}function _c(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let i=1;i<a.length;i++)if(_c(a[i]))return!0;return!1}function Js(a){if(!a)return!0;const i=a[0];return a.length<=1?"any"!==i:"=="===i?Ho(a[1],a[2],"=="):"!="===i?Qn(Ho(a[1],a[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Ho(a[1],a[2],i):"any"===i?(l=a.slice(1),["any"].concat(l.map(Js))):"all"===i?["all"].concat(a.slice(1).map(Js)):"none"===i?["all"].concat(a.slice(1).map(Js).map(Qn)):"in"===i?xl(a[1],a.slice(2)):"!in"===i?Qn(xl(a[1],a.slice(2))):"has"===i?Ta(a[1]):"!has"===i?Qn(Ta(a[1])):"within"!==i||a;var l}function Ho(a,i,l){switch(a){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,a,i]}}function xl(a,i){if(0===i.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",a,["literal",i.sort(vl)]]:["filter-in-small",a,["literal",i]]}}function Ta(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Qn(a){return["!",a]}function pr(a){return us(Di(a.value))?cs(Uo({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cn(a)}function cn(a){const i=a.value,l=a.key;if("array"!==ht(i))return[new Be(l,i,`array expected, ${ht(i)} found`)];const h=a.styleSpec;let p,v=[];if(i.length<1)return[new Be(l,i,"filter array must have at least 1 element")];switch(v=v.concat(Ai({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),Jt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Jt(i[1])&&v.push(new Be(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&v.push(new Be(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=ht(i[1]),"string"!==p&&v.push(new Be(`${l}[1]`,i[1],`string expected, ${p} found`)));for(let x=2;x<i.length;x++)p=ht(i[x]),"$type"===Jt(i[1])?v=v.concat(Ai({key:`${l}[${x}]`,value:i[x],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&v.push(new Be(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)v=v.concat(cn({key:`${l}[${x}]`,value:i[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=ht(i[1]),2!==i.length?v.push(new Be(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==p&&v.push(new Be(`${l}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=ht(i[1]),2!==i.length?v.push(new Be(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==p&&v.push(new Be(`${l}[1]`,i[1],`object expected, ${p} found`))}return v}function er(a,i){const l=a.key,h=a.style,p=a.styleSpec,v=a.value,x=a.objectKey,D=p[`${i}_${a.layerType}`];if(!D)return[];const S=x.match(/^(.*)-transition$/);if("paint"===i&&S&&D[S[1]]&&D[S[1]].transition)return tr({key:l,value:v,valueSpec:p.transition,style:h,styleSpec:p});const A=a.valueSpec||D[x];if(!A)return[new Be(l,v,`unknown property "${x}"`)];let k;if("string"===ht(v)&&Ks(A)&&!A.tokens&&(k=/^{([^}]+)}$/.exec(v)))return[new Be(l,v,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const F=[];return"symbol"===a.layerType&&("text-field"===x&&h&&!h.glyphs&&F.push(new Be(l,v,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&ml(Di(v))&&"identity"===Jt(v.type)&&F.push(new Be(l,v,'"text-font" does not support identity functions'))),F.concat(tr({key:a.key,value:v,valueSpec:A,style:h,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:x}))}function Lr(a){return er(a,"paint")}function ds(a){return er(a,"layout")}function ii(a){let i=[];const l=a.value,h=a.key,p=a.style,v=a.styleSpec;l.type||l.ref||i.push(new Be(h,l,'either "type" or "ref" is required'));let x=Jt(l.type);const D=Jt(l.ref);if(l.id){const S=Jt(l.id);for(let A=0;A<a.arrayIndex;A++){const k=p.layers[A];Jt(k.id)===S&&i.push(new Be(h,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let S;["type","source","source-layer","filter","layout"].forEach(A=>{A in l&&i.push(new Be(h,l[A],`"${A}" is prohibited for ref layers`))}),p.layers.forEach(A=>{Jt(A.id)===D&&(S=A)}),S?S.ref?i.push(new Be(h,l.ref,"ref cannot reference another ref layer")):x=Jt(S.type):i.push(new Be(h,l.ref,`ref layer "${D}" not found`))}else if("background"!==x)if(l.source){const S=p.sources&&p.sources[l.source],A=S&&Jt(S.type);S?"vector"===A&&"raster"===x?i.push(new Be(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===A&&"raster"!==x?i.push(new Be(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==A||l["source-layer"]?"raster-dem"===A&&"hillshade"!==x?i.push(new Be(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!l.paint||!l.paint["line-gradient"]||"geojson"===A&&S.lineMetrics||i.push(new Be(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Be(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Be(h,l.source,`source "${l.source}" not found`))}else i.push(new Be(h,l,'missing required property "source"'));return i=i.concat(At({key:h,value:l,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>tr({key:`${h}.type`,value:l.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:pr,layout:S=>At({layer:l,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":A=>ds(Uo({layerType:x},A))}}),paint:S=>At({layer:l,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":A=>Lr(Uo({layerType:x},A))}})}})),i}function oi(a){const i=a.value,l=a.key,h=ht(i);return"string"!==h?[new Be(l,i,`string expected, ${h} found`)]:[]}const Ye={promoteId:function({key:a,value:i}){if("string"===ht(i))return oi({key:a,value:i});{const l=[];for(const h in i)l.push(...oi({key:`${a}.${h}`,value:i[h]}));return l}}};function wt(a){const i=a.value,l=a.key,h=a.styleSpec,p=a.style;if(!i.type)return[new Be(l,i,'"type" is required')];const v=Jt(i.type);let x;switch(v){case"vector":case"raster":case"raster-dem":return x=At({key:l,value:i,valueSpec:h[`source_${v.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:Ye}),x;case"geojson":if(x=At({key:l,value:i,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Ye}),i.cluster)for(const D in i.clusterProperties){const[S,A]=i.clusterProperties[D],k="string"==typeof S?[S,["accumulated"],["get",D]]:S;x.push(...cs({key:`${l}.${D}.map`,value:A,expressionContext:"cluster-map"})),x.push(...cs({key:`${l}.${D}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return x;case"video":return At({key:l,value:i,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return At({key:l,value:i,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Be(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ai({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:h})}}function Dn(a){const i=a.value,l=a.styleSpec,h=l.light,p=a.style;let v=[];const x=ht(i);if(void 0===i)return v;if("object"!==x)return v=v.concat([new Be("light",i,`object expected, ${x} found`)]),v;for(const D in i){const S=D.match(/^(.*)-transition$/);v=v.concat(S&&h[S[1]]&&h[S[1]].transition?tr({key:D,value:i[D],valueSpec:l.transition,style:p,styleSpec:l}):h[D]?tr({key:D,value:i[D],valueSpec:h[D],style:p,styleSpec:l}):[new Be(D,i[D],`unknown property "${D}"`)])}return v}const Bn={"*":()=>[],array:Ia,boolean:function(a){const i=a.value,l=a.key,h=ht(i);return"boolean"!==h?[new Be(l,i,`boolean expected, ${h} found`)]:[]},number:yl,color:function(a){const i=a.key,l=a.value,h=ht(l);return"string"!==h?[new Be(i,l,`color expected, ${h} found`)]:null===Ii(l)?[new Be(i,l,`color expected, "${l}" found`)]:[]},constants:Hs,enum:Ai,filter:pr,function:_l,layer:ii,object:At,source:wt,light:Dn,string:oi,formatted:function(a){return 0===oi(a).length?[]:cs(a)},resolvedImage:function(a){return 0===oi(a).length?[]:cs(a)}};function tr(a){const i=a.value,l=a.valueSpec,h=a.styleSpec;return l.expression&&ml(Jt(i))?_l(a):l.expression&&gl(Di(i))?cs(a):l.type&&Bn[l.type]?Bn[l.type](a):At(Uo({},a,{valueSpec:l.type?h[l.type]:l}))}function Fr(a){const i=a.value,l=a.key,h=oi(a);return h.length||(-1===i.indexOf("{fontstack}")&&h.push(new Be(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&h.push(new Be(l,i,'"glyphs" url must include a "{range}" token'))),h}function Pi(a,i=xe){let l=[];return l=l.concat(tr({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:Fr,"*":()=>[]}})),a.constants&&(l=l.concat(Hs({key:"constants",value:a.constants,style:a,styleSpec:i}))),$n(l)}function $n(a){return[].concat(a).sort((i,l)=>i.line-l.line)}function xo(a){return function(...i){return $n(a.apply(this,i))}}Pi.source=xo(wt),Pi.light=xo(Dn),Pi.layer=xo(ii),Pi.filter=xo(pr),Pi.paintProperty=xo(Lr),Pi.layoutProperty=xo(ds);const io=Pi,Ft=io.light,Ma=io.paintProperty,Aa=io.layoutProperty;function vc(a,i){let l=!1;if(i&&i.length)for(const h of i)a.fire(new $s(new Error(h.message))),l=!0;return l}class Ri{constructor(i,l,h){const p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(h=x[2]);for(let S=0;S<this.d*this.d;S++){const A=x[3+S],k=x[3+S+1];p.push(A===k?null:x.subarray(A,k))}const D=x[3+p.length+1];this.keys=x.subarray(x[3+p.length],D),this.bboxes=x.subarray(D),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let x=0;x<this.d*this.d;x++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;const v=h/l*i;this.min=-v,this.max=i+v}insert(i,l,h,p,v){this._forEachCell(l,h,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,h,p,v,x){this.cells[v].push(x)}query(i,l,h,p,v){const x=this.min,D=this.max;if(i<=x&&l<=x&&D<=h&&D<=p&&!v)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(i,l,h,p,this._queryCell,S,{},v),S}}_queryCell(i,l,h,p,v,x,D,S){const A=this.cells[v];if(null!==A){const k=this.keys,F=this.bboxes;for(let N=0;N<A.length;N++){const U=A[N];if(void 0===D[U]){const V=4*U;(S?S(F[V+0],F[V+1],F[V+2],F[V+3]):i<=F[V+2]&&l<=F[V+3]&&h>=F[V+0]&&p>=F[V+1])?(D[U]=!0,x.push(k[U])):D[U]=!1}}}}_forEachCell(i,l,h,p,v,x,D,S){const A=this._convertToCellCoord(i),k=this._convertToCellCoord(l),F=this._convertToCellCoord(h),N=this._convertToCellCoord(p);for(let U=A;U<=F;U++)for(let V=k;V<=N;V++){const Q=this.d*V+U;if((!S||S(this._convertFromCellCoord(U),this._convertFromCellCoord(V),this._convertFromCellCoord(U+1),this._convertFromCellCoord(V+1)))&&v.call(this,i,l,h,p,Q,x,D,S))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const p=new Int32Array(l+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=l;for(let x=0;x<i.length;x++){const D=i[x];p[3+x]=v,p.set(D,v),v+=D.length}return p[3+i.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+i.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(i,l){const h=i.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(i){return new Ri(i.buffer)}}const Xn={};function je(a,i,l={}){Object.defineProperty(i,"_classRegistryKey",{value:a,writeable:!1}),Xn[a]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}je("Object",Object),je("TransferableGridIndex",Ri),je("Color",L),je("Error",Error),je("AJAXError",Cr),je("ResolvedImage",ie),je("StylePropertyFunction",jr),je("StyleExpression",gc,{omit:["_evaluator"]}),je("ZoomDependentExpression",yc),je("ZoomConstantExpression",ri),je("CompoundExpression",vt,{omit:["_evaluate"]});for(const a in Ea)Ea[a]._classRegistryKey||je(`Expression_${a}`,Ea[a]);function Go(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function si(a,i){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Go(a)||Er(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return i&&i.push(l.buffer),l}if(a instanceof ImageData)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const h of a)l.push(si(h,i));return l}if("object"==typeof a){const l=a.constructor,h=l._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");const p=l.serialize?l.serialize(a,i):{};if(!l.serialize){for(const v in a){if(!a.hasOwnProperty(v)||Xn[h].omit.indexOf(v)>=0)continue;const x=a[v];p[v]=Xn[h].shallow.indexOf(v)>=0?x:si(x,i)}a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof a)}function $i(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Go(a)||Er(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map($i);if("object"==typeof a){const i=a.$name||"Object";if(!Xn[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=Xn[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(a);const h=Object.create(l.prototype);for(const p of Object.keys(a)){if("$name"===p)continue;const v=a[p];h[p]=Xn[i].shallow.indexOf(p)>=0?v:$i(v)}return h}throw new Error("can't deserialize object of type "+typeof a)}class Qs{constructor(){this.first=!0}update(i,l){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const Me={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function wu(a){for(const i of a)if(qo(i.charCodeAt(0)))return!0;return!1}function bl(a){for(const i of a)if(!Du(i.charCodeAt(0)))return!1;return!0}function Du(a){return!(Me.Arabic(a)||Me["Arabic Supplement"](a)||Me["Arabic Extended-A"](a)||Me["Arabic Presentation Forms-A"](a)||Me["Arabic Presentation Forms-B"](a))}function qo(a){return!(746!==a&&747!==a&&(a<4352||!(Me["Bopomofo Extended"](a)||Me.Bopomofo(a)||Me["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Me["CJK Compatibility Ideographs"](a)||Me["CJK Compatibility"](a)||Me["CJK Radicals Supplement"](a)||Me["CJK Strokes"](a)||!(!Me["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Me["CJK Unified Ideographs Extension A"](a)||Me["CJK Unified Ideographs"](a)||Me["Enclosed CJK Letters and Months"](a)||Me["Hangul Compatibility Jamo"](a)||Me["Hangul Jamo Extended-A"](a)||Me["Hangul Jamo Extended-B"](a)||Me["Hangul Jamo"](a)||Me["Hangul Syllables"](a)||Me.Hiragana(a)||Me["Ideographic Description Characters"](a)||Me.Kanbun(a)||Me["Kangxi Radicals"](a)||Me["Katakana Phonetic Extensions"](a)||Me.Katakana(a)&&12540!==a||!(!Me["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Me["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Me["Unified Canadian Aboriginal Syllabics"](a)||Me["Unified Canadian Aboriginal Syllabics Extended"](a)||Me["Vertical Forms"](a)||Me["Yijing Hexagram Symbols"](a)||Me["Yi Syllables"](a)||Me["Yi Radicals"](a))))}function Pa(a){return!(qo(a)||(i=a,Me["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Me["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Me["Letterlike Symbols"](i)||Me["Number Forms"](i)||Me["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Me["Control Pictures"](i)&&9251!==i||Me["Optical Character Recognition"](i)||Me["Enclosed Alphanumerics"](i)||Me["Geometric Shapes"](i)||Me["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Me["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Me["CJK Symbols and Punctuation"](i)||Me.Katakana(i)||Me["Private Use Area"](i)||Me["CJK Compatibility Forms"](i)||Me["Small Form Variants"](i)||Me["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function fs(a){return a>=1424&&a<=2303||Me["Arabic Presentation Forms-A"](a)||Me["Arabic Presentation Forms-B"](a)}function Hr(a,i){return!(!i&&fs(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Me.Khmer(a))}function Tf(a){for(const i of a)if(fs(i.charCodeAt(0)))return!0;return!1}const Or="deferred",fi="loading",Ra="loaded";let ps=null,Tr="unavailable",mr=null;const Eu=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(Tr="error"),ps&&ps(a)};function Cu(){ea.fire(new vo("pluginStateChange",{pluginStatus:Tr,pluginURL:mr}))}const ea=new js,xc=function(){return Tr},bc=function(){if(Tr!==Or||!mr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tr=fi,Cu(),mr&&go({url:mr},a=>{a?Eu(a):(Tr=Ra,Cu())})},ji={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Tr===Ra||null!=ji.applyArabicShaping,isLoading:()=>Tr===fi,setState(a){Tr=a.pluginStatus,mr=a.pluginURL},isParsed:()=>null!=ji.applyArabicShaping&&null!=ji.processBidirectionalText&&null!=ji.processStyledBidirectionalText,getPluginURL:()=>mr};class kn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qs,this.transition={})}isSupportedScript(i){return function(l,h){for(const p of l)if(!Hr(p.charCodeAt(0),h))return!1;return!0}(i,ji.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class wc{constructor(i,l){this.property=i,this.value=l,this.expression=function(h,p){if(ml(h))return new jr(h,p);if(gl(h)){const v=xu(h,p);if("error"===v.result)throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=h;return"string"==typeof h&&"color"===p.type&&(v=L.parse(h)),{kind:"constant",evaluate:()=>v}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class Dc{constructor(i){this.property=i,this.value=new wc(i,void 0)}transitioned(i,l){return new Yh(this.property,this.value,l,zt({},i.transition,this.transition),i.now)}untransitioned(){return new Yh(this.property,this.value,null,{},0)}}class Su{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ln(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Dc(this._values[i].property)),this._values[i].value=new wc(this._values[i].property,null===l?void 0:ln(l))}getTransition(i){return ln(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Dc(this._values[i].property)),this._values[i].transition=ln(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h);const p=this.getTransition(l);void 0!==p&&(i[`${l}-transition`]=p)}return i}transitioned(i,l){const h=new Jh(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(i,l._values[p]);return h}untransitioned(){const i=new Jh(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Yh{constructor(i,l,h,p,v){this.property=i,this.value=l,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const p=i.now||0,v=this.value.possiblyEvaluate(i,l,h),x=this.prior;if(x){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return x.possiblyEvaluate(i,l,h);{const D=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,h),v,function(S){if(S<=0)return 0;if(S>=1)return 1;const A=S*S,k=A*S;return 4*(S<.5?k:3*(S-A)+k-.75)}(D))}}return v}}class Jh{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const p=new Ec(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(i,l,h);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Mf{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return ln(this._values[i].value)}setValue(i,l){this._values[i]=new wc(this._values[i].property,null===l?void 0:ln(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){const p=new Ec(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(i,l,h);return p}}class bo{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,h,p){return this.property.evaluate(this.value,this.parameters,i,l,h,p)}}class Ec{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class et{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,h){const p=Ir[this.specification.type];return p?p(i,l,h):i}}class st{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,p){return new bo(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},h,p)}:i.expression,l)}interpolate(i,l,h){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new bo(this,{kind:"constant",value:void 0},i.parameters);const p=Ir[this.specification.type];return p?new bo(this,{kind:"constant",value:p(i.value.value,l.value.value,h)},i.parameters):i}evaluate(i,l,h,p,v,x){return"constant"===i.kind?i.value:i.evaluate(l,h,p,v,x)}}class ta extends st{possiblyEvaluate(i,l,h,p){if(void 0===i.value)return new bo(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const v=i.expression.evaluate(l,null,{},h,p),x="resolvedImage"===i.property.specification.type&&"string"!=typeof v?v.name:v,D=this._calculate(x,x,x,l);return new bo(this,{kind:"constant",value:D},l)}if("camera"===i.expression.kind){const v=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new bo(this,{kind:"constant",value:v},l)}return new bo(this,i.expression,l)}evaluate(i,l,h,p,v,x){if("source"===i.kind){const D=i.evaluate(l,h,p,v,x);return this._calculate(D,D,D,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},h,p),i.evaluate({zoom:Math.floor(l.zoom)},h,p),i.evaluate({zoom:Math.floor(l.zoom)+1},h,p),l):i.value}_calculate(i,l,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class wl{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,p){if(void 0!==i.value){if("constant"===i.expression.kind){const v=i.expression.evaluate(l,null,{},h,p);return this._calculate(v,v,v,l)}return this._calculate(i.expression.evaluate(new kn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new kn(Math.floor(l.zoom),l)),i.expression.evaluate(new kn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class Iu{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,p){return!!i.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class gr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const h=i[l];h.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new wc(h,void 0),v=this.defaultTransitionablePropertyValues[l]=new Dc(h);this.defaultTransitioningPropertyValues[l]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate({})}}}je("DataDrivenProperty",st),je("DataConstantProperty",et),je("CrossFadedDataDrivenProperty",ta),je("CrossFadedProperty",wl),je("ColorRampProperty",Iu);const pi="-transition";class ai extends js{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Mf(l.layout)),l.paint)){this._transitionablePaint=new Su(l.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ec(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,h={}){null!=l&&this._validate(Aa,`layers.${this.id}.layout.${i}`,i,l,h)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(pi)?this._transitionablePaint.getTransition(i.slice(0,-pi.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(null!=l&&this._validate(Ma,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(i.endsWith(pi))return this._transitionablePaint.setTransition(i.slice(0,-pi.length),l||void 0),!1;{const p=this._transitionablePaint._values[i],v="cross-faded-data-driven"===p.property.specification["property-type"],x=p.value.isDataDriven(),D=p.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const S=this._transitionablePaint._values[i].value;return S.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(i,D,S)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),wr(i,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(i,l,h,p,v={}){return(!v||!1!==v.validate)&&vc(this,i.call(io,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof bo&&Ks(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const ms={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class na{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class En{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function lr(a,i=1){let l=0,h=0;return{members:a.map(p=>{const v=ms[p.type].BYTES_PER_ELEMENT,x=l=Cc(l,Math.max(i,v)),D=p.components||1;return h=Math.max(h,v),l+=v*D,{name:p.name,type:p.type,components:D,offset:x}}),size:Cc(l,Math.max(h,i)),alignment:i}}function Cc(a,i){return Math.ceil(a/i)*i}class gs extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.int16[p+0]=l,this.int16[p+1]=h,i}}gs.prototype.bytesPerElement=4,je("StructArrayLayout2i4",gs);class ka extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,p)}emplace(i,l,h,p,v){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,this.int16[x+3]=v,i}}ka.prototype.bytesPerElement=8,je("StructArrayLayout4i8",ka);class m extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,p,v,x)}emplace(i,l,h,p,v,x,D){const S=6*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=p,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=D,i}}m.prototype.bytesPerElement=12,je("StructArrayLayout2i4i12",m);class o extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,p,v,x)}emplace(i,l,h,p,v,x,D){const S=4*i,A=8*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.uint8[A+4]=p,this.uint8[A+5]=v,this.uint8[A+6]=x,this.uint8[A+7]=D,i}}o.prototype.bytesPerElement=8,je("StructArrayLayout2i4ub8",o);class u extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.float32[p+0]=l,this.float32[p+1]=h,i}}u.prototype.bytesPerElement=8,je("StructArrayLayout2f8",u);class f extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x,D,S,A,k){const F=this.length;return this.resize(F+1),this.emplace(F,i,l,h,p,v,x,D,S,A,k)}emplace(i,l,h,p,v,x,D,S,A,k,F){const N=10*i;return this.uint16[N+0]=l,this.uint16[N+1]=h,this.uint16[N+2]=p,this.uint16[N+3]=v,this.uint16[N+4]=x,this.uint16[N+5]=D,this.uint16[N+6]=S,this.uint16[N+7]=A,this.uint16[N+8]=k,this.uint16[N+9]=F,i}}f.prototype.bytesPerElement=20,je("StructArrayLayout10ui20",f);class g extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x,D,S,A,k,F,N){const U=this.length;return this.resize(U+1),this.emplace(U,i,l,h,p,v,x,D,S,A,k,F,N)}emplace(i,l,h,p,v,x,D,S,A,k,F,N,U){const V=12*i;return this.int16[V+0]=l,this.int16[V+1]=h,this.int16[V+2]=p,this.int16[V+3]=v,this.uint16[V+4]=x,this.uint16[V+5]=D,this.uint16[V+6]=S,this.uint16[V+7]=A,this.int16[V+8]=k,this.int16[V+9]=F,this.int16[V+10]=N,this.int16[V+11]=U,i}}g.prototype.bytesPerElement=24,je("StructArrayLayout4i4ui4i24",g);class b extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const v=3*i;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=p,i}}b.prototype.bytesPerElement=12,je("StructArrayLayout3f12",b);class E extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}E.prototype.bytesPerElement=4,je("StructArrayLayout1ul4",E);class I extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x,D,S,A){const k=this.length;return this.resize(k+1),this.emplace(k,i,l,h,p,v,x,D,S,A)}emplace(i,l,h,p,v,x,D,S,A,k){const F=10*i,N=5*i;return this.int16[F+0]=l,this.int16[F+1]=h,this.int16[F+2]=p,this.int16[F+3]=v,this.int16[F+4]=x,this.int16[F+5]=D,this.uint32[N+3]=S,this.uint16[F+8]=A,this.uint16[F+9]=k,i}}I.prototype.bytesPerElement=20,je("StructArrayLayout6i1ul2ui20",I);class T extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,p,v,x)}emplace(i,l,h,p,v,x,D){const S=6*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=p,this.int16[S+3]=v,this.int16[S+4]=x,this.int16[S+5]=D,i}}T.prototype.bytesPerElement=12,je("StructArrayLayout2i2i2i12",T);class R extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,p,v)}emplace(i,l,h,p,v,x){const D=4*i,S=8*i;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=p,this.int16[S+6]=v,this.int16[S+7]=x,i}}R.prototype.bytesPerElement=16,je("StructArrayLayout2f1f2i16",R);class O extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,p)}emplace(i,l,h,p,v){const x=12*i,D=3*i;return this.uint8[x+0]=l,this.uint8[x+1]=h,this.float32[D+1]=p,this.float32[D+2]=v,i}}O.prototype.bytesPerElement=12,je("StructArrayLayout2ub2f12",O);class B extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const v=3*i;return this.uint16[v+0]=l,this.uint16[v+1]=h,this.uint16[v+2]=p,i}}B.prototype.bytesPerElement=6,je("StructArrayLayout3ui6",B);class j extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae){const fe=this.length;return this.resize(fe+1),this.emplace(fe,i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae)}emplace(i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae,fe){const de=24*i,me=12*i,Ie=48*i;return this.int16[de+0]=l,this.int16[de+1]=h,this.uint16[de+2]=p,this.uint16[de+3]=v,this.uint32[me+2]=x,this.uint32[me+3]=D,this.uint32[me+4]=S,this.uint16[de+10]=A,this.uint16[de+11]=k,this.uint16[de+12]=F,this.float32[me+7]=N,this.float32[me+8]=U,this.uint8[Ie+36]=V,this.uint8[Ie+37]=Q,this.uint8[Ie+38]=ee,this.uint32[me+10]=ae,this.int16[de+22]=fe,i}}j.prototype.bytesPerElement=48,je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",j);class K extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae,fe,de,me,Ie,De,Ge,nt,Ue,Ve,ke,He){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae,fe,de,me,Ie,De,Ge,nt,Ue,Ve,ke,He)}emplace(i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q,ee,ae,fe,de,me,Ie,De,Ge,nt,Ue,Ve,ke,He,Oe){const Pe=34*i,ct=17*i;return this.int16[Pe+0]=l,this.int16[Pe+1]=h,this.int16[Pe+2]=p,this.int16[Pe+3]=v,this.int16[Pe+4]=x,this.int16[Pe+5]=D,this.int16[Pe+6]=S,this.int16[Pe+7]=A,this.uint16[Pe+8]=k,this.uint16[Pe+9]=F,this.uint16[Pe+10]=N,this.uint16[Pe+11]=U,this.uint16[Pe+12]=V,this.uint16[Pe+13]=Q,this.uint16[Pe+14]=ee,this.uint16[Pe+15]=ae,this.uint16[Pe+16]=fe,this.uint16[Pe+17]=de,this.uint16[Pe+18]=me,this.uint16[Pe+19]=Ie,this.uint16[Pe+20]=De,this.uint16[Pe+21]=Ge,this.uint16[Pe+22]=nt,this.uint32[ct+12]=Ue,this.float32[ct+13]=Ve,this.float32[ct+14]=ke,this.float32[ct+15]=He,this.float32[ct+16]=Oe,i}}K.prototype.bytesPerElement=68,je("StructArrayLayout8i15ui1ul4f68",K);class H extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}H.prototype.bytesPerElement=4,je("StructArrayLayout1f4",H);class X extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const v=3*i;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=p,i}}X.prototype.bytesPerElement=6,je("StructArrayLayout3i6",X);class oe extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const v=4*i;return this.uint32[2*i+0]=l,this.uint16[v+2]=h,this.uint16[v+3]=p,i}}oe.prototype.bytesPerElement=8,je("StructArrayLayout1ul2ui8",oe);class se extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.uint16[p+0]=l,this.uint16[p+1]=h,i}}se.prototype.bytesPerElement=4,je("StructArrayLayout2ui4",se);class ce extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}ce.prototype.bytesPerElement=2,je("StructArrayLayout1ui2",ce);class J extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,p)}emplace(i,l,h,p,v){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,this.float32[x+3]=v,i}}J.prototype.bytesPerElement=16,je("StructArrayLayout4f16",J);class we extends na{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new tt(this.anchorPointX,this.anchorPointY)}}we.prototype.size=20;class ge extends I{get(i){return new we(this,i)}}je("CollisionBoxArray",ge);class _e extends na{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_e.prototype.size=48;class Ae extends j{get(i){return new _e(this,i)}}je("PlacedSymbolArray",Ae);class Re extends na{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Re.prototype.size=68;class be extends K{get(i){return new Re(this,i)}}je("SymbolInstanceArray",be);class Ze extends H{getoffsetX(i){return this.float32[1*i+0]}}je("GlyphOffsetArray",Ze);class Ne extends X{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}je("SymbolLineVertexArray",Ne);class he extends na{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}he.prototype.size=8;class Ke extends oe{get(i){return new he(this,i)}}je("FeatureIndexArray",Ke);class Pt extends gs{}class $t extends gs{}class Bt extends m{}class pt extends o{}class jt extends u{}class Ht extends f{}class cr extends g{}class Gr extends b{}class ki extends E{}class Hi extends T{}class wo extends O{}class _n extends B{}class yr extends se{}const Wo=lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:_r}=Wo;class It{constructor(i=[]){this.segments=i}prepareSegment(i,l,h,p){let v=this.segments[this.segments.length-1];return i>It.MAX_VERTEX_ARRAY_LENGTH&&Vn(`Max vertices per segment is ${It.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!v||v.vertexLength+i>It.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p)&&(v={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==p&&(v.sortKey=p),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,p){return new It([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function on(a,i){return 256*(a=ue(Math.floor(a),0,255))+ue(Math.floor(i),0,255)}It.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,je("SegmentVector",It);const Kn=lr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var qr={exports:{}},Li=function(a,i){var l,h,p,v,x,D,S,A;for(h=a.length-(l=3&a.length),p=i,x=3432918353,D=461845907,A=0;A<h;)S=255&a.charCodeAt(A)|(255&a.charCodeAt(++A))<<8|(255&a.charCodeAt(++A))<<16|(255&a.charCodeAt(++A))<<24,++A,p=27492+(65535&(v=5*(65535&(p=(p^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(S=0,l){case 3:S^=(255&a.charCodeAt(A+2))<<16;case 2:S^=(255&a.charCodeAt(A+1))<<8;case 1:p^=S=(65535&(S=(S=(65535&(S^=255&a.charCodeAt(A)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},La=function(a,i){for(var l,h=a.length,p=i^h,v=0;h>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++v;switch(h){case 3:p^=(255&a.charCodeAt(v+2))<<16;case 2:p^=(255&a.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};qr.exports=Li,qr.exports.murmur3=Li,qr.exports.murmur2=La;var Fa=qr.exports;class Dl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,p){this.ids.push(Sc(i)),this.positions.push(l,h,p)}getPositions(i){const l=Sc(i);let h=0,p=this.ids.length-1;for(;h<p;){const x=h+p>>1;this.ids[x]>=l?p=x:h=x+1}const v=[];for(;this.ids[h]===l;)v.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return v}static serialize(i,l){const h=new Float64Array(i.ids),p=new Uint32Array(i.positions);return Eo(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(i){const l=new Dl;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Sc(a){const i=+a;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Fa(String(a))}function Eo(a,i,l,h){for(;l<h;){const p=a[l+h>>1];let v=l-1,x=h+1;for(;;){do{v++}while(a[v]<p);do{x--}while(a[x]>p);if(v>=x)break;Oa(a,v,x),Oa(i,3*v,3*x),Oa(i,3*v+1,3*x+1),Oa(i,3*v+2,3*x+2)}x-l<h-x?(Eo(a,i,l,x),l=x+1):(Eo(a,i,x+1,h),h=x)}}function Oa(a,i,l){const h=a[i];a[i]=a[l],a[l]=h}je("FeaturePositionMap",Dl);class Gi{constructor(i,l){this.gl=i.gl,this.location=l}}class ys extends Gi{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Qh extends Gi{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Tu extends Gi{constructor(i,l){super(i,l),this.current=L.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const $m=new Float32Array(16);function ed(a){return[on(255*a.r,255*a.g),on(255*a.b,255*a.a)]}class Mr{constructor(i,l,h){this.value=i,this.uniformNames=l.map(p=>`u_${p}`),this.type=h}setUniform(i,l,h){i.set(h.constantOr(this.value))}getBinding(i,l,h){return"color"===this.type?new Tu(i,l):new ys(i,l)}}class oo{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,h,p){const v="u_pattern_to"===p?this.patternTo:"u_pattern_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,l,h){return"u_pattern"===h.substr(0,9)?new Qh(i,l):new ys(i,l)}}class fn{constructor(i,l,h,p){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,l,h,p,v){const x=this.paintVertexArray.length,D=this.expression.evaluate(new kn(0),l,{},p,[],v);this.paintVertexArray.resize(i),this._setPaintValue(x,i,D)}updatePaintArray(i,l,h,p){const v=this.expression.evaluate({zoom:0},h,p);this._setPaintValue(i,l,v)}_setPaintValue(i,l,h){if("color"===this.type){const p=ed(h);for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=i;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Co{constructor(i,l,h,p,v,x){this.expression=i,this.uniformNames=l.map(D=>`u_${D}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,h,p,v){const x=this.expression.evaluate(new kn(this.zoom),l,{},p,[],v),D=this.expression.evaluate(new kn(this.zoom+1),l,{},p,[],v),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,x,D)}updatePaintArray(i,l,h,p){const v=this.expression.evaluate({zoom:this.zoom},h,p),x=this.expression.evaluate({zoom:this.zoom+1},h,p);this._setPaintValue(i,l,v,x)}_setPaintValue(i,l,h,p){if("color"===this.type){const v=ed(h),x=ed(p);for(let D=i;D<l;D++)this.paintVertexArray.emplace(D,v[0],v[1],x[0],x[1])}else{for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,p=ue(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(p)}getBinding(i,l,h){return new ys(i,l)}}class ra{constructor(i,l,h,p,v,x){this.expression=i,this.type=l,this.useIntegerZoom=h,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,l,h){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,p,v){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],v)}_setPaintValues(i,l,h,p){if(!p||!h)return;const{min:v,mid:x,max:D}=h,S=p[v],A=p[x],k=p[D];if(S&&A&&k)for(let F=i;F<l;F++)this.zoomInPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],A.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],A.pixelRatio,k.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Kn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Kn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Af{constructor(i,l,h){this.binders={},this._buffers=[];const p=[];for(const v in i.paint._values){if(!h(v))continue;const x=i.paint.get(v);if(!(x instanceof bo&&Ks(x.property.specification)))continue;const D=jm(v,i.type),S=x.value,A=x.property.specification.type,k=x.property.useIntegerZoom,F=x.property.specification["property-type"],N="cross-faded"===F||"cross-faded-data-driven"===F;if("constant"===S.kind)this.binders[v]=N?new oo(S.value,D):new Mr(S.value,D,A),p.push(`/u_${v}`);else if("source"===S.kind||N){const U=Pf(v,A,"source");this.binders[v]=N?new ra(S,A,k,l,U,i.id):new fn(S,D,A,U),p.push(`/a_${v}`)}else{const U=Pf(v,A,"composite");this.binders[v]=new Co(S,D,A,k,l,U),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof fn||l instanceof Co?l.maxValue:0}populatePaintArrays(i,l,h,p,v){for(const x in this.binders){const D=this.binders[x];(D instanceof fn||D instanceof Co||D instanceof ra)&&D.populatePaintArray(i,l,h,p,v)}}setConstantPatternPositions(i,l){for(const h in this.binders){const p=this.binders[h];p instanceof oo&&p.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,h,p,v){let x=!1;for(const D in i){const S=l.getPositions(D);for(const A of S){const k=h.feature(A.index);for(const F in this.binders){const N=this.binders[F];if((N instanceof fn||N instanceof Co||N instanceof ra)&&!0===N.expression.isStateDependent){const U=p.paint.get(F);N.expression=U.value,N.updatePaintArray(A.start,A.end,k,i[D],v),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Mr||h instanceof oo)&&i.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof fn||h instanceof Co)for(let p=0;p<h.paintVertexAttributes.length;p++)i.push(h.paintVertexAttributes[p].name);else if(h instanceof ra)for(let p=0;p<Kn.members.length;p++)i.push(Kn.members[p].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Mr||h instanceof oo||h instanceof Co)for(const p of h.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const h=[];for(const p in this.binders){const v=this.binders[p];if(v instanceof Mr||v instanceof oo||v instanceof Co)for(const x of v.uniformNames)if(l[x]){const D=v.getBinding(i,l[x],x);h.push({name:x,property:p,binding:D})}}return h}setUniforms(i,l,h,p){for(const{name:v,property:x,binding:D}of l)this.binders[x].setUniform(D,p,h.get(x),v)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(i&&h instanceof ra){const p=2===i.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof fn||h instanceof Co)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof fn||h instanceof Co||h instanceof ra)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof fn||l instanceof Co||l instanceof ra)&&l.destroy()}}}class za{constructor(i,l,h=(()=>!0)){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new Af(p,l,h);this.needsUpload=!1,this._featureMap=new Dl,this._bufferOffset=0}populatePaintArrays(i,l,h,p,v,x){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(i,l,p,v,x);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,p){for(const v of h)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,l,v,p)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function jm(a,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}function Pf(a,i,l){const p={"line-pattern":{source:Ht,composite:Ht},"fill-pattern":{source:Ht,composite:Ht},"fill-extrusion-pattern":{source:Ht,composite:Ht}}[a];return p&&p[l]||{color:{source:u,composite:J},number:{source:H,composite:u}}[i][l]}je("ConstantBinder",Mr),je("CrossFadedConstantBinder",oo),je("SourceExpressionBinder",fn),je("CrossFadedCompositeBinder",ra),je("CompositeExpressionBinder",Co),je("ProgramConfiguration",Af,{omit:["_buffers"]}),je("ProgramConfigurationSet",za);var jn=8192;const El=Math.pow(2,14)-1,Ic=-El-1;function _s(a){const i=jn/a.extent,l=a.loadGeometry();for(let h=0;h<l.length;h++){const p=l[h];for(let v=0;v<p.length;v++){const x=p[v],D=Math.round(x.x*i),S=Math.round(x.y*i);x.x=ue(D,Ic,El),x.y=ue(S,Ic,El),(D<x.x||D>x.x+1||S<x.y||S>x.y+1)&&Vn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function ia(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?_s(a):[]}}function Mu(a,i,l,h,p){a.emplaceBack(2*i+(h+1)/2,2*l+(p+1)/2)}class oa{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Pt,this.indexArray=new _n,this.segments=new It,this.programConfigurations=new za(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){const p=this.layers[0],v=[];let x=null,D=!1;"circle"===p.type&&(x=p.layout.get("circle-sort-key"),D=!x.isConstant());for(const{feature:S,id:A,index:k,sourceLayerIndex:F}of i){const N=this.layers[0]._featureFilter.needGeometry,U=ia(S,N);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),U,h))continue;const V=D?x.evaluate(U,{},h):void 0,Q={id:A,properties:S.properties,type:S.type,sourceLayerIndex:F,index:k,geometry:N?U.geometry:_s(S),patterns:{},sortKey:V};v.push(Q)}D&&v.sort((S,A)=>S.sortKey-A.sortKey);for(const S of v){const{geometry:A,index:k,sourceLayerIndex:F}=S,N=i[k].feature;this.addFeature(S,A,k,h),l.featureIndex.insert(N,A,k,F,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_r),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,p){for(const v of l)for(const x of v){const D=x.x,S=x.y;if(D<0||D>=jn||S<0||S>=jn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),k=A.vertexLength;Mu(this.layoutVertexArray,D,S,-1,-1),Mu(this.layoutVertexArray,D,S,1,-1),Mu(this.layoutVertexArray,D,S,1,1),Mu(this.layoutVertexArray,D,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},p)}}function Cl(a,i){for(let l=0;l<a.length;l++)if(sa(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(sa(a,i[l]))return!0;return!!Rf(a,i)}function Hm(a,i,l){return!!sa(a,i)||!!nd(i,a,l)}function Gm(a,i){if(1===a.length)return Zm(i,a[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let p=0;p<h.length;p++)if(sa(a,h[p]))return!0}for(let l=0;l<a.length;l++)if(Zm(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(Rf(a,i[l]))return!0;return!1}function td(a,i,l){if(a.length>1){if(Rf(a,i))return!0;for(let h=0;h<i.length;h++)if(nd(i[h],a,l))return!0}for(let h=0;h<a.length;h++)if(nd(a[h],i,l))return!0;return!1}function Rf(a,i){if(0===a.length||0===i.length)return!1;for(let l=0;l<a.length-1;l++){const h=a[l],p=a[l+1];for(let v=0;v<i.length-1;v++)if(qm(h,p,i[v],i[v+1]))return!0}return!1}function qm(a,i,l,h){return Kt(a,l,h)!==Kt(i,l,h)&&Kt(a,i,l)!==Kt(a,i,h)}function nd(a,i,l){const h=l*l;if(1===i.length)return a.distSqr(i[0])<h;for(let p=1;p<i.length;p++)if(Wm(a,i[p-1],i[p])<h)return!0;return!1}function Wm(a,i,l){const h=i.distSqr(l);if(0===h)return a.distSqr(i);const p=((a.x-i.x)*(l.x-i.x)+(a.y-i.y)*(l.y-i.y))/h;return a.distSqr(p<0?i:p>1?l:l.sub(i)._mult(p)._add(i))}function Zm(a,i){let l,h,p,v=!1;for(let x=0;x<a.length;x++){l=a[x];for(let D=0,S=l.length-1;D<l.length;S=D++)h=l[D],p=l[S],h.y>i.y!=p.y>i.y&&i.x<(p.x-h.x)*(i.y-h.y)/(p.y-h.y)+h.x&&(v=!v)}return v}function sa(a,i){let l=!1;for(let h=0,p=a.length-1;h<a.length;p=h++){const v=a[h],x=a[p];v.y>i.y!=x.y>i.y&&i.x<(x.x-v.x)*(i.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function kf(a,i,l){const h=l[0],p=l[2];if(a.x<h.x&&i.x<h.x||a.x>p.x&&i.x>p.x||a.y<h.y&&i.y<h.y||a.y>p.y&&i.y>p.y)return!1;const v=Kt(a,i,l[0]);return v!==Kt(a,i,l[1])||v!==Kt(a,i,l[2])||v!==Kt(a,i,l[3])}function Sl(a,i,l){const h=i.paint.get(a).value;return"constant"===h.kind?h.value:l.programConfigurations.get(i.id).getMaxValue(a)}function aa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Tc(a,i,l,h,p){if(!i[0]&&!i[1])return a;const v=tt.convert(i)._mult(p);"viewport"===l&&v._rotate(-h);const x=[];for(let D=0;D<a.length;D++)x.push(a[D].sub(v));return x}je("CircleBucket",oa,{omit:["layers"]});const Lf=new gr({"circle-sort-key":new st(xe.layout_circle["circle-sort-key"])});var Au={paint:new gr({"circle-radius":new st(xe.paint_circle["circle-radius"]),"circle-color":new st(xe.paint_circle["circle-color"]),"circle-blur":new st(xe.paint_circle["circle-blur"]),"circle-opacity":new st(xe.paint_circle["circle-opacity"]),"circle-translate":new et(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(xe.paint_circle["circle-stroke-opacity"])}),layout:Lf},Il=typeof Float32Array<"u"?Float32Array:Array;function Tl(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Pu(a,i,l){var h=i[0],p=i[1],v=i[2],x=i[3],D=i[4],S=i[5],A=i[6],k=i[7],F=i[8],N=i[9],U=i[10],V=i[11],Q=i[12],ee=i[13],ae=i[14],fe=i[15],de=l[0],me=l[1],Ie=l[2],De=l[3];return a[0]=de*h+me*D+Ie*F+De*Q,a[1]=de*p+me*S+Ie*N+De*ee,a[2]=de*v+me*A+Ie*U+De*ae,a[3]=de*x+me*k+Ie*V+De*fe,a[4]=(de=l[4])*h+(me=l[5])*D+(Ie=l[6])*F+(De=l[7])*Q,a[5]=de*p+me*S+Ie*N+De*ee,a[6]=de*v+me*A+Ie*U+De*ae,a[7]=de*x+me*k+Ie*V+De*fe,a[8]=(de=l[8])*h+(me=l[9])*D+(Ie=l[10])*F+(De=l[11])*Q,a[9]=de*p+me*S+Ie*N+De*ee,a[10]=de*v+me*A+Ie*U+De*ae,a[11]=de*x+me*k+Ie*V+De*fe,a[12]=(de=l[12])*h+(me=l[13])*D+(Ie=l[14])*F+(De=l[15])*Q,a[13]=de*p+me*S+Ie*N+De*ee,a[14]=de*v+me*A+Ie*U+De*ae,a[15]=de*x+me*k+Ie*V+De*fe,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var la,av=Pu;function Mc(a,i,l){var h=i[0],p=i[1],v=i[2],x=i[3];return a[0]=l[0]*h+l[4]*p+l[8]*v+l[12]*x,a[1]=l[1]*h+l[5]*p+l[9]*v+l[13]*x,a[2]=l[2]*h+l[6]*p+l[10]*v+l[14]*x,a[3]=l[3]*h+l[7]*p+l[11]*v+l[15]*x,a}function rd(a,i){const l=Mc([],[a.x,a.y,0,1],i);return new tt(l[0]/l[3],l[1]/l[3])}la=new Il(4),Il!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0,la[3]=0);class Ff extends oa{}je("HeatmapBucket",Ff,{omit:["layers"]});var Zo={paint:new gr({"heatmap-radius":new st(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Iu(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(xe.paint_heatmap["heatmap-opacity"])})};function id(a,{width:i,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*l*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${i*l*h}`)}else p=new Uint8Array(i*l*h);return a.width=i,a.height=l,a.data=p,a}function Ac(a,{width:i,height:l},h){if(i===a.width&&l===a.height)return;const p=id({},{width:i,height:l},h);Pc(a,p,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,i),height:Math.min(a.height,l)},h),a.width=i,a.height=l,a.data=p.data}function Pc(a,i,l,h,p,v){if(0===p.width||0===p.height)return i;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||h.x>i.width-p.width||h.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,D=i.data;for(let S=0;S<p.height;S++){const A=((l.y+S)*a.width+l.x)*v,k=((h.y+S)*i.width+h.x)*v;for(let F=0;F<p.width*v;F++)D[k+F]=x[A+F]}return i}class Ml{constructor(i,l){id(this,i,1,l)}resize(i){Ac(this,i,1)}clone(){return new Ml({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,p,v){Pc(i,l,h,p,v,1)}}class mi{constructor(i,l){id(this,i,4,l)}resize(i){Ac(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new mi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,p,v){Pc(i,l,h,p,v,4)}}function Ru(a){const i={},l=a.resolution||256,h=a.clips?a.clips.length:1,p=a.image||new mi({width:l,height:h}),v=(x,D,S)=>{i[a.evaluationKey]=S;const A=a.expression.evaluate(i);p.data[x+D+0]=Math.floor(255*A.r/A.a),p.data[x+D+1]=Math.floor(255*A.g/A.a),p.data[x+D+2]=Math.floor(255*A.b/A.a),p.data[x+D+3]=Math.floor(255*A.a)};if(a.clips)for(let x=0,D=0;x<h;++x,D+=4*l)for(let S=0,A=0;S<l;S++,A+=4){const k=S/(l-1),{start:F,end:N}=a.clips[x];v(D,A,F*(1-k)+N*k)}else for(let x=0,D=0;x<l;x++,D+=4)v(0,D,x/(l-1));return p}je("AlphaImage",Ml),je("RGBAImage",mi);var Xm={paint:new gr({"hillshade-illumination-direction":new et(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(xe.paint_hillshade["hillshade-accent-color"])})};const Of=lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:zf}=Of;var ku={exports:{}};function Rc(a,i,l){l=l||2;var h,p,v,x,D,S,A,k=i&&i.length,F=k?i[0]*l:a.length,N=Nf(a,0,F,l,!0),U=[];if(!N||N.next===N.prev)return U;if(k&&(N=function(Q,ee,ae,fe){var de,me,Ie,De=[];for(de=0,me=ee.length;de<me;de++)(Ie=Nf(Q,ee[de]*fe,de<me-1?ee[de+1]*fe:Q.length,fe,!1))===Ie.next&&(Ie.steiner=!0),De.push($f(Ie));for(De.sort(Ym),de=0;de<De.length;de++)ae=So(ae=Vf(De[de],ae),ae.next);return ae}(a,i,N,l)),a.length>80*l){h=v=a[0],p=x=a[1];for(var V=l;V<F;V+=l)(D=a[V])<h&&(h=D),(S=a[V+1])<p&&(p=S),D>v&&(v=D),S>x&&(x=S);A=0!==(A=Math.max(v-h,x-p))?1/A:0}return Io(N,U,l,h,p,A),U}function Nf(a,i,l,h,p){var v,x;if(p===Gf(a,i,l,h)>0)for(v=i;v<l;v+=h)x=mt(v,a[v],a[v+1],x);else for(v=l-h;v>=i;v-=h)x=mt(v,a[v],a[v+1],x);return x&&xs(x,x.next)&&(Fu(x),x=x.next),x}function So(a,i){if(!a)return a;i||(i=a);var l,h=a;do{if(l=!1,h.steiner||!xs(h,h.next)&&0!==Cn(h.prev,h,h.next))h=h.next;else{if(Fu(h),(h=i=h.prev)===h.next)break;l=!0}}while(l||h!==i);return i}function Io(a,i,l,h,p,v,x){if(a){!x&&v&&function(k,F,N,U){var V=k;do{null===V.z&&(V.z=sd(V.x,V.y,F,N,U)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==k);V.prevZ.nextZ=null,V.prevZ=null,function(Q){var ee,ae,fe,de,me,Ie,De,Ge,nt=1;do{for(ae=Q,Q=null,me=null,Ie=0;ae;){for(Ie++,fe=ae,De=0,ee=0;ee<nt&&(De++,fe=fe.nextZ);ee++);for(Ge=nt;De>0||Ge>0&&fe;)0!==De&&(0===Ge||!fe||ae.z<=fe.z)?(de=ae,ae=ae.nextZ,De--):(de=fe,fe=fe.nextZ,Ge--),me?me.nextZ=de:Q=de,de.prevZ=me,me=de;ae=fe}me.nextZ=null,nt*=2}while(Ie>1)}(V)}(a,h,p,v);for(var D,S,A=a;a.prev!==a.next;)if(D=a.prev,S=a.next,v?Bf(a,h,p,v):Km(a))i.push(D.i/l),i.push(a.i/l),i.push(S.i/l),Fu(a),a=S.next,A=S.next;else if((a=S)===A){x?1===x?Io(a=Uf(So(a),i,l),i,l,h,p,v,2):2===x&&Al(a,i,l,h,p,v):Io(So(a),i,l,h,p,v,1);break}}}function Km(a){var i=a.prev,l=a,h=a.next;if(Cn(i,l,h)>=0)return!1;for(var p=a.next.next;p!==a.prev;){if(vs(i.x,i.y,l.x,l.y,h.x,h.y,p.x,p.y)&&Cn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Bf(a,i,l,h){var p=a.prev,v=a,x=a.next;if(Cn(p,v,x)>=0)return!1;for(var D=p.x>v.x?p.x>x.x?p.x:x.x:v.x>x.x?v.x:x.x,S=p.y>v.y?p.y>x.y?p.y:x.y:v.y>x.y?v.y:x.y,A=sd(p.x<v.x?p.x<x.x?p.x:x.x:v.x<x.x?v.x:x.x,p.y<v.y?p.y<x.y?p.y:x.y:v.y<x.y?v.y:x.y,i,l,h),k=sd(D,S,i,l,h),F=a.prevZ,N=a.nextZ;F&&F.z>=A&&N&&N.z<=k;){if(F!==a.prev&&F!==a.next&&vs(p.x,p.y,v.x,v.y,x.x,x.y,F.x,F.y)&&Cn(F.prev,F,F.next)>=0||(F=F.prevZ,N!==a.prev&&N!==a.next&&vs(p.x,p.y,v.x,v.y,x.x,x.y,N.x,N.y)&&Cn(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;F&&F.z>=A;){if(F!==a.prev&&F!==a.next&&vs(p.x,p.y,v.x,v.y,x.x,x.y,F.x,F.y)&&Cn(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;N&&N.z<=k;){if(N!==a.prev&&N!==a.next&&vs(p.x,p.y,v.x,v.y,x.x,x.y,N.x,N.y)&&Cn(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function Uf(a,i,l){var h=a;do{var p=h.prev,v=h.next.next;!xs(p,v)&&ad(p,h,h.next,v)&&Lu(p,v)&&Lu(v,p)&&(i.push(p.i/l),i.push(h.i/l),i.push(v.i/l),Fu(h),Fu(h.next),h=a=v),h=h.next}while(h!==a);return So(h)}function Al(a,i,l,h,p,v){var x=a;do{for(var D=x.next.next;D!==x.prev;){if(x.i!==D.i&&Pl(x,D)){var S=jf(x,D);return x=So(x,x.next),S=So(S,S.next),Io(x,i,l,h,p,v),void Io(S,i,l,h,p,v)}D=D.next}x=x.next}while(x!==a)}function Ym(a,i){return a.x-i.x}function Vf(a,i){var l=function(v,x){var D,S=x,A=v.x,k=v.y,F=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var N=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(N<=A&&N>F){if(F=N,N===A){if(k===S.y)return S;if(k===S.next.y)return S.next}D=S.x<S.next.x?S:S.next}}S=S.next}while(S!==x);if(!D)return null;if(A===F)return D;var U,V=D,Q=D.x,ee=D.y,ae=1/0;S=D;do{A>=S.x&&S.x>=Q&&A!==S.x&&vs(k<ee?A:F,k,Q,ee,k<ee?F:A,k,S.x,S.y)&&(U=Math.abs(k-S.y)/(A-S.x),Lu(S,v)&&(U<ae||U===ae&&(S.x>D.x||S.x===D.x&&od(D,S)))&&(D=S,ae=U)),S=S.next}while(S!==V);return D}(a,i);if(!l)return i;var h=jf(l,a),p=So(l,l.next);return So(h,h.next),i===l?p:i}function od(a,i){return Cn(a.prev,a,i.prev)<0&&Cn(i.next,a,a.next)<0}function sd(a,i,l,h,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*p)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-h)*p)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function $f(a){var i=a,l=a;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==a);return l}function vs(a,i,l,h,p,v,x,D){return(p-x)*(i-D)-(a-x)*(v-D)>=0&&(a-x)*(h-D)-(l-x)*(i-D)>=0&&(l-x)*(v-D)-(p-x)*(h-D)>=0}function Pl(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&ad(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1}(a,i)&&(Lu(a,i)&&Lu(i,a)&&function(l,h){var p=l,v=!1,x=(l.x+h.x)/2,D=(l.y+h.y)/2;do{p.y>D!=p.next.y>D&&p.next.y!==p.y&&x<(p.next.x-p.x)*(D-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next}while(p!==l);return v}(a,i)&&(Cn(a.prev,a,i.prev)||Cn(a,i.prev,i))||xs(a,i)&&Cn(a.prev,a,a.next)>0&&Cn(i.prev,i,i.next)>0)}function Cn(a,i,l){return(i.y-a.y)*(l.x-i.x)-(i.x-a.x)*(l.y-i.y)}function xs(a,i){return a.x===i.x&&a.y===i.y}function ad(a,i,l,h){var p=bs(Cn(a,i,l)),v=bs(Cn(a,i,h)),x=bs(Cn(l,h,a)),D=bs(Cn(l,h,i));return p!==v&&x!==D||!(0!==p||!Rl(a,l,i))||!(0!==v||!Rl(a,h,i))||!(0!==x||!Rl(l,a,h))||!(0!==D||!Rl(l,i,h))}function Rl(a,i,l){return i.x<=Math.max(a.x,l.x)&&i.x>=Math.min(a.x,l.x)&&i.y<=Math.max(a.y,l.y)&&i.y>=Math.min(a.y,l.y)}function bs(a){return a>0?1:a<0?-1:0}function Lu(a,i){return Cn(a.prev,a,a.next)<0?Cn(a,i,a.next)>=0&&Cn(a,a.prev,i)>=0:Cn(a,i,a.prev)<0||Cn(a,a.next,i)<0}function jf(a,i){var l=new Hf(a.i,a.x,a.y),h=new Hf(i.i,i.x,i.y),p=a.next,v=i.prev;return a.next=i,i.prev=a,l.next=p,p.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function mt(a,i,l,h){var p=new Hf(a,i,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Fu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Hf(a,i,l){this.i=a,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gf(a,i,l,h){for(var p=0,v=i,x=l-h;v<l;v+=h)p+=(a[x]-a[v])*(a[v+1]+a[x+1]),x=v;return p}ku.exports=Rc,ku.exports.default=Rc,Rc.deviation=function(a,i,l,h){var p=i&&i.length,v=Math.abs(Gf(a,0,p?i[0]*l:a.length,l));if(p)for(var x=0,D=i.length;x<D;x++)v-=Math.abs(Gf(a,i[x]*l,x<D-1?i[x+1]*l:a.length,l));var S=0;for(x=0;x<h.length;x+=3){var A=h[x]*l,k=h[x+1]*l,F=h[x+2]*l;S+=Math.abs((a[A]-a[F])*(a[k+1]-a[A+1])-(a[A]-a[k])*(a[F+1]-a[A+1]))}return 0===v&&0===S?0:Math.abs((S-v)/v)},Rc.flatten=function(a){for(var i=a[0][0].length,l={vertices:[],holes:[],dimensions:i},h=0,p=0;p<a.length;p++){for(var v=0;v<a[p].length;v++)for(var x=0;x<i;x++)l.vertices.push(a[p][v][x]);p>0&&l.holes.push(h+=a[p-1].length)}return l};var Jm=ku.exports;function lv(a,i,l,h,p){Qm(a,i,l||0,h||a.length-1,p||kc)}function Qm(a,i,l,h,p){for(;h>l;){if(h-l>600){var v=h-l+1,x=i-l+1,D=Math.log(v),S=.5*Math.exp(2*D/3),A=.5*Math.sqrt(D*S*(v-S)/v)*(x-v/2<0?-1:1);Qm(a,i,Math.max(l,Math.floor(i-x*S/v+A)),Math.min(h,Math.floor(i+(v-x)*S/v+A)),p)}var k=a[i],F=l,N=h;for(Ou(a,l,i),p(a[h],k)>0&&Ou(a,l,h);F<N;){for(Ou(a,F,N),F++,N--;p(a[F],k)<0;)F++;for(;p(a[N],k)>0;)N--}0===p(a[l],k)?Ou(a,l,N):Ou(a,++N,h),N<=i&&(l=N+1),i<=N&&(h=N-1)}}function Ou(a,i,l){var h=a[i];a[i]=a[l],a[l]=h}function kc(a,i){return a<i?-1:a>i?1:0}function qf(a,i){const l=a.length;if(l<=1)return[a];const h=[];let p,v;for(let x=0;x<l;x++){const D=dt(a[x]);0!==D&&(a[x].area=Math.abs(D),void 0===v&&(v=D<0),v===D<0?(p&&h.push(p),p=[a[x]]):p.push(a[x]))}if(p&&h.push(p),i>1)for(let x=0;x<h.length;x++)h[x].length<=i||(lv(h[x],i,1,h[x].length-1,cv),h[x]=h[x].slice(0,i));return h}function cv(a,i){return i.area-a.area}function ur(a,i,l){const h=l.patternDependencies;let p=!1;for(const v of i){const x=v.paint.get(`${a}-pattern`);x.isConstant()||(p=!0);const D=x.constantOr(null);D&&(p=!0,h[D.to]=!0,h[D.from]=!0)}return p}function Lc(a,i,l,h,p){const v=p.patternDependencies;for(const x of i){const D=x.paint.get(`${a}-pattern`).value;if("constant"!==D.kind){let S=D.evaluate({zoom:h-1},l,{},p.availableImages),A=D.evaluate({zoom:h},l,{},p.availableImages),k=D.evaluate({zoom:h+1},l,{},p.availableImages);S=S&&S.name?S.name:S,A=A&&A.name?A.name:A,k=k&&k.name?k.name:k,v[S]=!0,v[A]=!0,v[k]=!0,l.patterns[x.id]={min:S,mid:A,max:k}}}return l}class Na{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $t,this.indexArray=new _n,this.indexArray2=new yr,this.programConfigurations=new za(i.layers,i.zoom),this.segments=new It,this.segments2=new It,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=ur("fill",this.layers,l);const p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),x=[];for(const{feature:D,id:S,index:A,sourceLayerIndex:k}of i){const F=this.layers[0]._featureFilter.needGeometry,N=ia(D,F);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),N,h))continue;const U=v?p.evaluate(N,{},h,l.availableImages):void 0,V={id:S,properties:D.properties,type:D.type,sourceLayerIndex:k,index:A,geometry:F?N.geometry:_s(D),patterns:{},sortKey:U};x.push(V)}v&&x.sort((D,S)=>D.sortKey-S.sortKey);for(const D of x){const{geometry:S,index:A,sourceLayerIndex:k}=D;if(this.hasPattern){const F=Lc("fill",this.layers,D,this.zoom,l);this.patternFeatures.push(F)}else this.addFeature(D,S,A,h,{});l.featureIndex.insert(i[A].feature,S,A,k,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zf),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,p,v){for(const x of qf(l,500)){let D=0;for(const U of x)D+=U.length;const S=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),A=S.vertexLength,k=[],F=[];for(const U of x){if(0===U.length)continue;U!==x[0]&&F.push(k.length/2);const V=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Q=V.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Q+U.length-1,Q),k.push(U[0].x),k.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(Q+ee-1,Q+ee),k.push(U[ee].x),k.push(U[ee].y);V.vertexLength+=U.length,V.primitiveLength+=U.length}const N=Jm(k,F);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(A+N[U],A+N[U+1],A+N[U+2]);S.vertexLength+=D,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,p)}}je("FillBucket",Na,{omit:["layers","patternFeatures"]});const eg=new gr({"fill-sort-key":new st(xe.layout_fill["fill-sort-key"])});var so={paint:new gr({"fill-antialias":new et(xe.paint_fill["fill-antialias"]),"fill-opacity":new st(xe.paint_fill["fill-opacity"]),"fill-color":new st(xe.paint_fill["fill-color"]),"fill-outline-color":new st(xe.paint_fill["fill-outline-color"]),"fill-translate":new et(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ta(xe.paint_fill["fill-pattern"])}),layout:eg};const Ba=lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Wf}=Ba;var To={},Fc=tt,Zf=Oc;function Oc(a,i,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=p,a.readFields(tg,this,i)}function tg(a,i,l){1==a?i.id=l.readVarint():2==a?function(h,p){for(var v=h.readVarint()+h.pos;h.pos<v;){var x=p._keys[h.readVarint()],D=p._values[h.readVarint()];p.properties[x]=D}}(l,i):3==a?i.type=l.readVarint():4==a&&(i._geometry=l.pos)}function uv(a){for(var i,l,h=0,p=0,v=a.length,x=v-1;p<v;x=p++)h+=((l=a[x]).x-(i=a[p]).x)*(i.y+l.y);return h}Oc.types=["Unknown","Point","LineString","Polygon"],Oc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,l=a.readVarint()+a.pos,h=1,p=0,v=0,x=0,D=[];a.pos<l;){if(p<=0){var S=a.readVarint();h=7&S,p=S>>3}if(p--,1===h||2===h)v+=a.readSVarint(),x+=a.readSVarint(),1===h&&(i&&D.push(i),i=[]),i.push(new Fc(v,x));else{if(7!==h)throw new Error("unknown command "+h);i&&i.push(i[0].clone())}}return i&&D.push(i),D},Oc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,l=1,h=0,p=0,v=0,x=1/0,D=-1/0,S=1/0,A=-1/0;a.pos<i;){if(h<=0){var k=a.readVarint();l=7&k,h=k>>3}if(h--,1===l||2===l)(p+=a.readSVarint())<x&&(x=p),p>D&&(D=p),(v+=a.readSVarint())<S&&(S=v),v>A&&(A=v);else if(7!==l)throw new Error("unknown command "+l)}return[x,S,D,A]},Oc.prototype.toGeoJSON=function(a,i,l){var h,p,v=this.extent*Math.pow(2,l),x=this.extent*a,D=this.extent*i,S=this.loadGeometry(),A=Oc.types[this.type];function k(U){for(var V=0;V<U.length;V++){var Q=U[V];U[V]=[360*(Q.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+D)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(h=0;h<S.length;h++)F[h]=S[h][0];k(S=F);break;case 2:for(h=0;h<S.length;h++)k(S[h]);break;case 3:for(S=function(U){var V=U.length;if(V<=1)return[U];for(var Q,ee,ae=[],fe=0;fe<V;fe++){var de=uv(U[fe]);0!==de&&(void 0===ee&&(ee=de<0),ee===de<0?(Q&&ae.push(Q),Q=[U[fe]]):Q.push(U[fe]))}return Q&&ae.push(Q),ae}(S),h=0;h<S.length;h++)for(p=0;p<S[h].length;p++)k(S[h][p])}1===S.length?S=S[0]:A="Multi"+A;var N={type:"Feature",geometry:{type:A,coordinates:S},properties:this.properties};return"id"in this&&(N.id=this.id),N};var qi=Zf,zu=Ua;function Ua(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(hv,this,i),this.length=this._features.length}function hv(a,i,l){15===a?i.version=l.readVarint():1===a?i.name=l.readString():5===a?i.extent=l.readVarint():2===a?i._features.push(l.pos):3===a?i._keys.push(l.readString()):4===a&&i._values.push(function(h){for(var p=null,v=h.readVarint()+h.pos;h.pos<v;){var x=h.readVarint()>>3;p=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return p}(l))}Ua.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new qi(this._pbf,i,this.extent,this._keys,this._values)};var Xf=zu;function ng(a,i,l){if(3===a){var h=new Xf(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}To.VectorTile=function(a,i){this.layers=a.readFields(ng,{},i)},To.VectorTileFeature=Zf,To.VectorTileLayer=zu;const rg=To.VectorTileFeature.types,ld=Math.pow(2,13);function zc(a,i,l,h,p,v,x,D){a.emplaceBack(i,l,2*Math.floor(h*ld)+x,p*ld*2,v*ld*2,Math.round(D))}class cd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Bt,this.indexArray=new _n,this.programConfigurations=new za(i.layers,i.zoom),this.segments=new It,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.features=[],this.hasPattern=ur("fill-extrusion",this.layers,l);for(const{feature:p,id:v,index:x,sourceLayerIndex:D}of i){const S=this.layers[0]._featureFilter.needGeometry,A=ia(p,S);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),A,h))continue;const k={id:v,sourceLayerIndex:D,index:x,geometry:S?A.geometry:_s(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Lc("fill-extrusion",this.layers,k,this.zoom,l)):this.addFeature(k,k.geometry,x,h,{}),l.featureIndex.insert(p,k.geometry,x,D,this.index,!0)}}addFeatures(i,l,h){for(const p of this.features){const{geometry:v}=p;this.addFeature(p,v,p.index,l,h)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Wf),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,p,v){for(const x of qf(l,500)){let D=0;for(const U of x)D+=U.length;let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of x){if(0===U.length||((a=U).every(i=>i.x<0)||a.every(i=>i.x>jn)||a.every(i=>i.y<0)||a.every(i=>i.y>jn)))continue;let V=0;for(let Q=0;Q<U.length;Q++){const ee=U[Q];if(Q>=1){const ae=U[Q-1];if(!ig(ee,ae)){S.vertexLength+4>It.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const fe=ee.sub(ae)._perp()._unit(),de=ae.dist(ee);V+de>32768&&(V=0),zc(this.layoutVertexArray,ee.x,ee.y,fe.x,fe.y,0,0,V),zc(this.layoutVertexArray,ee.x,ee.y,fe.x,fe.y,0,1,V),V+=de,zc(this.layoutVertexArray,ae.x,ae.y,fe.x,fe.y,0,0,V),zc(this.layoutVertexArray,ae.x,ae.y,fe.x,fe.y,0,1,V);const me=S.vertexLength;this.indexArray.emplaceBack(me,me+2,me+1),this.indexArray.emplaceBack(me+1,me+2,me+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+D>It.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),"Polygon"!==rg[i.type])continue;const A=[],k=[],F=S.vertexLength;for(const U of x)if(0!==U.length){U!==x[0]&&k.push(A.length/2);for(let V=0;V<U.length;V++){const Q=U[V];zc(this.layoutVertexArray,Q.x,Q.y,0,0,1,1,0),A.push(Q.x),A.push(Q.y)}}const N=Jm(A,k);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(F+N[U],F+N[U+2],F+N[U+1]);S.primitiveLength+=N.length/3,S.vertexLength+=D}var a;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,p)}}function ig(a,i){return a.x===i.x&&(a.x<0||a.x>jn)||a.y===i.y&&(a.y<0||a.y>jn)}je("FillExtrusionBucket",cd,{omit:["layers","features"]});var Nu={paint:new gr({"fill-extrusion-opacity":new et(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ta(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Va(a,i){return a.x*i.x+a.y*i.y}function kl(a,i){if(1===a.length){let l=0;const h=i[l++];let p;for(;!p||h.equals(p);)if(p=i[l++],!p)return 1/0;for(;l<i.length;l++){const v=i[l],x=a[0],D=p.sub(h),S=v.sub(h),A=x.sub(h),k=Va(D,D),F=Va(D,S),N=Va(S,S),U=Va(A,D),V=Va(A,S),Q=k*N-F*F,ee=(N*U-F*V)/Q,ae=(k*V-F*U)/Q,fe=h.z*(1-ee-ae)+p.z*ee+v.z*ae;if(isFinite(fe))return fe}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}const Kf=lr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nc}=Kf,og=lr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yf}=og,Bc=To.VectorTileFeature.types,Bu=Math.cos(Math.PI/180*37.5),hd=Math.pow(2,14)/.5;class dd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new pt,this.layoutVertexArray2=new jt,this.indexArray=new _n,this.programConfigurations=new za(i.layers,i.zoom),this.segments=new It,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=ur("line",this.layers,l);const p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),x=[];for(const{feature:D,id:S,index:A,sourceLayerIndex:k}of i){const F=this.layers[0]._featureFilter.needGeometry,N=ia(D,F);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),N,h))continue;const U=v?p.evaluate(N,{},h):void 0,V={id:S,properties:D.properties,type:D.type,sourceLayerIndex:k,index:A,geometry:F?N.geometry:_s(D),patterns:{},sortKey:U};x.push(V)}v&&x.sort((D,S)=>D.sortKey-S.sortKey);for(const D of x){const{geometry:S,index:A,sourceLayerIndex:k}=D;if(this.hasPattern){const F=Lc("line",this.layers,D,this.zoom,l);this.patternFeatures.push(F)}else this.addFeature(D,S,A,h,{});l.featureIndex.insert(i[A].feature,S,A,k,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Yf)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Nc),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,p,v){const x=this.layers[0].layout,D=x.get("line-join").evaluate(i,{}),S=x.get("line-cap"),A=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const F of l)this.addLine(F,i,D,S,A,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,p)}addLine(i,l,h,p,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<i.length-1;ae++)this.totalDistance+=i[ae].dist(i[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===Bc[l.type];let S=i.length;for(;S>=2&&i[S-1].equals(i[S-2]);)S--;let A=0;for(;A<S-1&&i[A].equals(i[A+1]);)A++;if(S<(D?3:2))return;"bevel"===h&&(v=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let N,U,V,Q,ee;this.e1=this.e2=-1,D&&(N=i[S-2],ee=i[A].sub(N)._unit()._perp());for(let ae=A;ae<S;ae++){if(V=ae===S-1?D?i[A+1]:void 0:i[ae+1],V&&i[ae].equals(V))continue;ee&&(Q=ee),N&&(U=N),N=i[ae],ee=V?V.sub(N)._unit()._perp():Q,Q=Q||ee;let fe=Q.add(ee);0===fe.x&&0===fe.y||fe._unit();const de=Q.x*ee.x+Q.y*ee.y,me=fe.x*ee.x+fe.y*ee.y,Ie=0!==me?1/me:1/0,De=2*Math.sqrt(2-2*me),Ge=me<Bu&&U&&V,nt=Q.x*ee.y-Q.y*ee.x>0;if(Ge&&ae>A){const ke=N.dist(U);if(ke>2*k){const He=N.sub(N.sub(U)._mult(k/ke)._round());this.updateDistance(U,He),this.addCurrentVertex(He,Q,0,0,F),U=He}}const Ue=U&&V;let Ve=Ue?h:D?"butt":p;if(Ue&&"round"===Ve&&(Ie<x?Ve="miter":Ie<=2&&(Ve="fakeround")),"miter"===Ve&&Ie>v&&(Ve="bevel"),"bevel"===Ve&&(Ie>2&&(Ve="flipbevel"),Ie<v&&(Ve="miter")),U&&this.updateDistance(U,N),"miter"===Ve)fe._mult(Ie),this.addCurrentVertex(N,fe,0,0,F);else if("flipbevel"===Ve){if(Ie>100)fe=ee.mult(-1);else{const ke=Ie*Q.add(ee).mag()/Q.sub(ee).mag();fe._perp()._mult(ke*(nt?-1:1))}this.addCurrentVertex(N,fe,0,0,F),this.addCurrentVertex(N,fe.mult(-1),0,0,F)}else if("bevel"===Ve||"fakeround"===Ve){const ke=-Math.sqrt(Ie*Ie-1),He=nt?ke:0,Oe=nt?0:ke;if(U&&this.addCurrentVertex(N,Q,He,Oe,F),"fakeround"===Ve){const Pe=Math.round(180*De/Math.PI/20);for(let ct=1;ct<Pe;ct++){let rt=ct/Pe;if(.5!==rt){const sn=rt-.5;rt+=rt*sn*(rt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*sn*sn+(.848013+de*(.215638*de-1.06021)))}const Gt=ee.sub(Q)._mult(rt)._add(Q)._unit()._mult(nt?-1:1);this.addHalfVertex(N,Gt.x,Gt.y,!1,nt,0,F)}}V&&this.addCurrentVertex(N,ee,-He,-Oe,F)}else if("butt"===Ve)this.addCurrentVertex(N,fe,0,0,F);else if("square"===Ve){const ke=U?1:-1;this.addCurrentVertex(N,fe,ke,ke,F)}else"round"===Ve&&(U&&(this.addCurrentVertex(N,Q,0,0,F),this.addCurrentVertex(N,Q,1,1,F,!0)),V&&(this.addCurrentVertex(N,ee,-1,-1,F,!0),this.addCurrentVertex(N,ee,0,0,F)));if(Ge&&ae<S-1){const ke=N.dist(V);if(ke>2*k){const He=N.add(V.sub(N)._mult(k/ke)._round());this.updateDistance(N,He),this.addCurrentVertex(He,ee,0,0,F),N=He}}}}addCurrentVertex(i,l,h,p,v,x=!1){const D=l.y*p-l.x,S=-l.y-l.x*p;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,x,!1,h,v),this.addHalfVertex(i,D,S,x,!0,-p,v),this.distance>hd/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(i,l,h,p,v,x))}addHalfVertex({x:i,y:l},h,p,v,x,D,S){const A=.5*(this.lineClips?this.scaledDistance*(hd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(0===D?0:D<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),x?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}je("LineBucket",dd,{omit:["layers","patternFeatures"]});const sg=new gr({"line-cap":new et(xe.layout_line["line-cap"]),"line-join":new st(xe.layout_line["line-join"]),"line-miter-limit":new et(xe.layout_line["line-miter-limit"]),"line-round-limit":new et(xe.layout_line["line-round-limit"]),"line-sort-key":new st(xe.layout_line["line-sort-key"])});var $a={paint:new gr({"line-opacity":new st(xe.paint_line["line-opacity"]),"line-color":new st(xe.paint_line["line-color"]),"line-translate":new et(xe.paint_line["line-translate"]),"line-translate-anchor":new et(xe.paint_line["line-translate-anchor"]),"line-width":new st(xe.paint_line["line-width"]),"line-gap-width":new st(xe.paint_line["line-gap-width"]),"line-offset":new st(xe.paint_line["line-offset"]),"line-blur":new st(xe.paint_line["line-blur"]),"line-dasharray":new wl(xe.paint_line["line-dasharray"]),"line-pattern":new ta(xe.paint_line["line-pattern"]),"line-gradient":new Iu(xe.paint_line["line-gradient"])}),layout:sg};const Ll=new class extends st{possiblyEvaluate(a,i){return i=new kn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,l,h){return i=zt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,l,h)}}($a.paint.properties["line-width"].specification);function Jf(a,i){return i>0?i+2*a:a}Ll.useIntegerZoom=!0;const dv=lr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qf=lr([{name:"a_projected_pos",components:3,type:"Float32"}],4);lr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ag=lr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);lr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lg=lr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cg=lr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ug(a,i,l){return a.sections.forEach(h=>{h.text=function(p,v,x){const D=v.layout.get("text-transform").evaluate(x,{});return"uppercase"===D?p=p.toLocaleUpperCase():"lowercase"===D&&(p=p.toLocaleLowerCase()),ji.applyArabicShaping&&(p=ji.applyArabicShaping(p)),p}(h.text,i,l)}),a}lr([{name:"triangle",components:3,type:"Uint16"}]),lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),lr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),lr([{type:"Float32",name:"offsetX"}]),lr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Uc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var nr=24,Uu=vn,ep=function(a,i,l,h,p){var v,x,D=8*p-h-1,S=(1<<D)-1,A=S>>1,k=-7,F=l?p-1:0,N=l?-1:1,U=a[i+F];for(F+=N,v=U&(1<<-k)-1,U>>=-k,k+=D;k>0;v=256*v+a[i+F],F+=N,k-=8);for(x=v&(1<<-k)-1,v>>=-k,k+=h;k>0;x=256*x+a[i+F],F+=N,k-=8);if(0===v)v=1-A;else{if(v===S)return x?NaN:1/0*(U?-1:1);x+=Math.pow(2,h),v-=A}return(U?-1:1)*x*Math.pow(2,v-h)},fd=function(a,i,l,h,p,v){var x,D,S,A=8*v-p-1,k=(1<<A)-1,F=k>>1,N=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,U=h?0:v-1,V=h?1:-1,Q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(D=isNaN(i)?1:0,x=k):(x=Math.floor(Math.log(i)/Math.LN2),i*(S=Math.pow(2,-x))<1&&(x--,S*=2),(i+=x+F>=1?N/S:N*Math.pow(2,1-F))*S>=2&&(x++,S/=2),x+F>=k?(D=0,x=k):x+F>=1?(D=(i*S-1)*Math.pow(2,p),x+=F):(D=i*Math.pow(2,F-1)*Math.pow(2,p),x=0));p>=8;a[l+U]=255&D,U+=V,D/=256,p-=8);for(x=x<<p|D,A+=p;A>0;a[l+U]=255&x,U+=V,x/=256,A-=8);a[l+U-V]|=128*Q};function vn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}vn.Varint=0,vn.Fixed64=1,vn.Bytes=2,vn.Fixed32=5;var ws,tp=4294967296,np=1/tp,rp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Mo(a){return a.type===vn.Bytes?a.readVarint()+a.pos:a.pos+1}function hg(a,i,l){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=a;p--)l.buf[p+h]=l.buf[p]}function pd(a,i){for(var l=0;l<a.length;l++)i.writeVarint(a[l])}function fv(a,i){for(var l=0;l<a.length;l++)i.writeSVarint(a[l])}function pv(a,i){for(var l=0;l<a.length;l++)i.writeFloat(a[l])}function mv(a,i){for(var l=0;l<a.length;l++)i.writeDouble(a[l])}function gv(a,i){for(var l=0;l<a.length;l++)i.writeBoolean(a[l])}function yv(a,i){for(var l=0;l<a.length;l++)i.writeFixed32(a[l])}function dg(a,i){for(var l=0;l<a.length;l++)i.writeSFixed32(a[l])}function ip(a,i){for(var l=0;l<a.length;l++)i.writeFixed64(a[l])}function md(a,i){for(var l=0;l<a.length;l++)i.writeSFixed64(a[l])}function $c(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function ja(a,i,l){a[l]=i,a[l+1]=i>>>8,a[l+2]=i>>>16,a[l+3]=i>>>24}function gd(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function Fi(a,i,l){1===a&&l.readMessage(fg,i)}function fg(a,i,l){if(3===a){const{id:h,bitmap:p,width:v,height:x,left:D,top:S,advance:A}=l.readMessage(pg,{});i.push({id:h,bitmap:new Ml({width:v+6,height:x+6},p),metrics:{width:v,height:x,left:D,top:S,advance:A}})}}function pg(a,i,l){1===a?i.id=l.readVarint():2===a?i.bitmap=l.readBytes():3===a?i.width=l.readVarint():4===a?i.height=l.readVarint():5===a?i.left=l.readSVarint():6===a?i.top=l.readSVarint():7===a&&(i.advance=l.readVarint())}function op(a){let i=0,l=0;for(const x of a)i+=x.w*x.h,l=Math.max(l,x.w);a.sort((x,D)=>D.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let p=0,v=0;for(const x of a)for(let D=h.length-1;D>=0;D--){const S=h[D];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,v=Math.max(v,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===S.w&&x.h===S.h){const A=h.pop();D<h.length&&(h[D]=A)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(h.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:p,h:v,fill:i/(p*v)||0}}vn.prototype={destroy:function(){this.buf=null},readFields:function(a,i,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,v=this.pos;this.type=7&h,a(p,i,this),this.pos===v&&this.skip(h)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=$c(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=gd(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=$c(this.buf,this.pos)+$c(this.buf,this.pos+4)*tp;return this.pos+=8,a},readSFixed64:function(){var a=$c(this.buf,this.pos)+gd(this.buf,this.pos+4)*tp;return this.pos+=8,a},readFloat:function(){var a=ep(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=ep(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,l,h=this.buf;return i=127&(l=h[this.pos++]),l<128?i:(i|=(127&(l=h[this.pos++]))<<7,l<128?i:(i|=(127&(l=h[this.pos++]))<<14,l<128?i:(i|=(127&(l=h[this.pos++]))<<21,l<128?i:function(p,v,x){var D,S,A=x.buf;if(D=(112&(S=A[x.pos++]))>>4,S<128||(D|=(127&(S=A[x.pos++]))<<3,S<128)||(D|=(127&(S=A[x.pos++]))<<10,S<128)||(D|=(127&(S=A[x.pos++]))<<17,S<128)||(D|=(127&(S=A[x.pos++]))<<24,S<128)||(D|=(1&(S=A[x.pos++]))<<31,S<128))return function Vc(a,i,l){return l?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}(p,D,v);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&rp?rp.decode(this.buf.subarray(i,a)):function(l,h,p){for(var v="",x=h;x<p;){var D,S,A,k=l[x],F=null,N=k>239?4:k>223?3:k>191?2:1;if(x+N>p)break;1===N?k<128&&(F=k):2===N?128==(192&(D=l[x+1]))&&(F=(31&k)<<6|63&D)<=127&&(F=null):3===N?(S=l[x+2],128==(192&(D=l[x+1]))&&128==(192&S)&&((F=(15&k)<<12|(63&D)<<6|63&S)<=2047||F>=55296&&F<=57343)&&(F=null)):4===N&&(S=l[x+2],A=l[x+3],128==(192&(D=l[x+1]))&&128==(192&S)&&128==(192&A)&&((F=(15&k)<<18|(63&D)<<12|(63&S)<<6|63&A)<=65535||F>=1114112)&&(F=null)),null===F?(F=65533,N=1):F>65535&&(F-=65536,v+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),v+=String.fromCharCode(F),x+=N}return v}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==vn.Bytes)return a.push(this.readVarint(i));var l=Mo(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==vn.Bytes)return a.push(this.readSVarint());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==vn.Bytes)return a.push(this.readBoolean());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==vn.Bytes)return a.push(this.readFloat());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==vn.Bytes)return a.push(this.readDouble());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==vn.Bytes)return a.push(this.readFixed32());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==vn.Bytes)return a.push(this.readSFixed32());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==vn.Bytes)return a.push(this.readFixed64());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==vn.Bytes)return a.push(this.readSFixed64());var i=Mo(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===vn.Varint)for(;this.buf[this.pos++]>127;);else if(i===vn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===vn.Fixed32)this.pos+=4;else{if(i!==vn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),ja(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),ja(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),ja(this.buf,-1&a,this.pos),ja(this.buf,Math.floor(a*np),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),ja(this.buf,-1&a,this.pos),ja(this.buf,Math.floor(a*np),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,l){var h,p,v,D;if(i>=0?(h=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(h=~(-i%4294967296))?h=h+1|0:(h=0,p=p+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),v=h,(D=l).buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,D.buf[D.pos]=127&(v>>>=7),function(v,x){var D=(7&v)<<4;x.buf[x.pos++]|=D|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(h,p,v){for(var x,D,S=0;S<p.length;S++){if((x=p.charCodeAt(S))>55295&&x<57344){if(!D){x>56319||S+1===p.length?(h[v++]=239,h[v++]=191,h[v++]=189):D=x;continue}if(x<56320){h[v++]=239,h[v++]=191,h[v++]=189,D=x;continue}x=D-55296<<10|x-56320|65536,D=null}else D&&(h[v++]=239,h[v++]=191,h[v++]=189,D=null);x<128?h[v++]=x:(x<2048?h[v++]=x>>6|192:(x<65536?h[v++]=x>>12|224:(h[v++]=x>>18|240,h[v++]=x>>12&63|128),h[v++]=x>>6&63|128),h[v++]=63&x|128)}return v}(this.buf,a,this.pos);var l=this.pos-i;l>=128&&hg(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),fd(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),fd(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,i){this.pos++;var l=this.pos;a(i,this);var h=this.pos-l;h>=128&&hg(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,i,l){this.writeTag(a,vn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,pd,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,fv,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,gv,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,pv,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,mv,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,yv,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,dg,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,ip,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,md,i)},writeBytesField:function(a,i){this.writeTag(a,vn.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,vn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,vn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,vn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,vn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,vn.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,vn.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,vn.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,vn.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,vn.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,Boolean(i))}};class Vu{constructor(i,{pixelRatio:l,version:h,stretchX:p,stretchY:v,content:x}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=p,this.stretchY=v,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $u{constructor(i,l){const h={},p={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,h,v),this.addImages(l,p,v);const{w:x,h:D}=op(v),S=new mi({width:x||1,height:D||1});for(const A in i){const k=i[A],F=h[A].paddedRect;mi.copy(k.data,S,{x:0,y:0},{x:F.x+1,y:F.y+1},k.data)}for(const A in l){const k=l[A],F=p[A].paddedRect,N=F.x+1,U=F.y+1,V=k.data.width,Q=k.data.height;mi.copy(k.data,S,{x:0,y:0},{x:N,y:U},k.data),mi.copy(k.data,S,{x:0,y:Q-1},{x:N,y:U-1},{width:V,height:1}),mi.copy(k.data,S,{x:0,y:0},{x:N,y:U+Q},{width:V,height:1}),mi.copy(k.data,S,{x:V-1,y:0},{x:N-1,y:U},{width:1,height:Q}),mi.copy(k.data,S,{x:0,y:0},{x:N+V,y:U},{width:1,height:Q})}this.image=S,this.iconPositions=h,this.patternPositions=p}addImages(i,l,h){for(const p in i){const v=i[p],x={x:0,y:0,w:v.data.width+2,h:v.data.height+2};h.push(x),l[p]=new Vu(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;const[p,v]=i.tl;h.update(l.data,void 0,{x:p,y:v})}}je("ImagePosition",Vu),je("ImageAtlas",$u),y.WritingMode=void 0,(ws=y.WritingMode||(y.WritingMode={}))[ws.none=0]="none",ws[ws.horizontal=1]="horizontal",ws[ws.vertical=2]="vertical",ws[ws.horizontalOnly=3]="horizontalOnly";const ju=-17;class jc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const h=new jc;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new jc;return l.imageName=i,l}}class Fl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const h=new Fl;for(let p=0;p<i.sections.length;p++){const v=i.sections[p];v.image?h.addImageSection(v):h.addTextSection(v,l)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let h=0;h<i.length;h++){const p=i.charCodeAt(h+1)||null,v=i.charCodeAt(h-1)||null;l+=p&&Pa(p)&&!Uc[i[h+1]]||v&&Pa(v)&&!Uc[i[h-1]]||!Uc[i[h]]?i[h]:Uc[i[h]]}return l}(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&Hu[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&Hu[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new Fl;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(jc.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(h)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void Vn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(jc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Vn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hc(a,i,l,h,p,v,x,D,S,A,k,F,N,U,V,Q){const ee=Fl.fromFeature(a,p);let ae;F===y.WritingMode.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:de}=ji;if(fe&&1===ee.sections.length){ae=[];const De=fe(ee.toString(),Ha(ee,A,v,i,h,U,V));for(const Ge of De){const nt=new Fl;nt.text=Ge,nt.sections=ee.sections;for(let Ue=0;Ue<Ge.length;Ue++)nt.sectionIndex.push(0);ae.push(nt)}}else if(de){ae=[];const De=de(ee.text,ee.sectionIndex,Ha(ee,A,v,i,h,U,V));for(const Ge of De){const nt=new Fl;nt.text=Ge[0],nt.sectionIndex=Ge[1],nt.sections=ee.sections,ae.push(nt)}}else ae=function(De,Ge){const nt=[],Ue=De.text;let Ve=0;for(const ke of Ge)nt.push(De.substring(Ve,ke)),Ve=ke;return Ve<Ue.length&&nt.push(De.substring(Ve,Ue.length)),nt}(ee,Ha(ee,A,v,i,h,U,V));const me=[],Ie={positionedLines:me,text:ee.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(De,Ge,nt,Ue,Ve,ke,He,Oe,Pe,ct,rt,Gt){let sn=0,Pn=ju,Rn=0,Ar=0;const Un="right"===Oe?1:"left"===Oe?0:.5;let rr=0;for(const or of Ve){or.trim();const Pr=or.getMaxScale(),Nr=(Pr-1)*nr,li={positionedGlyphs:[],lineOffset:0};De.positionedLines[rr]=li;const _i=li.positionedGlyphs;let vi=0;if(!or.length()){Pn+=ke,++rr;continue}for(let hr=0;hr<or.length();hr++){const Ut=or.getSection(hr),Wi=or.getSectionIndex(hr),sr=or.getCharCode(hr);let vr=0,Zi=null,ao=null,lo=null,ua=nr;const co=!(Pe===y.WritingMode.horizontal||!rt&&!qo(sr)||rt&&(Hu[sr]||(ir=sr,Me.Arabic(ir)||Me["Arabic Supplement"](ir)||Me["Arabic Extended-A"](ir)||Me["Arabic Presentation Forms-A"](ir)||Me["Arabic Presentation Forms-B"](ir))));if(Ut.imageName){const zi=Ue[Ut.imageName];if(!zi)continue;lo=Ut.imageName,De.iconsInText=De.iconsInText||!0,ao=zi.paddedRect;const ci=zi.displaySize;Ut.scale=Ut.scale*nr/Gt,Zi={width:ci[0],height:ci[1],left:1,top:-3,advance:co?ci[1]:ci[0]},vr=Nr+(nr-ci[1]*Ut.scale),ua=Zi.advance;const Ao=co?ci[0]*Ut.scale-nr*Pr:ci[1]*Ut.scale-nr*Pr;Ao>0&&Ao>vi&&(vi=Ao)}else{const zi=nt[Ut.fontStack],ci=zi&&zi[sr];if(ci&&ci.rect)ao=ci.rect,Zi=ci.metrics;else{const Ao=Ge[Ut.fontStack],lh=Ao&&Ao[sr];if(!lh)continue;Zi=lh.metrics}vr=(Pr-Ut.scale)*nr}co?(De.verticalizable=!0,_i.push({glyph:sr,imageName:lo,x:sn,y:Pn+vr,vertical:co,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Wi,metrics:Zi,rect:ao}),sn+=ua*Ut.scale+ct):(_i.push({glyph:sr,imageName:lo,x:sn,y:Pn+vr,vertical:co,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Wi,metrics:Zi,rect:ao}),sn+=Zi.advance*Ut.scale+ct)}0!==_i.length&&(Rn=Math.max(sn-ct,Rn),ap(_i,0,_i.length-1,Un,vi)),sn=0;const Fn=ke*Pr+vi;li.lineOffset=Math.max(vi,Nr),Pn+=Fn,Ar=Math.max(Fn,Ar),++rr}var ir;const zr=Pn-ju,{horizontalAlign:Qt,verticalAlign:yi}=Wu(He);(function(or,Pr,Nr,li,_i,vi,Fn,hr,Ut){const Wi=(Pr-Nr)*_i;let sr=0;sr=vi!==Fn?-hr*li-ju:(-li*Ut+.5)*Fn;for(const vr of or)for(const Zi of vr.positionedGlyphs)Zi.x+=Wi,Zi.y+=sr})(De.positionedLines,Un,Qt,yi,Rn,Ar,ke,zr,Ve.length),De.top+=-yi*zr,De.bottom=De.top+zr,De.left+=-Qt*Rn,De.right=De.left+Rn}(Ie,i,l,h,ae,x,D,S,F,A,N,Q),!function(De){for(const Ge of De)if(0!==Ge.positionedGlyphs.length)return!1;return!0}(me)&&Ie}const Hu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gi(a,i,l,h,p,v){if(i.imageName){const x=h[i.imageName];return x?x.displaySize[0]*i.scale*nr/v+p:0}{const x=l[i.fontStack],D=x&&x[a];return D?D.metrics.advance*i.scale+p:0}}function Gu(a,i,l,h){const p=Math.pow(a-i,2);return h?a<i?p/2:2*p:p+Math.abs(l)*l}function sp(a,i,l){let h=0;return 10===a&&(h-=1e4),l&&(h+=150),40!==a&&65288!==a||(h+=50),41!==i&&65289!==i||(h+=50),h}function qu(a,i,l,h,p,v){let x=null,D=Gu(i,l,p,v);for(const S of h){const A=Gu(i-S.x,l,p,v)+S.badness;A<=D&&(x=S,D=A)}return{index:a,x:i,priorBreak:x,badness:D}}function Wr(a){return a?Wr(a.priorBreak).concat(a.index):[]}function Ha(a,i,l,h,p,v,x){if("point"!==v)return[];if(!a)return[];const D=[],S=function(N,U,V,Q,ee,ae){let fe=0;for(let de=0;de<N.length();de++){const me=N.getSection(de);fe+=gi(N.getCharCode(de),me,Q,ee,U,ae)}return fe/Math.max(1,Math.ceil(fe/V))}(a,i,l,h,p,x),A=a.text.indexOf("\u200b")>=0;let k=0;for(let N=0;N<a.length();N++){const U=a.getSection(N),V=a.getCharCode(N);if(Hu[V]||(k+=gi(V,U,h,p,i,x)),N<a.length()-1){const Q=!((F=V)<11904||!(Me["Bopomofo Extended"](F)||Me.Bopomofo(F)||Me["CJK Compatibility Forms"](F)||Me["CJK Compatibility Ideographs"](F)||Me["CJK Compatibility"](F)||Me["CJK Radicals Supplement"](F)||Me["CJK Strokes"](F)||Me["CJK Symbols and Punctuation"](F)||Me["CJK Unified Ideographs Extension A"](F)||Me["CJK Unified Ideographs"](F)||Me["Enclosed CJK Letters and Months"](F)||Me["Halfwidth and Fullwidth Forms"](F)||Me.Hiragana(F)||Me["Ideographic Description Characters"](F)||Me["Kangxi Radicals"](F)||Me["Katakana Phonetic Extensions"](F)||Me.Katakana(F)||Me["Vertical Forms"](F)||Me["Yi Radicals"](F)||Me["Yi Syllables"](F)));(mg[V]||Q||U.imageName)&&D.push(qu(N+1,k,S,D,sp(V,a.getCharCode(N+1),Q&&A),!1))}}var F;return Wr(qu(a.length(),k,S,D,0,!0))}function Wu(a){let i=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function ap(a,i,l,h,p){if(!h&&!p)return;const v=a[l],x=(a[l].x+v.metrics.advance*v.scale)*h;for(let D=i;D<=l;D++)a[D].x-=x,a[D].y+=p}function gg(a,i,l){const{horizontalAlign:h,verticalAlign:p}=Wu(l),v=i[0]-a.displaySize[0]*h,x=i[1]-a.displaySize[1]*p;return{image:a,top:x,bottom:x+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function yd(a,i,l,h,p,v){const x=a.image;let D;if(x.content){const ee=x.content,ae=x.pixelRatio||1;D=[ee[0]/ae,ee[1]/ae,x.displaySize[0]-ee[2]/ae,x.displaySize[1]-ee[3]/ae]}const S=i.left*v,A=i.right*v;let k,F,N,U;"width"===l||"both"===l?(U=p[0]+S-h[3],F=p[0]+A+h[1]):(U=p[0]+(S+A-x.displaySize[0])/2,F=U+x.displaySize[0]);const V=i.top*v,Q=i.bottom*v;return"height"===l||"both"===l?(k=p[1]+V-h[0],N=p[1]+Q+h[2]):(k=p[1]+(V+Q-x.displaySize[1])/2,N=k+x.displaySize[1]),{image:x,top:k,right:F,bottom:N,left:U,collisionPadding:D}}const Ds=128;function _d(a,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new kn(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let v=0;for(;v<h.length&&h[v]<=a;)v++;v=Math.max(0,v-1);let x=v;for(;x<h.length&&h[x]<a+1;)x++;x=Math.min(h.length-1,x);const D=h[v],S=h[x];return"composite"===l.kind?{kind:"composite",minZoom:D,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:D,maxZoom:S,minSize:l.evaluate(new kn(D)),maxSize:l.evaluate(new kn(S)),interpolationType:p}}}class ca extends tt{constructor(i,l,h,p){super(i,l),this.angle=h,void 0!==p&&(this.segment=p)}clone(){return new ca(this.x,this.y,this.angle,this.segment)}}function vd(a,i,l,h,p){if(void 0===i.segment)return!0;let v=i,x=i.segment+1,D=0;for(;D>-l/2;){if(x--,x<0)return!1;D-=a[x].dist(v),v=a[x]}D+=a[x].dist(a[x+1]),x++;const S=[];let A=0;for(;D<l/2;){const k=a[x],F=a[x+1];if(!F)return!1;let N=a[x-1].angleTo(k)-k.angleTo(F);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:D,angleDelta:N}),A+=N;D-S[0].distance>h;)A-=S.shift().angleDelta;if(A>p)return!1;x++,D+=k.dist(F)}return!0}function lp(a){let i=0;for(let l=0;l<a.length-1;l++)i+=a[l].dist(a[l+1]);return i}function cp(a,i,l){return a?.6*i*l:0}function Zu(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function xd(a,i,l,h,p,v){const x=cp(l,p,v),D=Zu(l,h)*v;let S=0;const A=lp(a)/2;for(let k=0;k<a.length-1;k++){const F=a[k],N=a[k+1],U=F.dist(N);if(S+U>A){const V=(A-S)/U,Q=Nn(F.x,N.x,V),ee=Nn(F.y,N.y,V),ae=new ca(Q,ee,N.angleTo(F),k);return ae._round(),!x||vd(a,ae,D,x,i)?ae:void 0}S+=U}}function yg(a,i,l,h,p,v,x,D,S){const A=cp(h,v,x),k=Zu(h,p),F=k*x,N=0===a[0].x||a[0].x===S||0===a[0].y||a[0].y===S;return i-F<i/4&&(i=F+i/4),Ol(a,N?i/2*D%i:(k/2+2*v)*x*D%i,i,A,l,F,N,!1,S)}function Ol(a,i,l,h,p,v,x,D,S){const A=v/2,k=lp(a);let F=0,N=i-l,U=[];for(let V=0;V<a.length-1;V++){const Q=a[V],ee=a[V+1],ae=Q.dist(ee),fe=ee.angleTo(Q);for(;N+l<F+ae;){N+=l;const de=(N-F)/ae,me=Nn(Q.x,ee.x,de),Ie=Nn(Q.y,ee.y,de);if(me>=0&&me<S&&Ie>=0&&Ie<S&&N-A>=0&&N+A<=k){const De=new ca(me,Ie,fe,V);De._round(),h&&!vd(a,De,v,h,p)||U.push(De)}}F+=ae}return D||U.length||x||(U=Ol(a,F/2,l,h,p,v,x,!0,S)),U}function up(a,i,l,h,p){const v=[];for(let x=0;x<a.length;x++){const D=a[x];let S;for(let A=0;A<D.length-1;A++){let k=D[A],F=D[A+1];k.x<i&&F.x<i||(k.x<i?k=new tt(i,k.y+(i-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x<i&&(F=new tt(i,k.y+(i-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y<l&&F.y<l||(k.y<l?k=new tt(k.x+(l-k.y)/(F.y-k.y)*(F.x-k.x),l)._round():F.y<l&&(F=new tt(k.x+(l-k.y)/(F.y-k.y)*(F.x-k.x),l)._round()),k.x>=h&&F.x>=h||(k.x>=h?k=new tt(h,k.y+(h-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x>=h&&(F=new tt(h,k.y+(h-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y>=p&&F.y>=p||(k.y>=p?k=new tt(k.x+(p-k.y)/(F.y-k.y)*(F.x-k.x),p)._round():F.y>=p&&(F=new tt(k.x+(p-k.y)/(F.y-k.y)*(F.x-k.x),p)._round()),S&&k.equals(S[S.length-1])||(S=[k],v.push(S)),S.push(F)))))}}return v}function hp(a,i,l,h){const p=[],v=a.image,x=v.pixelRatio,D=v.paddedRect.w-2,S=v.paddedRect.h-2,A=a.right-a.left,k=a.bottom-a.top,F=v.stretchX||[[0,D]],N=v.stretchY||[[0,S]],U=(ke,He)=>ke+He[1]-He[0],V=F.reduce(U,0),Q=N.reduce(U,0),ee=D-V,ae=S-Q;let fe=0,de=V,me=0,Ie=Q,De=0,Ge=ee,nt=0,Ue=ae;if(v.content&&h){const ke=v.content;fe=zl(F,0,ke[0]),me=zl(N,0,ke[1]),de=zl(F,ke[0],ke[2]),Ie=zl(N,ke[1],ke[3]),De=ke[0]-fe,nt=ke[1]-me,Ge=ke[2]-ke[0]-de,Ue=ke[3]-ke[1]-Ie}const Ve=(ke,He,Oe,Pe)=>{const ct=Gc(ke.stretch-fe,de,A,a.left),rt=Es(ke.fixed-De,Ge,ke.stretch,V),Gt=Gc(He.stretch-me,Ie,k,a.top),sn=Es(He.fixed-nt,Ue,He.stretch,Q),Pn=Gc(Oe.stretch-fe,de,A,a.left),Rn=Es(Oe.fixed-De,Ge,Oe.stretch,V),Ar=Gc(Pe.stretch-me,Ie,k,a.top),Un=Es(Pe.fixed-nt,Ue,Pe.stretch,Q),rr=new tt(ct,Gt),ir=new tt(Pn,Gt),zr=new tt(Pn,Ar),Qt=new tt(ct,Ar),yi=new tt(rt/x,sn/x),or=new tt(Rn/x,Un/x),Pr=i*Math.PI/180;if(Pr){const _i=Math.sin(Pr),vi=Math.cos(Pr),Fn=[vi,-_i,_i,vi];rr._matMult(Fn),ir._matMult(Fn),Qt._matMult(Fn),zr._matMult(Fn)}const Nr=ke.stretch+ke.fixed,li=He.stretch+He.fixed;return{tl:rr,tr:ir,bl:Qt,br:zr,tex:{x:v.paddedRect.x+1+Nr,y:v.paddedRect.y+1+li,w:Oe.stretch+Oe.fixed-Nr,h:Pe.stretch+Pe.fixed-li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:or,minFontScaleX:Ge/x/A,minFontScaleY:Ue/x/k,isSDF:l}};if(h&&(v.stretchX||v.stretchY)){const ke=Xu(F,ee,V),He=Xu(N,ae,Q);for(let Oe=0;Oe<ke.length-1;Oe++){const Pe=ke[Oe],ct=ke[Oe+1];for(let rt=0;rt<He.length-1;rt++)p.push(Ve(Pe,He[rt],ct,He[rt+1]))}}else p.push(Ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:S+1}));return p}function zl(a,i,l){let h=0;for(const p of a)h+=Math.max(i,Math.min(l,p[1]))-Math.max(i,Math.min(l,p[0]));return h}function Xu(a,i,l){const h=[{fixed:-1,stretch:0}];for(const[p,v]of a){const x=h[h.length-1];h.push({fixed:p-x.stretch,stretch:x.stretch}),h.push({fixed:p-x.stretch,stretch:x.stretch+(v-p)})}return h.push({fixed:i+1,stretch:l}),h}function Gc(a,i,l,h){return a/i*l+h}function Es(a,i,l,h){return a-i*l/h}je("Anchor",ca);class Nl{constructor(i,l,h,p,v,x,D,S,A,k){if(this.boxStartIndex=i.length,A){let F=x.top,N=x.bottom;const U=x.collisionPadding;U&&(F-=U[1],N+=U[3]);let V=N-F;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let F=x.top*D-S,N=x.bottom*D+S,U=x.left*D-S,V=x.right*D+S;const Q=x.collisionPadding;if(Q&&(U-=Q[0]*D,F-=Q[1]*D,V+=Q[2]*D,N+=Q[3]*D),k){const ee=new tt(U,F),ae=new tt(V,F),fe=new tt(U,N),de=new tt(V,N),me=k*Math.PI/180;ee._rotate(me),ae._rotate(me),fe._rotate(me),de._rotate(me),U=Math.min(ee.x,ae.x,fe.x,de.x),V=Math.max(ee.x,ae.x,fe.x,de.x),F=Math.min(ee.y,ae.y,fe.y,de.y),N=Math.max(ee.y,ae.y,fe.y,de.y)}i.emplaceBack(l.x,l.y,U,F,V,N,h,p,v)}this.boxEndIndex=i.length}}class dp{constructor(i=[],l=_g){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,p=l[i];for(;i>0;){const v=i-1>>1,x=l[v];if(h(p,x)>=0)break;l[i]=x,i=v}l[i]=p}_down(i){const{data:l,compare:h}=this,p=this.length>>1,v=l[i];for(;i<p;){let x=1+(i<<1),D=l[x];const S=x+1;if(S<this.length&&h(l[S],D)<0&&(x=S,D=l[S]),h(D,v)>=0)break;l[i]=D,i=x}l[i]=v}}function _g(a,i){return a<i?-1:a>i?1:0}function bd(a,i=1,l=!1){let h=1/0,p=1/0,v=-1/0,x=-1/0;const D=a[0];for(let U=0;U<D.length;U++){const V=D[U];(!U||V.x<h)&&(h=V.x),(!U||V.y<p)&&(p=V.y),(!U||V.x>v)&&(v=V.x),(!U||V.y>x)&&(x=V.y)}const S=Math.min(v-h,x-p);let A=S/2;const k=new dp([],vg);if(0===S)return new tt(h,p);for(let U=h;U<v;U+=S)for(let V=p;V<x;V+=S)k.push(new Bl(U+A,V+A,A,a));let F=function(U){let V=0,Q=0,ee=0;const ae=U[0];for(let fe=0,de=ae.length,me=de-1;fe<de;me=fe++){const Ie=ae[fe],De=ae[me],Ge=Ie.x*De.y-De.x*Ie.y;Q+=(Ie.x+De.x)*Ge,ee+=(Ie.y+De.y)*Ge,V+=3*Ge}return new Bl(Q/V,ee/V,0,U)}(a),N=k.length;for(;k.length;){const U=k.pop();(U.d>F.d||!F.d)&&(F=U,l&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-F.d<=i||(A=U.h/2,k.push(new Bl(U.p.x-A,U.p.y-A,A,a)),k.push(new Bl(U.p.x+A,U.p.y-A,A,a)),k.push(new Bl(U.p.x-A,U.p.y+A,A,a)),k.push(new Bl(U.p.x+A,U.p.y+A,A,a)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${F.d}`)),F.p}function vg(a,i){return i.max-a.max}function Bl(a,i,l,h){this.p=new tt(a,i),this.h=l,this.d=function(p,v){let x=!1,D=1/0;for(let S=0;S<v.length;S++){const A=v[S];for(let k=0,F=A.length,N=F-1;k<F;N=k++){const U=A[k],V=A[N];U.y>p.y!=V.y>p.y&&p.x<(V.x-U.x)*(p.y-U.y)/(V.y-U.y)+U.x&&(x=!x),D=Math.min(D,Wm(p,U,V))}}return(x?1:-1)*Math.sqrt(D)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const wd=Number.POSITIVE_INFINITY;function fp(a,i){return i[1]!==wd?function(l,h,p){let v=0,x=0;switch(h=Math.abs(h),p=Math.abs(p),l){case"top-right":case"top-left":case"top":x=p-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-p}switch(l){case"top-right":case"bottom-right":case"right":v=-h;break;case"top-left":case"bottom-left":case"left":v=h}return[v,x]}(a,i[0],i[1]):function(l,h){let p=0,v=0;h<0&&(h=0);const x=h/Math.sqrt(2);switch(l){case"top-right":case"top-left":v=x-7;break;case"bottom-right":case"bottom-left":v=7-x;break;case"bottom":v=7-h;break;case"top":v=h-7}switch(l){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=h;break;case"right":p=-h}return[p,v]}(a,i[0])}function Dd(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xg(a,i,l,h,p,v,x,D,S,A,k){let F=v.textMaxSize.evaluate(i,{});void 0===F&&(F=x);const N=a.layers[0].layout,U=N.get("icon-offset").evaluate(i,{},k),V=Ed(l.horizontal),Q=x/24,ee=a.tilePixelRatio*Q,ae=a.tilePixelRatio*F/24,fe=a.tilePixelRatio*D,de=a.tilePixelRatio*N.get("symbol-spacing"),me=N.get("text-padding")*a.tilePixelRatio,Ie=N.get("icon-padding")*a.tilePixelRatio,De=N.get("text-max-angle")/180*Math.PI,Ge="viewport"!==N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),nt="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Ue=N.get("symbol-placement"),Ve=de/2,ke=N.get("icon-text-fit");let He;h&&"none"!==ke&&(a.allowVerticalPlacement&&l.vertical&&(He=yd(h,l.vertical,ke,N.get("icon-text-fit-padding"),U,Q)),V&&(h=yd(h,V,ke,N.get("icon-text-fit-padding"),U,Q)));const Oe=(Pe,ct)=>{ct.x<0||ct.x>=jn||ct.y<0||ct.y>=jn||function(rt,Gt,sn,Pn,Rn,Ar,Un,rr,ir,zr,Qt,yi,or,Pr,Nr,li,_i,vi,Fn,hr,Ut,Wi,sr,vr,Zi){const ao=rt.addToLineVertexArray(Gt,sn);let lo,ua,co,zi,ci=0,Ao=0,lh=0,ch=0,Pd=-1,Xc=-1;const Ko={};let Rd=Fa(""),Is=0,kd=0;if(void 0===rr._unevaluatedLayout.getValue("text-radial-offset")?[Is,kd]=rr.layout.get("text-offset").evaluate(Ut,{},vr).map(xi=>xi*nr):(Is=rr.layout.get("text-radial-offset").evaluate(Ut,{},vr)*nr,kd=wd),rt.allowVerticalPlacement&&Pn.vertical){const xi=rr.layout.get("text-rotate").evaluate(Ut,{},vr)+90;co=new Nl(ir,Gt,zr,Qt,yi,Pn.vertical,or,Pr,Nr,xi),Un&&(zi=new Nl(ir,Gt,zr,Qt,yi,Un,_i,vi,Nr,xi))}if(Rn){const xi=rr.layout.get("icon-rotate").evaluate(Ut,{}),Yo="none"!==rr.layout.get("icon-text-fit"),Yc=hp(Rn,xi,sr,Yo),Wa=Un?hp(Un,xi,sr,Yo):void 0;ua=new Nl(ir,Gt,zr,Qt,yi,Rn,_i,vi,!1,xi),ci=4*Yc.length;const Sp=rt.iconSizeData;let ha=null;"source"===Sp.kind?(ha=[Ds*rr.layout.get("icon-size").evaluate(Ut,{})],ha[0]>Cs&&Vn(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Sp.kind&&(ha=[Ds*Wi.compositeIconSizes[0].evaluate(Ut,{},vr),Ds*Wi.compositeIconSizes[1].evaluate(Ut,{},vr)],(ha[0]>Cs||ha[1]>Cs)&&Vn(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,Yc,ha,hr,Fn,Ut,y.WritingMode.none,Gt,ao.lineStartIndex,ao.lineLength,-1,vr),Pd=rt.icon.placedSymbolArray.length-1,Wa&&(Ao=4*Wa.length,rt.addSymbols(rt.icon,Wa,ha,hr,Fn,Ut,y.WritingMode.vertical,Gt,ao.lineStartIndex,ao.lineLength,-1,vr),Xc=rt.icon.placedSymbolArray.length-1)}const uh=Object.keys(Pn.horizontal);for(const xi of uh){const Yo=Pn.horizontal[xi];if(!lo){Rd=Fa(Yo.text);const Wa=rr.layout.get("text-rotate").evaluate(Ut,{},vr);lo=new Nl(ir,Gt,zr,Qt,yi,Yo,or,Pr,Nr,Wa)}const Yc=1===Yo.positionedLines.length;if(lh+=Ku(rt,Gt,Yo,Ar,rr,Nr,Ut,li,ao,Pn.vertical?y.WritingMode.horizontal:y.WritingMode.horizontalOnly,Yc?uh:[xi],Ko,Pd,Wi,vr),Yc)break}Pn.vertical&&(ch+=Ku(rt,Gt,Pn.vertical,Ar,rr,Nr,Ut,li,ao,y.WritingMode.vertical,["vertical"],Ko,Xc,Wi,vr));const hh=lo?lo.boxStartIndex:rt.collisionBoxArray.length,Eg=lo?lo.boxEndIndex:rt.collisionBoxArray.length,Ld=co?co.boxStartIndex:rt.collisionBoxArray.length,dh=co?co.boxEndIndex:rt.collisionBoxArray.length,Ts=ua?ua.boxStartIndex:rt.collisionBoxArray.length,Cp=ua?ua.boxEndIndex:rt.collisionBoxArray.length,Fd=zi?zi.boxStartIndex:rt.collisionBoxArray.length,Cg=zi?zi.boxEndIndex:rt.collisionBoxArray.length;let Po=-1;const Kc=(xi,Yo)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,Yo):Yo;Po=Kc(lo,Po),Po=Kc(co,Po),Po=Kc(ua,Po),Po=Kc(zi,Po);const qa=Po>-1?1:0;qa&&(Po*=Zi/nr),rt.glyphOffsetArray.length>=Ul.MAX_GLYPHS&&Vn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ut.sortKey&&rt.addToSortKeyRanges(rt.symbolInstances.length,Ut.sortKey),rt.symbolInstances.emplaceBack(Gt.x,Gt.y,Ko.right>=0?Ko.right:-1,Ko.center>=0?Ko.center:-1,Ko.left>=0?Ko.left:-1,Ko.vertical||-1,Pd,Xc,Rd,hh,Eg,Ld,dh,Ts,Cp,Fd,Cg,zr,lh,ch,ci,Ao,qa,0,or,Is,kd,Po)}(a,ct,Pe,l,h,p,He,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,ee,me,Ge,S,fe,Ie,nt,U,i,v,A,k,x)};if("line"===Ue)for(const Pe of up(i.geometry,0,0,jn,jn)){const ct=yg(Pe,de,De,l.vertical||V,h,24,ae,a.overscaling,jn);for(const rt of ct)V&&Cd(a,V.text,Ve,rt)||Oe(Pe,rt)}else if("line-center"===Ue){for(const Pe of i.geometry)if(Pe.length>1){const ct=xd(Pe,De,l.vertical||V,h,24,ae);ct&&Oe(Pe,ct)}}else if("Polygon"===i.type)for(const Pe of qf(i.geometry,0)){const ct=bd(Pe,16);Oe(Pe[0],new ca(ct.x,ct.y,0))}else if("LineString"===i.type)for(const Pe of i.geometry)Oe(Pe,new ca(Pe[0].x,Pe[0].y,0));else if("Point"===i.type)for(const Pe of i.geometry)for(const ct of Pe)Oe([ct],new ca(ct.x,ct.y,0))}const Cs=32640;function Ku(a,i,l,h,p,v,x,D,S,A,k,F,N,U,V){const Q=function(fe,de,me,Ie,De,Ge,nt,Ue){const Ve=Ie.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,ke=[];for(const He of de.positionedLines)for(const Oe of He.positionedGlyphs){if(!Oe.rect)continue;const Pe=Oe.rect||{};let ct=4,rt=!0,Gt=1,sn=0;const Pn=(De||Ue)&&Oe.vertical,Rn=Oe.metrics.advance*Oe.scale/2;if(Ue&&de.verticalizable&&(sn=He.lineOffset/2-(Oe.imageName?-(nr-Oe.metrics.width*Oe.scale)/2:(Oe.scale-1)*nr)),Oe.imageName){const Fn=nt[Oe.imageName];rt=Fn.sdf,Gt=Fn.pixelRatio,ct=1/Gt}const Ar=De?[Oe.x+Rn,Oe.y]:[0,0];let Un=De?[0,0]:[Oe.x+Rn+me[0],Oe.y+me[1]-sn],rr=[0,0];Pn&&(rr=Un,Un=[0,0]);const ir=(Oe.metrics.left-ct)*Oe.scale-Rn+Un[0],zr=(-Oe.metrics.top-ct)*Oe.scale+Un[1],Qt=ir+Pe.w*Oe.scale/Gt,yi=zr+Pe.h*Oe.scale/Gt,or=new tt(ir,zr),Pr=new tt(Qt,zr),Nr=new tt(ir,yi),li=new tt(Qt,yi);if(Pn){const Fn=new tt(-Rn,Rn-ju),hr=-Math.PI/2,Ut=12-Rn,Wi=new tt(22-Ut,-(Oe.imageName?Ut:0)),sr=new tt(...rr);or._rotateAround(hr,Fn)._add(Wi)._add(sr),Pr._rotateAround(hr,Fn)._add(Wi)._add(sr),Nr._rotateAround(hr,Fn)._add(Wi)._add(sr),li._rotateAround(hr,Fn)._add(Wi)._add(sr)}if(Ve){const Fn=Math.sin(Ve),hr=Math.cos(Ve),Ut=[hr,-Fn,Fn,hr];or._matMult(Ut),Pr._matMult(Ut),Nr._matMult(Ut),li._matMult(Ut)}const _i=new tt(0,0),vi=new tt(0,0);ke.push({tl:or,tr:Pr,bl:Nr,br:li,tex:Pe,writingMode:de.writingMode,glyphOffset:Ar,sectionIndex:Oe.sectionIndex,isSDF:rt,pixelOffsetTL:_i,pixelOffsetBR:vi,minFontScaleX:0,minFontScaleY:0})}return ke}(0,l,D,p,v,x,h,a.allowVerticalPlacement),ee=a.textSizeData;let ae=null;"source"===ee.kind?(ae=[Ds*p.layout.get("text-size").evaluate(x,{})],ae[0]>Cs&&Vn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ee.kind&&(ae=[Ds*U.compositeTextSizes[0].evaluate(x,{},V),Ds*U.compositeTextSizes[1].evaluate(x,{},V)],(ae[0]>Cs||ae[1]>Cs)&&Vn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Q,ae,D,v,x,A,i,S.lineStartIndex,S.lineLength,N,V);for(const fe of k)F[fe]=a.text.placedSymbolArray.length-1;return 4*Q.length}function Ed(a){for(const i in a)return a[i];return null}function Cd(a,i,l,h){const p=a.compareText;if(i in p){const v=p[i];for(let x=v.length-1;x>=0;x--)if(h.dist(v[x])<l)return!0}else p[i]=[];return p[i].push(h),!1}const bg=To.VectorTileFeature.types,wg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qc(a,i,l,h,p,v,x,D,S,A,k,F,N){const U=D?Math.min(Cs,Math.round(D[0])):0,V=D?Math.min(Cs,Math.round(D[1])):0;a.emplaceBack(i,l,Math.round(32*h),Math.round(32*p),v,x,(U<<1)+(S?1:0),V,16*A,16*k,256*F,256*N)}function Yu(a,i,l){a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l)}function Ga(a){for(const i of a.sections)if(Tf(i.text))return!0;return!1}class Ju{constructor(i){this.layoutVertexArray=new cr,this.indexArray=new _n,this.programConfigurations=i,this.segments=new It,this.dynamicLayoutVertexArray=new Gr,this.opacityVertexArray=new ki,this.placedSymbolArray=new Ae}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Qf.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,wg,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}je("SymbolBuffers",Ju);class Qu{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new It,this.collisionVertexArray=new wo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,ag.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}je("CollisionBuffers",Qu);class Ul{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tl([]),this.placementViewportMatrix=Tl([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_d(this.zoom,l["text-size"]),this.iconSizeData=_d(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.canOverlap="never"!==eh(h,"text-overlap","text-allow-overlap")||"never"!==eh(h,"icon-overlap","icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==v&&!p.isConstant(),this.sortFeaturesByY=("viewport-y"===v||"auto"===v&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(x=>y.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new Ju(new za(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Ju(new za(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ze,this.lineVertexArray=new Ne,this.symbolInstances=new be}calculateGlyphDependencies(i,l,h,p,v){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(h||p)&&v){const D=Uc[i.charAt(x)];D&&(l[D.charCodeAt(0)]=!0)}}populate(i,l,h){const p=this.layers[0],v=p.layout,x=v.get("text-font"),D=v.get("text-field"),S=v.get("icon-image"),A=("constant"!==D.value.kind||D.value.value instanceof Z&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!A&&!k)return;const N=l.iconDependencies,U=l.glyphDependencies,V=l.availableImages,Q=new kn(this.zoom);for(const{feature:ee,id:ae,index:fe,sourceLayerIndex:de}of i){const me=p._featureFilter.needGeometry,Ie=ia(ee,me);if(!p._featureFilter.filter(Q,Ie,h))continue;let De,Ge;if(me||(Ie.geometry=_s(ee)),A){const Ue=p.getValueAndResolveTokens("text-field",Ie,h,V),Ve=Z.factory(Ue);Ga(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===xc()||this.hasRTLText&&ji.isParsed())&&(De=ug(Ve,p,Ie))}if(k){const Ue=p.getValueAndResolveTokens("icon-image",Ie,h,V);Ge=Ue instanceof ie?Ue:ie.fromString(Ue)}if(!De&&!Ge)continue;const nt=this.sortFeaturesByKey?F.evaluate(Ie,{},h):void 0;if(this.features.push({id:ae,text:De,icon:Ge,index:fe,sourceLayerIndex:de,geometry:Ie.geometry,properties:ee.properties,type:bg[ee.type],sortKey:nt}),Ge&&(N[Ge.name]=!0),De){const Ue=x.evaluate(Ie,{},h).join(","),Ve="viewport"!==v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.WritingMode.vertical)>=0;for(const ke of De.sections)if(ke.image)N[ke.image.name]=!0;else{const He=wu(De.toString()),Oe=ke.fontStack||Ue,Pe=U[Oe]=U[Oe]||{};this.calculateGlyphDependencies(ke.text,Pe,Ve,this.allowVerticalPlacement,He)}}}"line"===v.get("symbol-placement")&&(this.features=function(ee){const ae={},fe={},de=[];let me=0;function Ie(Ue){de.push(ee[Ue]),me++}function De(Ue,Ve,ke){const He=fe[Ue];return delete fe[Ue],fe[Ve]=He,de[He].geometry[0].pop(),de[He].geometry[0]=de[He].geometry[0].concat(ke[0]),He}function Ge(Ue,Ve,ke){const He=ae[Ve];return delete ae[Ve],ae[Ue]=He,de[He].geometry[0].shift(),de[He].geometry[0]=ke[0].concat(de[He].geometry[0]),He}function nt(Ue,Ve,ke){const He=ke?Ve[0][Ve[0].length-1]:Ve[0][0];return`${Ue}:${He.x}:${He.y}`}for(let Ue=0;Ue<ee.length;Ue++){const Ve=ee[Ue],ke=Ve.geometry,He=Ve.text?Ve.text.toString():null;if(!He){Ie(Ue);continue}const Oe=nt(He,ke),Pe=nt(He,ke,!0);if(Oe in fe&&Pe in ae&&fe[Oe]!==ae[Pe]){const ct=Ge(Oe,Pe,ke),rt=De(Oe,Pe,de[ct].geometry);delete ae[Oe],delete fe[Pe],fe[nt(He,de[rt].geometry,!0)]=rt,de[ct].geometry=null}else Oe in fe?De(Oe,Pe,ke):Pe in ae?Ge(Oe,Pe,ke):(Ie(Ue),ae[Oe]=me-1,fe[Pe]=me-1)}return de.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ae)=>ee.sortKey-ae.sortKey)}update(i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(void 0!==i.segment){let p=i.dist(l[i.segment+1]),v=i.dist(l[i.segment]);const x={};for(let D=i.segment+1;D<l.length;D++)x[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:p},D<l.length-1&&(p+=l[D+1].dist(l[D]));for(let D=i.segment||0;D>=0;D--)x[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:v},D>0&&(v+=l[D-1].dist(l[D]));for(let D=0;D<l.length;D++){const S=x[D];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,p,v,x,D,S,A,k,F,N){const U=i.indexArray,V=i.layoutVertexArray,Q=i.segments.prepareSegment(4*l.length,V,U,this.canOverlap?x.sortKey:void 0),ee=this.glyphOffsetArray.length,ae=Q.vertexLength,fe=this.allowVerticalPlacement&&D===y.WritingMode.vertical?Math.PI/2:0,de=x.text&&x.text.sections;for(let me=0;me<l.length;me++){const{tl:Ie,tr:De,bl:Ge,br:nt,tex:Ue,pixelOffsetTL:Ve,pixelOffsetBR:ke,minFontScaleX:He,minFontScaleY:Oe,glyphOffset:Pe,isSDF:ct,sectionIndex:rt}=l[me],Gt=Q.vertexLength,sn=Pe[1];qc(V,S.x,S.y,Ie.x,sn+Ie.y,Ue.x,Ue.y,h,ct,Ve.x,Ve.y,He,Oe),qc(V,S.x,S.y,De.x,sn+De.y,Ue.x+Ue.w,Ue.y,h,ct,ke.x,Ve.y,He,Oe),qc(V,S.x,S.y,Ge.x,sn+Ge.y,Ue.x,Ue.y+Ue.h,h,ct,Ve.x,ke.y,He,Oe),qc(V,S.x,S.y,nt.x,sn+nt.y,Ue.x+Ue.w,Ue.y+Ue.h,h,ct,ke.x,ke.y,He,Oe),Yu(i.dynamicLayoutVertexArray,S,fe),U.emplaceBack(Gt,Gt+1,Gt+2),U.emplaceBack(Gt+1,Gt+2,Gt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),me!==l.length-1&&rt===l[me+1].sectionIndex||i.programConfigurations.populatePaintArrays(V.length,x,x.index,{},N,de&&de[rt])}i.placedSymbolArray.emplaceBack(S.x,S.y,ee,this.glyphOffsetArray.length-ee,ae,A,k,S.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],D,0,!1,0,F)}_addCollisionDebugVertex(i,l,h,p,v,x){return l.emplaceBack(0,0),i.emplaceBack(h.x,h.y,p,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,h,p,v,x,D){const S=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),A=S.vertexLength,k=v.layoutVertexArray,F=v.collisionVertexArray,N=D.anchorX,U=D.anchorY;this._addCollisionDebugVertex(k,F,x,N,U,new tt(i,l)),this._addCollisionDebugVertex(k,F,x,N,U,new tt(h,l)),this._addCollisionDebugVertex(k,F,x,N,U,new tt(h,p)),this._addCollisionDebugVertex(k,F,x,N,U,new tt(i,p)),S.vertexLength+=4;const V=v.indexArray;V.emplaceBack(A,A+1),V.emplaceBack(A+1,A+2),V.emplaceBack(A+2,A+3),V.emplaceBack(A+3,A),S.primitiveLength+=4}addDebugCollisionBoxes(i,l,h,p){for(let v=i;v<l;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qu(Hi,lg.members,yr),this.iconCollisionBox=new Qu(Hi,lg.members,yr);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,h,p,v,x,D,S,A){const k={};for(let F=l;F<h;F++){const N=i.get(F);k.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.textFeatureIndex=N.featureIndex;break}for(let F=p;F<v;F++){const N=i.get(F);k.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.verticalTextFeatureIndex=N.featureIndex;break}for(let F=x;F<D;F++){const N=i.get(F);k.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.iconFeatureIndex=N.featureIndex;break}for(let F=S;F<A;F++){const N=i.get(F);k.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.verticalIconFeatureIndex=N.featureIndex;break}return k}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<p;v+=4)i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),p=[],v=[],x=[];for(let D=0;D<this.symbolInstances.length;++D){x.push(D);const S=this.symbolInstances.get(D);p.push(0|Math.round(l*S.anchorX+h*S.anchorY)),v.push(S.featureIndex)}return x.sort((D,S)=>p[D]-p[S]||v[S]-v[D]),x}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((p,v,x)=>{p>=0&&x.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}je("SymbolBucket",Ul,{omit:["layers","collisionBoxArray","features","compareText"]}),Ul.MAX_GLYPHS=65535,Ul.addDynamicAttributes=Yu;const _v=new gr({"symbol-placement":new et(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(xe.layout_symbol["icon-size"]),"icon-text-fit":new et(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(xe.layout_symbol["icon-image"]),"icon-rotate":new st(xe.layout_symbol["icon-rotate"]),"icon-padding":new et(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new st(xe.layout_symbol["icon-offset"]),"icon-anchor":new st(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(xe.layout_symbol["text-rotation-alignment"]),"text-field":new st(xe.layout_symbol["text-field"]),"text-font":new st(xe.layout_symbol["text-font"]),"text-size":new st(xe.layout_symbol["text-size"]),"text-max-width":new st(xe.layout_symbol["text-max-width"]),"text-line-height":new et(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new st(xe.layout_symbol["text-letter-spacing"]),"text-justify":new st(xe.layout_symbol["text-justify"]),"text-radial-offset":new st(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new st(xe.layout_symbol["text-anchor"]),"text-max-angle":new et(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(xe.layout_symbol["text-writing-mode"]),"text-rotate":new st(xe.layout_symbol["text-rotate"]),"text-padding":new et(xe.layout_symbol["text-padding"]),"text-keep-upright":new et(xe.layout_symbol["text-keep-upright"]),"text-transform":new st(xe.layout_symbol["text-transform"]),"text-offset":new st(xe.layout_symbol["text-offset"]),"text-allow-overlap":new et(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new et(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new et(xe.layout_symbol["text-ignore-placement"]),"text-optional":new et(xe.layout_symbol["text-optional"])});var Vl={paint:new gr({"icon-opacity":new st(xe.paint_symbol["icon-opacity"]),"icon-color":new st(xe.paint_symbol["icon-color"]),"icon-halo-color":new st(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(xe.paint_symbol["text-opacity"]),"text-color":new st(xe.paint_symbol["text-color"],{runtimeType:ti,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new st(xe.paint_symbol["text-halo-color"]),"text-halo-width":new st(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new st(xe.paint_symbol["text-halo-blur"]),"text-translate":new et(xe.paint_symbol["text-translate"]),"text-translate-anchor":new et(xe.paint_symbol["text-translate-anchor"])}),layout:_v};class pp{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Tn,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}je("FormatSectionOverride",pp,{omit:["defaultValue"]});class Wc extends ai{constructor(i){super(i,Vl)}recalculate(i,l){if(super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const v of h)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,p){const v=this.layout.get(i).evaluate(l,{},h,p),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||gl(x.value)||!v?v:(D=l.properties,v.replace(/{([^{}]+)}/g,(A,k)=>k in D?String(D[k]):""));var D}createBucket(i){return new Ul(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Vl.paint.overridableProperties){if(!Wc.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new pp(l),p=new gc(h,l.property.specification);let v=null;v="constant"===l.value.kind||"source"===l.value.kind?new ri("source",p):new yc("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new bo(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Wc.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),p=Vl.paint.properties[l];let v=!1;const x=D=>{for(const S of D)if(p.overrides&&p.overrides.hasOverride(S))return void(v=!0)};if("constant"===h.value.kind&&h.value.value instanceof Z)x(h.value.value.sections);else if("source"===h.value.kind){const D=A=>{v||(A instanceof Se&&re(A.value)===Ei?x(A.value.sections):A instanceof Xe?x(A.sections):A.eachChild(D))},S=h.value;S._styleExpression&&D(S._styleExpression.expression)}return v}}function eh(a,i,l){let h="never";const p=a.get(i);return p?h=p:a.get(l)&&(h="always"),h}var mp={paint:new gr({"background-color":new et(xe.paint_background["background-color"]),"background-pattern":new wl(xe.paint_background["background-pattern"]),"background-opacity":new et(xe.paint_background["background-opacity"])})},Sd={paint:new gr({"raster-opacity":new et(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(xe.paint_raster["raster-saturation"]),"raster-contrast":new et(xe.paint_raster["raster-contrast"]),"raster-resampling":new et(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(xe.paint_raster["raster-fade-duration"])})};class gp extends ai{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const th={circle:class extends ai{constructor(a){super(a,Au)}createBucket(a){return new oa(a)}queryRadius(a){const i=a;return Sl("circle-radius",this,i)+Sl("circle-stroke-width",this,i)+aa(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,l,h,p,v,x,D){const S=Tc(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,x),A=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l),k="map"===this.paint.get("circle-pitch-alignment"),F=k?S:(V=D,S.map(Q=>rd(Q,V))),N=k?A*x:A;var V;for(const U of h)for(const V of U){const Q=k?V:rd(V,D);let ee=N;const ae=Mc([],[V.x,V.y,0,1],D);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?ee*=ae[3]/v.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(ee*=v.cameraToCenterDistance/ae[3]),Hm(F,Q,ee))return!0}return!1}},heatmap:class extends ai{constructor(a){super(a,Zo),this._updateColorRamp()}createBucket(a){return new Ff(a)}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ru({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends ai{constructor(a){super(a,Xm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends ai{constructor(a){super(a,so)}recalculate(a,i){super.recalculate(a,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Na(a)}queryRadius(){return aa(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,l,h,p,v,x){return Gm(Tc(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,x),h)}isTileClipped(){return!0}},"fill-extrusion":class extends ai{constructor(a){super(a,Nu)}createBucket(a){return new cd(a)}queryRadius(){return aa(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,i,l,h,p,v,x,D){const S=Tc(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,x),A=this.paint.get("fill-extrusion-height").evaluate(i,l),k=this.paint.get("fill-extrusion-base").evaluate(i,l),F=function(U,V,Q,ee){const ae=[];for(const fe of U){const de=[fe.x,fe.y,0,1];Mc(de,de,V),ae.push(new tt(de[0]/de[3],de[1]/de[3]))}return ae}(S,D),N=function(U,V,Q,ee){const ae=[],fe=[],de=ee[8]*V,me=ee[9]*V,Ie=ee[10]*V,De=ee[11]*V,Ge=ee[8]*Q,nt=ee[9]*Q,Ue=ee[10]*Q,Ve=ee[11]*Q;for(const ke of U){const He=[],Oe=[];for(const Pe of ke){const ct=Pe.x,rt=Pe.y,Gt=ee[0]*ct+ee[4]*rt+ee[12],sn=ee[1]*ct+ee[5]*rt+ee[13],Pn=ee[2]*ct+ee[6]*rt+ee[14],Rn=ee[3]*ct+ee[7]*rt+ee[15],Ar=Pn+Ie,Un=Rn+De,rr=Gt+Ge,ir=sn+nt,zr=Pn+Ue,Qt=Rn+Ve,yi=new tt((Gt+de)/Un,(sn+me)/Un);yi.z=Ar/Un,He.push(yi);const or=new tt(rr/Qt,ir/Qt);or.z=zr/Qt,Oe.push(or)}ae.push(He),fe.push(Oe)}return[ae,fe]}(h,k,A,D);return function(U,V,Q){let ee=1/0;Gm(Q,V)&&(ee=kl(Q,V[0]));for(let ae=0;ae<V.length;ae++){const fe=V[ae],de=U[ae];for(let me=0;me<fe.length-1;me++){const Ie=fe[me],De=[Ie,fe[me+1],de[me+1],de[me],Ie];Cl(Q,De)&&(ee=Math.min(ee,kl(Q,De)))}}return ee!==1/0&&ee}(N[0],N[1],F)}},line:class extends ai{constructor(a){super(a,$a),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){"line-gradient"===a&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Da,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=Ll.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new dd(a)}queryRadius(a){const i=a,l=Jf(Sl("line-width",this,i),Sl("line-gap-width",this,i)),h=Sl("line-offset",this,i);return l/2+Math.abs(h)+aa(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,l,h,p,v,x){const D=Tc(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,x),S=x/2*Jf(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),A=this.paint.get("line-offset").evaluate(i,l);return A&&(h=function(k,F){const N=[];for(let U=0;U<k.length;U++){const V=k[U],Q=[];for(let ee=0;ee<V.length;ee++){const ae=V[ee-1],fe=V[ee],de=V[ee+1],me=0===ee?new tt(0,0):fe.sub(ae)._unit()._perp(),Ie=ee===V.length-1?new tt(0,0):de.sub(fe)._unit()._perp(),De=me._add(Ie)._unit(),Ge=De.x*Ie.x+De.y*Ie.y;0!==Ge&&De._mult(1/Ge),Q.push(De._mult(F)._add(fe))}N.push(Q)}return N}(h,A*x)),function(k,F,N){for(let U=0;U<F.length;U++){const V=F[U];if(k.length>=3)for(let Q=0;Q<V.length;Q++)if(sa(k,V[Q]))return!0;if(td(k,V,N))return!0}return!1}(D,h,S)}isTileClipped(){return!0}},symbol:Wc,background:class extends ai{constructor(a){super(a,mp)}},raster:class extends ai{constructor(a){super(a,Sd)}}};class nh{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Id=6371008.8;class Ln{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ln(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,p=i.lat*l,v=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((i.lng-this.lng)*l);return Id*Math.acos(Math.min(v,1))}toBounds(i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new Ss(new Ln(this.lng-h,this.lat-l),new Ln(this.lng+h,this.lat+l))}static convert(i){if(i instanceof Ln)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Ln(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Ln(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ss{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Ln?new Ln(i.lng,i.lat):Ln.convert(i),this}setSouthWest(i){return this._sw=i instanceof Ln?new Ln(i.lng,i.lat):Ln.convert(i),this}extend(i){const l=this._sw,h=this._ne;let p,v;if(i instanceof Ln)p=i,v=i;else{if(!(i instanceof Ss))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Ss.convert(i)):this.extend(Ln.convert(i)):this;if(p=i._sw,v=i._ne,!p||!v)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(v.lng,h.lng),h.lat=Math.max(v.lat,h.lat)):(this._sw=new Ln(p.lng,p.lat),this._ne=new Ln(v.lng,v.lat)),this}getCenter(){return new Ln((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ln(this.getWest(),this.getNorth())}getSouthEast(){return new Ln(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:h}=Ln.convert(i);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(i){return i instanceof Ss?i:i&&new Ss(i)}}const rh=2*Math.PI*Id;function $l(a){return rh*Math.cos(a*Math.PI/180)}function yp(a){return(180+a)/360}function Td(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function _p(a,i){return a/$l(i)}function Md(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class ih{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=Ln.convert(i);return new ih(yp(h.lng),Td(h.lat),_p(l,h.lat))}toLngLat(){return new Ln(360*this.x-180,Md(this.y))}toAltitude(){return this.z*$l(Md(this.y))}meterInMercatorCoordinateUnits(){return 1/rh*(i=Md(this.y),1/Math.cos(i*Math.PI/180));var i}}function Ad(a,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[a*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class oh{constructor(i,l,h){this.z=i,this.x=l,this.y=h,this.key=Xo(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,h){const p=(x=this.y,D=this.z,S=Ad(256*(v=this.x),256*(x=Math.pow(2,D)-x-1),D),A=Ad(256*(v+1),256*(x+1),D),S[0]+","+S[1]+","+A[0]+","+A[1]);var v,x,D,S,A;const k=function(F,N,U){let V,Q="";for(let ee=F;ee>0;ee--)V=1<<ee-1,Q+=(N&V?1:0)+(U&V?2:0);return Q}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,p)}getTilePoint(i){const l=Math.pow(2,this.z);return new tt((i.x*l-this.x)*jn,(i.y*l-this.y)*jn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zc{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Xo(i,l.z,l.z,l.x,l.y)}}class Oi{constructor(i,l,h,p,v){this.overscaledZ=i,this.wrap=l,this.canonical=new oh(h,+p,+v),this.key=Xo(l,i,h,p,v)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new Oi(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){const h=this.canonical.z-i;return i>this.canonical.z?Xo(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Xo(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new Oi(l,this.wrap,l,h,p),new Oi(l,this.wrap,l,h+1,p),new Oi(l,this.wrap,l,h,p+1),new Oi(l,this.wrap,l,h+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Oi(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ih(i.x-this.wrap,i.y))}}function Xo(a,i,l,h,p){(a*=2)<0&&(a=-1*a-1);const v=1<<l;return(v*v*a+v*p+h).toString(36)+l.toString(36)+i.toString(36)}je("CanonicalTileID",oh),je("OverscaledTileID",Oi,{omit:["posMatrix"]});class vp{constructor(i,l,h){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return void Vn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const p=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=h||"mapbox";for(let v=0;v<p;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(p,v)]=this.data[this._idx(p-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,p)]=this.data[this._idx(v,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]}get(i,l){const h=new Uint8Array(this.data.buffer),p=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[p],h[p+1],h[p+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,h){return(256*i*256+256*l+h)/10-1e4}_unpackTerrarium(i,l,h){return 256*i+l+h/256-32768}getPixels(){return new mi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,v=l*this.dim+this.dim,x=h*this.dim,D=h*this.dim+this.dim;switch(l){case-1:p=v-1;break;case 1:v=p+1}switch(h){case-1:x=D-1;break;case 1:D=x+1}const S=-l*this.dim,A=-h*this.dim;for(let k=x;k<D;k++)for(let F=p;F<v;F++)this.data[this._idx(F,k)]=i.data[this._idx(F+S,k+A)]}}je("DEMData",vp);class xp{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class Dg{constructor(i,l,h,p,v){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=h,i._y=p,this.properties=i.properties,this.id=v}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}class bp{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ri(jn,16,0),this.grid3D=new Ri(jn,16,0),this.featureIndexArray=new Ke,this.promoteId=l}insert(i,l,h,p,v,x){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,v);const S=x?this.grid3D:this.grid;for(let A=0;A<l.length;A++){const k=l[A],F=[1/0,1/0,-1/0,-1/0];for(let N=0;N<k.length;N++){const U=k[N];F[0]=Math.min(F[0],U.x),F[1]=Math.min(F[1],U.y),F[2]=Math.max(F[2],U.x),F[3]=Math.max(F[3],U.y)}F[0]<jn&&F[1]<jn&&F[2]>=0&&F[3]>=0&&S.insert(D,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new To.VectorTile(new Uu(this.rawTileData)).layers,this.sourceLayerCoder=new xp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,h,p){this.loadVTLayers();const v=i.params||{},x=jn/i.tileSize/i.scale,D=hs(v.filter),S=i.queryGeometry,A=i.queryPadding*x,k=wp(S),F=this.grid.query(k.minX-A,k.minY-A,k.maxX+A,k.maxY+A),N=wp(i.cameraQueryGeometry),U=this.grid3D.query(N.minX-A,N.minY-A,N.maxX+A,N.maxY+A,(ee,ae,fe,de)=>function(me,Ie,De,Ge,nt){for(const Ve of me)if(Ie<=Ve.x&&De<=Ve.y&&Ge>=Ve.x&&nt>=Ve.y)return!0;const Ue=[new tt(Ie,De),new tt(Ie,nt),new tt(Ge,nt),new tt(Ge,De)];if(me.length>2)for(const Ve of Ue)if(sa(me,Ve))return!0;for(let Ve=0;Ve<me.length-1;Ve++)if(kf(me[Ve],me[Ve+1],Ue))return!0;return!1}(i.cameraQueryGeometry,ee-A,ae-A,fe+A,de+A));for(const ee of U)F.push(ee);F.sort(Dp);const V={};let Q;for(let ee=0;ee<F.length;ee++){const ae=F[ee];if(ae===Q)continue;Q=ae;const fe=this.featureIndexArray.get(ae);let de=null;this.loadMatchingFeature(V,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,D,v.layers,v.availableImages,l,h,p,(me,Ie,De)=>(de||(de=_s(me)),Ie.queryIntersectsFeature(S,me,De,de,this.z,i.transform,x,i.pixelPosMatrix)))}return V}loadMatchingFeature(i,l,h,p,v,x,D,S,A,k,F){const N=this.bucketLayerIDs[l];if(x&&!function(ee,ae){for(let fe=0;fe<ee.length;fe++)if(ae.indexOf(ee[fe])>=0)return!0;return!1}(x,N))return;const U=this.sourceLayerCoder.decode(h),V=this.vtLayers[U].feature(p);if(v.needGeometry){const ee=ia(V,!0);if(!v.filter(new kn(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!v.filter(new kn(this.tileID.overscaledZ),V))return;const Q=this.getId(V,U);for(let ee=0;ee<N.length;ee++){const ae=N[ee];if(x&&x.indexOf(ae)<0)continue;const fe=S[ae];if(!fe)continue;let de={};Q&&k&&(de=k.getState(fe.sourceLayer||"_geojsonTileLayer",Q));const me=zt({},A[ae]);me.paint=sh(me.paint,fe.paint,V,de,D),me.layout=sh(me.layout,fe.layout,V,de,D);const Ie=!F||F(V,fe,de);if(!Ie)continue;const De=new Dg(V,this.z,this.x,this.y,Q);De.layer=me;let Ge=i[ae];void 0===Ge&&(Ge=i[ae]=[]),Ge.push({featureIndex:p,feature:De,intersectionZ:Ie})}}lookupSymbolFeatures(i,l,h,p,v,x,D,S){const A={};this.loadVTLayers();const k=hs(v);for(const F of i)this.loadMatchingFeature(A,h,p,F,k,x,D,S,l);return A}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;return this.promoteId&&(h=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof h&&(h=Number(h))),h}}function sh(a,i,l,h,p){return mn(a,(v,x)=>{const D=i instanceof Ec?i.get(x):null;return D&&D.evaluate?D.evaluate(l,h,p):D})}function wp(a){let i=1/0,l=1/0,h=-1/0,p=-1/0;for(const v of a)i=Math.min(i,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),p=Math.max(p,v.y);return{minX:i,minY:l,maxX:h,maxY:p}}function Dp(a,i){return i-a}var jl;je("FeatureIndex",bp,{omit:["rawTileData","sourceLayerCoder"]}),y.PerformanceMarkers=void 0,(jl=y.PerformanceMarkers||(y.PerformanceMarkers={})).create="create",jl.load="load",jl.fullLoad="fullLoad";let Hl=null,Gl=[];const ah=1e3/30,Ep={mark(a){performance.mark(a)},frame(a){const i=a;null!=Hl&&Gl.push(i-Hl),Hl=i},clearMetrics(){Hl=null,Gl=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in y.PerformanceMarkers)performance.clearMarks(y.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",y.PerformanceMarkers.create,y.PerformanceMarkers.load),performance.measure("fullLoadTime",y.PerformanceMarkers.create,y.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,i=performance.getEntriesByName("fullLoadTime")[0].duration,l=Gl.length,h=1/(Gl.reduce((v,x)=>v+x,0)/l/1e3),p=Gl.filter(v=>v>ah).reduce((v,x)=>v+(x-ah)/ah,0);return{loadTime:a,fullLoadTime:i,fps:h,percentDroppedFrames:p/(l+p)*100}}};y.AJAXError=Cr,y.ARRAY_TYPE=Il,y.Actor=class{constructor(a,i,l){this.target=a,this.parent=i,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},bn(["receive","process"],this),this.invoker=new nh(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=qt()?a:window}send(a,i,l,h,p=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[v]=l);const x=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:si(i,x)},x),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){const i=a.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){delete this.tasks[l];const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h()}else qt()||i.mustQueue?(this.tasks[l]=i,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,i)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),i=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),i&&this.processTask(a,i)}processTask(a,i){if("<response>"===i.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(i.error?l($i(i.error)):l(null,$i(i.data)))}else{let l=!1;const h=Yr(this.globalScope)?void 0:[],p=i.hasCallback?(D,S)=>{l=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:D?si(D):null,data:si(S,h)},h)}:D=>{l=!0};let v=null;const x=$i(i.data);if(this.parent[i.type])v=this.parent[i.type](i.sourceMapId,x,p);else if(this.parent.getWorkerSource){const D=i.type.split(".");v=this.parent.getWorkerSource(i.sourceMapId,D[0],x.source)[D[1]](x,p)}else p(new Error(`Could not find function ${i.type}`));!l&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},y.AlphaImage=Ml,y.CanonicalTileID=oh,y.CollisionBoxArray=ge,y.CollisionCircleLayoutArray=class extends R{},y.Color=L,y.DEMData=vp,y.DataConstantProperty=et,y.DictionaryCoder=xp,y.EXTENT=jn,y.ErrorEvent=$s,y.EvaluationParameters=kn,y.Event=vo,y.Evented=js,y.FeatureIndex=bp,y.FillBucket=Na,y.FillExtrusionBucket=cd,y.GeoJSONFeature=Dg,y.ImageAtlas=$u,y.ImagePosition=Vu,y.LineBucket=dd,y.LineStripIndexArray=class extends ce{},y.LngLat=Ln,y.LngLatBounds=Ss,y.MercatorCoordinate=ih,y.ONE_EM=nr,y.OverscaledTileID=Oi,y.PerformanceUtils=Ep,y.PosArray=class extends gs{},y.Properties=gr,y.QuadTriangleArray=class extends B{},y.RGBAImage=mi,y.RasterBoundsArray=class extends ka{},y.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return 0===a.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},y.ResourceType=Bs,y.SegmentVector=It,y.SymbolBucket=Ul,y.Transitionable=Su,y.TriangleIndexArray=_n,y.Uniform1f=ys,y.Uniform1i=class extends Gi{constructor(a,i){super(a,i),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},y.Uniform2f=class extends Gi{constructor(a,i){super(a,i),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},y.Uniform3f=class extends Gi{constructor(a,i){super(a,i),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},y.Uniform4f=Qh,y.UniformColor=Tu,y.UniformMatrix4f=class extends Gi{constructor(a,i){super(a,i),this.current=$m}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let i=1;i<16;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},y.UnwrappedTileID=Zc,y.ValidationError=Be,y.ZoomHistory=Qs,y.addDynamicAttributes=Yu,y.asyncAll=function(a,i,l){if(!a.length)return l(null,[]);let h=a.length;const p=new Array(a.length);let v=null;a.forEach((x,D)=>{i(x,(S,A)=>{S&&(v=S),p[D]=A,0==--h&&l(v,p)})})},y.bezier=hi,y.bindAll=bn,y.cacheEntryPossiblyAdded=function(a){$r++,$r>po&&(a.getActor().send("enforceCacheSizeLimit",ns),$r=0)},y.clamp=ue,y.clearTileCache=function(a){const i=caches.delete(Qr);a&&i.catch(a).then(()=>a())},y.clipLine=up,y.clone=function(a){var i=new Il(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},y.clone$1=ln,y.collisionCircleLayout=cg,y.config=di,y.create=function(){var a=new Il(16);return Il!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.createExpression=Vi,y.createFilter=hs,y.createLayout=lr,y.createStyleLayer=function(a){return"custom"===a.type?new gp(a):new th[a.type](a)},y.dot=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]*i[3]},y.ease=Je,y.emitValidationErrors=vc,y.enforceCacheSizeLimit=function(a){No(),rn&&rn.then(i=>{i.keys().then(l=>{for(let h=0;h<l.length-a;h++)i.delete(l[h])})})},y.evaluateSizeForFeature=function(a,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:p}){return"source"===a.kind?h/Ds:"composite"===a.kind?Nn(h/Ds,p/Ds,l):i},y.evaluateSizeForZoom=function(a,i){let l=0,h=0;if("constant"===a.kind)h=a.layoutSize;else if("source"!==a.kind){const{interpolationType:p,minZoom:v,maxZoom:x}=a,D=p?ue(it.interpolationFactor(p,i,v,x),0,1):0;"camera"===a.kind?h=Nn(a.minSize,a.maxSize,D):l=D}return{uSizeT:l,uSize:h}},y.evaluateVariableOffset=fp,y.evented=ea,y.exported=Jr,y.exported$1=wi,y.extend=zt,y.filterObject=wr,y.getAnchorAlignment=Wu,y.getAnchorJustification=Dd,y.getArrayBuffer=go,y.getImage=ol,y.getJSON=function(a,i){return Us(zt(a,{type:"json"}),i)},y.getOverlapMode=eh,y.getRTLTextPluginStatus=xc,y.getReferrer=mo,y.getVideo=function(a,i){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<a.length;h++){const p=window.document.createElement("source");rc(a[h])||(l.crossOrigin="Anonymous"),p.src=a[h],l.appendChild(p)}return{cancel:()=>{}}},y.identity=Tl,y.invert=function(a,i){var l=i[0],h=i[1],p=i[2],v=i[3],x=i[4],D=i[5],S=i[6],A=i[7],k=i[8],F=i[9],N=i[10],U=i[11],V=i[12],Q=i[13],ee=i[14],ae=i[15],fe=l*D-h*x,de=l*S-p*x,me=l*A-v*x,Ie=h*S-p*D,De=h*A-v*D,Ge=p*A-v*S,nt=k*Q-F*V,Ue=k*ee-N*V,Ve=k*ae-U*V,ke=F*ee-N*Q,He=F*ae-U*Q,Oe=N*ae-U*ee,Pe=fe*Oe-de*He+me*ke+Ie*Ve-De*Ue+Ge*nt;return Pe?(a[0]=(D*Oe-S*He+A*ke)*(Pe=1/Pe),a[1]=(p*He-h*Oe-v*ke)*Pe,a[2]=(Q*Ge-ee*De+ae*Ie)*Pe,a[3]=(N*De-F*Ge-U*Ie)*Pe,a[4]=(S*Ve-x*Oe-A*Ue)*Pe,a[5]=(l*Oe-p*Ve+v*Ue)*Pe,a[6]=(ee*me-V*Ge-ae*de)*Pe,a[7]=(k*Ge-N*me+U*de)*Pe,a[8]=(x*He-D*Ve+A*nt)*Pe,a[9]=(h*Ve-l*He-v*nt)*Pe,a[10]=(V*De-Q*me+ae*fe)*Pe,a[11]=(F*me-k*De-U*fe)*Pe,a[12]=(D*Ue-x*ke-S*nt)*Pe,a[13]=(l*ke-h*Ue+p*nt)*Pe,a[14]=(Q*de-V*Ie-ee*fe)*Pe,a[15]=(k*Ie-F*de+N*fe)*Pe,a):null},y.isImageBitmap=Er,y.isSafari=Yr,y.keysDifference=function(a,i){const l=[];for(const h in a)h in i||l.push(h);return l},y.lazyLoadRTLTextPlugin=function(){ji.isLoading()||ji.isLoaded()||"deferred"!==xc()||bc()},y.makeRequest=Us,y.mapObject=mn,y.mercatorXfromLng=yp,y.mercatorYfromLat=Td,y.mercatorZfromAltitude=_p,y.mul=av,y.multiply=Pu,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.number=Nn,y.ortho=function(a,i,l,h,p,v,x){var D=1/(i-l),S=1/(h-p),A=1/(v-x);return a[0]=-2*D,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*A,a[11]=0,a[12]=(i+l)*D,a[13]=(p+h)*S,a[14]=(x+v)*A,a[15]=1,a},y.parseCacheControl=In,y.parseGlyphPBF=function(a){return new Uu(a).readFields(Fi,[])},y.pbf=Uu,y.performSymbolLayout=function(a,i,l,h,p,v,x){a.createArrays(),a.tilePixelRatio=jn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const D=a.layers[0].layout,S=a.layers[0]._unevaluatedLayout._values,A={layoutIconSize:S["icon-size"].possiblyEvaluate(new kn(a.zoom+1),x),layoutTextSize:S["text-size"].possiblyEvaluate(new kn(a.zoom+1),x),textMaxSize:S["text-size"].possiblyEvaluate(new kn(18))};if("composite"===a.textSizeData.kind){const{minZoom:V,maxZoom:Q}=a.textSizeData;A.compositeTextSizes=[S["text-size"].possiblyEvaluate(new kn(V),x),S["text-size"].possiblyEvaluate(new kn(Q),x)]}if("composite"===a.iconSizeData.kind){const{minZoom:V,maxZoom:Q}=a.iconSizeData;A.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new kn(V),x),S["icon-size"].possiblyEvaluate(new kn(Q),x)]}const k=D.get("text-line-height")*nr,F="viewport"!==D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),N=D.get("text-keep-upright"),U=D.get("text-size");for(const V of a.features){const Q=D.get("text-font").evaluate(V,{},x).join(","),ee=U.evaluate(V,{},x),ae=A.layoutTextSize.evaluate(V,{},x),fe=A.layoutIconSize.evaluate(V,{},x),de={horizontal:{},vertical:void 0},me=V.text;let Ie,De=[0,0];if(me){const Ue=me.toString(),Ve=D.get("text-letter-spacing").evaluate(V,{},x)*nr,ke=bl(Ue)?Ve:0,He=D.get("text-anchor").evaluate(V,{},x),Oe=D.get("text-variable-anchor");if(!Oe){const sn=D.get("text-radial-offset").evaluate(V,{},x);De=sn?fp(He,[sn*nr,wd]):D.get("text-offset").evaluate(V,{},x).map(Pn=>Pn*nr)}let Pe=F?"center":D.get("text-justify").evaluate(V,{},x);const ct=D.get("symbol-placement"),rt="point"===ct?D.get("text-max-width").evaluate(V,{},x)*nr:0,Gt=()=>{a.allowVerticalPlacement&&wu(Ue)&&(de.vertical=Hc(me,i,l,p,Q,rt,k,He,"left",ke,De,y.WritingMode.vertical,!0,ct,ae,ee))};if(!F&&Oe){const sn="auto"===Pe?Oe.map(Rn=>Dd(Rn)):[Pe];let Pn=!1;for(let Rn=0;Rn<sn.length;Rn++){const Ar=sn[Rn];if(!de.horizontal[Ar])if(Pn)de.horizontal[Ar]=de.horizontal[0];else{const Un=Hc(me,i,l,p,Q,rt,k,"center",Ar,ke,De,y.WritingMode.horizontal,!1,ct,ae,ee);Un&&(de.horizontal[Ar]=Un,Pn=1===Un.positionedLines.length)}}Gt()}else{"auto"===Pe&&(Pe=Dd(He));const sn=Hc(me,i,l,p,Q,rt,k,He,Pe,ke,De,y.WritingMode.horizontal,!1,ct,ae,ee);sn&&(de.horizontal[Pe]=sn),Gt(),wu(Ue)&&F&&N&&(de.vertical=Hc(me,i,l,p,Q,rt,k,He,Pe,ke,De,y.WritingMode.vertical,!1,ct,ae,ee))}}let Ge=!1;if(V.icon&&V.icon.name){const Ue=h[V.icon.name];Ue&&(Ie=gg(p[V.icon.name],D.get("icon-offset").evaluate(V,{},x),D.get("icon-anchor").evaluate(V,{},x)),Ge=!!Ue.sdf,void 0===a.sdfIcons?a.sdfIcons=Ge:a.sdfIcons!==Ge&&Vn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ue.pixelRatio!==a.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const nt=Ed(de.horizontal)||de.vertical;a.iconsInText=!!nt&&nt.iconsInText,(nt||Ie)&&xg(a,V,de,Ie,h,A,ae,fe,De,Ge,x)}v&&a.generateCollisionDebugBuffers()},y.perspective=function(a,i,l,h,p){var v,x=1/Math.tan(i/2);return a[0]=x/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=p&&p!==1/0?(a[10]=(p+h)*(v=1/(h-p)),a[14]=2*p*h*v):(a[10]=-1,a[14]=-2*h),a},y.pick=function(a,i){const l={};for(let h=0;h<i.length;h++){const p=i[h];p in a&&(l[p]=a[p])}return l},y.plugin=ji,y.pointGeometry=tt,y.polygonIntersectsPolygon=Cl,y.potpack=op,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=je,y.registerForPluginStateChange=function(a){return a({pluginStatus:Tr,pluginURL:mr}),ea.on("pluginStateChange",a),a},y.renderColorRamp=Ru,y.rotateX=function(a,i,l){var h=Math.sin(l),p=Math.cos(l),v=i[4],x=i[5],D=i[6],S=i[7],A=i[8],k=i[9],F=i[10],N=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=v*p+A*h,a[5]=x*p+k*h,a[6]=D*p+F*h,a[7]=S*p+N*h,a[8]=A*p-v*h,a[9]=k*p-x*h,a[10]=F*p-D*h,a[11]=N*p-S*h,a},y.rotateZ=function(a,i,l){var h=Math.sin(l),p=Math.cos(l),v=i[0],x=i[1],D=i[2],S=i[3],A=i[4],k=i[5],F=i[6],N=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=v*p+A*h,a[1]=x*p+k*h,a[2]=D*p+F*h,a[3]=S*p+N*h,a[4]=A*p-v*h,a[5]=k*p-x*h,a[6]=F*p-D*h,a[7]=N*p-S*h,a},y.scale=function(a,i,l){var h=l[0],p=l[1],v=l[2];return a[0]=i[0]*h,a[1]=i[1]*h,a[2]=i[2]*h,a[3]=i[3]*h,a[4]=i[4]*p,a[5]=i[5]*p,a[6]=i[6]*p,a[7]=i[7]*p,a[8]=i[8]*v,a[9]=i[9]*v,a[10]=i[10]*v,a[11]=i[11]*v,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a},y.scale$1=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a[3]=i[3]*l,a},y.setCacheLimits=function(a,i){ns=a,po=i},y.setRTLTextPlugin=function(a,i,l=!1){if(Tr===Or||Tr===fi||Tr===Ra)throw new Error("setRTLTextPlugin cannot be called multiple times.");mr=Jr.resolveURL(a),Tr=Or,ps=i,Cu(),l||bc()},y.spec=xe,y.sphericalToCartesian=function([a,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:a*Math.cos(i)*Math.sin(l),y:a*Math.sin(i)*Math.sin(l),z:a*Math.cos(l)}},y.toEvaluationFeature=ia,y.transformMat4=Mc,y.translate=function(a,i,l){var h,p,v,x,D,S,A,k,F,N,U,V,Q=l[0],ee=l[1],ae=l[2];return i===a?(a[12]=i[0]*Q+i[4]*ee+i[8]*ae+i[12],a[13]=i[1]*Q+i[5]*ee+i[9]*ae+i[13],a[14]=i[2]*Q+i[6]*ee+i[10]*ae+i[14],a[15]=i[3]*Q+i[7]*ee+i[11]*ae+i[15]):(p=i[1],v=i[2],x=i[3],D=i[4],S=i[5],A=i[6],k=i[7],F=i[8],N=i[9],U=i[10],V=i[11],a[0]=h=i[0],a[1]=p,a[2]=v,a[3]=x,a[4]=D,a[5]=S,a[6]=A,a[7]=k,a[8]=F,a[9]=N,a[10]=U,a[11]=V,a[12]=h*Q+D*ee+F*ae+i[12],a[13]=p*Q+S*ee+N*ae+i[13],a[14]=v*Q+A*ee+U*ae+i[14],a[15]=x*Q+k*ee+V*ae+i[15]),a},y.triggerPluginCompletionEvent=Eu,y.unicodeBlockLookup=Me,y.uniqueId=function(){return Sn++},y.validateCustomStyleLayer=function(a){const i=[],l=a.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&i.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},y.validateLight=Ft,y.validateStyle=io,y.vectorTile=To,y.warnOnce=Vn,y.wrap=Yt}),Oo(0,function(y){function pn(G){const P=typeof G;if("number"===P||"boolean"===P||"string"===P||null==G)return JSON.stringify(G);if(Array.isArray(G)){let W="[";for(const Z of G)W+=`${pn(Z)},`;return`${W}]`}const L=Object.keys(G).sort();let $="{";for(let W=0;W<L.length;W++)$+=`${JSON.stringify(L[W])}:${pn(G[L[W]])},`;return`${$}}`}function ui(G){let P="";for(const L of y.refProperties)P+=`/${pn(G[L])}`;return P}class hi{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,L){for(const W of P){this._layerConfigs[W.id]=W;const Z=this._layers[W.id]=y.createStyleLayer(W);Z._featureFilter=y.createFilter(Z.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of L)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const $=function(W,Z){const ie={};for(let ne=0;ne<W.length;ne++){const re=Z&&Z[W[ne].id]||ui(W[ne]);Z&&(Z[W[ne].id]=re);let ye=ie[re];ye||(ye=ie[re]=[]),ye.push(W[ne])}const Y=[];for(const ne in ie)Y.push(ie[ne]);return Y}(Object.values(this._layerConfigs),this.keyCache);for(const W of $){const Z=W.map(Se=>this._layers[Se.id]),ie=Z[0];if("none"===ie.visibility)continue;const Y=ie.source||"";let ne=this.familiesBySource[Y];ne||(ne=this.familiesBySource[Y]={});const re=ie.sourceLayer||"_geojsonTileLayer";let ye=ne[re];ye||(ye=ne[re]=[]),ye.push(Z)}}}class Je{constructor(P){const L={},$=[];for(const Y in P){const ne=P[Y],re=L[Y]={};for(const ye in ne){const Se=ne[+ye];if(!Se||0===Se.bitmap.width||0===Se.bitmap.height)continue;const pe={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};$.push(pe),re[ye]={rect:pe,metrics:Se.metrics}}}const{w:W,h:Z}=y.potpack($),ie=new y.AlphaImage({width:W||1,height:Z||1});for(const Y in P){const ne=P[Y];for(const re in ne){const ye=ne[+re];if(!ye||0===ye.bitmap.width||0===ye.bitmap.height)continue;const Se=L[Y][re].rect;y.AlphaImage.copy(ye.bitmap,ie,{x:0,y:0},{x:Se.x+1,y:Se.y+1},ye.bitmap)}}this.image=ie,this.positions=L}}y.register("GlyphAtlas",Je);class ue{constructor(P){this.tileID=new y.OverscaledTileID(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId}parse(P,L,$,W,Z){this.status="parsing",this.data=P,this.collisionBoxArray=new y.CollisionBoxArray;const ie=new y.DictionaryCoder(Object.keys(P.layers).sort()),Y=new y.FeatureIndex(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const ne={},re={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},ye=L.familiesBySource[this.source];for(const Mt in ye){const bt=P.layers[Mt];if(!bt)continue;1===bt.version&&y.warnOnce(`Vector tile source "${this.source}" layer "${Mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vt=ie.encode(Mt),Wn=[];for(let zn=0;zn<bt.length;zn++){const fr=bt.feature(zn),Sr=Y.getId(fr,Mt);Wn.push({feature:fr,id:Sr,index:zn,sourceLayerIndex:vt})}for(const zn of ye[Mt]){const fr=zn[0];fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||"none"!==fr.visibility&&(Yt(zn,this.zoom,$),(ne[fr.id]=fr.createBucket({index:Y.bucketLayerIDs.length,layers:zn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vt,sourceID:this.source})).populate(Wn,re,this.tileID.canonical),Y.bucketLayerIDs.push(zn.map(Sr=>Sr.id)))}}let Se,pe,We,$e;const Xe=y.mapObject(re.glyphDependencies,Mt=>Object.keys(Mt).map(Number));Object.keys(Xe).length?W.send("getGlyphs",{uid:this.uid,stacks:Xe},(Mt,bt)=>{Se||(Se=Mt,pe=bt,Lt.call(this))}):pe={};const at=Object.keys(re.iconDependencies);at.length?W.send("getImages",{icons:at,source:this.source,tileID:this.tileID,type:"icons"},(Mt,bt)=>{Se||(Se=Mt,We=bt,Lt.call(this))}):We={};const Xt=Object.keys(re.patternDependencies);function Lt(){if(Se)return Z(Se);if(pe&&We&&$e){const Mt=new Je(pe),bt=new y.ImageAtlas(We,$e);for(const vt in ne){const Wn=ne[vt];Wn instanceof y.SymbolBucket?(Yt(Wn.layers,this.zoom,$),y.performSymbolLayout(Wn,pe,Mt.positions,We,bt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Wn.hasPattern&&(Wn instanceof y.LineBucket||Wn instanceof y.FillBucket||Wn instanceof y.FillExtrusionBucket)&&(Yt(Wn.layers,this.zoom,$),Wn.addFeatures(re,this.tileID.canonical,bt.patternPositions))}this.status="done",Z(null,{buckets:Object.values(ne).filter(vt=>!vt.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mt.image,imageAtlas:bt,glyphMap:this.returnDependencies?pe:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?Mt.positions:null})}}Xt.length?W.send("getImages",{icons:Xt,source:this.source,tileID:this.tileID,type:"patterns"},(Mt,bt)=>{Se||(Se=Mt,$e=bt,Lt.call(this))}):$e={},Lt.call(this)}}function Yt(G,P,L){const $=new y.EvaluationParameters(P);for(const W of G)W.recalculate($,L)}function zt(G,P){const L=y.getArrayBuffer(G.request,($,W,Z,ie)=>{$?P($):W&&P(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(W)),rawData:W,cacheControl:Z,expires:ie})});return()=>{L.cancel(),P()}}class Sn{constructor(P,L,$,W){this.actor=P,this.layerIndex=L,this.availableImages=$,this.loadVectorData=W||zt,this.loading={},this.loaded={}}loadTile(P,L){const $=P.uid;this.loading||(this.loading={});const W=!!(P&&P.request&&P.request.collectResourceTiming)&&new y.RequestPerformance(P.request),Z=this.loading[$]=new ue(P);Z.abort=this.loadVectorData(P,(ie,Y)=>{if(delete this.loading[$],ie||!Y)return Z.status="done",this.loaded[$]=Z,L(ie);const ne=Y.rawData,re={};Y.expires&&(re.expires=Y.expires),Y.cacheControl&&(re.cacheControl=Y.cacheControl);const ye={};if(W){const Se=W.finish();Se&&(ye.resourceTiming=JSON.parse(JSON.stringify(Se)))}Z.vectorTile=Y.vectorTile,Z.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(Se,pe)=>{if(Se||!pe)return L(Se);L(null,y.extend({rawTileData:ne.slice(0)},pe,re,ye))}),this.loaded=this.loaded||{},this.loaded[$]=Z})}reloadTile(P,L){const $=this.loaded,W=P.uid,Z=this;if($&&$[W]){const ie=$[W];ie.showCollisionBoxes=P.showCollisionBoxes;const Y=(ne,re)=>{const ye=ie.reloadCallback;ye&&(delete ie.reloadCallback,ie.parse(ie.vectorTile,Z.layerIndex,this.availableImages,Z.actor,ye)),L(ne,re)};"parsing"===ie.status?ie.reloadCallback=Y:"done"===ie.status&&(ie.vectorTile?ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y):Y())}}abortTile(P,L){const $=this.loading,W=P.uid;$&&$[W]&&$[W].abort&&($[W].abort(),delete $[W]),L()}removeTile(P,L){const $=this.loaded,W=P.uid;$&&$[W]&&delete $[W],L()}}class bn{constructor(){this.loaded={}}loadTile(P,L){const{uid:$,encoding:W,rawImageData:Z}=P,ie=y.isImageBitmap(Z)?this.getImageData(Z):Z,Y=new y.DEMData($,ie,W);this.loaded=this.loaded||{},this.loaded[$]=Y,L(null,Y)}getImageData(P){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const L=this.offscreenCanvasContext.getImageData(-1,-1,P.width+2,P.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:L.width,height:L.height},L.data)}removeTile(P){const L=this.loaded,$=P.uid;L&&L[$]&&delete L[$]}}var mn=function G(P,L){var $,W=P&&P.type;if("FeatureCollection"===W)for($=0;$<P.features.length;$++)G(P.features[$],L);else if("GeometryCollection"===W)for($=0;$<P.geometries.length;$++)G(P.geometries[$],L);else if("Feature"===W)G(P.geometry,L);else if("Polygon"===W)wr(P.coordinates,L);else if("MultiPolygon"===W)for($=0;$<P.coordinates.length;$++)wr(P.coordinates[$],L);return P};function wr(G,P){if(0!==G.length){ln(G[0],P);for(var L=1;L<G.length;L++)ln(G[L],!P)}}function ln(G,P){for(var L=0,$=0,W=0,Z=G.length,ie=Z-1;W<Z;ie=W++){var Y=(G[W][0]-G[ie][0])*(G[ie][1]+G[W][1]),ne=L+Y;$+=Math.abs(L)>=Math.abs(Y)?L-ne+Y:Y-ne+L,L=ne}L+$>=0!=!!P&&G.reverse()}const Kr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Vn{constructor(P){this._feature=P,this.extent=y.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const L of this._feature.geometry)P.push([new y.pointGeometry(L[0],L[1])]);return P}{const P=[];for(const L of this._feature.geometry){const $=[];for(const W of L)$.push(new y.pointGeometry(W[0],W[1]));P.push($)}return P}}toGeoJSON(P,L,$){return Kr.call(this,P,L,$)}}class Kt{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=P.length,this._features=P}feature(P){return new Vn(this._features[P])}}var dt={exports:{}},qt=y.pointGeometry,In=y.vectorTile.VectorTileFeature,Vr=Yn;function Yn(G,P){this.options=P||{},this.features=G,this.length=G.length}function Dr(G,P){this.id="number"==typeof G.id?G.id:void 0,this.type=G.type,this.rawGeometry=1===G.type?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=P||4096}Yn.prototype.feature=function(G){return new Dr(this.features[G],this.options.extent)},Dr.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var P=0;P<G.length;P++){for(var L=G[P],$=[],W=0;W<L.length;W++)$.push(new qt(L[W][0],L[W][1]));this.geometry.push($)}return this.geometry},Dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,P=1/0,L=-1/0,$=1/0,W=-1/0,Z=0;Z<G.length;Z++)for(var ie=G[Z],Y=0;Y<ie.length;Y++){var ne=ie[Y];P=Math.min(P,ne.x),L=Math.max(L,ne.x),$=Math.min($,ne.y),W=Math.max(W,ne.y)}return[P,$,L,W]},Dr.prototype.toGeoJSON=In.prototype.toGeoJSON;var Yr=y.pbf,Er=Vr;function Jr(G){var P=new Yr;return function(L,$){for(var W in L.layers)$.writeMessage(3,tt,L.layers[W])}(G,P),P.finish()}function tt(G,P){var L;P.writeVarintField(15,G.version||1),P.writeStringField(1,G.name||""),P.writeVarintField(5,G.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<G.length;L++)$.feature=G.feature(L),P.writeMessage(2,Gn,$);var W=$.keys;for(L=0;L<W.length;L++)P.writeStringField(3,W[L]);var Z=$.values;for(L=0;L<Z.length;L++)P.writeMessage(4,ns,Z[L])}function Gn(G,P){var L=G.feature;void 0!==L.id&&P.writeVarintField(1,L.id),P.writeMessage(2,di,G),P.writeVarintField(3,L.type),P.writeMessage(4,zo,L)}function di(G,P){var L=G.feature,$=G.keys,W=G.values,Z=G.keycache,ie=G.valuecache;for(var Y in L.properties){var ne=L.properties[Y],re=Z[Y];if(null!==ne){void 0===re&&($.push(Y),Z[Y]=re=$.length-1),P.writeVarint(re);var ye=typeof ne;"string"!==ye&&"boolean"!==ye&&"number"!==ye&&(ne=JSON.stringify(ne));var Se=ye+":"+ne,pe=ie[Se];void 0===pe&&(W.push(ne),ie[Se]=pe=W.length-1),P.writeVarint(pe)}}}function Qr(G,P){return(P<<3)+(7&G)}function rn(G){return G<<1^G>>31}function zo(G,P){for(var L=G.loadGeometry(),$=G.type,W=0,Z=0,ie=L.length,Y=0;Y<ie;Y++){var ne=L[Y],re=1;1===$&&(re=ne.length),P.writeVarint(Qr(1,re));for(var ye=3===$?ne.length-1:ne.length,Se=0;Se<ye;Se++){1===Se&&1!==$&&P.writeVarint(Qr(2,ye-1));var pe=ne[Se].x-W,We=ne[Se].y-Z;P.writeVarint(rn(pe)),P.writeVarint(rn(We)),W+=pe,Z+=We}3===$&&P.writeVarint(Qr(7,1))}}function ns(G,P){var L=typeof G;"string"===L?P.writeStringField(1,G):"boolean"===L?P.writeBooleanField(7,G):"number"===L&&(G%1!=0?P.writeDoubleField(3,G):G<0?P.writeSVarintField(6,G):P.writeVarintField(5,G))}dt.exports=Jr,dt.exports.fromVectorTileJs=Jr,dt.exports.fromGeojsonVt=function(G,P){P=P||{};var L={};for(var $ in G)L[$]=new Er(G[$].features,P),L[$].name=$,L[$].version=P.version,L[$].extent=P.extent;return Jr({layers:L})},dt.exports.GeoJSONWrapper=Er;var po=dt.exports;function No(G,P,L,$,W,Z){if(W-$<=L)return;const ie=$+W>>1;$r(G,P,ie,$,W,Z%2),No(G,P,L,$,ie-1,Z+1),No(G,P,L,ie+1,W,Z+1)}function $r(G,P,L,$,W,Z){for(;W>$;){if(W-$>600){const re=W-$+1,ye=L-$+1,Se=Math.log(re),pe=.5*Math.exp(2*Se/3),We=.5*Math.sqrt(Se*pe*(re-pe)/re)*(ye-re/2<0?-1:1);$r(G,P,L,Math.max($,Math.floor(L-ye*pe/re+We)),Math.min(W,Math.floor(L+(re-ye)*pe/re+We)),Z)}const ie=P[2*L+Z];let Y=$,ne=W;for(wi(G,P,$,L),P[2*W+Z]>ie&&wi(G,P,$,W);Y<ne;){for(wi(G,P,Y,ne),Y++,ne--;P[2*Y+Z]<ie;)Y++;for(;P[2*ne+Z]>ie;)ne--}P[2*$+Z]===ie?wi(G,P,$,ne):(ne++,wi(G,P,ne,W)),ne<=L&&($=ne+1),L<=ne&&(W=ne-1)}}function wi(G,P,L,$){Qi(G,L,$),Qi(P,2*L,2*$),Qi(P,2*L+1,2*$+1)}function Qi(G,P,L){const $=G[P];G[P]=G[L],G[L]=$}function wn(G,P,L,$){const W=G-L,Z=P-$;return W*W+Z*Z}const On=G=>G[0],rl=G=>G[1];class Nt{constructor(P,L=On,$=rl,W=64,Z=Float64Array){this.nodeSize=W,this.points=P;const ie=P.length<65536?Uint16Array:Uint32Array,Y=this.ids=new ie(P.length),ne=this.coords=new Z(2*P.length);for(let re=0;re<P.length;re++)Y[re]=re,ne[2*re]=L(P[re]),ne[2*re+1]=$(P[re]);No(Y,ne,W,0,Y.length-1,0)}range(P,L,$,W){return function(Z,ie,Y,ne,re,ye,Se){const pe=[0,Z.length-1,0],We=[];let $e,Xe;for(;pe.length;){const at=pe.pop(),Xt=pe.pop(),Lt=pe.pop();if(Xt-Lt<=Se){for(let vt=Lt;vt<=Xt;vt++)$e=ie[2*vt],Xe=ie[2*vt+1],$e>=Y&&$e<=re&&Xe>=ne&&Xe<=ye&&We.push(Z[vt]);continue}const Mt=Math.floor((Lt+Xt)/2);$e=ie[2*Mt],Xe=ie[2*Mt+1],$e>=Y&&$e<=re&&Xe>=ne&&Xe<=ye&&We.push(Z[Mt]);const bt=(at+1)%2;(0===at?Y<=$e:ne<=Xe)&&(pe.push(Lt),pe.push(Mt-1),pe.push(bt)),(0===at?re>=$e:ye>=Xe)&&(pe.push(Mt+1),pe.push(Xt),pe.push(bt))}return We}(this.ids,this.coords,P,L,$,W,this.nodeSize)}within(P,L,$){return function(W,Z,ie,Y,ne,re){const ye=[0,W.length-1,0],Se=[],pe=ne*ne;for(;ye.length;){const We=ye.pop(),$e=ye.pop(),Xe=ye.pop();if($e-Xe<=re){for(let bt=Xe;bt<=$e;bt++)wn(Z[2*bt],Z[2*bt+1],ie,Y)<=pe&&Se.push(W[bt]);continue}const at=Math.floor((Xe+$e)/2),Xt=Z[2*at],Lt=Z[2*at+1];wn(Xt,Lt,ie,Y)<=pe&&Se.push(W[at]);const Mt=(We+1)%2;(0===We?ie-ne<=Xt:Y-ne<=Lt)&&(ye.push(Xe),ye.push(at-1),ye.push(Mt)),(0===We?ie+ne>=Xt:Y+ne>=Lt)&&(ye.push(at+1),ye.push($e),ye.push(Mt))}return Se}(this.ids,this.coords,P,L,$,this.nodeSize)}}const Bs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Cr=Math.fround||(mo=new Float32Array(1),G=>(mo[0]=+G,mo[0]));var mo;class il{constructor(P){this.options=Wt(Object.create(Bs),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:L,minZoom:$,maxZoom:W,nodeSize:Z}=this.options;L&&console.time("total time");const ie=`prepare ${P.length} points`;L&&console.time(ie),this.points=P;let Y=[];for(let ne=0;ne<P.length;ne++)P[ne].geometry&&Y.push(go(P[ne],ne));this.trees[W+1]=new Nt(Y,Vs,vo,Z,Float32Array),L&&console.timeEnd(ie);for(let ne=W;ne>=$;ne--){const re=+Date.now();Y=this._cluster(Y,ne),this.trees[ne]=new Nt(Y,Vs,vo,Z,Float32Array),L&&console.log("z%d: %d clusters in %dms",ne,Y.length,+Date.now()-re)}return L&&console.timeEnd("total time"),this}getClusters(P,L){let $=((P[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,P[1]));let Z=180===P[2]?180:((P[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)$=-180,Z=180;else if($>Z){const ye=this.getClusters([$,W,180,ie],L),Se=this.getClusters([-180,W,Z,ie],L);return ye.concat(Se)}const Y=this.trees[this._limitZoom(L)],ne=Y.range(yo($),_o(ie),yo(Z),_o(W)),re=[];for(const ye of ne){const Se=Y.points[ye];re.push(Se.numPoints?rc(Se):this.points[Se.index])}return re}getChildren(P){const L=this._getOriginId(P),$=this._getOriginZoom(P),W="No cluster with the specified id.",Z=this.trees[$];if(!Z)throw new Error(W);const ie=Z.points[L];if(!ie)throw new Error(W);const Y=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ne=Z.within(ie.x,ie.y,Y),re=[];for(const ye of ne){const Se=Z.points[ye];Se.parentId===P&&re.push(Se.numPoints?rc(Se):this.points[Se.index])}if(0===re.length)throw new Error(W);return re}getLeaves(P,L,$){const W=[];return this._appendLeaves(W,P,L=L||10,$=$||0,0),W}getTile(P,L,$){const W=this.trees[this._limitZoom(P)],Z=Math.pow(2,P),{extent:ie,radius:Y}=this.options,ne=Y/ie,re=($-ne)/Z,ye=($+1+ne)/Z,Se={features:[]};return this._addTileFeatures(W.range((L-ne)/Z,re,(L+1+ne)/Z,ye),W.points,L,$,Z,Se),0===L&&this._addTileFeatures(W.range(1-ne/Z,re,1,ye),W.points,Z,$,Z,Se),L===Z-1&&this._addTileFeatures(W.range(0,re,ne/Z,ye),W.points,-1,$,Z,Se),Se.features.length?Se:null}getClusterExpansionZoom(P){let L=this._getOriginZoom(P)-1;for(;L<=this.options.maxZoom;){const $=this.getChildren(P);if(L++,1!==$.length)break;P=$[0].properties.cluster_id}return L}_appendLeaves(P,L,$,W,Z){const ie=this.getChildren(L);for(const Y of ie){const ne=Y.properties;if(ne&&ne.cluster?Z+ne.point_count<=W?Z+=ne.point_count:Z=this._appendLeaves(P,ne.cluster_id,$,W,Z):Z<W?Z++:P.push(Y),P.length===$)break}return Z}_addTileFeatures(P,L,$,W,Z,ie){for(const Y of P){const ne=L[Y],re=ne.numPoints;let ye,Se,pe;if(re)ye=Bo(ne),Se=ne.x,pe=ne.y;else{const Xe=this.points[ne.index];ye=Xe.properties,Se=yo(Xe.geometry.coordinates[0]),pe=_o(Xe.geometry.coordinates[1])}const We={type:1,geometry:[[Math.round(this.options.extent*(Se*Z-$)),Math.round(this.options.extent*(pe*Z-W))]],tags:ye};let $e;re?$e=ne.id:this.options.generateId?$e=ne.index:this.points[ne.index].id&&($e=this.points[ne.index].id),void 0!==$e&&(We.id=$e),ie.features.push(We)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,L){const $=[],{radius:W,extent:Z,reduce:ie,minPoints:Y}=this.options,ne=W/(Z*Math.pow(2,L));for(let re=0;re<P.length;re++){const ye=P[re];if(ye.zoom<=L)continue;ye.zoom=L;const Se=this.trees[L+1],pe=Se.within(ye.x,ye.y,ne),We=ye.numPoints||1;let $e=We;for(const Xe of pe){const at=Se.points[Xe];at.zoom>L&&($e+=at.numPoints||1)}if($e>We&&$e>=Y){let Xe=ye.x*We,at=ye.y*We,Xt=ie&&We>1?this._map(ye,!0):null;const Lt=(re<<5)+(L+1)+this.points.length;for(const Mt of pe){const bt=Se.points[Mt];if(bt.zoom<=L)continue;bt.zoom=L;const vt=bt.numPoints||1;Xe+=bt.x*vt,at+=bt.y*vt,bt.parentId=Lt,ie&&(Xt||(Xt=this._map(ye,!0)),ie(Xt,this._map(bt)))}ye.parentId=Lt,$.push(Us(Xe/$e,at/$e,Lt,$e,Xt))}else if($.push(ye),$e>1)for(const Xe of pe){const at=Se.points[Xe];at.zoom<=L||(at.zoom=L,$.push(at))}}return $}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,L){if(P.numPoints)return L?Wt({},P.properties):P.properties;const $=this.points[P.index].properties,W=this.options.map($);return L&&W===$?Wt({},W):W}}function Us(G,P,L,$,W){return{x:Cr(G),y:Cr(P),zoom:1/0,id:L,parentId:-1,numPoints:$,properties:W}}function go(G,P){const[L,$]=G.geometry.coordinates;return{x:Cr(yo(L)),y:Cr(_o($)),zoom:1/0,index:P,parentId:-1}}function rc(G){return{type:"Feature",id:G.id,properties:Bo(G),geometry:{type:"Point",coordinates:[(P=G.x,360*(P-.5)),ol(G.y)]}};var P}function Bo(G){const P=G.numPoints,L=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return Wt(Wt({},G.properties),{cluster:!0,cluster_id:G.id,point_count:P,point_count_abbreviated:L})}function yo(G){return G/360+.5}function _o(G){const P=Math.sin(G*Math.PI/180),L=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return L<0?0:L>1?1:L}function ol(G){const P=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Wt(G,P){for(const L in P)G[L]=P[L];return G}function Vs(G){return G.x}function vo(G){return G.y}function $s(G,P,L,$){for(var W,Z=$,ie=L-P>>1,Y=L-P,ne=G[P],re=G[P+1],ye=G[L],Se=G[L+1],pe=P+3;pe<L;pe+=3){var We=js(G[pe],G[pe+1],ne,re,ye,Se);if(We>Z)W=pe,Z=We;else if(We===Z){var $e=Math.abs(pe-ie);$e<Y&&(W=pe,Y=$e)}}Z>$&&(W-P>3&&$s(G,P,W,$),G[W+2]=Z,L-W>3&&$s(G,W,L,$))}function js(G,P,L,$,W,Z){var ie=W-L,Y=Z-$;if(0!==ie||0!==Y){var ne=((G-L)*ie+(P-$)*Y)/(ie*ie+Y*Y);ne>1?(L=W,$=Z):ne>0&&(L+=ie*ne,$+=Y*ne)}return(ie=G-L)*ie+(Y=P-$)*Y}function xe(G,P,L,$){var W={id:void 0===G?null:G,type:P,geometry:L,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Z){var ie=Z.geometry,Y=Z.type;if("Point"===Y||"MultiPoint"===Y||"LineString"===Y)Be(Z,ie);else if("Polygon"===Y||"MultiLineString"===Y)for(var ne=0;ne<ie.length;ne++)Be(Z,ie[ne]);else if("MultiPolygon"===Y)for(ne=0;ne<ie.length;ne++)for(var re=0;re<ie[ne].length;re++)Be(Z,ie[ne][re])}(W),W}function Be(G,P){for(var L=0;L<P.length;L+=3)G.minX=Math.min(G.minX,P[L]),G.minY=Math.min(G.minY,P[L+1]),G.maxX=Math.max(G.maxX,P[L]),G.maxY=Math.max(G.maxY,P[L+1])}function Hs(G,P,L,$){if(P.geometry){var W=P.geometry.coordinates,Z=P.geometry.type,ie=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),Y=[],ne=P.id;if(L.promoteId?ne=P.properties[L.promoteId]:L.generateId&&(ne=$||0),"Point"===Z)Uo(W,Y);else if("MultiPoint"===Z)for(var re=0;re<W.length;re++)Uo(W[re],Y);else if("LineString"===Z)Jt(W,Y,ie,!1);else if("MultiLineString"===Z){if(L.lineMetrics){for(re=0;re<W.length;re++)Jt(W[re],Y=[],ie,!1),G.push(xe(ne,"LineString",Y,P.properties));return}Di(W,Y,ie,!1)}else if("Polygon"===Z)Di(W,Y,ie,!0);else{if("MultiPolygon"!==Z){if("GeometryCollection"===Z){for(re=0;re<P.geometry.geometries.length;re++)Hs(G,{id:ne,geometry:P.geometry.geometries[re],properties:P.properties},L,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<W.length;re++){var ye=[];Di(W[re],ye,ie,!0),Y.push(ye)}}G.push(xe(ne,Z,Y,P.properties))}}function Uo(G,P){P.push(ei(G[0])),P.push(rs(G[1])),P.push(0)}function Jt(G,P,L,$){for(var W,Z,ie=0,Y=0;Y<G.length;Y++){var ne=ei(G[Y][0]),re=rs(G[Y][1]);P.push(ne),P.push(re),P.push(0),Y>0&&(ie+=$?(W*re-ne*Z)/2:Math.sqrt(Math.pow(ne-W,2)+Math.pow(re-Z,2))),W=ne,Z=re}var ye=P.length-3;P[2]=1,$s(P,0,ye,L),P[ye+2]=1,P.size=Math.abs(ie),P.start=0,P.end=P.size}function Di(G,P,L,$){for(var W=0;W<G.length;W++){var Z=[];Jt(G[W],Z,L,$),P.push(Z)}}function ei(G){return G/360+.5}function rs(G){var P=Math.sin(G*Math.PI/180),L=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return L<0?0:L>1?1:L}function Tn(G,P,L,$,W,Z,ie,Y){if($/=P,Z>=(L/=P)&&ie<$)return G;if(ie<L||Z>=$)return null;for(var ne=[],re=0;re<G.length;re++){var ye=G[re],Se=ye.geometry,pe=ye.type,We=0===W?ye.minX:ye.minY,$e=0===W?ye.maxX:ye.maxY;if(We>=L&&$e<$)ne.push(ye);else if(!($e<L||We>=$)){var Xe=[];if("Point"===pe||"MultiPoint"===pe)Le(Se,Xe,L,$,W);else if("LineString"===pe)Tt(Se,Xe,L,$,W,!1,Y.lineMetrics);else if("MultiLineString"===pe)ti(Se,Xe,L,$,W,!1);else if("Polygon"===pe)ti(Se,Xe,L,$,W,!0);else if("MultiPolygon"===pe)for(var at=0;at<Se.length;at++){var Xt=[];ti(Se[at],Xt,L,$,W,!0),Xt.length&&Xe.push(Xt)}if(Xe.length){if(Y.lineMetrics&&"LineString"===pe){for(at=0;at<Xe.length;at++)ne.push(xe(ye.id,pe,Xe[at],ye.tags));continue}"LineString"!==pe&&"MultiLineString"!==pe||(1===Xe.length?(pe="LineString",Xe=Xe[0]):pe="MultiLineString"),"Point"!==pe&&"MultiPoint"!==pe||(pe=3===Xe.length?"Point":"MultiPoint"),ne.push(xe(ye.id,pe,Xe,ye.tags))}}}return ne.length?ne:null}function Le(G,P,L,$,W){for(var Z=0;Z<G.length;Z+=3){var ie=G[Z+W];ie>=L&&ie<=$&&(P.push(G[Z]),P.push(G[Z+1]),P.push(G[Z+2]))}}function Tt(G,P,L,$,W,Z,ie){for(var Y,ne,re=Et(G),ye=0===W?Ct:Vo,Se=G.start,pe=0;pe<G.length-3;pe+=3){var We=G[pe],$e=G[pe+1],Xe=G[pe+2],at=G[pe+3],Xt=G[pe+4],Lt=0===W?We:$e,Mt=0===W?at:Xt,bt=!1;ie&&(Y=Math.sqrt(Math.pow(We-at,2)+Math.pow($e-Xt,2))),Lt<L?Mt>L&&(ne=ye(re,We,$e,at,Xt,L),ie&&(re.start=Se+Y*ne)):Lt>$?Mt<$&&(ne=ye(re,We,$e,at,Xt,$),ie&&(re.start=Se+Y*ne)):eo(re,We,$e,Xe),Mt<L&&Lt>=L&&(ne=ye(re,We,$e,at,Xt,L),bt=!0),Mt>$&&Lt<=$&&(ne=ye(re,We,$e,at,Xt,$),bt=!0),!Z&&bt&&(ie&&(re.end=Se+Y*ne),P.push(re),re=Et(G)),ie&&(Se+=Y)}var vt=G.length-3;We=G[vt],$e=G[vt+1],Xe=G[vt+2],(Lt=0===W?We:$e)>=L&&Lt<=$&&eo(re,We,$e,Xe),vt=re.length-3,Z&&vt>=3&&(re[vt]!==re[0]||re[vt+1]!==re[1])&&eo(re,re[0],re[1],re[2]),re.length&&P.push(re)}function Et(G){var P=[];return P.size=G.size,P.start=G.start,P.end=G.end,P}function ti(G,P,L,$,W,Z){for(var ie=0;ie<G.length;ie++)Tt(G[ie],P,L,$,W,Z,!1)}function eo(G,P,L,$){G.push(P),G.push(L),G.push($)}function Ct(G,P,L,$,W,Z){var ie=(Z-P)/($-P);return G.push(Z),G.push(L+(W-L)*ie),G.push(1),ie}function Vo(G,P,L,$,W,Z){var ie=(Z-L)/(W-L);return G.push(P+($-P)*ie),G.push(Z),G.push(1),ie}function Ei(G,P){for(var L=[],$=0;$<G.length;$++){var W,Z=G[$],ie=Z.type;if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)W=to(Z.geometry,P);else if("MultiLineString"===ie||"Polygon"===ie){W=[];for(var Y=0;Y<Z.geometry.length;Y++)W.push(to(Z.geometry[Y],P))}else if("MultiPolygon"===ie)for(W=[],Y=0;Y<Z.geometry.length;Y++){for(var ne=[],re=0;re<Z.geometry[Y].length;re++)ne.push(to(Z.geometry[Y][re],P));W.push(ne)}L.push(xe(Z.id,ie,W,Z.tags))}return L}function to(G,P){var L=[];L.size=G.size,void 0!==G.start&&(L.start=G.start,L.end=G.end);for(var $=0;$<G.length;$+=3)L.push(G[$]+P,G[$+1],G[$+2]);return L}function qn(G,P){if(G.transformed)return G;var L,$,W,Z=1<<G.z,ie=G.x,Y=G.y;for(L=0;L<G.features.length;L++){var ne=G.features[L],re=ne.geometry,ye=ne.type;if(ne.geometry=[],1===ye)for($=0;$<re.length;$+=2)ne.geometry.push(hn(re[$],re[$+1],P,Z,ie,Y));else for($=0;$<re.length;$++){var Se=[];for(W=0;W<re[$].length;W+=2)Se.push(hn(re[$][W],re[$][W+1],P,Z,ie,Y));ne.geometry.push(Se)}}return G.transformed=!0,G}function hn(G,P,L,$,W,Z){return[Math.round(L*(G*$-W)),Math.round(L*(P*$-Z))]}function Ci(G,P,L,$,W){for(var Z=P===W.maxZoom?0:W.tolerance/((1<<P)*W.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:$,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Y=0;Y<G.length;Y++){ie.numFeatures++,$o(ie,G[Y],Z,W);var ne=G[Y].minX,re=G[Y].minY,ye=G[Y].maxX,Se=G[Y].maxY;ne<ie.minX&&(ie.minX=ne),re<ie.minY&&(ie.minY=re),ye>ie.maxX&&(ie.maxX=ye),Se>ie.maxY&&(ie.maxY=Se)}return ie}function $o(G,P,L,$){var W=P.geometry,Z=P.type,ie=[];if("Point"===Z||"MultiPoint"===Z)for(var Y=0;Y<W.length;Y+=3)ie.push(W[Y]),ie.push(W[Y+1]),G.numPoints++,G.numSimplified++;else if("LineString"===Z)Jn(ie,W,G,L,!1,!1);else if("MultiLineString"===Z||"Polygon"===Z)for(Y=0;Y<W.length;Y++)Jn(ie,W[Y],G,L,"Polygon"===Z,0===Y);else if("MultiPolygon"===Z)for(var ne=0;ne<W.length;ne++){var re=W[ne];for(Y=0;Y<re.length;Y++)Jn(ie,re[Y],G,L,!0,0===Y)}if(ie.length){var ye=P.tags||null;if("LineString"===Z&&$.lineMetrics){for(var Se in ye={},P.tags)ye[Se]=P.tags[Se];ye.mapbox_clip_start=W.start/W.size,ye.mapbox_clip_end=W.end/W.size}var pe={geometry:ie,type:"Polygon"===Z||"MultiPolygon"===Z?3:"LineString"===Z||"MultiLineString"===Z?2:1,tags:ye};null!==P.id&&(pe.id=P.id),G.features.push(pe)}}function Jn(G,P,L,$,W,Z){var ie=$*$;if($>0&&P.size<(W?ie:$))L.numPoints+=P.length/3;else{for(var Y=[],ne=0;ne<P.length;ne+=3)(0===$||P[ne+2]>ie)&&(L.numSimplified++,Y.push(P[ne]),Y.push(P[ne+1])),L.numPoints++;W&&function(re,ye){for(var Se=0,pe=0,We=re.length,$e=We-2;pe<We;$e=pe,pe+=2)Se+=(re[pe]-re[$e])*(re[pe+1]+re[$e+1]);if(Se>0===ye)for(pe=0,We=re.length;pe<We/2;pe+=2){var Xe=re[pe],at=re[pe+1];re[pe]=re[We-2-pe],re[pe+1]=re[We-1-pe],re[We-2-pe]=Xe,re[We-1-pe]=at}}(Y,Z),G.push(Y)}}function Si(G,P){var L=(P=this.options=function(W,Z){for(var ie in Z)W[ie]=Z[ie];return W}(Object.create(this.options),P)).debug;if(L&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var W,Z,ie,Y,ne,re,$=function(W,Z){var ie=[];if("FeatureCollection"===W.type)for(var Y=0;Y<W.features.length;Y++)Hs(ie,W.features[Y],Z,Y);else Hs(ie,"Feature"===W.type?W:{geometry:W},Z);return ie}(G,P);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=W=$,ne=Tn(W,1,-1-(ie=(Z=P).buffer/Z.extent),ie,0,-1,2,Z),re=Tn(W,1,1-ie,2+ie,0,-1,2,Z),(ne||re)&&(Y=Tn(W,1,-ie,1+ie,0,-1,2,Z)||[],ne&&(Y=Ei(ne,1).concat(Y)),re&&(Y=Y.concat(Ei(re,-1)))),($=Y).length&&this.splitTile($,0,0,0),L&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ii(G,P,L){return 32*((1<<G)*L+P)+G}function ni(G,P){const L=G.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const $=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!$)return P(null,null);const W=new Kt($.features);let Z=po(W);0===Z.byteOffset&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),P(null,{vectorTile:W,rawData:Z.buffer})}Si.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Si.prototype.splitTile=function(G,P,L,$,W,Z,ie){for(var Y=[G,P,L,$],ne=this.options,re=ne.debug;Y.length;){$=Y.pop(),L=Y.pop(),P=Y.pop(),G=Y.pop();var ye=1<<P,Se=Ii(P,L,$),pe=this.tiles[Se];if(!pe&&(re>1&&console.time("creation"),pe=this.tiles[Se]=Ci(G,P,L,$,ne),this.tileCoords.push({z:P,x:L,y:$}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,L,$,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));var We="z"+P;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(pe.source=G,W){if(P===ne.maxZoom||P===W)continue;var $e=1<<W-P;if(L!==Math.floor(Z/$e)||$!==Math.floor(ie/$e))continue}else if(P===ne.indexMaxZoom||pe.numPoints<=ne.indexMaxPoints)continue;if(pe.source=null,0!==G.length){re>1&&console.time("clipping");var Xe,at,Xt,Lt,Mt,bt,vt=.5*ne.buffer/ne.extent,Wn=.5-vt,zn=.5+vt,fr=1+vt;Xe=at=Xt=Lt=null,Mt=Tn(G,ye,L-vt,L+zn,0,pe.minX,pe.maxX,ne),bt=Tn(G,ye,L+Wn,L+fr,0,pe.minX,pe.maxX,ne),G=null,Mt&&(Xe=Tn(Mt,ye,$-vt,$+zn,1,pe.minY,pe.maxY,ne),at=Tn(Mt,ye,$+Wn,$+fr,1,pe.minY,pe.maxY,ne),Mt=null),bt&&(Xt=Tn(bt,ye,$-vt,$+zn,1,pe.minY,pe.maxY,ne),Lt=Tn(bt,ye,$+Wn,$+fr,1,pe.minY,pe.maxY,ne),bt=null),re>1&&console.timeEnd("clipping"),Y.push(Xe||[],P+1,2*L,2*$),Y.push(at||[],P+1,2*L,2*$+1),Y.push(Xt||[],P+1,2*L+1,2*$),Y.push(Lt||[],P+1,2*L+1,2*$+1)}}},Si.prototype.getTile=function(G,P,L){var $=this.options,W=$.extent,Z=$.debug;if(G<0||G>24)return null;var ie=1<<G,Y=Ii(G,P=(P%ie+ie)%ie,L);if(this.tiles[Y])return qn(this.tiles[Y],W);Z>1&&console.log("drilling down to z%d-%d-%d",G,P,L);for(var ne,re=G,ye=P,Se=L;!ne&&re>0;)re--,ye=Math.floor(ye/2),Se=Math.floor(Se/2),ne=this.tiles[Ii(re,ye,Se)];return ne&&ne.source?(Z>1&&console.log("found parent tile z%d-%d-%d",re,ye,Se),Z>1&&console.time("drilling down"),this.splitTile(ne.source,re,ye,Se,G,P,L),Z>1&&console.timeEnd("drilling down"),this.tiles[Y]?qn(this.tiles[Y],W):null):null};class Gs extends Sn{constructor(P,L,$,W){super(P,L,$,ni),W&&(this.loadGeoJSON=W)}loadData(P,L){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=L,this._pendingLoadDataParams=P,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const P=this._pendingCallback,L=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const $=!!(L&&L.request&&L.request.collectResourceTiming)&&new y.RequestPerformance(L.request);this.loadGeoJSON(L,(W,Z)=>{if(W||!Z)return P(W);if("object"!=typeof Z)return P(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{mn(Z,!0);try{if(L.filter){const Y=y.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Y.result)throw new Error(Y.value.map(re=>`${re.key}: ${re.message}`).join(", "));Z={type:"FeatureCollection",features:Z.features.filter(re=>Y.value.evaluate({zoom:0},re))}}this._geoJSONIndex=L.cluster?new il(function({superclusterOptions:Y,clusterProperties:ne}){if(!ne||!Y)return Y;const re={},ye={},Se={accumulated:null,zoom:0},pe={properties:null},We=Object.keys(ne);for(const $e of We){const[Xe,at]=ne[$e],Xt=y.createExpression(at),Lt=y.createExpression("string"==typeof Xe?[Xe,["accumulated"],["get",$e]]:Xe);re[$e]=Xt.value,ye[$e]=Lt.value}return Y.map=$e=>{pe.properties=$e;const Xe={};for(const at of We)Xe[at]=re[at].evaluate(Se,pe);return Xe},Y.reduce=($e,Xe)=>{pe.properties=Xe;for(const at of We)Se.accumulated=$e[at],$e[at]=ye[at].evaluate(Se,pe)},Y}(L)).load(Z.features):new Si(Y=Z,L.geojsonVtOptions)}catch(Y){return P(Y)}this.loaded={};const ie={};if($){const Y=$.finish();Y&&(ie.resourceTiming={},ie.resourceTiming[L.source]=JSON.parse(JSON.stringify(Y)))}P(null,ie)}var Y})}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(P,L){const $=this.loaded;return $&&$[P.uid]?super.reloadTile(P,L):this.loadTile(P,L)}loadGeoJSON(P,L){if(P.request)y.getJSON(P.request,L);else{if("string"!=typeof P.data)return L(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(P.data))}catch{return L(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}removeSource(P,L){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),L()}getClusterExpansionZoom(P,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch($){L($)}}getClusterChildren(P,L){try{L(null,this._geoJSONIndex.getChildren(P.clusterId))}catch($){L($)}}getClusterLeaves(P,L){try{L(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch($){L($)}}}class qs{constructor(P){this.self=P,this.actor=new y.Actor(P,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Sn,geojson:Gs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,$)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=$},this.self.registerRTLTextPlugin=L=>{if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=L.applyArabicShaping,y.plugin.processBidirectionalText=L.processBidirectionalText,y.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}setReferrer(P,L){this.referrer=L}setImages(P,L,$){this.availableImages[P]=L;for(const W in this.workerSources[P]){const Z=this.workerSources[P][W];for(const ie in Z)Z[ie].availableImages=L}$()}setLayers(P,L,$){this.getLayerIndex(P).replace(L),$()}updateLayers(P,L,$){this.getLayerIndex(P).update(L.layers,L.removedIds),$()}loadTile(P,L,$){this.getWorkerSource(P,L.type,L.source).loadTile(L,$)}loadDEMTile(P,L,$){this.getDEMWorkerSource(P,L.source).loadTile(L,$)}reloadTile(P,L,$){this.getWorkerSource(P,L.type,L.source).reloadTile(L,$)}abortTile(P,L,$){this.getWorkerSource(P,L.type,L.source).abortTile(L,$)}removeTile(P,L,$){this.getWorkerSource(P,L.type,L.source).removeTile(L,$)}removeDEMTile(P,L){this.getDEMWorkerSource(P,L.source).removeTile(L)}removeSource(P,L,$){if(!this.workerSources[P]||!this.workerSources[P][L.type]||!this.workerSources[P][L.type][L.source])return;const W=this.workerSources[P][L.type][L.source];delete this.workerSources[P][L.type][L.source],void 0!==W.removeSource?W.removeSource(L,$):$()}loadWorkerSource(P,L,$){try{this.self.importScripts(L.url),$()}catch(W){$(W.toString())}}syncRTLPluginState(P,L,$){try{y.plugin.setState(L);const W=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&null!=W){this.self.importScripts(W);const Z=y.plugin.isParsed();$(Z?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),Z)}}catch(W){$(W.toString())}}getAvailableImages(P){let L=this.availableImages[P];return L||(L=[]),L}getLayerIndex(P){let L=this.layerIndexes[P];return L||(L=this.layerIndexes[P]=new hi),L}getWorkerSource(P,L,$){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][L]||(this.workerSources[P][L]={}),this.workerSources[P][L][$]||(this.workerSources[P][L][$]=new this.workerSourceTypes[L]({send:(Z,ie,Y)=>{this.actor.send(Z,ie,Y,P)}},this.getLayerIndex(P),this.getAvailableImages(P))),this.workerSources[P][L][$]}getDEMWorkerSource(P,L){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][L]||(this.demWorkerSources[P][L]=new bn),this.demWorkerSources[P][L]}enforceCacheSizeLimit(P,L){y.enforceCacheSizeLimit(L)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qs(self)),qs}),Oo(0,function(y){var pn=ui;function ui(m){return o=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{g=new Worker(E),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(E),f}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var b=g.getImageData(0,0,1,1);return b&&b.width===f.width}()||(void 0===hi[u=o&&o.failIfMajorPerformanceCaveat]&&(hi[u]=function(f){var g,E,I,T,b=(E=f,I=document.createElement("canvas"),(T=Object.create(ui.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,I.getContext("webgl",T)||I.getContext("experimental-webgl",T));if(!b)return!1;try{g=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!g||b.isContextLost())&&(b.shaderSource(g,"void main() {}"),b.compileShader(g),!0===b.getShaderParameter(g,b.COMPILE_STATUS))}(u)),!hi[u]||document.documentMode));var o,u}var hi={};function Je(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let u=0;u<m.length;u++)if(!Je(m[u],o[u]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==o){if("object"!=typeof o||Object.keys(m).length!==Object.keys(o).length)return!1;for(const u in m)if(!Je(m[u],o[u]))return!1;return!0}return m===o}ui.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class ue{static testProp(o){if(!ue.docStyle)return o[0];for(let u=0;u<o.length;u++)if(o[u]in ue.docStyle)return o[u];return o[0]}static create(o,u,f){const g=window.document.createElement(o);return void 0!==u&&(g.className=u),f&&f.appendChild(g),g}static createNS(o,u){return window.document.createElementNS(o,u)}static disableDrag(){ue.docStyle&&ue.selectProp&&(ue.userSelect=ue.docStyle[ue.selectProp],ue.docStyle[ue.selectProp]="none")}static enableDrag(){ue.docStyle&&ue.selectProp&&(ue.docStyle[ue.selectProp]=ue.userSelect)}static setTransform(o,u){o.style[ue.transformProp]=u}static addEventListener(o,u,f,g={}){o.addEventListener(u,f,"passive"in g?g:g.capture)}static removeEventListener(o,u,f,g={}){o.removeEventListener(u,f,"passive"in g?g:g.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",ue.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ue.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ue.suppressClickInternal,!0)},0)}static mousePos(o,u){const f=o.getBoundingClientRect();return new y.pointGeometry(u.clientX-f.left-o.clientLeft,u.clientY-f.top-o.clientTop)}static touchPos(o,u){const f=o.getBoundingClientRect(),g=[];for(let b=0;b<u.length;b++)g.push(new y.pointGeometry(u[b].clientX-f.left-o.clientLeft,u[b].clientY-f.top-o.clientTop));return g}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}ue.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ue.selectProp=ue.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ue.transformProp=ue.testProp(["transform","WebkitTransform"]);class Yt{constructor(o){this._transformRequestFn=o}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}normalizeSpriteURL(o,u,f){const g=function(b){const E=b.match(zt);if(!E)throw new Error(`Unable to parse URL "${b}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return g.path+=`${u}${f}`,function(b){const E=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${E}`}(g)}setTransformRequest(o){this._transformRequestFn=o}}const zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sn(m){var o=new y.ARRAY_TYPE(3);return o[0]=m[0],o[1]=m[1],o[2]=m[2],o}var bn,mn=function(m,o,u){return m[0]=o[0]-u[0],m[1]=o[1]-u[1],m[2]=o[2]-u[2],m};bn=new y.ARRAY_TYPE(3),y.ARRAY_TYPE!=Float32Array&&(bn[0]=0,bn[1]=0,bn[2]=0);var m,wr=function(m){var o=m[0],u=m[1];return o*o+u*u};m=new y.ARRAY_TYPE(2),y.ARRAY_TYPE!=Float32Array&&(m[0]=0,m[1]=0);class ln{constructor(o,u,f,g){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,g)}update(o,u,f){const{width:g,height:b}=o,E=!(this.size&&this.size[0]===g&&this.size[1]===b||f),{context:I}=this,{gl:T}=I;if(this.useMipmap=Boolean(u&&u.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!u||!1!==u.premultiply)),E)this.size=[g,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||y.isImageBitmap(o)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,o):T.texImage2D(T.TEXTURE_2D,0,this.format,g,b,0,this.format,T.UNSIGNED_BYTE,o.data);else{const{x:R,y:O}=f||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||y.isImageBitmap(o)?T.texSubImage2D(T.TEXTURE_2D,0,R,O,T.RGBA,T.UNSIGNED_BYTE,o):T.texSubImage2D(T.TEXTURE_2D,0,R,O,g,b,T.RGBA,T.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(o,u,f){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),f!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f||o),this.filter=o),u!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Kr(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class Vn extends y.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:f}of this.requestors)this._notify(u,f);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let f=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),f=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),f=!1),this._validateContent(u.content,u)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),f=!1),f}_validateStretch(o,u){if(!o)return!0;let f=0;for(const g of o){if(g[0]<f||g[1]<g[0]||u<g[1])return!1;f=g[1]}return!0}_validateContent(o,u){return!(o&&(4!==o.length||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let f=!0;if(!this.isLoaded())for(const g of o)this.images[g]||(f=!1);this.isLoaded()||f?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const f={};for(const g of o){this.images[g]||this.fire(new y.Event("styleimagemissing",{id:g}));const b=this.images[g];b?f[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:y.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,f)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],f=this.getImage(o);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},b=new y.ImagePosition(g,f);this.patterns[o]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ln(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:f}=y.potpack(o),g=this.atlasImage;g.resize({width:u||1,height:f||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],I=E.x+1,T=E.y+1,R=this.images[b].data,O=R.width,B=R.height;y.RGBAImage.copy(R,g,{x:0,y:0},{x:I,y:T},{width:O,height:B}),y.RGBAImage.copy(R,g,{x:0,y:B-1},{x:I,y:T-1},{width:O,height:1}),y.RGBAImage.copy(R,g,{x:0,y:0},{x:I,y:T+B},{width:O,height:1}),y.RGBAImage.copy(R,g,{x:O-1,y:0},{x:I-1,y:T},{width:1,height:B}),y.RGBAImage.copy(R,g,{x:0,y:0},{x:I+O,y:T},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const f=this.images[u];Kr(f)&&this.updateImage(u,f)}}}const Kt=1e20;function dt(m,o,u,f,g,b,E,I,T){for(let R=o;R<o+f;R++)qt(m,u*b+R,b,g,E,I,T);for(let R=u;R<u+g;R++)qt(m,R*b+o,1,f,E,I,T)}function qt(m,o,u,f,g,b,E){b[0]=0,E[0]=-Kt,E[1]=Kt,g[0]=m[o];for(let I=1,T=0,R=0;I<f;I++){g[I]=m[o+I*u];const O=I*I;do{const B=b[T];R=(g[I]-g[B]+O-B*B)/(I-B)/2}while(R<=E[T]&&--T>-1);T++,b[T]=I,E[T]=R,E[T+1]=Kt}for(let I=0,T=0;I<f;I++){for(;E[T+1]<I;)T++;const R=b[T],O=I-R;m[o+I*u]=g[R]+O*O}}class In{constructor(o,u){this.requestManager=o,this.localIdeographFontFamily=u,this.entries={}}setURL(o){this.url=o}getGlyphs(o,u){const f=[];for(const g in o)for(const b of o[g])f.push({stack:g,id:b});y.asyncAll(f,({stack:g,id:b},E)=>{let I=this.entries[g];I||(I=this.entries[g]={glyphs:{},requests:{},ranges:{}});let T=I.glyphs[b];if(void 0!==T)return void E(null,{stack:g,id:b,glyph:T});if(T=this._tinySDF(I,g,b),T)return I.glyphs[b]=T,void E(null,{stack:g,id:b,glyph:T});const R=Math.floor(b/256);if(256*R>65535)return void E(new Error("glyphs > 65535 not supported"));if(I.ranges[R])return void E(null,{stack:g,id:b,glyph:T});let O=I.requests[R];O||(O=I.requests[R]=[],In.loadGlyphRange(g,R,this.url,this.requestManager,(B,j)=>{if(j){for(const K in j)this._doesCharSupportLocalGlyph(+K)||(I.glyphs[+K]=j[+K]);I.ranges[R]=!0}for(const K of O)K(B,j);delete I.requests[R]})),O.push((B,j)=>{B?E(B):j&&E(null,{stack:g,id:b,glyph:j[b]||null})})},(g,b)=>{if(g)u(g);else if(b){const E={};for(const{stack:I,id:T,glyph:R}of b)(E[I]||(E[I]={}))[T]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};u(null,E)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(y.unicodeBlockLookup["CJK Unified Ideographs"](o)||y.unicodeBlockLookup["Hangul Syllables"](o)||y.unicodeBlockLookup.Hiragana(o)||y.unicodeBlockLookup.Katakana(o))}_tinySDF(o,u,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let b=o.tinySDF;if(!b){let I="400";/bold/i.test(u)?I="900":/medium/i.test(u)?I="500":/light/i.test(u)&&(I="200"),b=o.tinySDF=new In.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:I})}const E=b.draw(String.fromCharCode(f));return{id:f,bitmap:new y.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}In.loadGlyphRange=function(m,o,u,f,g){const b=256*o,E=b+255,I=f.transformRequest(u.replace("{fontstack}",m).replace("{range}",`${b}-${E}`),y.ResourceType.Glyphs);y.getArrayBuffer(I,(T,R)=>{if(T)g(T);else if(R){const O={};for(const B of y.parseGlyphPBF(R))O[B.id]=B;g(null,O)}})},In.TinySDF=class{constructor({fontSize:m=24,buffer:o=3,radius:u=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=u;const I=this.size=m+4*o,T=this._createCanvas(I),R=this.ctx=T.getContext("2d",{willReadFrequently:!0});R.font=`${E} ${b} ${m}px ${g}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(m){const o=document.createElement("canvas");return o.width=o.height=m,o}draw(m){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(m),E=Math.ceil(u),I=Math.min(this.size-this.buffer,Math.ceil(b-g)),T=Math.min(this.size-this.buffer,E+Math.ceil(f)),R=I+2*this.buffer,O=T+2*this.buffer,B=Math.max(R*O,0),j=new Uint8ClampedArray(B),K={data:j,width:R,height:O,glyphWidth:I,glyphHeight:T,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(0===I||0===T)return K;const{ctx:H,buffer:X,gridInner:oe,gridOuter:se}=this;H.clearRect(X,X,I,T),H.fillText(m,X,X+E);const ce=H.getImageData(X,X,I,T);se.fill(Kt,0,B),oe.fill(0,0,B);for(let J=0;J<T;J++)for(let we=0;we<I;we++){const ge=ce.data[4*(J*I+we)+3]/255;if(0===ge)continue;const _e=(J+X)*R+we+X;if(1===ge)se[_e]=0,oe[_e]=Kt;else{const Ae=.5-ge;se[_e]=Ae>0?Ae*Ae:0,oe[_e]=Ae<0?Ae*Ae:0}}dt(se,0,0,R,O,R,this.f,this.v,this.z),dt(oe,X,X,I,T,R,this.f,this.v,this.z);for(let J=0;J<B;J++){const we=Math.sqrt(se[J])-Math.sqrt(oe[J]);j[J]=Math.round(255-255*(we/this.radius+this.cutoff))}return K}};const Vr=new y.Properties({anchor:new y.DataConstantProperty(y.spec.light.anchor),position:new class{constructor(){this.specification=y.spec.light.position}possiblyEvaluate(m,o){return y.sphericalToCartesian(m.expression.evaluate(o))}interpolate(m,o,u){return{x:y.number(m.x,o.x,u),y:y.number(m.y,o.y,u),z:y.number(m.z,o.z,u)}}},color:new y.DataConstantProperty(y.spec.light.color),intensity:new y.DataConstantProperty(y.spec.light.intensity)}),Yn="-transition";class Dr extends y.Evented{constructor(o){super(),this._transitionable=new y.Transitionable(Vr),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(y.validateLight,o,u))for(const f in o){const g=o[f];f.endsWith(Yn)?this._transitionable.setTransition(f.slice(0,-Yn.length),g):this._transitionable.setValue(f,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,f){return(!f||!1!==f.validate)&&y.emitValidationErrors(this,o.call(y.validateStyle,y.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:y.spec})))}}class Yr{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,u){const f=o.join(",")+String(u);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(o,u)),this.dashEntry[f]}getDashRanges(o,u,f){const g=[];let b=o.length%2==1?-o[o.length-1]*f:0,E=o[0]*f,I=!0;g.push({left:b,right:E,isDash:I,zeroLength:0===o[0]});let T=o[0];for(let R=1;R<o.length;R++){I=!I;const O=o[R];b=T*f,T+=O,E=T*f,g.push({left:b,right:E,isDash:I,zeroLength:0===O})}return g}addRoundDash(o,u,f){const g=u/2;for(let b=-f;b<=f;b++){const E=this.width*(this.nextRow+f+b);let I=0,T=o[I];for(let R=0;R<this.width;R++){R/T.right>1&&(T=o[++I]);const O=Math.abs(R-T.left),B=Math.abs(R-T.right),j=Math.min(O,B);let K;const H=b/f*(g+1);if(T.isDash){const X=g-Math.abs(H);K=Math.sqrt(j*j+X*X)}else K=g-Math.sqrt(j*j+H*H);this.data[E+R]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const T=o[I],R=o[I+1];T.zeroLength?o.splice(I,1):R&&R.isDash===T.isDash&&(R.left=T.left,o.splice(I,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const g=this.width*this.nextRow;let b=0,E=o[b];for(let I=0;I<this.width;I++){I/E.right>1&&(E=o[++b]);const T=Math.abs(I-E.left),R=Math.abs(I-E.right),O=Math.min(T,R);this.data[g+I]=Math.max(0,Math.min(255,(E.isDash?O:-O)+128))}}addDash(o,u){const f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;let b=0;for(let I=0;I<o.length;I++)b+=o[I];if(0!==b){const I=this.width/b,T=this.getDashRanges(o,this.width,I);u?this.addRoundDash(T,I,f):this.addRegularDash(T)}const E={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:b};return this.nextRow+=g,this.dirty=!0,E}bind(o){const u=o.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Er{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=y.uniqueId();const f=this.workerPool.acquire(this.id);for(let g=0;g<f.length;g++){const b=new Er.Actor(f[g],u,this.id);b.name=`Worker ${g}`,this.actors.push(b)}}broadcast(o,u,f){y.asyncAll(this.actors,(g,b)=>{g.send(o,u,b)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Jr(m,o,u){const f=function(g,b){if(g)return u(g);if(b){const E=y.pick(y.extend(b,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(I=>I.id)),u(null,E)}};return m.url?y.getJSON(o.transformRequest(m.url,y.ResourceType.Source),f):y.exported.frame(()=>f(null,m))}Er.Actor=y.Actor;class tt{constructor(o,u,f){this.bounds=y.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),f=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*u),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*u),E=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=f&&o.x<b&&o.y>=g&&o.y<E}}class Gn extends y.Evented{constructor(o,u,f,g){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(u,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jr(this._options,this.map._requestManager,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new y.ErrorEvent(o)):u&&(y.extend(this,u),u.bounds&&(this.tileBounds=new tt(u.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}loadTile(o,u){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(f,y.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(E,I){return delete o.request,o.aborted?u(null):E&&404!==E.status?u(E):(I&&I.resourceTiming&&(o.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&o.setExpiryData(I),o.loadVectorData(I,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,o.actor&&"expired"!==o.state?"loading"===o.state?o.reloadCallback=u:o.request=o.actor.send("reloadTile",g,b.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",g,b.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class di extends y.Evented{constructor(o,u,f,g){super(),this.id=o,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},u),y.extend(this,y.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jr(this._options,this.map._requestManager,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new y.ErrorEvent(o)):u&&(y.extend(this,u),u.bounds&&(this.tileBounds=new tt(u.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=y.getImage(this.map._requestManager.transformRequest(f,y.ResourceType.Tile),(g,b,E)=>{if(delete o.request,o.aborted)o.state="unloaded",u(null);else if(g)o.state="errored",u(g);else if(b){this.map._refreshExpiredTiles&&o.setExpiryData(E);const I=this.map.painter.context,T=I.gl;o.texture=this.map.painter.getTileTexture(b.width),o.texture?o.texture.update(b,{useMipmap:!0}):(o.texture=new ln(I,b,T.RGBA,{useMipmap:!0}),o.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),o.state="loaded",y.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}}let Qr;class rn extends di{constructor(o,u,f,g){super(o,u,f,g),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,u){const f=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function g(b,E){b&&(o.state="errored",u(b)),E&&(o.dem=E,o.needsHillshadePrepare=!0,o.state="loaded",u(null))}o.request=y.getImage(this.map._requestManager.transformRequest(f,y.ResourceType.Tile),function(b,E){if(delete o.request,o.aborted)o.state="unloaded",u(null);else if(b)o.state="errored",u(b);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData(E),delete E.cacheControl,delete E.expires;const I=y.isImageBitmap(E)&&(null==Qr&&(Qr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Qr)?E:y.exported.getImageData(E,1),T={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:I,encoding:this.encoding};o.actor&&"expired"!==o.state||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",T,g.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const u=o.canonical,f=Math.pow(2,u.z),g=(u.x-1+f)%f,b=0===u.x?o.wrap-1:o.wrap,E=(u.x+1+f)%f,I=u.x+1===f?o.wrap+1:o.wrap,T={};return T[new y.OverscaledTileID(o.overscaledZ,b,u.z,g,u.y).key]={backfilled:!1},T[new y.OverscaledTileID(o.overscaledZ,I,u.z,E,u.y).key]={backfilled:!1},u.y>0&&(T[new y.OverscaledTileID(o.overscaledZ,b,u.z,g,u.y-1).key]={backfilled:!1},T[new y.OverscaledTileID(o.overscaledZ,o.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},T[new y.OverscaledTileID(o.overscaledZ,I,u.z,E,u.y-1).key]={backfilled:!1}),u.y+1<f&&(T[new y.OverscaledTileID(o.overscaledZ,b,u.z,g,u.y+1).key]={backfilled:!1},T[new y.OverscaledTileID(o.overscaledZ,o.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},T[new y.OverscaledTileID(o.overscaledZ,I,u.z,E,u.y+1).key]={backfilled:!1}),T}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class zo extends y.Evented{constructor(o,u,f,g){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=u.data,this._options=y.extend({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const b=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(void 0!==u.buffer?u.buffer:128)*b,tolerance:(void 0!==u.tolerance?u.tolerance:.375)*b,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:void 0!==u.clusterMaxZoom?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:y.EXTENT,radius:(u.clusterRadius||50)*b,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},u),this}getClusterChildren(o,u){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},u),this}getClusterLeaves(o,u,f,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:u,offset:f},g),this}_updateWorkerData(o){const u=y.extend({},this.workerOptions),f=this._data;"string"==typeof f?(u.request=this.map._requestManager.transformRequest(y.exported.resolveURL(f),y.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(f),this._pendingLoads++,this.fire(new y.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(g,b)=>{if(this._pendingLoads--,this._removed||b&&b.abandoned)return;let E=null;if(b&&b.resourceTiming&&b.resourceTiming[this.id]&&(E=b.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:u.source},null),g)return void this.fire(new y.ErrorEvent(g));const I={dataType:"source",sourceDataType:o};this._collectResourceTiming&&E&&E.length>0&&y.extend(I,{resourceTiming:E}),this.fire(new y.Event("data",I))})}loaded(){return 0===this._pendingLoads}loadTile(o,u){const f=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const g={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(f,g,(b,E)=>(delete o.request,o.unloadVectorData(),o.aborted?u(null):b?u(b):(o.loadVectorData(E,this.map.painter,"reloadTile"===f),u(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return y.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ns=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class po extends y.Evented{constructor(o,u,f,g){super(),this.id=o,this.dispatcher=f,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=u}load(o,u){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),(f,g)=>{this._loaded=!0,f?this.fire(new y.ErrorEvent(f)):g&&(this.image=g,o&&(this.coordinates=o),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const u=o.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(g){let b=1/0,E=1/0,I=-1/0,T=-1/0;for(const j of g)b=Math.min(b,j.x),E=Math.min(E,j.y),I=Math.max(I,j.x),T=Math.max(T,j.y);const R=Math.max(I-b,T-E),O=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),B=Math.pow(2,O);return new y.CanonicalTileID(O,Math.floor((b+I)/2*B),Math.floor((E+T)/2*B))}(u),this.minzoom=this.maxzoom=this.tileID.z;const f=u.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new y.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,ns.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ln(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const f in this.tiles){const g=this.tiles[f];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class No extends po{constructor(o,u,f,g){super(o,u,f,g),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const u of o.urls)this.urls.push(this.map._requestManager.transformRequest(u,y.ResourceType.Source).url);y.getVideo(this.urls,(u,f)=>{this._loaded=!0,u?this.fire(new y.ErrorEvent(u)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const u=this.video.seekable;o<u.start(0)||o>u.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,ns.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new ln(o,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const f in this.tiles){const g=this.tiles[f];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $r extends po{constructor(o,u,f,g){super(o,u,f,g),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const u=this.map.painter.context,f=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,ns.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ln(u,this.canvas,f.RGBA,{premultiply:!0});for(const g in this.tiles){const b=this.tiles[g];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const wi={vector:Gn,raster:di,"raster-dem":rn,geojson:zo,video:No,image:po,canvas:$r};function Qi(m,o){const u=y.create();return y.translate(u,u,[1,1,0]),y.scale(u,u,[.5*m.width,.5*m.height,1]),y.multiply(u,u,m.calculatePosMatrix(o.toUnwrapped()))}function wn(m,o,u,f,g,b){const E=function(B,j,K){if(B)for(const H of B){const X=j[H];if(X&&X.source===K&&"fill-extrusion"===X.type)return!0}else for(const H in j){const X=j[H];if(X.source===K&&"fill-extrusion"===X.type)return!0}return!1}(g&&g.layers,o,m.id),I=b.maxPitchScaleFactor(),T=m.tilesIn(f,I,E);T.sort(On);const R=[];for(const B of T)R.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,g,b,I,Qi(m.transform,B.tileID))});const O=function(B){const j={},K={};for(const H of B){const X=H.queryResults,oe=H.wrappedTileID,se=K[oe]=K[oe]||{};for(const ce in X){const J=X[ce],we=se[ce]=se[ce]||{},ge=j[ce]=j[ce]||[];for(const _e of J)we[_e.featureIndex]||(we[_e.featureIndex]=!0,ge.push(_e))}}return j}(R);for(const B in O)O[B].forEach(j=>{const K=j.feature,H=m.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=H});return O}function On(m,o){const u=m.tileID,f=o.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}class rl{constructor(o,u){this.tileID=o,this.uid=y.uniqueId(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const u=o+this.timeAdded;u<y.exported.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(o,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,b){const E={};if(!b)return E;for(const I of g){const T=I.layerIds.map(R=>b.getLayer(R)).filter(Boolean);if(0!==T.length){I.layers=T,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(R=>T.filter(O=>O.id===R)[0]));for(const R of T)E[R.id]=I}}return E}(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof y.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof y.SymbolBucket&&b.hasRTLText){this.hasRTLText=!0,y.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new y.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ln(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ln(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,f,g,b,E,I,T,R,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:O,transform:T,params:I,queryPadding:this.queryPadding*R},o,u,f):{}}querySourceFeatures(o,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),b=u?u.sourceLayer:"",E=g._geojsonTileLayer||g[b];if(!E)return;const I=y.createFilter(u&&u.filter),{z:T,x:R,y:O}=this.tileID.canonical,B={z:T,x:R,y:O};for(let j=0;j<E.length;j++){const K=E.feature(j);if(I.needGeometry){const oe=y.toEvaluationFeature(K,!0);if(!I.filter(new y.EvaluationParameters(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!I.filter(new y.EvaluationParameters(this.tileID.overscaledZ),K))continue;const H=f.getId(K,b),X=new y.GeoJSONFeature(K,T,R,O,H);X.tile=B,o.push(X)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const f=y.parseCacheControl(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{const b=this.expirationTime-u;b?this.expirationTime=f+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!u.style.hasLayer(g))continue;const b=this.buckets[g],E=b.layers[0].sourceLayer||"_geojsonTileLayer",I=f[E],T=o[E];if(!I||!T||0===Object.keys(T).length)continue;b.update(T,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=u&&u.style&&u.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=y.exported.now()+o}setDependencies(o,u){const f={};for(const g of u)f[g]=!0;this.dependencies[o]=f}hasDependency(o,u){for(const f of o){const g=this.dependencies[f];if(g)for(const b of u)if(g[b])return!0}return!1}}class Nt{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,f){const g=o.wrapped().key;void 0===this.data[g]&&(this.data[g]=[]);const b={value:u,timeout:void 0};if(void 0!==f&&(b.timeout=setTimeout(()=>{this.remove(o,b)},f)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const f=o.wrapped().key,g=void 0===u?0:this.data[f].indexOf(u),b=this.data[f][g];return this.data[f].splice(g,1),b.timeout&&clearTimeout(b.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(b.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const f in this.data)for(const g of this.data[f])o(g.value)||u.push(g);for(const f of u)this.remove(f.value.tileID,f)}}class Bs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,f){const g=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},y.extend(this.stateChanges[o][g],f),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==g&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][g]){this.deletedStates[o][g]={};for(const b in this.state[o][g])f[b]||(this.deletedStates[o][g][b]=null)}else for(const b in f)this.deletedStates[o]&&this.deletedStates[o][g]&&null===this.deletedStates[o][g][b]&&delete this.deletedStates[o][g][b]}removeFeatureState(o,u,f){if(null===this.deletedStates[o])return;const g=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&void 0!==u)null!==this.deletedStates[o][g]&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][f]=null);else if(void 0!==u)if(this.stateChanges[o]&&this.stateChanges[o][g])for(f in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][f]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,u){const f=String(u),g=y.extend({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][u];if(null===b)return{};for(const E in b)delete g[E]}return g}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),y.extend(this.state[g][E],this.stateChanges[g][E]),b[E]=this.state[g][E];f[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(null===this.deletedStates[g])for(const E in this.state[g])b[E]={},this.state[g][E]={};else for(const E in this.deletedStates[g]){if(null===this.deletedStates[g][E])this.state[g][E]={};else for(const I of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][I];b[E]=this.state[g][E]}f[g]=f[g]||{},y.extend(f[g],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const g in o)o[g].setFeatureState(f,u)}}class Cr extends y.Evented{constructor(o,u,f){super(),this.id=o,this.dispatcher=f,this.on("data",g=>{"source"===g.dataType&&"metadata"===g.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===g.dataType&&"content"===g.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(g,b,E,I){const T=new wi[b.type](g,b,E,I);if(T.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${T.id}`);return y.bindAll(["load","abort","unload","serialize","prepare"],T),T}(o,u,f,this),this._tiles={},this._cache=new Nt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bs}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const u=this._tiles[o];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new y.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(o),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(mo).map(o=>o.key)}getRenderableIds(o){const u=[];for(const f in this._tiles)this._isIdRenderable(f,o)&&u.push(this._tiles[f]);return o?u.sort((f,g)=>{const b=f.tileID,E=g.tileID,I=new y.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new y.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||T.y-I.y||T.x-I.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(mo).map(f=>f.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(o,"reloading")}}_reloadTile(o,u){const f=this._tiles[o];f&&("loading"!==f.state&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,o,u)))}_tileLoaded(o,u,f,g){if(g)return o.state="errored",void(404!==g.status?this._source.fire(new y.ErrorEvent(g,{tile:o})):this.update(this.transform));o.timeAdded=y.exported.now(),"expired"===f&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),"raster-dem"===this.getSource().type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new y.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const u=this.getRenderableIds();for(let g=0;g<u.length;g++){const b=u[g];if(o.neighboringTiles&&o.neighboringTiles[b]){const E=this.getTileByID(b);f(o,E),f(E,o)}}function f(g,b){g.needsHillshadePrepare=!0;let E=b.tileID.canonical.x-g.tileID.canonical.x;const I=b.tileID.canonical.y-g.tileID.canonical.y,T=Math.pow(2,g.tileID.canonical.z),R=b.tileID.key;0===E&&0===I||Math.abs(I)>1||(Math.abs(E)>1&&(1===Math.abs(E+T)?E+=T:1===Math.abs(E-T)&&(E-=T)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,E,I),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,f,g){for(const b in this._tiles){let E=this._tiles[b];if(g[b]||!E.hasData()||E.tileID.overscaledZ<=u||E.tileID.overscaledZ>f)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>u+1;){const R=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[R.key],E&&E.hasData()&&(I=R)}let T=I;for(;T.overscaledZ>u;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){g[I.key]=I;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=o.overscaledZ-1;f>=u;f--){const g=o.scaledTo(f),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const u=Math.ceil(o.width/this._source.tileSize)+1,f=Math.ceil(o.height/this._source.tileSize)+1,g=Math.floor(u*f*5),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(o){const u=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,u){const f={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),f[b.tileID.key]=b}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(o){if(this.transform=o,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?u=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new y.OverscaledTileID(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(u=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(u=u.filter(T=>this._source.hasTile(T)))):u=[];const f=o.coveringZoomLevel(this._source),g=Math.max(f-Cr.maxOverzooming,this._source.minzoom),b=Math.max(f+Cr.maxUnderzooming,this._source.minzoom),E=this._updateRetainedTiles(u,f);if(il(this._source.type)){const T={},R={},O=Object.keys(E);for(const B of O){const j=E[B],K=this._tiles[B];if(!K||K.fadeEndTime&&K.fadeEndTime<=y.exported.now())continue;const H=this.findLoadedParent(j,g);H&&(this._addTile(H.tileID),T[H.tileID.key]=H.tileID),R[B]=j}this._retainLoadedChildren(R,f,b,E);for(const B in T)E[B]||(this._coveredTiles[B]=!0,E[B]=T[B])}for(const T in E)this._tiles[T].clearFadeHold();const I=y.keysDifference(this._tiles,E);for(const T of I){const R=this._tiles[T];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,u){const f={},g={},b=Math.max(u-Cr.maxOverzooming,this._source.minzoom),E=Math.max(u+Cr.maxUnderzooming,this._source.minzoom),I={};for(const T of o){const R=this._addTile(T);f[T.key]=T,R.hasData()||u<this._source.maxzoom&&(I[T.key]=T)}this._retainLoadedChildren(I,u,E,f);for(const T of o){let R=this._tiles[T.key];if(R.hasData())continue;if(u+1>this._source.maxzoom){const B=T.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){f[B.key]=B;continue}}else{const B=T.children(this._source.maxzoom);if(f[B[0].key]&&f[B[1].key]&&f[B[2].key]&&f[B[3].key])continue}let O=R.wasRequested();for(let B=T.overscaledZ-1;B>=b;--B){const j=T.scaledTo(B);if(g[j.key]||(g[j.key]=!0,R=this.getTile(j),!R&&O&&(R=this._addTile(j)),R&&(f[j.key]=j,O=R.wasRequested(),R.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let f,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}u.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(b),f)break;g=b}for(const b of u)this._loadedParentTiles[b]=f}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const f=u;return u||(u=new rl(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))),u.uses++,this._tiles[o.key]=u,f||this._source.fire(new y.Event("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const f=u.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,u,f){const g=[],b=this.transform;if(!b)return g;const E=f?b.getCameraQueryGeometry(o):o,I=o.map(H=>b.pointCoordinate(H)),T=E.map(H=>b.pointCoordinate(H)),R=this.getIds();let O=1/0,B=1/0,j=-1/0,K=-1/0;for(const H of T)O=Math.min(O,H.x),B=Math.min(B,H.y),j=Math.max(j,H.x),K=Math.max(K,H.y);for(let H=0;H<R.length;H++){const X=this._tiles[R[H]];if(X.holdingForFade())continue;const oe=X.tileID,se=Math.pow(2,b.zoom-X.tileID.overscaledZ),ce=u*X.queryPadding*y.EXTENT/X.tileSize/se,J=[oe.getTilePoint(new y.MercatorCoordinate(O,B)),oe.getTilePoint(new y.MercatorCoordinate(j,K))];if(J[0].x-ce<y.EXTENT&&J[0].y-ce<y.EXTENT&&J[1].x+ce>=0&&J[1].y+ce>=0){const we=I.map(_e=>oe.getTilePoint(_e)),ge=T.map(_e=>oe.getTilePoint(_e));g.push({tile:X,tileID:oe,queryGeometry:we,cameraQueryGeometry:ge,scale:se})}}return g}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(f=>this._tiles[f].tileID);for(const f of u)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(il(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=y.exported.now())return!0}return!1}setFeatureState(o,u,f){this._state.updateState(o=o||"_geojsonTileLayer",u,f)}removeFeatureState(o,u,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,f)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,f){const g=this._tiles[o];g&&g.setDependencies(u,f)}reloadTilesForDependencies(o,u){for(const f in this._tiles)this._tiles[f].hasDependency(o,u)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(o,u))}}function mo(m,o){const u=Math.abs(2*m.wrap)-+(m.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||f-u||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function il(m){return"raster"===m||"image"===m||"video"===m}Cr.maxOverzooming=10,Cr.maxUnderzooming=3;const Us="mapboxgl_preloaded_worker_pool";class go{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<go.workerCount;)this.workers.push(new Worker(ka.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Us]}numActive(){return Object.keys(this.active).length}}const rc=Math.floor(y.exported.hardwareConcurrency/2);let Bo;function yo(){return Bo||(Bo=new go),Bo}function _o(m,o){const u={};for(const f in m)"ref"!==f&&(u[f]=m[f]);return y.refProperties.forEach(f=>{f in o&&(u[f]=o[f])}),u}function ol(m){m=m.slice();const o=Object.create(null);for(let u=0;u<m.length;u++)o[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=_o(m[u],o[m[u].ref]));return m}go.workerCount=Math.max(Math.min(rc,6),1);const Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vs(m,o,u){u.push({command:Wt.addSource,args:[m,o[m]]})}function vo(m,o,u){o.push({command:Wt.removeSource,args:[m]}),u[m]=!0}function $s(m,o,u,f){vo(m,u,f),Vs(m,o,u)}function js(m,o,u){let f;for(f in m[u])if(Object.prototype.hasOwnProperty.call(m[u],f)&&"data"!==f&&!Je(m[u][f],o[u][f]))return!1;for(f in o[u])if(Object.prototype.hasOwnProperty.call(o[u],f)&&"data"!==f&&!Je(m[u][f],o[u][f]))return!1;return!0}function xe(m,o,u,f,g,b){let E;for(E in o=o||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(Je(m[E],o[E])||u.push({command:b,args:[f,E,o[E],g]}));for(E in o)Object.prototype.hasOwnProperty.call(o,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(Je(m[E],o[E])||u.push({command:b,args:[f,E,o[E],g]}))}function Be(m){return m.id}function Hs(m,o){return m[o.id]=o,m}class Uo{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=y.clamp(o,0,1);let u=1,f=this._distances[u];const g=o*this.paddedLength+this.padding;for(;f<g&&u<this._distances.length;)f=this._distances[++u];const b=u-1,E=this._distances[b],I=f-E,T=I>0?(g-E)/I:0;return this.points[b].mult(1-T).add(this.points[u].mult(T))}}function Jt(m,o){let u=!0;return"always"===m||"never"!==m&&"never"!==o||(u=!1),u}class Di{constructor(o,u,f){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(u/f);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,f,g,b){this._forEachCell(u,f,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(o,u,f,g){this._forEachCell(u-g,f-g,u+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(f),this.circles.push(g)}_insertBoxCell(o,u,f,g,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,u,f,g,b,E){this.circleCells[b].push(E)}_query(o,u,f,g,b,E,I){if(f<0||o>this.width||g<0||u>this.height)return[];const T=[];if(o<=0&&u<=0&&this.width<=f&&this.height<=g){if(b)return[{key:null,x1:o,y1:u,x2:f,y2:g}];for(let R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],B=this.circles[3*R+1],j=this.circles[3*R+2];T.push({key:this.circleKeys[R],x1:O-j,y1:B-j,x2:O+j,y2:B+j})}}else this._forEachCell(o,u,f,g,this._queryCell,T,{hitTest:b,overlapMode:E,seenUids:{box:{},circle:{}}},I);return T}query(o,u,f,g){return this._query(o,u,f,g,!1,null)}hitTest(o,u,f,g,b,E){return this._query(o,u,f,g,!0,b,E).length>0}hitTestCircle(o,u,f,g,b){const E=o-f,I=o+f,T=u-f,R=u+f;if(I<0||E>this.width||R<0||T>this.height)return!1;const O=[];return this._forEachCell(E,T,I,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:g,circle:{x:o,y:u,radius:f},seenUids:{box:{},circle:{}}},b),O.length>0}_queryCell(o,u,f,g,b,E,I,T){const{seenUids:R,hitTest:O,overlapMode:B}=I,j=this.boxCells[b];if(null!==j){const H=this.bboxes;for(const X of j)if(!R.box[X]){R.box[X]=!0;const oe=4*X,se=this.boxKeys[X];if(o<=H[oe+2]&&u<=H[oe+3]&&f>=H[oe+0]&&g>=H[oe+1]&&(!T||T(se))&&(!O||!Jt(B,se.overlapMode))&&(E.push({key:se,x1:H[oe],y1:H[oe+1],x2:H[oe+2],y2:H[oe+3]}),O))return!0}}const K=this.circleCells[b];if(null!==K){const H=this.circles;for(const X of K)if(!R.circle[X]){R.circle[X]=!0;const oe=3*X,se=this.circleKeys[X];if(this._circleAndRectCollide(H[oe],H[oe+1],H[oe+2],o,u,f,g)&&(!T||T(se))&&(!O||!Jt(B,se.overlapMode))){const ce=H[oe],J=H[oe+1],we=H[oe+2];if(E.push({key:se,x1:ce-we,y1:J-we,x2:ce+we,y2:J+we}),O)return!0}}}return!1}_queryCellCircle(o,u,f,g,b,E,I,T){const{circle:R,seenUids:O,overlapMode:B}=I,j=this.boxCells[b];if(null!==j){const H=this.bboxes;for(const X of j)if(!O.box[X]){O.box[X]=!0;const oe=4*X,se=this.boxKeys[X];if(this._circleAndRectCollide(R.x,R.y,R.radius,H[oe+0],H[oe+1],H[oe+2],H[oe+3])&&(!T||T(se))&&!Jt(B,se.overlapMode))return E.push(!0),!0}}const K=this.circleCells[b];if(null!==K){const H=this.circles;for(const X of K)if(!O.circle[X]){O.circle[X]=!0;const oe=3*X,se=this.circleKeys[X];if(this._circlesCollide(H[oe],H[oe+1],H[oe+2],R.x,R.y,R.radius)&&(!T||T(se))&&!Jt(B,se.overlapMode))return E.push(!0),!0}}}_forEachCell(o,u,f,g,b,E,I,T){const R=this._convertToXCellCoord(o),O=this._convertToYCellCoord(u),B=this._convertToXCellCoord(f),j=this._convertToYCellCoord(g);for(let K=R;K<=B;K++)for(let H=O;H<=j;H++)if(b.call(this,o,u,f,g,this.xCellCount*H+K,E,I,T))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,f,g,b,E){const I=g-o,T=b-u,R=f+E;return R*R>I*I+T*T}_circleAndRectCollide(o,u,f,g,b,E,I){const T=(E-g)/2,R=Math.abs(o-(g+T));if(R>T+f)return!1;const O=(I-b)/2,B=Math.abs(u-(b+O));if(B>O+f)return!1;if(R<=T||B<=O)return!0;const j=R-T,K=B-O;return j*j+K*K<=f*f}}function ei(m,o,u,f,g){const b=y.create();return o?(y.scale(b,b,[1/g,1/g,1]),u||y.rotateZ(b,b,f.angle)):y.multiply(b,f.labelPlaneMatrix,m),b}function rs(m,o,u,f,g){if(o){const b=y.clone(m);return y.scale(b,b,[g,g,1]),u||y.rotateZ(b,b,-f.angle),b}return f.glCoordMatrix}function Tn(m,o){const u=[m.x,m.y,0,1];hn(u,u,o);const f=u[3];return{point:new y.pointGeometry(u[0]/f,u[1]/f),signedDistanceFromCamera:f}}function Le(m,o){return.5+m/o*.5}function Tt(m,o){const u=m[0]/m[3],f=m[1]/m[3];return u>=-o[0]&&u<=o[0]&&f>=-o[1]&&f<=o[1]}function Et(m,o,u,f,g,b,E,I,T){const R=f?m.textSizeData:m.iconSizeData,O=y.evaluateSizeForZoom(R,u.transform.zoom),B=[256/u.width*2+1,256/u.height*2+1],j=f?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;j.clear();const K=m.lineVertexArray,H=f?m.text.placedSymbolArray:m.icon.placedSymbolArray,X=u.transform.width/u.transform.height;let oe=!1;for(let se=0;se<H.length;se++){const ce=H.get(se);if(ce.hidden||ce.writingMode===y.WritingMode.vertical&&!oe){qn(ce.numGlyphs,j);continue}oe=!1;const J=[ce.anchorX,ce.anchorY,0,1];if(y.transformMat4(J,J,o),!Tt(J,B)){qn(ce.numGlyphs,j);continue}const we=Le(u.transform.cameraToCenterDistance,J[3]),ge=y.evaluateSizeForFeature(R,O,ce),_e=E?ge/we:ge*we,Ae=new y.pointGeometry(ce.anchorX,ce.anchorY),Re=Tn(Ae,g).point,be={},Ze=Ct(ce,_e,!1,I,o,g,b,m.glyphOffsetArray,K,j,Re,Ae,be,X,T);oe=Ze.useVertical,(Ze.notEnoughRoom||oe||Ze.needsFlipping&&Ct(ce,_e,!0,I,o,g,b,m.glyphOffsetArray,K,j,Re,Ae,be,X,T).notEnoughRoom)&&qn(ce.numGlyphs,j)}f?m.text.dynamicLayoutVertexBuffer.updateData(j):m.icon.dynamicLayoutVertexBuffer.updateData(j)}function ti(m,o,u,f,g,b,E,I,T,R,O,B){const j=I.glyphStartIndex+I.numGlyphs,K=I.lineStartIndex,H=I.lineStartIndex+I.lineLength,X=o.getoffsetX(I.glyphStartIndex),oe=o.getoffsetX(j-1),se=Ei(m*X,u,f,g,b,E,I.segment,K,H,T,R,O,B);if(!se)return null;const ce=Ei(m*oe,u,f,g,b,E,I.segment,K,H,T,R,O,B);return ce?{first:se,last:ce}:null}function eo(m,o,u,f){return m===y.WritingMode.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*f?{useVertical:!0}:(m===y.WritingMode.vertical?o.y<u.y:o.x>u.x)?{needsFlipping:!0}:null}function Ct(m,o,u,f,g,b,E,I,T,R,O,B,j,K,H){const X=o/24,oe=m.lineOffsetX*X,se=m.lineOffsetY*X;let ce;if(m.numGlyphs>1){const J=m.glyphStartIndex+m.numGlyphs,we=m.lineStartIndex,ge=m.lineStartIndex+m.lineLength,_e=ti(X,I,oe,se,u,O,B,m,T,b,j,H);if(!_e)return{notEnoughRoom:!0};const Ae=Tn(_e.first.point,E).point,Re=Tn(_e.last.point,E).point;if(f&&!u){const be=eo(m.writingMode,Ae,Re,K);if(be)return be}ce=[_e.first];for(let be=m.glyphStartIndex+1;be<J-1;be++)ce.push(Ei(X*I.getoffsetX(be),oe,se,u,O,B,m.segment,we,ge,T,b,j,H));ce.push(_e.last)}else{if(f&&!u){const we=Tn(B,g).point,ge=m.lineStartIndex+m.segment+1,_e=new y.pointGeometry(T.getx(ge),T.gety(ge)),Ae=Tn(_e,g),Re=Ae.signedDistanceFromCamera>0?Ae.point:Vo(B,_e,we,1,g),be=eo(m.writingMode,we,Re,K);if(be)return be}const J=Ei(X*I.getoffsetX(m.glyphStartIndex),oe,se,u,O,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,T,b,j,H);if(!J)return{notEnoughRoom:!0};ce=[J]}for(const J of ce)y.addDynamicAttributes(R,J.point,J.angle);return{}}function Vo(m,o,u,f,g){const b=Tn(m.add(m.sub(o)._unit()),g).point,E=u.sub(b);return u.add(E._mult(f/E.mag()))}function Ei(m,o,u,f,g,b,E,I,T,R,O,B,j){const K=f?m-o:m+o;let H=K>0?1:-1,X=0;f&&(H*=-1,X=Math.PI),H<0&&(X+=Math.PI);let oe=H>0?I+E:I+E+1,se=g,ce=g,J=0,we=0;const ge=Math.abs(K),_e=[];for(;J+we<=ge;){if(oe+=H,oe<I||oe>=T)return null;if(ce=se,_e.push(se),se=B[oe],void 0===se){const Ne=new y.pointGeometry(R.getx(oe),R.gety(oe)),he=Tn(Ne,O);if(he.signedDistanceFromCamera>0)se=B[oe]=he.point;else{const Ke=oe-H;se=Vo(0===J?b:new y.pointGeometry(R.getx(Ke),R.gety(Ke)),Ne,ce,ge-J+1,O)}}J+=we,we=ce.dist(se)}const Ae=(ge-J)/we,Re=se.sub(ce),be=Re.mult(Ae)._add(ce);be._add(Re._unit()._perp()._mult(u*H));const Ze=X+Math.atan2(se.y-ce.y,se.x-ce.x);return _e.push(be),{point:be,angle:j?Ze:0,path:_e}}const to=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qn(m,o){for(let u=0;u<m;u++){const f=o.length;o.resize(f+4),o.float32.set(to,3*f)}}function hn(m,o,u){const f=o[0],g=o[1];return m[0]=u[0]*f+u[4]*g+u[12],m[1]=u[1]*f+u[5]*g+u[13],m[3]=u[3]*f+u[7]*g+u[15],m}const Ci=100;class $o{constructor(o,u=new Di(o.width+200,o.height+200,25),f=new Di(o.width+200,o.height+200,25)){this.transform=o,this.grid=u,this.ignoredGrid=f,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ci,this.screenBottomBoundary=o.height+Ci,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200}placeCollisionBox(o,u,f,g,b){const E=this.projectAndGetPerspectiveRatio(g,o.anchorPointX,o.anchorPointY),I=f*E.perspectiveRatio,T=o.x1*I+E.point.x,R=o.y1*I+E.point.y,O=o.x2*I+E.point.x,B=o.y2*I+E.point.y;return!this.isInsideGrid(T,R,O,B)||"always"!==u&&this.grid.hitTest(T,R,O,B,u,b)?{box:[],offscreen:!1}:{box:[T,R,O,B],offscreen:this.isOffscreen(T,R,O,B)}}placeCollisionCircles(o,u,f,g,b,E,I,T,R,O,B,j,K){const H=[],X=new y.pointGeometry(u.anchorX,u.anchorY),oe=Tn(X,E),se=Le(this.transform.cameraToCenterDistance,oe.signedDistanceFromCamera),ce=(O?b/se:b*se)/y.ONE_EM,J=Tn(X,I).point,we=ti(ce,g,u.lineOffsetX*ce,u.lineOffsetY*ce,!1,J,X,u,f,I,{},!1);let ge=!1,_e=!1,Ae=!0;if(we){const Re=.5*j*se+K,be=new y.pointGeometry(-100,-100),Ze=new y.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ne=new Uo,he=we.first,Ke=we.last;let Pt=[];for(let pt=he.path.length-1;pt>=1;pt--)Pt.push(he.path[pt]);for(let pt=1;pt<Ke.path.length;pt++)Pt.push(Ke.path[pt]);const $t=2.5*Re;if(T){const pt=Pt.map(jt=>Tn(jt,T));Pt=pt.some(jt=>jt.signedDistanceFromCamera<=0)?[]:pt.map(jt=>jt.point)}let Bt=[];if(Pt.length>0){const pt=Pt[0].clone(),jt=Pt[0].clone();for(let Ht=1;Ht<Pt.length;Ht++)pt.x=Math.min(pt.x,Pt[Ht].x),pt.y=Math.min(pt.y,Pt[Ht].y),jt.x=Math.max(jt.x,Pt[Ht].x),jt.y=Math.max(jt.y,Pt[Ht].y);Bt=pt.x>=be.x&&jt.x<=Ze.x&&pt.y>=be.y&&jt.y<=Ze.y?[Pt]:jt.x<be.x||pt.x>Ze.x||jt.y<be.y||pt.y>Ze.y?[]:y.clipLine([Pt],be.x,be.y,Ze.x,Ze.y)}for(const pt of Bt){Ne.reset(pt,.25*Re);let jt=0;jt=Ne.length<=.5*Re?1:Math.ceil(Ne.paddedLength/$t)+1;for(let Ht=0;Ht<jt;Ht++){const cr=Ht/Math.max(jt-1,1),Gr=Ne.lerp(cr),ki=Gr.x+Ci,Hi=Gr.y+Ci;H.push(ki,Hi,Re,0);const wo=ki-Re,_n=Hi-Re,yr=ki+Re,Wo=Hi+Re;if(Ae=Ae&&this.isOffscreen(wo,_n,yr,Wo),_e=_e||this.isInsideGrid(wo,_n,yr,Wo),"always"!==o&&this.grid.hitTestCircle(ki,Hi,Re,o,B)&&(ge=!0,!R))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!R&&ge||!_e?[]:H,offscreen:Ae,collisionDetected:ge}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let f=1/0,g=1/0,b=-1/0,E=-1/0;for(const O of o){const B=new y.pointGeometry(O.x+Ci,O.y+Ci);f=Math.min(f,B.x),g=Math.min(g,B.y),b=Math.max(b,B.x),E=Math.max(E,B.y),u.push(B)}const I=this.grid.query(f,g,b,E).concat(this.ignoredGrid.query(f,g,b,E)),T={},R={};for(const O of I){const B=O.key;if(void 0===T[B.bucketInstanceId]&&(T[B.bucketInstanceId]={}),T[B.bucketInstanceId][B.featureIndex])continue;const j=[new y.pointGeometry(O.x1,O.y1),new y.pointGeometry(O.x2,O.y1),new y.pointGeometry(O.x2,O.y2),new y.pointGeometry(O.x1,O.y2)];y.polygonIntersectsPolygon(u,j)&&(T[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(o,u,f,g,b,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:E,overlapMode:u},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,f,g,b,E){const I=f?this.ignoredGrid:this.grid,T={bucketInstanceId:g,featureIndex:b,collisionGroupID:E,overlapMode:u};for(let R=0;R<o.length;R+=4)I.insertCircle(T,o[R],o[R+1],o[R+2])}projectAndGetPerspectiveRatio(o,u,f){const g=[u,f,0,1];return hn(g,g,o),{point:new y.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+Ci,(-g[1]/g[3]+1)/2*this.transform.height+Ci),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(o,u,f,g){return f<Ci||o>=this.screenRightBoundary||g<Ci||u>this.screenBottomBoundary}isInsideGrid(o,u,f,g){return f>=0&&o<this.gridRightBoundary&&g>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=y.identity([]);return y.translate(o,o,[-100,-100,0]),o}}function Jn(m,o,u){return o*(y.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}class Si{constructor(o,u,f,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):g&&f?1:0,this.placed=f}isHidden(){return 0===this.opacity&&!this.placed}}class Ii{constructor(o,u,f,g,b){this.text=new Si(o?o.text:null,u,f,b),this.icon=new Si(o?o.icon:null,u,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ni{constructor(o,u,f){this.text=o,this.icon=u,this.skipFade=f}}class Gs{constructor(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]}}class qs{constructor(o,u,f,g,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=b}}class G{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:f=>f.collisionGroupID===u}}return this.collisionGroups[o]}}function P(m,o,u,f,g){const{horizontalAlign:b,verticalAlign:E}=y.getAnchorAlignment(m),I=-(b-.5)*o,T=-(E-.5)*u,R=y.evaluateVariableOffset(m,f);return new y.pointGeometry(I+R[0]*g,T+R[1]*g)}function L(m,o,u,f,g,b){const{x1:E,x2:I,y1:T,y2:R,anchorPointX:O,anchorPointY:B}=m,j=new y.pointGeometry(o,u);return f&&j._rotate(g?b:-b),{x1:E+j.x,y1:T+j.y,x2:I+j.x,y2:R+j.y,anchorPointX:O,anchorPointY:B}}class ${constructor(o,u,f,g){this.transform=o.clone(),this.collisionIndex=new $o(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new G(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,f,g){const b=f.getBucket(u),E=f.latestFeatureIndex;if(!b||!E||u.id!==b.layerIds[0])return;const I=f.collisionBoxArray,T=b.layers[0].layout,R=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/y.EXTENT,B=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),j="map"===T.get("text-pitch-alignment"),K="map"===T.get("text-rotation-alignment"),H=Jn(f,1,this.transform.zoom),X=ei(B,j,K,this.transform,H);let oe=null;if(j){const ce=rs(B,j,K,this.transform,H);oe=y.multiply([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[b.bucketInstanceId]=new qs(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,f.tileID);const se={bucket:b,layout:T,posMatrix:B,textLabelPlaneMatrix:X,labelToScreenMatrix:oe,scale:R,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const ce of b.sortKeyRanges){const{sortKey:J,symbolInstanceStart:we,symbolInstanceEnd:ge}=ce;o.push({sortKey:J,symbolInstanceStart:we,symbolInstanceEnd:ge,parameters:se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:se})}attemptAnchorPlacement(o,u,f,g,b,E,I,T,R,O,B,j,K,H,X){const oe=[j.textOffset0,j.textOffset1],se=P(o,f,g,oe,b),ce=this.collisionIndex.placeCollisionBox(L(u,se.x,se.y,E,I,this.transform.angle),B,T,R,O.predicate);if((!X||0!==this.collisionIndex.placeCollisionBox(L(X,se.x,se.y,E,I,this.transform.angle),B,T,R,O.predicate).box.length)&&ce.box.length>0){let J;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(J=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:oe,width:f,height:g,anchor:o,textBoxScale:b,prevAnchor:J},this.markUsedJustification(K,o,j,H),K.allowVerticalPlacement&&(this.markUsedOrientation(K,H,j),this.placedOrientations[j.crossTileID]=H),{shift:se,placedGlyphBoxes:ce}}}placeLayerBucketPart(o,u,f){const{bucket:g,layout:b,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:T,textPixelRatio:R,holdingForFade:O,collisionBoxArray:B,partiallyEvaluatedTextSize:j,collisionGroup:K}=o.parameters,H=b.get("text-optional"),X=b.get("icon-optional"),oe=y.getOverlapMode(b,"text-overlap","text-allow-overlap"),se="always"===oe,ce=y.getOverlapMode(b,"icon-overlap","icon-allow-overlap"),J="always"===ce,we="map"===b.get("text-rotation-alignment"),ge="map"===b.get("text-pitch-alignment"),_e="none"!==b.get("icon-text-fit"),Ae="viewport-y"===b.get("symbol-z-order"),Re=se&&(J||!g.hasIconData()||X),be=J&&(se||!g.hasTextData()||H);!g.collisionArrays&&B&&g.deserializeCollisionBoxes(B);const Ze=(Ne,he)=>{if(u[Ne.crossTileID])return;if(O)return void(this.placements[Ne.crossTileID]=new ni(!1,!1,!1));let Ke=!1,Pt=!1,$t=!0,Bt=null,pt={box:null,offscreen:null},jt={box:null,offscreen:null},Ht=null,cr=null,Gr=null,ki=0,Hi=0,wo=0;he.textFeatureIndex?ki=he.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(ki=Ne.featureIndex),he.verticalTextFeatureIndex&&(Hi=he.verticalTextFeatureIndex);const _n=he.textBox;if(_n){const _r=on=>{let Kn=y.WritingMode.horizontal;if(g.allowVerticalPlacement&&!on&&this.prevPlacement){const qr=this.prevPlacement.placedOrientations[Ne.crossTileID];qr&&(this.placedOrientations[Ne.crossTileID]=qr,Kn=qr,this.markUsedOrientation(g,Kn,Ne))}return Kn},It=(on,Kn)=>{if(g.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&he.verticalTextBox){for(const qr of g.writingModes)if(qr===y.WritingMode.vertical?(pt=Kn(),jt=pt):pt=on(),pt&&pt.box&&pt.box.length)break}else pt=on()};if(b.get("text-variable-anchor")){let on=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ne.crossTileID]){const An=this.prevPlacement.variableOffsets[Ne.crossTileID];on.indexOf(An.anchor)>0&&(on=on.filter(Do=>Do!==An.anchor),on.unshift(An.anchor))}const Kn=(An,Do,Li)=>{const La=An.x2-An.x1,Fa=An.y2-An.y1,Dl=Ne.textBoxScale,Sc=_e&&"never"===ce?Do:null;let Eo={box:[],offscreen:!1};const Oa="never"!==oe?2*on.length:on.length;for(let Gi=0;Gi<Oa;++Gi){const ys=this.attemptAnchorPlacement(on[Gi%on.length],An,La,Fa,Dl,we,ge,R,E,K,Gi>=on.length?oe:"never",Ne,g,Li,Sc);if(ys&&(Eo=ys.placedGlyphBoxes,Eo&&Eo.box&&Eo.box.length)){Ke=!0,Bt=ys.shift;break}}return Eo};It(()=>Kn(_n,he.iconBox,y.WritingMode.horizontal),()=>{const An=he.verticalTextBox;return g.allowVerticalPlacement&&!(pt&&pt.box&&pt.box.length)&&Ne.numVerticalGlyphVertices>0&&An?Kn(An,he.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),pt&&(Ke=pt.box,$t=pt.offscreen);const qr=_r(pt&&pt.box);if(!Ke&&this.prevPlacement){const An=this.prevPlacement.variableOffsets[Ne.crossTileID];An&&(this.variableOffsets[Ne.crossTileID]=An,this.markUsedJustification(g,An.anchor,Ne,qr))}}else{const on=(Kn,qr)=>{const An=this.collisionIndex.placeCollisionBox(Kn,oe,R,E,K.predicate);return An&&An.box&&An.box.length&&(this.markUsedOrientation(g,qr,Ne),this.placedOrientations[Ne.crossTileID]=qr),An};It(()=>on(_n,y.WritingMode.horizontal),()=>{const Kn=he.verticalTextBox;return g.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Kn?on(Kn,y.WritingMode.vertical):{box:null,offscreen:null}}),_r(pt&&pt.box&&pt.box.length)}}if(Ht=pt,Ke=Ht&&Ht.box&&Ht.box.length>0,$t=Ht&&Ht.offscreen,Ne.useRuntimeCollisionCircles){const _r=g.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),It=y.evaluateSizeForFeature(g.textSizeData,j,_r),on=b.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(oe,_r,g.lineVertexArray,g.glyphOffsetArray,It,E,I,T,f,ge,K.predicate,Ne.collisionCircleDiameter,on),Ke=se||cr.circles.length>0&&!cr.collisionDetected,$t=$t&&cr.offscreen}if(he.iconFeatureIndex&&(wo=he.iconFeatureIndex),he.iconBox){const _r=It=>{const on=_e&&Bt?L(It,Bt.x,Bt.y,we,ge,this.transform.angle):It;return this.collisionIndex.placeCollisionBox(on,ce,R,E,K.predicate)};jt&&jt.box&&jt.box.length&&he.verticalIconBox?(Gr=_r(he.verticalIconBox),Pt=Gr.box.length>0):(Gr=_r(he.iconBox),Pt=Gr.box.length>0),$t=$t&&Gr.offscreen}const yr=H||0===Ne.numHorizontalGlyphVertices&&0===Ne.numVerticalGlyphVertices,Wo=X||0===Ne.numIconVertices;if(yr||Wo?Wo?yr||(Pt=Pt&&Ke):Ke=Pt&&Ke:Pt=Ke=Pt&&Ke,Ke&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,oe,b.get("text-ignore-placement"),g.bucketInstanceId,jt&&jt.box&&Hi?Hi:ki,K.ID),Pt&&Gr&&this.collisionIndex.insertCollisionBox(Gr.box,ce,b.get("icon-ignore-placement"),g.bucketInstanceId,wo,K.ID),cr&&(Ke&&this.collisionIndex.insertCollisionCircles(cr.circles,oe,b.get("text-ignore-placement"),g.bucketInstanceId,ki,K.ID),f)){const _r=g.bucketInstanceId;let It=this.collisionCircleArrays[_r];void 0===It&&(It=this.collisionCircleArrays[_r]=new Gs);for(let on=0;on<cr.circles.length;on+=4)It.circles.push(cr.circles[on+0]),It.circles.push(cr.circles[on+1]),It.circles.push(cr.circles[on+2]),It.circles.push(cr.collisionDetected?1:0)}this.placements[Ne.crossTileID]=new ni(Ke||Re,Pt||be,$t||g.justReloaded),u[Ne.crossTileID]=!0};if(Ae){const Ne=g.getSortedSymbolIndexes(this.transform.angle);for(let he=Ne.length-1;he>=0;--he){const Ke=Ne[he];Ze(g.symbolInstances.get(Ke),g.collisionArrays[Ke])}}else for(let Ne=o.symbolInstanceStart;Ne<o.symbolInstanceEnd;Ne++)Ze(g.symbolInstances.get(Ne),g.collisionArrays[Ne]);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[g.bucketInstanceId];y.invert(Ne.invProjMatrix,E),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(o,u,f,g){let b;b=g===y.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(u)];const E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=b>=0&&I!==b?0:f.crossTileID)}markUsedOrientation(o,u,f){const g=u===y.WritingMode.horizontal||u===y.WritingMode.horizontalOnly?u:0,b=u===y.WritingMode.vertical?u:0,E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const I of E)o.text.placedSymbolArray.get(I).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let f=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const g=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(const T in this.placements){const R=this.placements[T],O=b[T];O?(this.opacities[T]=new Ii(O,g,R.text,R.icon),f=f||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[T]=new Ii(null,g,R.text,R.icon,R.skipFade),f=f||R.text||R.icon)}for(const T in b){const R=b[T];if(!this.opacities[T]){const O=new Ii(R,g,!1,!1);O.isHidden()||(this.opacities[T]=O,f=f||R.text.placed||R.icon.placed)}}for(const T in E)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=E[T]);for(const T in I)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=I[T]);f?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const f={};for(const g of u){const b=g.getBucket(o);b&&g.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,f,g.collisionBoxArray)}}updateBucketOpacities(o,u,f){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const g=o.layers[0].layout,b=new Ii(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),I=g.get("icon-allow-overlap"),T=g.get("text-variable-anchor"),R="map"===g.get("text-rotation-alignment"),O="map"===g.get("text-pitch-alignment"),B="none"!==g.get("icon-text-fit"),j=new Ii(null,0,E&&(I||!o.hasIconData()||g.get("icon-optional")),I&&(E||!o.hasTextData()||g.get("text-optional")),!0);!o.collisionArrays&&f&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(f);const K=(H,X,oe)=>{for(let se=0;se<X/4;se++)H.opacityVertexArray.emplaceBack(oe)};for(let H=0;H<o.symbolInstances.length;H++){const X=o.symbolInstances.get(H),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:se,crossTileID:ce}=X;let J=this.opacities[ce];u[ce]?J=b:J||(J=j,this.opacities[ce]=J),u[ce]=!0;const we=X.numIconVertices>0,ge=this.placedOrientations[X.crossTileID],_e=ge===y.WritingMode.vertical,Ae=ge===y.WritingMode.horizontal||ge===y.WritingMode.horizontalOnly;if(oe>0||se>0){const Re=pe(J.text);K(o.text,oe,_e?We:Re),K(o.text,se,Ae?We:Re);const be=J.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(he=>{he>=0&&(o.text.placedSymbolArray.get(he).hidden=be||_e?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=be||Ae?1:0);const Ze=this.variableOffsets[X.crossTileID];Ze&&this.markUsedJustification(o,Ze.anchor,X,ge);const Ne=this.placedOrientations[X.crossTileID];Ne&&(this.markUsedJustification(o,"left",X,Ne),this.markUsedOrientation(o,Ne,X))}if(we){const Re=pe(J.icon),be=!(B&&X.verticalPlacedIconSymbolIndex&&_e);X.placedIconSymbolIndex>=0&&(K(o.icon,X.numIconVertices,be?Re:We),o.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=J.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(K(o.icon,X.numVerticalIconVertices,be?We:Re),o.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=J.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Re=o.collisionArrays[H];if(Re){let be=new y.pointGeometry(0,0);if(Re.textBox||Re.verticalTextBox){let Ne=!0;if(T){const he=this.variableOffsets[ce];he?(be=P(he.anchor,he.width,he.height,he.textOffset,he.textBoxScale),R&&be._rotate(O?this.transform.angle:-this.transform.angle)):Ne=!1}Re.textBox&&W(o.textCollisionBox.collisionVertexArray,J.text.placed,!Ne||_e,be.x,be.y),Re.verticalTextBox&&W(o.textCollisionBox.collisionVertexArray,J.text.placed,!Ne||Ae,be.x,be.y)}const Ze=Boolean(!Ae&&Re.verticalIconBox);Re.iconBox&&W(o.iconCollisionBox.collisionVertexArray,J.icon.placed,Ze,B?be.x:0,B?be.y:0),Re.verticalIconBox&&W(o.iconCollisionBox.collisionVertexArray,J.icon.placed,!Ze,B?be.x:0,B?be.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=H.invProjMatrix,o.placementViewportMatrix=H.viewportMatrix,o.collisionCircleArray=H.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const f=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*f>o}setStale(){this.stale=!0}}function W(m,o,u,f,g){m.emplaceBack(o?1:0,u?1:0,f||0,g||0),m.emplaceBack(o?1:0,u?1:0,f||0,g||0),m.emplaceBack(o?1:0,u?1:0,f||0,g||0),m.emplaceBack(o?1:0,u?1:0,f||0,g||0)}const Z=Math.pow(2,25),ie=Math.pow(2,24),Y=Math.pow(2,17),ne=Math.pow(2,16),re=Math.pow(2,9),ye=Math.pow(2,8),Se=Math.pow(2,1);function pe(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const o=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Z+o*ie+u*Y+o*ne+u*re+o*ye+u*Se+o}const We=0;class $e{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,f,g,b){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(E,g,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,T)=>I.sortKey-T.sortKey));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,b())return!0;return!1}}class Xe{constructor(o,u,f,g,b,E,I){this.placement=new $(o,b,E,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(o,u,f){const g=y.exported.now(),b=()=>{const E=y.exported.now()-g;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=u[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new $e(E)),this._inProgressLayer.continuePlacement(f[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const at=512/y.EXTENT/2;class Xt{constructor(o,u,f){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let g=0;g<u.length;g++){const b=u.get(g),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,u){const f=at/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*y.EXTENT+o.anchorX)*f),y:Math.floor((u.canonical.y*y.EXTENT+o.anchorY)*f)}}findMatches(o,u,f){const g=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const E=o.get(b);if(E.crossTileID)continue;const I=this.indexedSymbolInstances[E.key];if(!I)continue;const T=this.getScaledCoordinates(E,u);for(const R of I)if(Math.abs(R.coord.x-T.x)<=g&&Math.abs(R.coord.y-T.y)<=g&&!f[R.crossTileID]){f[R.crossTileID]=!0,E.crossTileID=R.crossTileID;break}}}}class Lt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const f in this.indexes){const g=this.indexes[f],b={};for(const E in g){const I=g[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),b[I.tileID.key]=I}this.indexes[f]=b}this.lng=o}addBucket(o,u,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const g=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const I in E){const T=E[I];T.tileID.isChildOf(o)&&T.findMatches(u.symbolInstances,o,g)}else{const I=E[o.scaledTo(Number(b)).key];I&&I.findMatches(u.symbolInstances,o,g)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=f.generate(),g[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Xt(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const f in u.indexedSymbolInstances)for(const g of u.indexedSymbolInstances[f])delete this.usedCrossTileIDs[o][g.crossTileID]}removeStaleBuckets(o){let u=!1;for(const f in this.indexes){const g=this.indexes[f];for(const b in g)o[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[b]),delete g[b],u=!0)}return u}}class bt{constructor(){this.layerIndexes={},this.crossTileIDs=new Lt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,f){let g=this.layerIndexes[o.id];void 0===g&&(g=this.layerIndexes[o.id]=new Mt);let b=!1;const E={};g.handleWrapJump(f);for(const I of u){const T=I.getBucket(o);T&&o.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(I.tileID,T,this.crossTileIDs)&&(b=!0),E[T.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(o){const u={};o.forEach(f=>{u[f]=!0});for(const f in this.layerIndexes)u[f]||delete this.layerIndexes[f]}}const vt=(m,o)=>y.emitValidationErrors(m,o&&o.filter(u=>"source.canvas"!==u.identifier)),Wn=y.pick(Wt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zn=y.pick(Wt,["setCenter","setZoom","setBearing","setPitch"]),fr=function(){const m={},o=y.spec.$version;for(const u in y.spec.$root){const f=y.spec.$root[u];if(f.required){let g=null;g="version"===u?o:"array"===f.type?[]:{},null!=g&&(m[u]=g)}}return m}();class Sr extends y.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new Er(yo(),this),this.imageManager=new Vn,this.imageManager.setEventedParent(this),this.glyphManager=new In(o._requestManager,u.localIdeographFontFamily),this.lineAtlas=new Yr(256,512),this.crossTileSymbolIndex=new bt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());const f=this;this._rtlTextPluginCallback=Sr.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,E)=>{if(y.triggerPluginCompletionEvent(b),E&&E.every(I=>I))for(const I in f.sourceCaches)f.sourceCaches[I].reload()})}),this.on("data",g=>{if("source"!==g.dataType||"metadata"!==g.sourceDataType)return;const b=this.sourceCaches[g.sourceId];if(!b)return;const E=b.getSource();if(E&&E.vectorLayerIds)for(const I in this._layers){const T=this._layers[I];T.source===E.id&&this._validateLayer(T)}})}loadURL(o,u={}){this.fire(new y.Event("dataloading",{dataType:"style"}));const f="boolean"!=typeof u.validate||u.validate,g=this.map._requestManager.transformRequest(o,y.ResourceType.Style);this._request=y.getJSON(g,(b,E)=>{this._request=null,b?this.fire(new y.ErrorEvent(b)):E&&this._load(E,f)})}loadJSON(o,u={}){this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.exported.frame(()=>{this._request=null,this._load(o,!1!==u.validate)})}loadEmpty(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(fr,!1)}_load(o,u){if(u&&vt(this,y.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const g in o.sources)this.addSource(g,o.sources[g],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const f=ol(this.stylesheet.layers);this._order=f.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of f)g=y.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Dr(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(u,f,g,b){let E,I,T;const R=g>1?"@2x":"";let O=y.getJSON(f.transformRequest(f.normalizeSpriteURL(u,R,".json"),y.ResourceType.SpriteJSON),(K,H)=>{O=null,T||(T=K,E=H,j())}),B=y.getImage(f.transformRequest(f.normalizeSpriteURL(u,R,".png"),y.ResourceType.SpriteImage),(K,H)=>{B=null,T||(T=K,I=H,j())});function j(){if(T)b(T);else if(E&&I){const K=y.exported.getImageData(I),H={};for(const X in E){const{width:oe,height:se,x:ce,y:J,sdf:we,pixelRatio:ge,stretchX:_e,stretchY:Ae,content:Re}=E[X],be=new y.RGBAImage({width:oe,height:se});y.RGBAImage.copy(K,be,{x:ce,y:J},{x:0,y:0},{width:oe,height:se}),H[X]={data:be,pixelRatio:ge,sdf:we,stretchX:_e,stretchY:Ae,content:Re}}b(null,H)}}return{cancel(){O&&(O.cancel(),O=null),B&&(B.cancel(),B=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(u,f)=>{if(this._spriteRequest=null,u)this.fire(new y.ErrorEvent(u));else if(f)for(const g in f)this.imageManager.addImage(g,f[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.sourceCaches[o.source];if(!u)return;const f=o.sourceLayer;if(!f)return;const g=u.getSource();("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(f))&&this.fire(new y.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const f of o){const g=this._layers[f];"custom"!==g.type&&u.push(g.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const E in this._updatedSources){const I=this._updatedSources[E];"reload"===I?this._reloadSource(E):"clear"===I&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];f[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in f){const b=this.sourceCaches[g];f[g]!==b.used&&b.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(o),this.z=o.zoom,u&&this.fire(new y.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),vt(this,y.validateStyle(o)))return!1;(o=y.clone$1(o)).layers=ol(o.layers);const u=function(g,b){if(!g)return[{command:Wt.setStyle,args:[b]}];let E=[];try{if(!Je(g.version,b.version))return[{command:Wt.setStyle,args:[b]}];Je(g.center,b.center)||E.push({command:Wt.setCenter,args:[b.center]}),Je(g.zoom,b.zoom)||E.push({command:Wt.setZoom,args:[b.zoom]}),Je(g.bearing,b.bearing)||E.push({command:Wt.setBearing,args:[b.bearing]}),Je(g.pitch,b.pitch)||E.push({command:Wt.setPitch,args:[b.pitch]}),Je(g.sprite,b.sprite)||E.push({command:Wt.setSprite,args:[b.sprite]}),Je(g.glyphs,b.glyphs)||E.push({command:Wt.setGlyphs,args:[b.glyphs]}),Je(g.transition,b.transition)||E.push({command:Wt.setTransition,args:[b.transition]}),Je(g.light,b.light)||E.push({command:Wt.setLight,args:[b.light]});const I={},T=[];!function(O,B,j,K){let H;for(H in B=B||{},O=O||{})Object.prototype.hasOwnProperty.call(O,H)&&(Object.prototype.hasOwnProperty.call(B,H)||vo(H,j,K));for(H in B)Object.prototype.hasOwnProperty.call(B,H)&&(Object.prototype.hasOwnProperty.call(O,H)?Je(O[H],B[H])||("geojson"===O[H].type&&"geojson"===B[H].type&&js(O,B,H)?j.push({command:Wt.setGeoJSONSourceData,args:[H,B[H].data]}):$s(H,B,j,K)):Vs(H,B,j))}(g.sources,b.sources,T,I);const R=[];g.layers&&g.layers.forEach(O=>{I[O.source]?E.push({command:Wt.removeLayer,args:[O.id]}):R.push(O)}),E=E.concat(T),function(O,B,j){B=B||[];const K=(O=O||[]).map(Be),H=B.map(Be),X=O.reduce(Hs,{}),oe=B.reduce(Hs,{}),se=K.slice(),ce=Object.create(null);let J,we,ge,_e,Ae,Re,be;for(J=0,we=0;J<K.length;J++)ge=K[J],Object.prototype.hasOwnProperty.call(oe,ge)?we++:(j.push({command:Wt.removeLayer,args:[ge]}),se.splice(se.indexOf(ge,we),1));for(J=0,we=0;J<H.length;J++)ge=H[H.length-1-J],se[se.length-1-J]!==ge&&(Object.prototype.hasOwnProperty.call(X,ge)?(j.push({command:Wt.removeLayer,args:[ge]}),se.splice(se.lastIndexOf(ge,se.length-we),1)):we++,Re=se[se.length-J],j.push({command:Wt.addLayer,args:[oe[ge],Re]}),se.splice(se.length-J,0,ge),ce[ge]=!0);for(J=0;J<H.length;J++)if(ge=H[J],_e=X[ge],Ae=oe[ge],!ce[ge]&&!Je(_e,Ae))if(Je(_e.source,Ae.source)&&Je(_e["source-layer"],Ae["source-layer"])&&Je(_e.type,Ae.type)){for(be in xe(_e.layout,Ae.layout,j,ge,null,Wt.setLayoutProperty),xe(_e.paint,Ae.paint,j,ge,null,Wt.setPaintProperty),Je(_e.filter,Ae.filter)||j.push({command:Wt.setFilter,args:[ge,Ae.filter]}),Je(_e.minzoom,Ae.minzoom)&&Je(_e.maxzoom,Ae.maxzoom)||j.push({command:Wt.setLayerZoomRange,args:[ge,Ae.minzoom,Ae.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,be)&&"layout"!==be&&"paint"!==be&&"filter"!==be&&"metadata"!==be&&"minzoom"!==be&&"maxzoom"!==be&&(0===be.indexOf("paint.")?xe(_e[be],Ae[be],j,ge,be.slice(6),Wt.setPaintProperty):Je(_e[be],Ae[be])||j.push({command:Wt.setLayerProperty,args:[ge,be,Ae[be]]}));for(be in Ae)Object.prototype.hasOwnProperty.call(Ae,be)&&!Object.prototype.hasOwnProperty.call(_e,be)&&"layout"!==be&&"paint"!==be&&"filter"!==be&&"metadata"!==be&&"minzoom"!==be&&"maxzoom"!==be&&(0===be.indexOf("paint.")?xe(_e[be],Ae[be],j,ge,be.slice(6),Wt.setPaintProperty):Je(_e[be],Ae[be])||j.push({command:Wt.setLayerProperty,args:[ge,be,Ae[be]]}))}else j.push({command:Wt.removeLayer,args:[ge]}),Re=se[se.lastIndexOf(ge)+1],j.push({command:Wt.addLayer,args:[Ae,Re]})}(R,b.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:Wt.setStyle,args:[b]}]}return E}(this.serialize(),o).filter(g=>!(g.command in zn));if(0===u.length)return!1;const f=u.filter(g=>!(g.command in Wn));if(f.length>0)throw new Error(`Unimplemented: ${f.map(g=>g.command).join(", ")}.`);return u.forEach(g=>{"setTransition"!==g.command&&this[g.command].apply(this,g.args)}),this.stylesheet=o,!0}addImage(o,u){if(this.getImage(o))return this.fire(new y.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new y.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,u,f={}){if(this._checkLoaded(),void 0!==this.sourceCaches[o])throw new Error(`Source "${o}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(y.validateStyle.source,`sources.${o}`,u,null,f))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const g=this.sourceCaches[o]=new Cr(o,u,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:g.serialize(),sourceId:o})),g.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===o)return this.fire(new y.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${f}" is using it.`)));const u=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],u.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){this._checkLoaded(),this.sourceCaches[o].getSource().setData(u),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,u,f={}){this._checkLoaded();const g=o.id;if(this.getLayer(g))return void this.fire(new y.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let b;if("custom"===o.type){if(vt(this,y.validateCustomStyleLayer(o)))return;b=y.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(g,o.source),o=y.clone$1(o),o=y.extend(o,{source:g})),this._validate(y.validateStyle.layer,`layers.${g}`,o,{arrayIndex:-1},f))return;b=y.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[b.id]=b.serialize()}const E=u?this._order.indexOf(u):this._order.length;if(u&&-1===E)this.fire(new y.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${u}".`)));else{if(this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&"custom"!==b.type){const I=this._removedLayers[g];delete this._removedLayers[g],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new y.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const f=this._order.indexOf(o);this._order.splice(f,1);const g=u?this._order.indexOf(u):this._order.length;u&&-1===g?this.fire(new y.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${u}".`))):(this._order.splice(g,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new y.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));u.setEventedParent(null);const f=this._order.indexOf(o);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,u,f){this._checkLoaded();const g=this.getLayer(o);g?g.minzoom===u&&g.maxzoom===f||(null!=u&&(g.minzoom=u),null!=f&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new y.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,u,f={}){this._checkLoaded();const g=this.getLayer(o);if(g){if(!Je(g.filter,u))return null==u?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(y.validateStyle.filter,`layers.${g.id}.filter`,u,null,f)||(g.filter=y.clone$1(u),this._updateLayer(g)))}else this.fire(new y.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return y.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,u,f,g={}){this._checkLoaded();const b=this.getLayer(o);b?Je(b.getLayoutProperty(u),f)||(b.setLayoutProperty(u,f,g),this._updateLayer(b)):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,u){const f=this.getLayer(o);if(f)return f.getLayoutProperty(u);this.fire(new y.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,u,f,g={}){this._checkLoaded();const b=this.getLayer(o);b?Je(b.getPaintProperty(u),f)||(b.setPaintProperty(u,f,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const f=o.source,g=o.sourceLayer,b=this.sourceCaches[f];if(void 0===b)return void this.fire(new y.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const E=b.getSource().type;"geojson"===E&&g?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==E||g?(void 0===o.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,o.id,u)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,u){this._checkLoaded();const f=o.source,g=this.sourceCaches[f];if(void 0===g)return void this.fire(new y.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const b=g.getSource().type,E="vector"===b?o.sourceLayer:void 0;"vector"!==b||E?u&&"string"!=typeof o.id&&"number"!=typeof o.id?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(E,o.id,u):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const u=o.source,f=o.sourceLayer,g=this.sourceCaches[u];if(void 0!==g)return"vector"!==g.getSource().type||f?(void 0===o.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,o.id)):void this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new y.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>void 0!==o)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&"raster"!==this.sourceCaches[o.source].getSource().type&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const u=E=>"fill-extrusion"===this._layers[E].type,f={},g=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(u(I)){f[I]=E;for(const T of o){const R=T[I];if(R)for(const O of R)g.push(O)}}}g.sort((E,I)=>I.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(u(I))for(let T=g.length-1;T>=0;T--){const R=g[T].feature;if(f[R.layer.id]<E)break;b.push(R),g.pop()}else for(const T of o){const R=T[I];if(R)for(const O of R)b.push(O.feature)}}return b}queryRenderedFeatures(o,u,f){u&&u.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const g={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of u.layers){const I=this._layers[E];if(!I)return this.fire(new y.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];g[I.source]=!0}}const b=[];u.availableImages=this._availableImages;for(const E in this.sourceCaches)u.layers&&!g[E]||b.push(wn(this.sourceCaches[E],this._layers,this._serializedLayers,o,u,f));return this.placement&&b.push(function(E,I,T,R,O,B,j){const K={},H=B.queryRenderedSymbols(R),X=[];for(const oe of Object.keys(H).map(Number))X.push(j[oe]);X.sort(On);for(const oe of X){const se=oe.featureIndex.lookupSymbolFeatures(H[oe.bucketInstanceId],I,oe.bucketIndex,oe.sourceLayerIndex,O.filter,O.layers,O.availableImages,E);for(const ce in se){const J=K[ce]=K[ce]||[],we=se[ce];we.sort((ge,_e)=>{const Ae=oe.featureSortOrder;if(Ae){const Re=Ae.indexOf(ge.featureIndex);return Ae.indexOf(_e.featureIndex)-Re}return _e.featureIndex-ge.featureIndex});for(const ge of we)J.push(ge)}}for(const oe in K)K[oe].forEach(se=>{const ce=se.feature,J=T[E[oe].source].getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=J});return K}(this._layers,this._serializedLayers,this.sourceCaches,o,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const f=this.sourceCaches[o];return f?function(g,b){const E=g.getRenderableIds().map(R=>g.getTileByID(R)),I=[],T={};for(let R=0;R<E.length;R++){const O=E[R],B=O.tileID.canonical.key;T[B]||(T[B]=!0,O.querySourceFeatures(I,b))}return I}(f,u):[]}addSourceType(o,u,f){return Sr.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(Sr.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const E in o)if(!Je(o[E],f[E])){g=!0;break}if(!g)return;const b={now:y.exported.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(b)}_validate(o,u,f,g,b={}){return(!b||!1!==b.validate)&&vt(this,o.call(y.validateStyle,y.extend({key:u,style:this.serialize(),value:f,styleSpec:y.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const u in this.sourceCaches)this.sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,u,f,g,b=!1){let E=!1,I=!1;const T={};for(const R of this._order){const O=this._layers[R];if("symbol"!==O.type)continue;if(!T[O.source]){const j=this.sourceCaches[O.source];T[O.source]=j.getRenderableIds(!0).map(K=>j.getTileByID(K)).sort((K,H)=>H.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(H.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(O,T[O.source],o.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||0===f)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.exported.now(),o.zoom))&&(this.pauseablePlacement=new Xe(o,this._order,b,u,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.exported.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const R of this._order){const O=this._layers[R];"symbol"===O.type&&this.placement.updateLayerOpacities(O,T[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,f){this.imageManager.getImages(u.icons,f),this._updateTilesForChangedImages();const g=this.sourceCaches[u.source];g&&g.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(o,u,f){this.glyphManager.getGlyphs(u.stacks,f)}getResource(o,u,f){return y.makeRequest(u,f)}}Sr.getSourceType=function(m){return wi[m]},Sr.setSourceType=function(m,o){wi[m]=o},Sr.registerForPluginStateChange=y.registerForPluginStateChange;var Zn=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),ic={prelude:gn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),background:gn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:gn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:gn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:gn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:gn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:gn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:gn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:gn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:gn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:gn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:gn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:gn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:gn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:gn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:gn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:gn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:gn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:gn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:gn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")};function gn(m,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=o.match(/attribute ([\w]+) ([\w]+)/g),g=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(g):g,I={};return{fragmentSource:m=m.replace(u,(T,R,O,B,j)=>(I[j]=!0,"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nvarying ${O} ${B} ${j};\n#else\nuniform ${O} ${B} u_${j};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${j}\n    ${O} ${B} ${j} = u_${j};\n#endif\n`)),vertexSource:o=o.replace(u,(T,R,O,B,j)=>{const K="float"===B?"vec2":"vec4",H=j.match(/color/)?"color":K;return I[j]?"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${O} ${K} a_${j};\nvarying ${O} ${B} ${j};\n#else\nuniform ${O} ${B} u_${j};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${O} ${B} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${H}(a_${j}, u_${j}_t);\n#else\n    ${O} ${B} ${j} = u_${j};\n#endif\n`:"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${O} ${K} a_${j};\n#else\nuniform ${O} ${B} u_${j};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${O} ${B} ${j} = a_${j};\n#else\n    ${O} ${B} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${O} ${B} ${j} = unpack_mix_${H}(a_${j}, u_${j}_t);\n#else\n    ${O} ${B} ${j} = u_${j};\n#endif\n`}),staticAttributes:f,staticUniforms:E}}class oc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,f,g,b,E,I,T){this.context=o;let R=this.boundPaintVertexBuffers.length!==g.length;for(let O=0;!R&&O<g.length;O++)this.boundPaintVertexBuffers[O]!==g[O]&&(R=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===f&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===T?(o.bindVertexArrayOES.set(this.vao),I&&I.bind(),b&&b.dynamicDraw&&b.bind(),T&&T.bind()):this.freshBind(u,f,g,b,E,I,T)}freshBind(o,u,f,g,b,E,I){let T;const R=o.numAttributes,O=this.context,B=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I;else{T=O.currentNumAttributes||0;for(let j=R;j<T;j++)B.disableVertexAttribArray(j)}u.enableAttributes(B,o);for(const j of f)j.enableAttributes(B,o);E&&E.enableAttributes(B,o),I&&I.enableAttributes(B,o),u.bind(),u.setVertexAttribPointers(B,o,b);for(const j of f)j.bind(),j.setVertexAttribPointers(B,o,b);E&&(E.bind(),E.setVertexAttribPointers(B,o,b)),g&&g.bind(),I&&(I.bind(),I.setVertexAttribPointers(B,o,b)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function dn(m){const o=[];for(let u=0;u<m.length;u++){if(null===m[u])continue;const f=m[u].split(" ");o.push(f.pop())}return o}class sc{constructor(o,u,f,g,b,E){const I=o.gl;this.program=I.createProgram();const T=dn(f.staticAttributes),R=g?g.getBinderAttributes():[],O=T.concat(R),B=f.staticUniforms?dn(f.staticUniforms):[],j=g?g.getBinderUniforms():[],K=B.concat(j),H=[];for(const ge of K)H.indexOf(ge)<0&&H.push(ge);const X=g?g.defines():[];E&&X.push("#define OVERDRAW_INSPECTOR;");const oe=X.concat(ic.prelude.fragmentSource,f.fragmentSource).join("\n"),se=X.concat(ic.prelude.vertexSource,f.vertexSource).join("\n"),ce=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ce,oe),I.compileShader(ce),I.attachShader(this.program,ce);const J=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(J,se),I.compileShader(J),I.attachShader(this.program,J),this.attributes={};const we={};this.numAttributes=O.length;for(let ge=0;ge<this.numAttributes;ge++)O[ge]&&(I.bindAttribLocation(this.program,ge,O[ge]),this.attributes[O[ge]]=ge);I.linkProgram(this.program),I.deleteShader(J),I.deleteShader(ce);for(let ge=0;ge<H.length;ge++){const _e=H[ge];if(_e&&!we[_e]){const Ae=I.getUniformLocation(this.program,_e);Ae&&(we[_e]=Ae)}}this.fixedUniforms=b(o,we),this.binderUniforms=g?g.getUniforms(o,we):[]}draw(o,u,f,g,b,E,I,T,R,O,B,j,K,H,X,oe){const se=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(f),o.setStencilMode(g),o.setColorMode(b),o.setCullFace(E);for(const J in this.fixedUniforms)this.fixedUniforms[J].set(I[J]);H&&H.setUniforms(o,this.binderUniforms,j,{zoom:K});const ce={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[u];for(const J of B.get()){const we=J.vaos||(J.vaos={});(we[T]||(we[T]=new oc)).bind(o,this,R,H?H.getPaintVertexBuffers():[],O,J.vertexOffset,X,oe),se.drawElements(u,J.primitiveLength*ce,se.UNSIGNED_SHORT,J.primitiveOffset*ce*2)}}}function yn(m,o,u){const f=1/Jn(u,1,o.transform.tileZoom),g=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/g,E=b*(u.tileID.canonical.x+u.tileID.wrap*g),I=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const sl=(m,o,u,f)=>{const g=o.style.light,b=g.properties.get("position"),E=[b.x,b.y,b.z],I=(R=new y.ARRAY_TYPE(9),y.ARRAY_TYPE!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[5]=0,R[6]=0,R[7]=0),R[0]=1,R[4]=1,R[8]=1,R);var R;"viewport"===g.properties.get("anchor")&&function(R,O){var B=Math.sin(O),j=Math.cos(O);R[0]=j,R[1]=B,R[2]=0,R[3]=-B,R[4]=j,R[5]=0,R[6]=0,R[7]=0,R[8]=1}(I,-o.transform.angle),function(R,O,B){var j=O[0],K=O[1],H=O[2];R[0]=j*B[0]+K*B[3]+H*B[6],R[1]=j*B[1]+K*B[4]+H*B[7],R[2]=j*B[2]+K*B[5]+H*B[8]}(E,E,I);const T=g.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+u,u_opacity:f}},ac=(m,o,u,f,g,b,E)=>y.extend(sl(m,o,u,f),yn(b,o,E),{u_height_factor:-Math.pow(2,g.overscaledZ)/E.tileSize/8}),xa=m=>({u_matrix:m}),ut=(m,o,u,f)=>y.extend(xa(m),yn(u,o,f)),al=(m,o)=>({u_matrix:m,u_world:o}),ll=(m,o,u,f,g)=>y.extend(ut(m,o,u,f),{u_world:g}),Ws=(m,o,u,f)=>{const g=m.transform;let b,E;if("map"===f.paint.get("circle-pitch-alignment")){const I=Jn(u,1,g.zoom);b=!0,E=[I,I]}else b=!1,E=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+("map"===f.paint.get("circle-pitch-scale")),u_matrix:m.translatePosMatrix(o.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},ba=(m,o,u)=>{const f=Jn(u,1,o.zoom),g=Math.pow(2,o.zoom-u.tileID.overscaledZ),b=u.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[o.pixelsToGLUnits[0]/(f*g),o.pixelsToGLUnits[1]/(f*g)],u_overscale_factor:b}},ze=(m,o,u=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:u}),jo=m=>({u_matrix:m}),gt=(m,o,u,f)=>({u_matrix:m,u_extrude_scale:Jn(o,1,u),u_intensity:f});function tn(m,o){const u=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new y.MercatorCoordinate(0,f/u).toLngLat().lat,new y.MercatorCoordinate(0,(f+1)/u).toLngLat().lat]}const wa=(m,o,u)=>{const f=m.transform;return{u_matrix:hu(m,o,u),u_ratio:1/Jn(o,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},lc=(m,o,u,f)=>y.extend(wa(m,o,u),{u_image:0,u_image_height:f}),Da=(m,o,u,f)=>{const g=m.transform,b=Ir(o,g);return{u_matrix:hu(m,o,u),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Jn(o,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[b,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Nn=(m,o,u,f,g)=>{const b=m.lineAtlas,E=Ir(o,m.transform),I="round"===u.layout.get("line-cap"),T=b.getDash(f.from,I),R=b.getDash(f.to,I),O=T.width*g.fromScale,B=R.width*g.toScale;return y.extend(wa(m,o,u),{u_patternscale_a:[E/O,-T.height/2],u_patternscale_b:[E/B,-R.height/2],u_sdfgamma:b.width/(256*Math.min(O,B)*m.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:R.y,u_mix:g.t})};function Ir(m,o){return 1/Jn(m,1,o.tileZoom)}function hu(m,o,u){return m.translatePosMatrix(o.tileID.posMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const du=(m,o,u,f,g)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(E=g.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Gh(g.paint.get("raster-hue-rotate"))};var b,E};function Gh(m){m*=Math.PI/180;const o=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Ui=(m,o,u,f,g,b,E,I,T,R)=>{const O=g.transform;return{u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:O.width/O.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+T,u_pitch_with_map:+f,u_texsize:R,u_texture:0}},fu=(m,o,u,f,g,b,E,I,T,R,O)=>{const B=g.transform;return y.extend(Ui(m,o,u,f,g,b,E,I,T,R),{u_gamma_scale:f?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+O})},Cf=(m,o,u,f,g,b,E,I,T,R)=>y.extend(fu(m,o,u,f,g,b,E,I,!0,T,!0),{u_texsize_icon:R,u_texture_icon:1}),Sf=(m,o,u)=>({u_matrix:m,u_opacity:o,u_color:u}),pu=(m,o,u,f,g,b)=>y.extend(function(E,I,T,R){const O=T.imageManager.getPattern(E.from.toString()),B=T.imageManager.getPattern(E.to.toString()),{width:j,height:K}=T.imageManager.getPixelSize(),H=Math.pow(2,R.tileID.overscaledZ),X=R.tileSize*Math.pow(2,T.transform.tileZoom)/H,oe=X*(R.tileID.canonical.x+R.tileID.wrap*H),se=X*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[j,K],u_mix:I.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Jn(R,1,T.transform.tileZoom),u_pixel_coord_upper:[oe>>16,se>>16],u_pixel_coord_lower:[65535&oe,65535&se]}}(f,b,u,g),{u_matrix:m,u_opacity:o}),cc={fillExtrusion:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_lightpos:new y.Uniform3f(m,o.u_lightpos),u_lightintensity:new y.Uniform1f(m,o.u_lightintensity),u_lightcolor:new y.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new y.Uniform1f(m,o.u_vertical_gradient),u_opacity:new y.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_lightpos:new y.Uniform3f(m,o.u_lightpos),u_lightintensity:new y.Uniform1f(m,o.u_lightintensity),u_lightcolor:new y.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new y.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new y.Uniform1f(m,o.u_height_factor),u_image:new y.Uniform1i(m,o.u_image),u_texsize:new y.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(m,o.u_scale),u_fade:new y.Uniform1f(m,o.u_fade),u_opacity:new y.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_image:new y.Uniform1i(m,o.u_image),u_texsize:new y.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(m,o.u_scale),u_fade:new y.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_world:new y.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_world:new y.Uniform2f(m,o.u_world),u_image:new y.Uniform1i(m,o.u_image),u_texsize:new y.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(m,o.u_scale),u_fade:new y.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(m,o.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(m,o.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(m,o.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(m,o.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(m,o.u_extrude_scale),u_overscale_factor:new y.Uniform1f(m,o.u_overscale_factor)}),collisionCircle:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new y.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new y.UniformColor(m,o.u_color),u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_overlay:new y.Uniform1i(m,o.u_overlay),u_overlay_scale:new y.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new y.Uniform1f(m,o.u_extrude_scale),u_intensity:new y.Uniform1f(m,o.u_intensity),u_matrix:new y.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_world:new y.Uniform2f(m,o.u_world),u_image:new y.Uniform1i(m,o.u_image),u_color_ramp:new y.Uniform1i(m,o.u_color_ramp),u_opacity:new y.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_image:new y.Uniform1i(m,o.u_image),u_latrange:new y.Uniform2f(m,o.u_latrange),u_light:new y.Uniform2f(m,o.u_light),u_shadow:new y.UniformColor(m,o.u_shadow),u_highlight:new y.UniformColor(m,o.u_highlight),u_accent:new y.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_image:new y.Uniform1i(m,o.u_image),u_dimension:new y.Uniform2f(m,o.u_dimension),u_zoom:new y.Uniform1f(m,o.u_zoom),u_unpack:new y.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_ratio:new y.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(m,o.u_units_to_pixels)}),lineGradient:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_ratio:new y.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(m,o.u_units_to_pixels),u_image:new y.Uniform1i(m,o.u_image),u_image_height:new y.Uniform1f(m,o.u_image_height)}),linePattern:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_texsize:new y.Uniform2f(m,o.u_texsize),u_ratio:new y.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_image:new y.Uniform1i(m,o.u_image),u_units_to_pixels:new y.Uniform2f(m,o.u_units_to_pixels),u_scale:new y.Uniform3f(m,o.u_scale),u_fade:new y.Uniform1f(m,o.u_fade)}),lineSDF:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_ratio:new y.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(m,o.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(m,o.u_patternscale_a),u_patternscale_b:new y.Uniform2f(m,o.u_patternscale_b),u_sdfgamma:new y.Uniform1f(m,o.u_sdfgamma),u_image:new y.Uniform1i(m,o.u_image),u_tex_y_a:new y.Uniform1f(m,o.u_tex_y_a),u_tex_y_b:new y.Uniform1f(m,o.u_tex_y_b),u_mix:new y.Uniform1f(m,o.u_mix)}),raster:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new y.Uniform2f(m,o.u_tl_parent),u_scale_parent:new y.Uniform1f(m,o.u_scale_parent),u_buffer_scale:new y.Uniform1f(m,o.u_buffer_scale),u_fade_t:new y.Uniform1f(m,o.u_fade_t),u_opacity:new y.Uniform1f(m,o.u_opacity),u_image0:new y.Uniform1i(m,o.u_image0),u_image1:new y.Uniform1i(m,o.u_image1),u_brightness_low:new y.Uniform1f(m,o.u_brightness_low),u_brightness_high:new y.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new y.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new y.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new y.Uniform3f(m,o.u_spin_weights)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new y.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(m,o.u_size_t),u_size:new y.Uniform1f(m,o.u_size),u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(m,o.u_pitch),u_rotate_symbol:new y.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(m,o.u_fade_change),u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new y.Uniform1i(m,o.u_is_text),u_pitch_with_map:new y.Uniform1i(m,o.u_pitch_with_map),u_texsize:new y.Uniform2f(m,o.u_texsize),u_texture:new y.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new y.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(m,o.u_size_t),u_size:new y.Uniform1f(m,o.u_size),u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(m,o.u_pitch),u_rotate_symbol:new y.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(m,o.u_fade_change),u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new y.Uniform1i(m,o.u_is_text),u_pitch_with_map:new y.Uniform1i(m,o.u_pitch_with_map),u_texsize:new y.Uniform2f(m,o.u_texsize),u_texture:new y.Uniform1i(m,o.u_texture),u_gamma_scale:new y.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new y.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(m,o.u_size_t),u_size:new y.Uniform1f(m,o.u_size),u_camera_to_center_distance:new y.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(m,o.u_pitch),u_rotate_symbol:new y.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(m,o.u_fade_change),u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new y.Uniform1i(m,o.u_is_text),u_pitch_with_map:new y.Uniform1i(m,o.u_pitch_with_map),u_texsize:new y.Uniform2f(m,o.u_texsize),u_texsize_icon:new y.Uniform2f(m,o.u_texsize_icon),u_texture:new y.Uniform1i(m,o.u_texture),u_texture_icon:new y.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new y.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_opacity:new y.Uniform1f(m,o.u_opacity),u_color:new y.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new y.UniformMatrix4f(m,o.u_matrix),u_opacity:new y.Uniform1f(m,o.u_opacity),u_image:new y.Uniform1i(m,o.u_image),u_pattern_tl_a:new y.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(m,o.u_pattern_br_b),u_texsize:new y.Uniform2f(m,o.u_texsize),u_mix:new y.Uniform1f(m,o.u_mix),u_pattern_size_a:new y.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new y.Uniform1f(m,o.u_scale_a),u_scale_b:new y.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(m,o.u_tile_units_to_pixels)})};class mu{constructor(o,u,f){this.context=o;const g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const uc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qh{constructor(o,u,f,g){this.length=u.length,this.attributes=f,this.itemSize=u.bytesPerElement,this.dynamicDraw=g,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let f=0;f<this.attributes.length;f++){const g=u.attributes[this.attributes[f].name];void 0!==g&&o.enableVertexAttribArray(g)}}setVertexAttribPointers(o,u,f){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],E=u.attributes[b.name];void 0!==E&&o.vertexAttribPointer(E,b.components,o[uc[b.type]],!1,this.itemSize,b.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class St{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class un extends St{getDefault(){return y.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class cl extends St{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class ul extends St{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Wh extends St{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class it extends St{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class gu extends St{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class no extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class is extends St{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class hc extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class hl extends St{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class dl extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class dc extends St{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class fl extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class os extends St{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class pl extends St{getDefault(){return y.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class fc extends St{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Zs extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class ft extends St{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class pc extends St{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Zh extends St{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ti extends St{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class yu extends St{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class If extends St{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class xn extends St{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class _u extends St{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ea extends St{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xh extends St{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xs extends St{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ca extends St{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ro extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class vu extends St{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ss extends St{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class Ks extends ss{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class mc extends ss{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class as{constructor(o,u,f,g){this.context=o,this.width=u,this.height=f;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Ks(o,b),g&&(this.depthAttachment=new mc(o,b))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const f=this.depthAttachment.get();f&&o.deleteRenderbuffer(f)}o.deleteFramebuffer(this.framebuffer)}}class ht{constructor(o,u,f){this.blendFunction=o,this.blendColor=u,this.mask=f}}ht.Replace=[1,0],ht.disabled=new ht(ht.Replace,y.Color.transparent,[!1,!1,!1,!1]),ht.unblended=new ht(ht.Replace,y.Color.transparent,[!0,!0,!0,!0]),ht.alphaBlended=new ht([1,771],y.Color.transparent,[!0,!0,!0,!0]);class ml{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new un(this),this.clearDepth=new cl(this),this.clearStencil=new ul(this),this.colorMask=new Wh(this),this.depthMask=new it(this),this.stencilMask=new gu(this),this.stencilFunc=new no(this),this.stencilOp=new is(this),this.stencilTest=new hc(this),this.depthRange=new hl(this),this.depthTest=new dl(this),this.depthFunc=new dc(this),this.blend=new fl(this),this.blendFunc=new os(this),this.blendColor=new pl(this),this.blendEquation=new fc(this),this.cullFace=new Zs(this),this.cullFaceSide=new ft(this),this.frontFace=new pc(this),this.program=new Zh(this),this.activeTexture=new Ti(this),this.viewport=new yu(this),this.bindFramebuffer=new If(this),this.bindRenderbuffer=new xn(this),this.bindTexture=new _u(this),this.bindVertexBuffer=new Ea(this),this.bindElementBuffer=new Xh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xs(this),this.pixelStoreUnpack=new Ca(this),this.pixelStoreUnpackPremultiplyAlpha=new ro(this),this.pixelStoreUnpackFlipY=new vu(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new mu(this,o,u)}createVertexBuffer(o,u,f){return new qh(this,o,u,f)}createRenderbuffer(o,u,f){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,o,u,f),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,f){return new as(this,o,u,f)}clear({color:o,depth:u}){const f=this.gl;let g=0;o&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f.clear(g)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Je(o.blendFunction,ht.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Fe{constructor(o,u,f){this.func=o,this.mask=u,this.range=f}}Fe.ReadOnly=!1,Fe.ReadWrite=!0,Fe.disabled=new Fe(519,Fe.ReadOnly,[0,1]);class ot{constructor(o,u,f,g,b,E){this.test=o,this.ref=u,this.mask=f,this.fail=g,this.depthFail=b,this.pass=E}}ot.disabled=new ot({func:519,mask:0},0,0,7680,7680,7680);class Mn{constructor(o,u,f){this.enable=o,this.mode=u,this.frontFace=f}}let Ys;function ls(m,o,u,f,g,b,E){const I=m.context,T=I.gl,R=m.useProgram("collisionBox"),O=[];let B=0,j=0;for(let J=0;J<f.length;J++){const we=f[J],ge=o.getTile(we),_e=ge.getBucket(u);if(!_e)continue;let Ae=we.posMatrix;0===g[0]&&0===g[1]||(Ae=m.translatePosMatrix(we.posMatrix,ge,g,b));const Re=E?_e.textCollisionBox:_e.iconCollisionBox,be=_e.collisionCircleArray;if(be.length>0){const Ze=y.create(),Ne=Ae;y.mul(Ze,_e.placementInvProjMatrix,m.transform.glCoordMatrix),y.mul(Ze,Ze,_e.placementViewportMatrix),O.push({circleArray:be,circleOffset:j,transform:Ne,invTransform:Ze}),B+=be.length/4,j=B}Re&&R.draw(I,T.LINES,Fe.disabled,ot.disabled,m.colorModeForRenderPass(),Mn.disabled,ba(Ae,m.transform,ge),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,m.transform.zoom,null,null,Re.collisionVertexBuffer)}if(!E||!O.length)return;const K=m.useProgram("collisionCircle"),H=new y.CollisionCircleLayoutArray;H.resize(4*B),H._trim();let X=0;for(const J of O)for(let we=0;we<J.circleArray.length/4;we++){const ge=4*we,_e=J.circleArray[ge+0],Ae=J.circleArray[ge+1],Re=J.circleArray[ge+2],be=J.circleArray[ge+3];H.emplace(X++,_e,Ae,Re,be,0),H.emplace(X++,_e,Ae,Re,be,1),H.emplace(X++,_e,Ae,Re,be,2),H.emplace(X++,_e,Ae,Re,be,3)}(!Ys||Ys.length<2*B)&&(Ys=function(J){const we=2*J,ge=new y.QuadTriangleArray;ge.resize(we),ge._trim();for(let _e=0;_e<we;_e++){const Ae=6*_e;ge.uint16[Ae+0]=4*_e+0,ge.uint16[Ae+1]=4*_e+1,ge.uint16[Ae+2]=4*_e+2,ge.uint16[Ae+3]=4*_e+2,ge.uint16[Ae+4]=4*_e+3,ge.uint16[Ae+5]=4*_e+0}return ge}(B));const oe=I.createIndexBuffer(Ys,!0),se=I.createVertexBuffer(H,y.collisionCircleLayout.members,!0);for(const J of O){const we={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(ce=m.transform).cameraToCenterDistance,u_viewport_size:[ce.width,ce.height]};K.draw(I,T.TRIANGLES,Fe.disabled,ot.disabled,m.colorModeForRenderPass(),Mn.disabled,we,u.id,se,oe,y.SegmentVector.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ce;se.destroy(),oe.destroy()}Mn.disabled=new Mn(!1,1029,2305),Mn.backCCW=new Mn(!0,1029,2305);const Kh=y.identity(new Float32Array(16));function gc(m,o,u,f,g,b){const{horizontalAlign:E,verticalAlign:I}=y.getAnchorAlignment(m),T=-(E-.5)*o,R=-(I-.5)*u,O=y.evaluateVariableOffset(m,f);return new y.pointGeometry((T/g+O[0])*b,(R/g+O[1])*b)}function gl(m,o,u,f,g,b,E,I,T,R){const O=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,j=m.icon.dynamicLayoutVertexArray,K={};B.clear();for(let H=0;H<O.length;H++){const X=O.get(H),se=X.hidden||!X.crossTileID||m.allowVerticalPlacement&&!X.placedOrientation?null:f[X.crossTileID];if(se){const ce=new y.pointGeometry(X.anchorX,X.anchorY),J=Tn(ce,u?E:b),we=Le(g.cameraToCenterDistance,J.signedDistanceFromCamera);let ge=y.evaluateSizeForFeature(m.textSizeData,T,X)*we/y.ONE_EM;u&&(ge*=m.tilePixelRatio/I);const{width:_e,height:Ae,anchor:Re,textOffset:be,textBoxScale:Ze}=se,Ne=gc(Re,_e,Ae,be,Ze,ge),he=u?Tn(ce.add(Ne),b).point:J.point.add(o?Ne.rotate(-g.angle):Ne),Ke=m.allowVerticalPlacement&&X.placedOrientation===y.WritingMode.vertical?Math.PI/2:0;for(let Pt=0;Pt<X.numGlyphs;Pt++)y.addDynamicAttributes(B,he,Ke);R&&X.associatedIconIndex>=0&&(K[X.associatedIconIndex]={shiftedAnchor:he,angle:Ke})}else qn(X.numGlyphs,B)}if(R){j.clear();const H=m.icon.placedSymbolArray;for(let X=0;X<H.length;X++){const oe=H.get(X);if(oe.hidden)qn(oe.numGlyphs,j);else{const se=K[X];if(se)for(let ce=0;ce<oe.numGlyphs;ce++)y.addDynamicAttributes(j,se.shiftedAnchor,se.angle);else qn(oe.numGlyphs,j)}}m.icon.dynamicLayoutVertexBuffer.updateData(j)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function Vi(m,o,u){return u.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ri(m,o,u,f,g,b,E,I,T,R,O,B){const j=m.context,K=j.gl,H=m.transform,X="map"===I,oe="map"===T,se="viewport"!==I&&"point"!==u.layout.get("symbol-placement"),ce=X&&!oe&&!se,J=!u.layout.get("symbol-sort-key").isConstant();let we=!1;const ge=m.depthModeForSublayer(0,Fe.ReadOnly),_e=u.layout.get("text-variable-anchor"),Ae=[];for(const Re of f){const be=o.getTile(Re),Ze=be.getBucket(u);if(!Ze)continue;const Ne=g?Ze.text:Ze.icon;if(!Ne||!Ne.segments.get().length)continue;const he=Ne.programConfigurations.get(u.id),Ke=g||Ze.sdfIcons,Pt=g?Ze.textSizeData:Ze.iconSizeData,$t=oe||0!==H.pitch,Bt=m.useProgram(Vi(Ke,g,Ze),he),pt=y.evaluateSizeForZoom(Pt,H.zoom);let jt,Ht,cr,Gr,ki=[0,0],Hi=null;if(g)Ht=be.glyphAtlasTexture,cr=K.LINEAR,jt=be.glyphAtlasTexture.size,Ze.iconsInText&&(ki=be.imageAtlasTexture.size,Hi=be.imageAtlasTexture,Gr=$t||m.options.rotating||m.options.zooming||"composite"===Pt.kind||"camera"===Pt.kind?K.LINEAR:K.NEAREST);else{const Li=1!==u.layout.get("icon-size").constantOr(0)||Ze.iconsNeedLinear;Ht=be.imageAtlasTexture,cr=Ke||m.options.rotating||m.options.zooming||Li||$t?K.LINEAR:K.NEAREST,jt=be.imageAtlasTexture.size}const wo=Jn(be,1,m.transform.zoom),_n=ei(Re.posMatrix,oe,X,m.transform,wo),yr=rs(Re.posMatrix,oe,X,m.transform,wo),Wo=_e&&Ze.hasTextData(),_r="none"!==u.layout.get("icon-text-fit")&&Wo&&Ze.hasIconData();if(se){const Li="map"===u.layout.get("text-rotation-alignment");Et(Ze,Re.posMatrix,m,g,_n,yr,oe,R,Li)}const It=m.translatePosMatrix(Re.posMatrix,be,b,E),on=se||g&&_e||_r?Kh:_n,Kn=m.translatePosMatrix(yr,be,b,E,!0),qr=Ke&&0!==u.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1);let An;An=Ke?Ze.iconsInText?Cf(Pt.kind,pt,ce,oe,m,It,on,Kn,jt,ki):fu(Pt.kind,pt,ce,oe,m,It,on,Kn,g,jt,!0):Ui(Pt.kind,pt,ce,oe,m,It,on,Kn,g,jt);const Do={program:Bt,buffers:Ne,uniformValues:An,atlasTexture:Ht,atlasTextureIcon:Hi,atlasInterpolation:cr,atlasInterpolationIcon:Gr,isSDF:Ke,hasHalo:qr};if(J&&Ze.canOverlap){we=!0;const Li=Ne.segments.get();for(const La of Li)Ae.push({segments:new y.SegmentVector([La]),sortKey:La.sortKey,state:Do})}else Ae.push({segments:Ne.segments,sortKey:0,state:Do})}we&&Ae.sort((Re,be)=>Re.sortKey-be.sortKey);for(const Re of Ae){const be=Re.state;if(j.activeTexture.set(K.TEXTURE0),be.atlasTexture.bind(be.atlasInterpolation,K.CLAMP_TO_EDGE),be.atlasTextureIcon&&(j.activeTexture.set(K.TEXTURE1),be.atlasTextureIcon&&be.atlasTextureIcon.bind(be.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),be.isSDF){const Ze=be.uniformValues;be.hasHalo&&(Ze.u_is_halo=1,yc(be.buffers,Re.segments,u,m,be.program,ge,O,B,Ze)),Ze.u_is_halo=0}yc(be.buffers,Re.segments,u,m,be.program,ge,O,B,be.uniformValues)}}function yc(m,o,u,f,g,b,E,I,T){const R=f.context;g.draw(R,R.gl.TRIANGLES,b,E,I,Mn.disabled,T,u.id,m.layoutVertexBuffer,m.indexBuffer,o,u.paint,f.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function xu(m,o,u,f,g,b,E){const I=m.context.gl,T=u.paint.get("fill-pattern"),R=T&&T.constantOr(1),O=u.getCrossfadeParameters();let B,j,K,H,X;E?(j=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=I.LINES):(j=R?"fillPattern":"fill",B=I.TRIANGLES);for(const oe of f){const se=o.getTile(oe);if(R&&!se.patternsLoaded())continue;const ce=se.getBucket(u);if(!ce)continue;const J=ce.programConfigurations.get(u.id),we=m.useProgram(j,J);R&&(m.context.activeTexture.set(I.TEXTURE0),se.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),J.updatePaintBuffers(O));const ge=T.constantOr(null);if(ge&&se.imageAtlas){const Ae=se.imageAtlas,Re=Ae.patternPositions[ge.to.toString()],be=Ae.patternPositions[ge.from.toString()];Re&&be&&J.setConstantPatternPositions(Re,be)}const _e=m.translatePosMatrix(oe.posMatrix,se,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(E){H=ce.indexBuffer2,X=ce.segments2;const Ae=[I.drawingBufferWidth,I.drawingBufferHeight];K="fillOutlinePattern"===j&&R?ll(_e,m,O,se,Ae):al(_e,Ae)}else H=ce.indexBuffer,X=ce.segments,K=R?ut(_e,m,O,se):xa(_e);we.draw(m.context,B,g,m.stencilModeForClipping(oe),b,Mn.disabled,K,u.id,ce.layoutVertexBuffer,H,X,u.paint,m.transform.zoom,J)}}function jr(m,o,u,f,g,b,E){const I=m.context,T=I.gl,R=u.paint.get("fill-extrusion-pattern"),O=R.constantOr(1),B=u.getCrossfadeParameters(),j=u.paint.get("fill-extrusion-opacity");for(const K of f){const H=o.getTile(K),X=H.getBucket(u);if(!X)continue;const oe=X.programConfigurations.get(u.id),se=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",oe);O&&(m.context.activeTexture.set(T.TEXTURE0),H.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),oe.updatePaintBuffers(B));const ce=R.constantOr(null);if(ce&&H.imageAtlas){const _e=H.imageAtlas,Ae=_e.patternPositions[ce.to.toString()],Re=_e.patternPositions[ce.from.toString()];Ae&&Re&&oe.setConstantPatternPositions(Ae,Re)}const J=m.translatePosMatrix(K.posMatrix,H,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),we=u.paint.get("fill-extrusion-vertical-gradient"),ge=O?ac(J,m,we,j,K,B,H):sl(J,m,we,j);se.draw(I,I.gl.TRIANGLES,g,b,E,Mn.backCCW,ge,u.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,u.paint,m.transform.zoom,oe)}}function Mi(m,o,u,f,g,b){const E=m.context,I=E.gl,T=o.fbo;if(!T)return;const R=m.useProgram("hillshade");E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,T.colorAttachment.get());const O=((B,j,K)=>{const H=K.paint.get("hillshade-shadow-color"),X=K.paint.get("hillshade-highlight-color"),oe=K.paint.get("hillshade-accent-color");let se=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(se-=B.transform.angle);const ce=!B.options.moving;return{u_matrix:B.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ce),u_image:0,u_latrange:tn(0,j.tileID),u_light:[K.paint.get("hillshade-exaggeration"),se],u_shadow:H,u_highlight:X,u_accent:oe}})(m,o,u);R.draw(E,I.TRIANGLES,f,g,b,Mn.disabled,O,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function At(m,o,u,f,g,b){const E=m.context,I=E.gl,T=o.dem;if(T&&T.data){const R=T.dim,O=T.stride,B=T.getPixels();if(E.activeTexture.set(I.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(O),o.demTexture){const K=o.demTexture;K.update(B,{premultiply:!1}),K.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new ln(E,B,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);E.activeTexture.set(I.TEXTURE0);let j=o.fbo;if(!j){const K=new ln(E,{width:R,height:R,data:null},I.RGBA);K.bind(I.LINEAR,I.CLAMP_TO_EDGE),j=o.fbo=E.createFramebuffer(R,R,!0),j.colorAttachment.set(K.texture)}E.bindFramebuffer.set(j.framebuffer),E.viewport.set([0,0,R,R]),m.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,f,g,b,Mn.disabled,((K,H)=>{const X=H.stride,oe=y.create();return y.ortho(oe,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(oe,oe,[0,-y.EXTENT,0]),{u_matrix:oe,u_image:1,u_dimension:[X,X],u_zoom:K.overscaledZ,u_unpack:H.getUnpackVector()}})(o.tileID,T),u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Ia(m,o,u,f,g){const b=f.paint.get("raster-fade-duration");if(b>0){const E=y.exported.now(),I=(E-m.timeAdded)/b,T=o?(E-o.timeAdded)/b:-1,R=u.getSource(),O=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),B=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),j=B&&m.refreshedUponExpiration?1:y.clamp(B?I:1-T,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const yl=new y.Color(1,0,0,1),_l=new y.Color(0,1,0,1),cs=new y.Color(0,0,1,1),Ai=new y.Color(1,0,1,1),us=new y.Color(0,1,1,1);function bu(m,o,u,f){vl(m,0,o+u/2,m.transform.width,u,f)}function hs(m,o,u,f){vl(m,o-u/2,0,u,m.transform.height,f)}function vl(m,o,u,f,g,b){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*m.pixelRatio,u*m.pixelRatio,f*m.pixelRatio,g*m.pixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}function _c(m,o,u){const f=m.context,g=f.gl,b=u.posMatrix,E=m.useProgram("debug"),I=Fe.disabled,T=ot.disabled,R=m.colorModeForRenderPass(),O="$debug";f.activeTexture.set(g.TEXTURE0),m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),E.draw(f,g.LINE_STRIP,I,T,R,Mn.disabled,ze(b,y.Color.red),O,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);const B=o.getTileByID(u.key).latestRawTileData,j=Math.floor((B&&B.byteLength||0)/1024),K=o.getTile(u).tileSize,H=512/Math.min(K,512)*(u.overscaledZ/m.transform.zoom)*.5;let X=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(X+=` => ${u.overscaledZ}`),function(oe,se){oe.initDebugOverlayCanvas();const ce=oe.debugOverlayCanvas,J=oe.context.gl,we=oe.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,ce.width,ce.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(se,5,5),we.strokeText(se,5,5),oe.debugOverlayTexture.update(ce),oe.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)}(m,`${X} ${j}kb`),E.draw(f,g.TRIANGLES,I,T,ht.alphaBlended,Mn.disabled,ze(b,y.Color.transparent,H),O,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const Js={symbol:function(m,o,u,f,g){if("translucent"!==m.renderPass)return;const b=ot.disabled,E=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(I,T,R,O,B,j,K){const H=T.transform,X="map"===B,oe="map"===j;for(const se of I){const ce=O.getTile(se),J=ce.getBucket(R);if(!J||!J.text||!J.text.segments.get().length)continue;const we=y.evaluateSizeForZoom(J.textSizeData,H.zoom),ge=Jn(ce,1,T.transform.zoom),_e=ei(se.posMatrix,oe,X,T.transform,ge),Ae="none"!==R.layout.get("icon-text-fit")&&J.hasIconData();if(we){const Re=Math.pow(2,H.zoom-ce.tileID.overscaledZ);gl(J,X,oe,K,H,_e,se.posMatrix,Re,we,Ae)}}}(f,m,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),g),0!==u.paint.get("icon-opacity").constantOr(1)&&ri(m,o,u,f,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,E),0!==u.paint.get("text-opacity").constantOr(1)&&ri(m,o,u,f,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,E),o.map.showCollisionBoxes&&(ls(m,o,u,f,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),ls(m,o,u,f,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,u,f){if("translucent"!==m.renderPass)return;const g=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),E=u.paint.get("circle-stroke-opacity"),I=!u.layout.get("circle-sort-key").isConstant();if(0===g.constantOr(1)&&(0===b.constantOr(1)||0===E.constantOr(1)))return;const T=m.context,R=T.gl,O=m.depthModeForSublayer(0,Fe.ReadOnly),B=ot.disabled,j=m.colorModeForRenderPass(),K=[];for(let H=0;H<f.length;H++){const X=f[H],oe=o.getTile(X),se=oe.getBucket(u);if(!se)continue;const ce=se.programConfigurations.get(u.id),J={programConfiguration:ce,program:m.useProgram("circle",ce),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:Ws(m,X,oe,u)};if(I){const we=se.segments.get();for(const ge of we)K.push({segments:new y.SegmentVector([ge]),sortKey:ge.sortKey,state:J})}else K.push({segments:se.segments,sortKey:0,state:J})}I&&K.sort((H,X)=>H.sortKey-X.sortKey);for(const H of K){const{programConfiguration:X,program:oe,layoutVertexBuffer:se,indexBuffer:ce,uniformValues:J}=H.state;oe.draw(T,R.TRIANGLES,O,B,j,Mn.disabled,J,u.id,se,ce,H.segments,u.paint,m.transform.zoom,X)}},heatmap:function(m,o,u,f){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const g=m.context,b=g.gl,E=ot.disabled,I=new ht([b.ONE,b.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(T,R,O){const B=T.gl;T.activeTexture.set(B.TEXTURE1),T.viewport.set([0,0,R.width/4,R.height/4]);let j=O.heatmapFbo;if(j)B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get()),T.bindFramebuffer.set(j.framebuffer);else{const K=B.createTexture();B.bindTexture(B.TEXTURE_2D,K),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),j=O.heatmapFbo=T.createFramebuffer(R.width/4,R.height/4,!1),function(H,X,oe,se){const ce=H.gl;ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,X.width/4,X.height/4,0,ce.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:ce.UNSIGNED_BYTE,null),se.colorAttachment.set(oe)}(T,R,K,j)}})(g,m,u),g.clear({color:y.Color.transparent});for(let T=0;T<f.length;T++){const R=f[T];if(o.hasRenderableParent(R))continue;const O=o.getTile(R),B=O.getBucket(u);if(!B)continue;const j=B.programConfigurations.get(u.id),K=m.useProgram("heatmap",j),{zoom:H}=m.transform;K.draw(g,b.TRIANGLES,Fe.disabled,E,I,Mn.disabled,gt(R.posMatrix,O,H,u.paint.get("heatmap-intensity")),u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,m.transform.zoom,j)}g.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(g,b){const E=g.context,I=E.gl,T=b.heatmapFbo;if(!T)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,T.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new ln(E,b.colorRamp,I.RGBA)),R.bind(I.LINEAR,I.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(E,I.TRIANGLES,Fe.disabled,ot.disabled,g.colorModeForRenderPass(),Mn.disabled,((O,B,j,K)=>{const H=y.create();y.ortho(H,0,O.width,O.height,0,0,1);const X=O.context.gl;return{u_matrix:H,u_world:[X.drawingBufferWidth,X.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(g,b),b.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,b.paint,g.transform.zoom)}(m,u))},line:function(m,o,u,f){if("translucent"!==m.renderPass)return;const g=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===g.constantOr(1)||0===b.constantOr(1))return;const E=m.depthModeForSublayer(0,Fe.ReadOnly),I=m.colorModeForRenderPass(),T=u.paint.get("line-dasharray"),R=u.paint.get("line-pattern"),O=R.constantOr(1),B=u.paint.get("line-gradient"),j=u.getCrossfadeParameters(),K=O?"linePattern":T?"lineSDF":B?"lineGradient":"line",H=m.context,X=H.gl;let oe=!0;for(const se of f){const ce=o.getTile(se);if(O&&!ce.patternsLoaded())continue;const J=ce.getBucket(u);if(!J)continue;const we=J.programConfigurations.get(u.id),ge=m.context.program.get(),_e=m.useProgram(K,we),Ae=oe||_e.program!==ge,Re=R.constantOr(null);if(Re&&ce.imageAtlas){const Ze=ce.imageAtlas,Ne=Ze.patternPositions[Re.to.toString()],he=Ze.patternPositions[Re.from.toString()];Ne&&he&&we.setConstantPatternPositions(Ne,he)}const be=O?Da(m,ce,u,j):T?Nn(m,ce,u,T,j):B?lc(m,ce,u,J.lineClipsArray.length):wa(m,ce,u);if(O)H.activeTexture.set(X.TEXTURE0),ce.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),we.updatePaintBuffers(j);else if(T&&(Ae||m.lineAtlas.dirty))H.activeTexture.set(X.TEXTURE0),m.lineAtlas.bind(H);else if(B){const Ze=J.gradients[u.id];let Ne=Ze.texture;if(u.gradientVersion!==Ze.version){let he=256;if(u.stepInterpolant){const Ke=o.getSource().maxzoom,Pt=se.canonical.z===Ke?Math.ceil(1<<m.transform.maxZoom-se.canonical.z):1;he=y.clamp(y.nextPowerOfTwo(J.maxLineLength/y.EXTENT*1024*Pt),256,H.maxTextureSize)}Ze.gradient=y.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:he,image:Ze.gradient||void 0,clips:J.lineClipsArray}),Ze.texture?Ze.texture.update(Ze.gradient):Ze.texture=new ln(H,Ze.gradient,X.RGBA),Ze.version=u.gradientVersion,Ne=Ze.texture}H.activeTexture.set(X.TEXTURE0),Ne.bind(u.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}_e.draw(H,X.TRIANGLES,E,m.stencilModeForClipping(se),I,Mn.disabled,be,u.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,u.paint,m.transform.zoom,we,J.layoutVertexBuffer2),oe=!1}},fill:function(m,o,u,f){const g=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const E=m.colorModeForRenderPass(),I=u.paint.get("fill-pattern"),T=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===g.constantOr(y.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(m.renderPass===T){const R=m.depthModeForSublayer(1,"opaque"===m.renderPass?Fe.ReadWrite:Fe.ReadOnly);xu(m,o,u,f,R,E,!1)}if("translucent"===m.renderPass&&u.paint.get("fill-antialias")){const R=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,Fe.ReadOnly);xu(m,o,u,f,R,E,!0)}},"fill-extrusion":function(m,o,u,f){const g=u.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===m.renderPass){const b=new Fe(m.context.gl.LEQUAL,Fe.ReadWrite,m.depthRangeFor3D);if(1!==g||u.paint.get("fill-extrusion-pattern").constantOr(1))jr(m,o,u,f,b,ot.disabled,ht.disabled),jr(m,o,u,f,b,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();jr(m,o,u,f,b,ot.disabled,E)}}},hillshade:function(m,o,u,f){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const g=m.context,b=m.depthModeForSublayer(0,Fe.ReadOnly),E=m.colorModeForRenderPass(),[I,T]="translucent"===m.renderPass?m.stencilConfigForOverlap(f):[{},f];for(const R of T){const O=o.getTile(R);O.needsHillshadePrepare&&"offscreen"===m.renderPass?At(m,O,u,b,ot.disabled,E):"translucent"===m.renderPass&&Mi(m,O,u,b,I[R.overscaledZ],E)}g.viewport.set([0,0,m.width,m.height])},raster:function(m,o,u,f){if("translucent"!==m.renderPass||0===u.paint.get("raster-opacity")||!f.length)return;const g=m.context,b=g.gl,E=o.getSource(),I=m.useProgram("raster"),T=m.colorModeForRenderPass(),[R,O]=E instanceof po?[{},f]:m.stencilConfigForOverlap(f),B=O[O.length-1].overscaledZ,j=!m.options.moving;for(const K of O){const H=m.depthModeForSublayer(K.overscaledZ-B,1===u.paint.get("raster-opacity")?Fe.ReadWrite:Fe.ReadOnly,b.LESS),X=o.getTile(K),oe=m.transform.calculatePosMatrix(K.toUnwrapped(),j);X.registerFadeDuration(u.paint.get("raster-fade-duration"));const se=o.findLoadedParent(K,0),ce=Ia(X,se,o,u,m.transform);let J,we;const ge="nearest"===u.paint.get("raster-resampling")?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),X.texture.bind(ge,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),se?(se.texture.bind(ge,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),J=Math.pow(2,se.tileID.overscaledZ-X.tileID.overscaledZ),we=[X.tileID.canonical.x*J%1,X.tileID.canonical.y*J%1]):X.texture.bind(ge,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const _e=du(oe,we||[0,0],J||1,ce,u);E instanceof po?I.draw(g,b.TRIANGLES,H,ot.disabled,T,Mn.disabled,_e,u.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):I.draw(g,b.TRIANGLES,H,R[K.overscaledZ],T,Mn.disabled,_e,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,o,u){const f=u.paint.get("background-color"),g=u.paint.get("background-opacity");if(0===g)return;const b=m.context,E=b.gl,I=m.transform,T=I.tileSize,R=u.paint.get("background-pattern");if(m.isPatternMissing(R))return;const O=!R&&1===f.a&&1===g&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==O)return;const B=ot.disabled,j=m.depthModeForSublayer(0,"opaque"===O?Fe.ReadWrite:Fe.ReadOnly),K=m.colorModeForRenderPass(),H=m.useProgram(R?"backgroundPattern":"background"),X=I.coveringTiles({tileSize:T});R&&(b.activeTexture.set(E.TEXTURE0),m.imageManager.bind(m.context));const oe=u.getCrossfadeParameters();for(const se of X){const ce=m.transform.calculatePosMatrix(se.toUnwrapped()),J=R?pu(ce,g,m,R,{tileID:se,tileSize:T},oe):Sf(ce,g,f);H.draw(b,E.TRIANGLES,j,B,K,Mn.disabled,J,u.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,o,u){for(let f=0;f<u.length;f++)_c(m,o,u[f])},custom:function(m,o,u){const f=m.context,g=u.implementation;if("offscreen"===m.renderPass){const b=g.prerender;b&&(m.setCustomLayerDefaults(),f.setColorMode(m.colorModeForRenderPass()),b.call(g,f.gl,m.transform.customLayerMatrix()),f.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),f.setColorMode(m.colorModeForRenderPass()),f.setStencilMode(ot.disabled);const b="3d"===g.renderingMode?new Fe(m.context.gl.LEQUAL,Fe.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Fe.ReadOnly);f.setDepthMode(b),g.render(f.gl,m.transform.customLayerMatrix()),f.setDirty(),m.setBaseState(),f.bindFramebuffer.set(null)}}};class Ho{constructor(o,u){this.context=new ml(o),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Cr.maxUnderzooming+Cr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bt,this.gpuTimers={}}resize(o,u,f){if(this.width=o*f,this.height=u*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const o=this.context,u=new y.PosArray;u.emplaceBack(0,0),u.emplaceBack(y.EXTENT,0),u.emplaceBack(0,y.EXTENT),u.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,Zn.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);const f=new y.PosArray;f.emplaceBack(0,0),f.emplaceBack(y.EXTENT,0),f.emplaceBack(0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=o.createVertexBuffer(f,Zn.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);const g=new y.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(g,ns.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);const b=new y.PosArray;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,Zn.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);const E=new y.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const I=new y.TriangleIndexArray;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new ln(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const T=this.context.gl;this.stencilClearMode=new ot({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=y.create();y.ortho(f,0,this.width,this.height,0,0,1),y.scale(f,f,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,u.TRIANGLES,Fe.disabled,this.stencilClearMode,ht.disabled,Mn.disabled,jo(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,u){if(this.currentStencilSource===o.source||!o.isTileClipped()||!u||!u.length)return;this.currentStencilSource=o.source;const f=this.context,g=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(ht.disabled),f.setDepthMode(Fe.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of u){const I=this._tileClippingMaskIDs[E.key]=this.nextStencilID++;b.draw(f,g.TRIANGLES,Fe.disabled,new ot({func:g.ALWAYS,mask:0},I,255,g.KEEP,g.KEEP,g.REPLACE),ht.disabled,Mn.disabled,jo(E.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new ot({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){const u=this.context.gl;return new ot({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,f=o.sort((E,I)=>I.overscaledZ-E.overscaledZ),g=f[f.length-1].overscaledZ,b=f[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let I=0;I<b;I++)E[I+g]=new ot({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,f]}return[{[g]:ot.disabled},f]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new ht([o.CONSTANT_COLOR,o.ONE],new y.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?ht.unblended:ht.alphaBlended}depthModeForSublayer(o,u,f){if(!this.opaquePassEnabledForLayer())return Fe.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Fe(f||this.context.gl.LEQUAL,u,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(y.exported.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches;for(const T in g){const R=g[T];R.used&&R.prepare(this.context)}const b={},E={},I={};for(const T in g){const R=g[T];b[T]=R.getVisibleCoordinates(),E[T]=b[T].slice().reverse(),I[T]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<f.length;T++)if(this.style._layers[f[T]].is3D()){this.opaquePassCutoff=T;break}this.renderPass="offscreen";for(const T of f){const R=this.style._layers[T];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const O=E[R.source];("custom"===R.type||O.length)&&this.renderLayer(this,g[R.source],R,O)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[f[this.currentLayer]],R=g[T.source],O=b[T.source];this._renderTileClippingMasks(T,O),this.renderLayer(this,R,T,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const T=this.style._layers[f[this.currentLayer]],R=g[T.source],O=("symbol"===T.type?I:E)[T.source];this._renderTileClippingMasks(T,b[T.source]),this.renderLayer(this,R,T,O)}if(this.options.showTileBoundaries){let T,R;Object.values(this.style._layers).forEach(O=>{O.source&&!O.isHidden(this.transform.zoom)&&(O.source!==(R&&R.id)&&(R=this.style.sourceCaches[O.source]),(!T||T.getSource().maxzoom<R.getSource().maxzoom)&&(T=R))}),T&&Js.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const R=T.transform.padding;bu(T,T.transform.height-(R.top||0),3,yl),bu(T,R.bottom||0,3,_l),hs(T,R.left||0,3,cs),hs(T,T.transform.width-(R.right||0),3,Ai);const O=T.transform.centerPoint;var B,j,K,H;vl(B=T,(j=O.x)-1,(K=T.transform.height-O.y)-10,2,20,H=us),vl(B,j-10,K-1,20,2,H)}(this),this.context.setDefault()}renderLayer(o,u,f,g){f.isHidden(this.transform.zoom)||("background"===f.type||"custom"===f.type||g.length)&&(this.id=f.id,this.gpuTimingStart(f),Js[f.type](o,u,f,g,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let f=this.gpuTimers[o.id];f||(f=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),f.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const u={};for(const f in o){const g=o[f],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(g.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(g.query),u[f]=E}return u}translatePosMatrix(o,u,f,g,b){if(!f[0]&&!f[1])return o;const E=b?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(E){const R=Math.sin(E),O=Math.cos(E);f=[f[0]*O-f[1]*R,f[0]*R+f[1]*O]}const I=[b?f[0]:Jn(u,f[0],this.transform.zoom),b?f[1]:Jn(u,f[1],this.transform.zoom),0],T=new Float32Array(16);return y.translate(T,o,I),T}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),f=this.imageManager.getPattern(o.to.toString());return!u||!f}useProgram(o,u){this.cache=this.cache||{};const f=`${o}${u?u.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[f]||(this.cache[f]=new sc(this.context,o,ic[o],u,cc[o],this._showOverdrawInspector)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ln(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class xl{constructor(o,u){this.points=o,this.planes=u}static fromInvProjectionMatrix(o,u,f){const g=Math.pow(2,f),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>y.transformMat4([],I,o)).map(I=>y.scale$1([],I,1/I[3]/u*g)),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const T=function(j,K){var H=K[0],X=K[1],oe=K[2],se=H*H+X*X+oe*oe;return se>0&&(se=1/Math.sqrt(se)),j[0]=K[0]*se,j[1]=K[1]*se,j[2]=K[2]*se,j}([],(j=[],K=mn([],b[I[0]],b[I[1]]),H=mn([],b[I[2]],b[I[1]]),X=K[0],ce=H[0],j[0]=(oe=K[1])*(we=H[2])-(se=K[2])*(J=H[1]),j[1]=se*ce-X*we,j[2]=X*J-oe*ce,j)),R=-((O=T)[0]*(B=b[I[1]])[0]+O[1]*B[1]+O[2]*B[2]);var j,K,H,X,oe,se,ce,J,we,O,B;return T.concat(R)});return new xl(b,E)}}class Ta{constructor(o,u){var f,g,b;this.min=o,this.max=u,this.center=function(f,g,b){return f[0]=.5*g[0],f[1]=.5*g[1],f[2]=.5*g[2],f}([],((f=[])[0]=(g=this.min)[0]+(b=this.max)[0],f[1]=g[1]+b[1],f[2]=g[2]+b[2],f))}quadrant(o){const u=[o%2==0,o<2],f=Sn(this.min),g=Sn(this.max);for(let b=0;b<u.length;b++)f[b]=u[b]?this.min[b]:this.center[b],g[b]=u[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new Ta(f,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let f=!0;for(let g=0;g<o.planes.length;g++){const b=o.planes[g];let E=0;for(let I=0;I<u.length;I++)y.dot(b,u[I])>=0&&E++;if(0===E)return 0;E!==u.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const T=o.points[I][g]-this.min[g];b=Math.min(b,T),E=Math.max(E,T)}if(E<0||b>this.max[g]-this.min[g])return 0}return 1}}class Qn{constructor(o=0,u=0,f=0,g=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=f,this.right=g}interpolate(o,u,f){return null!=u.top&&null!=o.top&&(this.top=y.number(o.top,u.top,f)),null!=u.bottom&&null!=o.bottom&&(this.bottom=y.number(o.bottom,u.bottom,f)),null!=u.left&&null!=o.left&&(this.left=y.number(o.left,u.left,f)),null!=u.right&&null!=o.right&&(this.right=y.number(o.right,u.right,f)),this}getCenter(o,u){const f=y.clamp((this.left+o-this.right)/2,0,o),g=y.clamp((this.top+u-this.bottom)/2,0,u);return new y.pointGeometry(f,g)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Qn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class pr{constructor(o,u,f,g,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===b||!!b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new pr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const u=-y.wrap(o,-180,180)*Math.PI/180;var f;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(f=new y.ARRAY_TYPE(4),y.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(f,g,b){var E=g[0],I=g[1],T=g[2],R=g[3],O=Math.sin(b),B=Math.cos(b);f[0]=E*B+T*O,f[1]=I*B+R*O,f[2]=E*-O+T*B,f[3]=I*-O+R*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=y.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,f){this._unmodified=!1,this._edgeInsets.interpolate(o,u,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new y.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const f=this.pointCoordinate(new y.pointGeometry(0,0)),g=this.pointCoordinate(new y.pointGeometry(this.width,0)),b=this.pointCoordinate(new y.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new y.pointGeometry(0,this.height)),I=Math.floor(Math.min(f.x,g.x,b.x,E.x)),T=Math.floor(Math.max(f.x,g.x,b.x,E.x)),R=1;for(let O=I-R;O<=T+R;O++)0!==O&&u.push(new y.UnwrappedTileID(O,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const f=u;if(void 0!==o.minzoom&&u<o.minzoom)return[];void 0!==o.maxzoom&&u>o.maxzoom&&(u=o.maxzoom);const g=y.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,u),E=[b*g.x,b*g.y,0],I=xl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let T=o.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(T=u);const R=H=>({aabb:new Ta([H*b,0,0],[(H+1)*b,b,0]),zoom:0,x:0,y:0,wrap:H,fullyVisible:!1}),O=[],B=[],j=u,K=o.reparseOverscaled?f:u;if(this._renderWorldCopies)for(let H=1;H<=3;H++)O.push(R(-H)),O.push(R(H));for(O.push(R(0));O.length>0;){const H=O.pop(),X=H.x,oe=H.y;let se=H.fullyVisible;if(!se){const _e=H.aabb.intersects(I);if(0===_e)continue;se=2===_e}const ce=H.aabb.distanceX(E),J=H.aabb.distanceY(E),we=Math.max(Math.abs(ce),Math.abs(J));if(H.zoom===j||we>3+(1<<j-H.zoom)-2&&H.zoom>=T)B.push({tileID:new y.OverscaledTileID(H.zoom===j?K:H.zoom,H.wrap,H.zoom,X,oe),distanceSq:wr([E[0]-.5-X,E[1]-.5-oe])});else for(let _e=0;_e<4;_e++){const Ae=(X<<1)+_e%2,Re=(oe<<1)+(_e>>1);O.push({aabb:H.aabb.quadrant(_e),zoom:H.zoom+1,x:Ae,y:Re,wrap:H.wrap,fullyVisible:se})}}return B.sort((H,X)=>H.distanceSq-X.distanceSq).map(H=>H.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=y.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.pointGeometry(y.mercatorXfromLng(o.lng)*this.worldSize,y.mercatorYfromLat(u)*this.worldSize)}unproject(o){return new y.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(o,u){const f=this.pointCoordinate(u),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),E=new y.MercatorCoordinate(b.x-(f.x-g.x),b.y-(f.y-g.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o){return this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}locationCoordinate(o){return y.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o.toLngLat()}pointCoordinate(o){const u=[o.x,o.y,0,1],f=[o.x,o.y,1,1];y.transformMat4(u,u,this.pixelMatrixInverse),y.transformMat4(f,f,this.pixelMatrixInverse);const g=u[3],b=f[3],E=u[1]/g,I=f[1]/b,T=u[2]/g,R=f[2]/b,O=T===R?0:(0-T)/(R-T);return new y.MercatorCoordinate(y.number(u[0]/g,f[0]/b,O)/this.worldSize,y.number(E,I,O)/this.worldSize)}coordinatePoint(o){const u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return y.transformMat4(u,u,this.pixelMatrix),new y.pointGeometry(u[0]/u[3],u[1]/u[3])}getBounds(){return(new y.LngLatBounds).extend(this.pointLocation(new y.pointGeometry(0,0))).extend(this.pointLocation(new y.pointGeometry(this.width,0))).extend(this.pointLocation(new y.pointGeometry(this.width,this.height))).extend(this.pointLocation(new y.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,u=!1){const f=o.key,g=u?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const b=o.canonical,E=this.worldSize/this.zoomScale(b.z),I=b.x+Math.pow(2,b.z)*o.wrap,T=y.identity(new Float64Array(16));return y.translate(T,T,[I*E,b.y*E,0]),y.scale(T,T,[E/y.EXTENT,E/y.EXTENT,1]),y.multiply(T,u?this.alignedProjMatrix:this.projMatrix,T),g[f]=new Float32Array(T),g[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,u,f,g,b=-90,E=90,I=-180,T=180;const R=this.size,O=this._unmodified;if(this.latRange){const K=this.latRange;b=y.mercatorYfromLat(K[1])*this.worldSize,E=y.mercatorYfromLat(K[0])*this.worldSize,o=E-b<R.y?R.y/(E-b):0}if(this.lngRange){const K=this.lngRange;I=y.mercatorXfromLng(K[0])*this.worldSize,T=y.mercatorXfromLng(K[1])*this.worldSize,u=T-I<R.x?R.x/(T-I):0}const B=this.point,j=Math.max(u||0,o||0);if(j)return this.center=this.unproject(new y.pointGeometry(u?(T+I)/2:B.x,o?(E+b)/2:B.y)),this.zoom+=this.scaleZoom(j),this._unmodified=O,void(this._constraining=!1);if(this.latRange){const K=B.y,H=R.y/2;K-H<b&&(g=b+H),K+H>E&&(g=E-H)}if(this.lngRange){const K=B.x,H=R.x/2;K-H<I&&(f=I+H),K+H>T&&(f=T-H)}void 0===f&&void 0===g||(this.center=this.unproject(new y.pointGeometry(void 0!==f?f:B.x,void 0!==g?g:B.y))),this._unmodified=O,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const u=Math.PI/2+this._pitch,f=this._fov*(.5+o.y/this.height),g=Math.sin(f)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-u-f,.01,Math.PI-.01)),b=this.point,E=b.x,I=b.y,T=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),R=this.height/50;let O=new Float64Array(16);y.perspective(O,this._fov,this.width/this.height,R,T),O[8]=2*-o.x/this.width,O[9]=2*o.y/this.height,y.scale(O,O,[1,-1,1]),y.translate(O,O,[0,0,-this.cameraToCenterDistance]),y.rotateX(O,O,this._pitch),y.rotateZ(O,O,this.angle),y.translate(O,O,[-E,-I,0]),this.mercatorMatrix=y.scale([],O,[this.worldSize,this.worldSize,this.worldSize]),y.scale(O,O,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=O,this.invProjMatrix=y.invert([],this.projMatrix);const B=this.width%2/2,j=this.height%2/2,K=Math.cos(this.angle),H=Math.sin(this.angle),X=E-Math.round(E)+K*B+H*j,oe=I-Math.round(I)+K*j+H*B,se=new Float64Array(O);if(y.translate(se,se,[X>.5?X-1:X,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=se,O=y.create(),y.scale(O,O,[this.width/2,-this.height/2,1]),y.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=y.create(),y.scale(O,O,[1,-1,1]),y.translate(O,O,[-1,-1,0]),y.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),O=y.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");this.pixelMatrixInverse=O,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new y.pointGeometry(0,0)),u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return y.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.pointGeometry(0,o))}getCameraQueryGeometry(o){const u=this.getCameraPoint();if(1===o.length)return[o[0],u];{let f=u.x,g=u.y,b=u.x,E=u.y;for(const I of o)f=Math.min(f,I.x),g=Math.min(g,I.y),b=Math.max(b,I.x),E=Math.max(E,I.y);return[new y.pointGeometry(f,g),new y.pointGeometry(b,g),new y.pointGeometry(b,E),new y.pointGeometry(f,E),new y.pointGeometry(f,g)]}}}class cn{constructor(o){this._hashName=o&&encodeURIComponent(o),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(u,f){let g=!1,b=null;const E=()=>{b=null,g&&(u(),b=setTimeout(E,300),g=!1)};return()=>(g=!0,b||E(),b)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const u=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),E=Math.round(u.lng*b)/b,I=Math.round(u.lat*b)/b,T=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=o?`/${E}/${I}/${f}`:`${f}/${I}/${E}`,(T||R)&&(O+="/"+Math.round(10*T)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const B=this._hashName;let j=!1;const K=window.location.hash.slice(1).split("&").map(H=>{const X=H.split("=")[0];return X===B?(j=!0,`${X}=${O}`):H}).filter(H=>H);return j||K.push(`${B}=${O}`),`#${K.join("&")}`}return`#${O}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(u=f)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const er={linearity:.3,easing:y.bezier(0,0,.3,1)},Lr=y.extend({deceleration:2500,maxSpeed:1400},er),ds=y.extend({deceleration:20,maxSpeed:1400},er),ii=y.extend({deceleration:1e3,maxSpeed:360},er),oi=y.extend({deceleration:1e3,maxSpeed:90},er);class Ye{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=y.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new y.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(u.pan.mag()){const b=Dn(u.pan.mag(),f,y.extend({},Lr,o||{}));g.offset=u.pan.mult(b.amount/u.pan.mag()),g.center=this._map.transform.center,wt(g,b)}if(u.zoom){const b=Dn(u.zoom,f,ds);g.zoom=this._map.transform.zoom+b.amount,wt(g,b)}if(u.bearing){const b=Dn(u.bearing,f,ii);g.bearing=this._map.transform.bearing+y.clamp(b.amount,-179,179),wt(g,b)}if(u.pitch){const b=Dn(u.pitch,f,oi);g.pitch=this._map.transform.pitch+b.amount,wt(g,b)}if(g.zoom||g.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.extend(g,{noMoveStart:!0})}}function wt(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Dn(m,o,u){const{maxSpeed:f,linearity:g,deceleration:b}=u,E=y.clamp(m*g/(o/1e3),-f,f),I=Math.abs(E)/(b*g);return{easing:u.easing,duration:1e3*I,amount:E*(I/2)}}class Bn extends y.Event{constructor(o,u,f,g={}){const b=ue.mousePos(u.getCanvasContainer(),f),E=u.unproject(b);super(o,y.extend({point:b,lngLat:E,originalEvent:f},g)),this._defaultPrevented=!1,this.target=u}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class tr extends y.Event{constructor(o,u,f){const g="touchend"===o?f.changedTouches:f.touches,b=ue.touchPos(u.getCanvasContainer(),g),E=b.map(T=>u.unproject(T)),I=b.reduce((T,R,O,B)=>T.add(R.div(B.length)),new y.pointGeometry(0,0));super(o,{points:b,point:I,lngLats:E,lngLat:u.unproject(I),originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Fr extends y.Event{constructor(o,u,f){super(o,{originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Pi{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Fr(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new Bn(o.type,this._map,o))}mouseup(o){this._map.fire(new Bn(o.type,this._map,o))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Bn(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Bn(o.type,this._map,o))}mouseover(o){this._map.fire(new Bn(o.type,this._map,o))}mouseout(o){this._map.fire(new Bn(o.type,this._map,o))}touchstart(o){return this._firePreventable(new tr(o.type,this._map,o))}touchmove(o){this._map.fire(new tr(o.type,this._map,o))}touchend(o){this._map.fire(new tr(o.type,this._map,o))}touchcancel(o){this._map.fire(new tr(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $n{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Bn(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Bn(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xo{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(ue.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const f=u;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=ue.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(g.x,f.x),E=Math.max(g.x,f.x),I=Math.min(g.y,f.y),T=Math.max(g.y,f.y);ue.setTransform(this._box,`translate(${b}px,${I}px)`),this._box.style.width=E-b+"px",this._box.style.height=T-I+"px"}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const f=this._startPos,g=u;if(this.reset(),ue.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(ue.remove(this._box),this._box=null),ue.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new y.Event(o,{originalEvent:u}))}}function io(m,o){const u={};for(let f=0;f<m.length;f++)u[m[f].identifier]=o[f];return u}class Ft{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const b=new y.pointGeometry(0,0);for(const E of g)b._add(E);return b.div(g.length)}(u),this.touches=io(f,u)))}touchmove(o,u,f){if(this.aborted||!this.centroid)return;const g=io(f,u);for(const b in this.touches){const I=g[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,u,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===f.length){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ma{constructor(o){this.singleTap=new Ft(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,f){this.singleTap.touchstart(o,u,f)}touchmove(o,u,f){this.singleTap.touchmove(o,u,f)}touchend(o,u,f){const g=this.singleTap.touchend(o,u,f);if(g){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Aa{constructor(){this._zoomIn=new Ma({numTouches:1,numTaps:2}),this._zoomOut=new Ma({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,f){this._zoomIn.touchstart(o,u,f),this._zoomOut.touchstart(o,u,f)}touchmove(o,u,f){this._zoomIn.touchmove(o,u,f),this._zoomOut.touchmove(o,u,f)}touchend(o,u,f){const g=this._zoomIn.touchend(o,u,f),b=this._zoomOut.touchend(o,u,f);return g?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(g)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vc={0:1,2:2};class Ri{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const f=ue.mouseButton(o);this._correctButton(o,f)&&(this._lastPoint=u,this._eventButton=f)}mousemoveWindow(o,u){const f=this._lastPoint;if(f)if(o.preventDefault(),function(g,b){const E=vc[b];return void 0===g.buttons||(g.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(f,u)}mouseupWindow(o){this._lastPoint&&ue.mouseButton(o)===this._eventButton&&(this._moved&&ue.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xn extends Ri{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return 0===u&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class je extends Ri{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const f=.8*(u.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){o.preventDefault()}}class Go extends Ri{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const f=-.5*(u.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){o.preventDefault()}}class si{constructor(o){this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new y.pointGeometry(0,0)}touchstart(o,u,f){return this._calculateTransform(o,u,f)}touchmove(o,u,f){if(this._active&&!(f.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,u,f)}touchend(o,u,f){this._calculateTransform(o,u,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,f){f.length>0&&(this._active=!0);const g=io(f,u),b=new y.pointGeometry(0,0),E=new y.pointGeometry(0,0);let I=0;for(const R in g){const O=g[R],B=this._touches[R];B&&(b._add(O),E._add(O.sub(B)),I++,g[R]=O)}if(this._touches=g,I<this._minTouches||!E.mag())return;const T=E.div(I);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $i{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,u,f){return{}}touchstart(o,u,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,f){if(!this._firstTwoTouches)return;o.preventDefault();const[g,b]=this._firstTwoTouches,E=Qs(f,u,g),I=Qs(f,u,b);if(!E||!I)return;const T=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],T,o)}touchend(o,u,f){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,E=Qs(f,u,g),I=Qs(f,u,b);E&&I||(this._active&&ue.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qs(m,o,u){for(let f=0;f<m.length;f++)if(m[f].identifier===u)return o[f]}function Me(m,o){return Math.log(m/o)/Math.LN2}class wu extends $i{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Me(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Me(this._distance,f),pinchAround:u}}}function bl(m,o){return 180*m.angleWith(o)/Math.PI}class Du extends $i{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const f=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bl(this._vector,f),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,f=bl(o,this._startVector);return Math.abs(f)<u}}function qo(m){return Math.abs(m.y)>Math.abs(m.x)}class Pa extends $i{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,qo(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,f){const g=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(g,b,f.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}}gestureBeginsVertically(o,u,f){if(void 0!==this._valid)return this._valid;const g=o.mag()>=2,b=u.mag()>=2;if(!g&&!b)return;if(!g||!b)return void 0===this._firstMove&&(this._firstMove=f),f-this._firstMove<100&&void 0;const E=o.y>0==u.y>0;return qo(o)&&qo(u)&&E}}const fs={panStep:100,bearingStep:15,pitchStep:10};class Hr{constructor(){const o=fs;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,f=0,g=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?g=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?g=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:I=>{const T=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Tf,zoom:u?Math.round(T)+u*(o.shiftKey?2:1):T,bearing:I.getBearing()+f*this._bearingStep,pitch:I.getPitch()+g*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tf(m){return m*(2-m)}const Or=4.000244140625;class fi{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,y.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const f=y.exported.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,0!==u&&u%Or==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(g*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ue.mousePos(this._el,o);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(0!==this._delta){const I="wheel"===this._type&&Math.abs(this._delta)>Or?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&0!==T&&(T=1/T);const R="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(R*T))),"wheel"===this._type&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"==typeof this._targetZoom?this._targetZoom:o.zoom,f=this._startZoom,g=this._easing;let b,E=!1;if("wheel"===this._type&&f&&g){const I=Math.min((y.exported.now()-this._lastWheelEventTime)/200,1),T=g(I);b=y.number(f,u,T),I<1?this._frameId||(this._frameId=!0):E=!0}else b=u,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=y.ease;if(this._prevEase){const f=this._prevEase,g=(y.exported.now()-f.start)/f.duration,b=f.easing(g+.01)-f.easing(g),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);u=y.bezier(E,I,.25,1)}return this._prevEase={start:y.exported.now(),duration:o,easing:u},u}reset(){this._active=!1}}class Ra{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ps{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,u){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tr{constructor(){this._tap=new Ma({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,u,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=u[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,u,f))}touchmove(o,u,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=u[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,f)}touchend(o,u,f){this._tapTime?this._swipePoint&&0===f.length&&this.reset():this._tap.touchend(o,u,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mr{constructor(o,u,f){this._el=o,this._mousePan=u,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Eu{constructor(o,u,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cu{constructor(o,u,f,g){this._el=o,this._touchZoom=u,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ea=m=>m.zoom||m.drag||m.pitch||m.rotate;class xc extends y.Event{}function bc(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ji{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ye(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),y.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,E]of this._listeners)ue.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,u,f]of this._listeners)ue.removeEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(o){const u=this._map,f=u.getCanvasContainer();this._add("mapEvent",new Pi(u,o));const g=u.boxZoom=new xo(u,o);this._add("boxZoom",g);const b=new Aa,E=new ps;u.doubleClickZoom=new Ra(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const I=new Tr;this._add("tapDragZoom",I);const T=u.touchPitch=new Pa;this._add("touchPitch",T);const R=new je(o),O=new Go(o);u.dragRotate=new Eu(o,R,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const B=new Xn(o),j=new si(o);u.dragPan=new mr(f,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]);const K=new Du,H=new wu;u.touchZoomRotate=new Cu(f,H,K,I),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]);const X=u.scrollZoom=new fi(u,this);this._add("scrollZoom",X,["mousePan"]);const oe=u.keyboard=new Hr;this._add("keyboard",oe),this._add("blockableMapEvent",new $n(u));for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[se]&&u[se].enable(o[se])}_add(o,u,f){this._handlers.push({handlerName:o,handler:u,allowed:f}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ea(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,u,f){for(const g in o)if(g!==f&&(!u||u.indexOf(g)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const f of o)this._el.contains(f.target)&&u.push(f);return u}handleEvent(o,u){if("blur"===o.type)return void this.stop(!0);this._updatingCamera=!0;const f="renderFrame"===o.type?void 0:o,g={needsRenderFrame:!1},b={},E={},I=o.touches,T=I?this._getMapTouches(I):void 0,R=T?ue.touchPos(this._el,T):ue.mousePos(this._el,o);for(const{handlerName:j,handler:K,allowed:H}of this._handlers){if(!K.isEnabled())continue;let X;this._blockedByActive(E,H,j)?K.reset():K[u||o.type]&&(X=K[u||o.type](o,R,T),this.mergeHandlerResult(g,b,X,j,f),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||K.isActive())&&(E[j]=K)}const O={};for(const j in this._previousActiveHandlers)E[j]||(O[j]=f);this._previousActiveHandlers=E,(Object.keys(O).length||bc(g))&&(this._changes.push([g,b,O]),this._triggerRenderFrame()),(Object.keys(E).length||bc(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=g;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,u,f,g,b){if(!f)return;y.extend(o,f);const E={handlerName:g,originalEvent:f.originalEvent||b};void 0!==f.zoomDelta&&(u.zoom=E),void 0!==f.panDelta&&(u.drag=E),void 0!==f.pitchDelta&&(u.pitch=E),void 0!==f.bearingDelta&&(u.rotate=E)}_applyChanges(){const o={},u={},f={};for(const[g,b,E]of this._changes)g.panDelta&&(o.panDelta=(o.panDelta||new y.pointGeometry(0,0))._add(g.panDelta)),g.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+g.pitchDelta),void 0!==g.around&&(o.around=g.around),void 0!==g.pinchAround&&(o.pinchAround=g.pinchAround),g.noInertia&&(o.noInertia=g.noInertia),y.extend(u,b),y.extend(f,E);this._updateMapTransform(o,u,f),this._changes=[]}_updateMapTransform(o,u,f){const g=this._map,b=g.transform;if(!bc(o))return this._fireEvents(u,f,!0);let{panDelta:E,zoomDelta:I,bearingDelta:T,pitchDelta:R,around:O,pinchAround:B}=o;void 0!==B&&(O=B),g._stop(!0),O=O||g.transform.centerPoint;const j=b.pointLocation(E?O.sub(E):O);T&&(b.bearing+=T),R&&(b.pitch+=R),I&&(b.zoom+=I),b.setLocationAtPoint(j,O),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,f,!0)}_fireEvents(o,u,f){const g=ea(this._eventsInProgress),b=ea(o),E={};for(const O in o){const{originalEvent:B}=o[O];this._eventsInProgress[O]||(E[`${O}start`]=B),this._eventsInProgress[O]=o[O]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in o){const{originalEvent:B}=o[O];this._fireEvent(O,B)}const I={};let T;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],T=u[B]||j,I[`${O}end`]=T)}for(const O in I)this._fireEvent(O,I[O]);const R=ea(this._eventsInProgress);if(f&&(g||b)&&!R){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;O?(B(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:T})):(this._map.fire(new y.Event("moveend",{originalEvent:T})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new y.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new xc("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const kn={extend:(m,...o)=>y.extend(m,...o),run(m){m()},logToElement(m,o=!1,u="log"){const f=window.document.getElementById(u);f&&(o&&(f.innerHTML=""),f.innerHTML+=`<br>${m}`)}};class wc extends y.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}getCenter(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,f){return o=y.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,y.extend({offset:o},u),f)}panTo(o,u,f){return this.easeTo(y.extend({center:o},u),f)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,f){return this.easeTo(y.extend({zoom:o},u),f)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,f){return this.easeTo(y.extend({bearing:o},u),f)}resetNorth(o,u){return this.rotateTo(0,y.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=y.LngLatBounds.convert(o);const f=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),f,u)}_cameraForBoxAndBearing(o,u,f,g){const b={top:0,bottom:0,right:0,left:0};if("number"==typeof(g=y.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding){const ge=g.padding;g.padding={top:ge,bottom:ge,right:ge,left:ge}}g.padding=y.extend(b,g.padding);const E=this.transform,I=E.padding,T=E.project(y.LngLat.convert(o)),R=E.project(y.LngLat.convert(u)),O=T.rotate(-f*Math.PI/180),B=R.rotate(-f*Math.PI/180),j=new y.pointGeometry(Math.max(O.x,B.x),Math.max(O.y,B.y)),K=new y.pointGeometry(Math.min(O.x,B.x),Math.min(O.y,B.y)),H=j.sub(K),X=(E.width-(I.left+I.right+g.padding.left+g.padding.right))/H.x,oe=(E.height-(I.top+I.bottom+g.padding.top+g.padding.bottom))/H.y;if(oe<0||X<0)return void y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(E.scaleZoom(E.scale*Math.min(X,oe)),g.maxZoom),ce=y.pointGeometry.convert(g.offset),J=new y.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(f*Math.PI/180),we=ce.add(J).mult(E.scale/E.zoomScale(se));return{center:E.unproject(T.add(R).div(2).sub(we)),zoom:se,bearing:f}}fitBounds(o,u,f){return this._fitInternal(this.cameraForBounds(o,u),u,f)}fitScreenCoordinates(o,u,f,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.pointGeometry.convert(o)),this.transform.pointLocation(y.pointGeometry.convert(u)),f,g),g,b)}_fitInternal(o,u,f){return o?(delete(u=y.extend(o,u)).padding,u.linear?this.easeTo(u,f):this.flyTo(u,f)):this}jumpTo(o,u){this.stop();const f=this.transform;let g=!1,b=!1,E=!1;return"zoom"in o&&f.zoom!==+o.zoom&&(g=!0,f.zoom=+o.zoom),void 0!==o.center&&(f.center=y.LngLat.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(b=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(E=!0,f.pitch=+o.pitch),null==o.padding||f.isPaddingEqual(o.padding)||(f.padding=o.padding),this.fire(new y.Event("movestart",u)).fire(new y.Event("move",u)),g&&this.fire(new y.Event("zoomstart",u)).fire(new y.Event("zoom",u)).fire(new y.Event("zoomend",u)),b&&this.fire(new y.Event("rotatestart",u)).fire(new y.Event("rotate",u)).fire(new y.Event("rotateend",u)),E&&this.fire(new y.Event("pitchstart",u)).fire(new y.Event("pitch",u)).fire(new y.Event("pitchend",u)),this.fire(new y.Event("moveend",u))}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=y.extend({offset:[0,0],duration:500,easing:y.ease},o)).animate||!o.essential&&y.exported.prefersReducedMotion)&&(o.duration=0);const f=this.transform,g=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),T="zoom"in o?+o.zoom:g,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:f.padding,j=y.pointGeometry.convert(o.offset);let K=f.centerPoint.add(j);const H=f.pointLocation(K),X=y.LngLat.convert(o.center||H);this._normalizeCenter(X);const oe=f.project(H),se=f.project(X).sub(oe),ce=f.zoomScale(T-g);let J,we;o.around&&(J=y.LngLat.convert(o.around),we=f.locationPoint(J));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||T!==g,this._rotating=this._rotating||b!==R,this._pitching=this._pitching||O!==E,this._padding=!f.isPaddingEqual(B),this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,ge),this._ease(_e=>{if(this._zooming&&(f.zoom=y.number(g,T,_e)),this._rotating&&(f.bearing=y.number(b,R,_e)),this._pitching&&(f.pitch=y.number(E,O,_e)),this._padding&&(f.interpolatePadding(I,B,_e),K=f.centerPoint.add(j)),J)f.setLocationAtPoint(J,we);else{const Ae=f.zoomScale(f.zoom-g),Re=T>g?Math.min(2,ce):Math.max(.5,ce),be=Math.pow(Re,1-_e),Ze=f.unproject(oe.add(se.mult(_e*be)).mult(Ae));f.setLocationAtPoint(f.renderWorldCopies?Ze.wrap():Ze,K)}this._fireMoveEvents(u)},_e=>{this._afterEase(u,_e)},o),this}_prepareEase(o,u,f={}){this._moving=!0,u||f.moving||this.fire(new y.Event("movestart",o)),this._zooming&&!f.zooming&&this.fire(new y.Event("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new y.Event("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new y.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new y.Event("move",o)),this._zooming&&this.fire(new y.Event("zoom",o)),this._rotating&&this.fire(new y.Event("rotate",o)),this._pitching&&this.fire(new y.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const f=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new y.Event("zoomend",o)),g&&this.fire(new y.Event("rotateend",o)),b&&this.fire(new y.Event("pitchend",o)),this.fire(new y.Event("moveend",o))}flyTo(o,u){if(!o.essential&&y.exported.prefersReducedMotion){const $t=y.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo($t,u)}this.stop(),o=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},o);const f=this.transform,g=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),T="zoom"in o?y.clamp(+o.zoom,f.minZoom,f.maxZoom):g,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:f.padding,j=f.zoomScale(T-g),K=y.pointGeometry.convert(o.offset);let H=f.centerPoint.add(K);const X=f.pointLocation(H),oe=y.LngLat.convert(o.center||X);this._normalizeCenter(oe);const se=f.project(X),ce=f.project(oe).sub(se);let J=o.curve;const we=Math.max(f.width,f.height),ge=we/j,_e=ce.mag();if("minZoom"in o){const $t=y.clamp(Math.min(o.minZoom,g,T),f.minZoom,f.maxZoom),Bt=we/f.zoomScale($t-g);J=Math.sqrt(Bt/_e*2)}const Ae=J*J;function Re($t){const Bt=(ge*ge-we*we+($t?-1:1)*Ae*Ae*_e*_e)/(2*($t?ge:we)*Ae*_e);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function be($t){return(Math.exp($t)-Math.exp(-$t))/2}function Ze($t){return(Math.exp($t)+Math.exp(-$t))/2}const Ne=Re(0);let he=function($t){return Ze(Ne)/Ze(Ne+J*$t)},Ke=function($t){return we*((Ze(Ne)*(be(Bt=Ne+J*$t)/Ze(Bt))-be(Ne))/Ae)/_e;var Bt},Pt=(Re(1)-Ne)/J;if(Math.abs(_e)<1e-6||!isFinite(Pt)){if(Math.abs(we-ge)<1e-6)return this.easeTo(o,u);const $t=ge<we?-1:1;Pt=Math.abs(Math.log(ge/we))/J,Ke=function(){return 0},he=function(Bt){return Math.exp($t*J*Bt)}}return o.duration="duration"in o?+o.duration:1e3*Pt/("screenSpeed"in o?+o.screenSpeed/J:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=b!==R,this._pitching=O!==E,this._padding=!f.isPaddingEqual(B),this._prepareEase(u,!1),this._ease($t=>{const Bt=$t*Pt,pt=1/he(Bt);f.zoom=1===$t?T:g+f.scaleZoom(pt),this._rotating&&(f.bearing=y.number(b,R,$t)),this._pitching&&(f.pitch=y.number(E,O,$t)),this._padding&&(f.interpolatePadding(I,B,$t),H=f.centerPoint.add(K));const jt=1===$t?oe:f.unproject(se.add(ce.mult(Ke(Bt))).mult(pt));f.setLocationAtPoint(f.renderWorldCopies?jt.wrap():jt,H),this._fireMoveEvents(u)},()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,u)}if(!o){const f=this.handlers;f&&f.stop(!1)}return this}_ease(o,u,f){!1===f.animate||0===f.duration?(o(1),u()):(this._easeStart=y.exported.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((y.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=y.wrap(o,-180,180);const f=Math.abs(o-u);return Math.abs(o-360-u)<f&&(o-=360),Math.abs(o+360-u)<f&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const f=o.lng-u.center.lng;o.lng+=f>180?-360:f<-180?360:0}}class Dc{constructor(o={}){this.options=o,y.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=ue.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ue.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ue.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ue.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const f=this._map._getUIString(`AttributionControl.${u}`);o.title=f,o.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(g=>"string"!=typeof g?"":g)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const u=this._map.style.sourceCaches;for(const g in u){const b=u[g];if(b.used){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(g=>String(g).trim()),o.sort((g,b)=>g.length-b.length),o=o.filter((g,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(g)>=0)return!1;return!0});const f=o.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Su{constructor(o={}){this.options=o,y.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=ue.create("div","maplibregl-ctrl mapboxgl-ctrl");const u=ue.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ue.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Yh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,f=u?this._queue.concat(u):this._queue;for(const g of f)if(g.id===o)return void(g.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const f of u)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Jh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Mf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},bo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ec{constructor(o,u,f=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new je({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new Go({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ue.addEventListener(u,"mousedown",this.mousedown),ue.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),ue.addEventListener(u,"touchmove",this.touchmove),ue.addEventListener(u,"touchend",this.touchend),ue.addEventListener(u,"touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),ue.disableDrag()}move(o,u){const f=this.map,g=this.mouseRotate.mousemoveWindow(o,u);if(g&&g.bearingDelta&&f.setBearing(f.getBearing()+g.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,u);b&&b.pitchDelta&&f.setPitch(f.getPitch()+b.pitchDelta)}}off(){const o=this.element;ue.removeEventListener(o,"mousedown",this.mousedown),ue.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),ue.removeEventListener(o,"touchmove",this.touchmove),ue.removeEventListener(o,"touchend",this.touchend),ue.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){ue.enableDrag(),ue.removeEventListener(window,"mousemove",this.mousemove),ue.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(y.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ue.mousePos(this.element,o)),ue.addEventListener(window,"mousemove",this.mousemove),ue.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,ue.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=ue.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=ue.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function et(m,o,u){if(m=new y.LngLat(m.lng,m.lat),o){const f=new y.LngLat(m.lng-360,m.lat),g=new y.LngLat(m.lng+360,m.lat),b=u.locationPoint(m).distSqr(o);u.locationPoint(f).distSqr(o)<b?m=f:u.locationPoint(g).distSqr(o)<b&&(m=g)}for(;Math.abs(m.lng-u.center.lng)>180;){const f=u.locationPoint(m);if(f.x>=0&&f.y>=0&&f.x<=u.width&&f.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const st={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ta(m,o,u){const f=m.classList;for(const g in st)f.remove(`maplibregl-${u}-anchor-${g}`,`mapboxgl-${u}-anchor-${g}`);f.add(`maplibregl-${u}-anchor-${o}`,`mapboxgl-${u}-anchor-${o}`)}class wl extends y.Evented{constructor(o,u){if(super(),(o instanceof HTMLElement||u)&&(o=y.extend({element:o},u)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=y.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ue.create("div"),this._element.setAttribute("aria-label","Map marker");const f=ue.createNS("http://www.w3.org/2000/svg","svg"),g=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${g}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${g}`);const E=ue.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const I=ue.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const T=ue.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of R){const J=ue.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",ce.rx),J.setAttributeNS(null,"ry",ce.ry),T.appendChild(J)}const O=ue.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const B=ue.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(B);const j=ue.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const K=ue.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(K);const H=ue.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const X=ue.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=ue.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const se=ue.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),X.appendChild(oe),X.appendChild(se),I.appendChild(T),I.appendChild(O),I.appendChild(j),I.appendChild(H),I.appendChild(X),f.appendChild(I),f.setAttributeNS(null,"height",g*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=y.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),ta(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ue.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=y.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const u=o.code,f=o.charCode||o.keyCode;"Space"!==u&&"Enter"!==u&&32!==f&&13!==f||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,f=this._element;this._popup&&(u===f||f.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?u=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?f="rotateX(0deg)":"map"===this._pitchAlignment&&(f=`rotateX(${this._map.getPitch()}deg)`),o&&"moveend"!==o.type||(this._pos=this._pos.round()),ue.setTransform(this._element,`${st[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${u}`)}getOffset(){return this._offset}setOffset(o){return this._offset=y.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new y.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Iu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gr,pi=0,ai=!1;const ms={maxWidth:100,unit:"metric"};function na(m,o,u){const f=u&&u.maxWidth||100,g=m._container.clientHeight/2,b=m.unproject([0,g]),E=m.unproject([f,g]),I=b.distanceTo(E);if(u&&"imperial"===u.unit){const T=3.2808*I;T>5280?En(o,f,T/5280,m._getUIString("ScaleControl.Miles")):En(o,f,T,m._getUIString("ScaleControl.Feet"))}else u&&"nautical"===u.unit?En(o,f,I/1852,m._getUIString("ScaleControl.NauticalMiles")):I>=1e3?En(o,f,I/1e3,m._getUIString("ScaleControl.Kilometers")):En(o,f,I,m._getUIString("ScaleControl.Meters"))}function En(m,o,u,f){const g=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(T){const R=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*R)/R}(I),E*I}(u);m.style.width=o*(g/u)+"px",m.innerHTML=`${g}&nbsp;${f}`}const lr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Cc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gs(m){if(m){if("number"==typeof m){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new y.pointGeometry(0,0),top:new y.pointGeometry(0,m),"top-left":new y.pointGeometry(o,o),"top-right":new y.pointGeometry(-o,o),bottom:new y.pointGeometry(0,-m),"bottom-left":new y.pointGeometry(o,-o),"bottom-right":new y.pointGeometry(-o,-o),left:new y.pointGeometry(m,0),right:new y.pointGeometry(-m,0)}}if(m instanceof y.pointGeometry||Array.isArray(m)){const o=y.pointGeometry.convert(m);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:y.pointGeometry.convert(m.center||[0,0]),top:y.pointGeometry.convert(m.top||[0,0]),"top-left":y.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":y.pointGeometry.convert(m["top-right"]||[0,0]),bottom:y.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":y.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":y.pointGeometry.convert(m["bottom-right"]||[0,0]),left:y.pointGeometry.convert(m.left||[0,0]),right:y.pointGeometry.convert(m.right||[0,0])}}return gs(new y.pointGeometry(0,0))}const ka={supported:pn,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:class extends wc{constructor(m){var o;if(y.PerformanceUtils.mark(y.PerformanceMarkers.create),null!=(m=y.extend({},Mf,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pr(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Yh,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Jh,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=null!==(o=m.pixelRatio)&&void 0!==o?o:devicePixelRatio,this._requestManager=new Yt(m.transformRequest),"string"==typeof m.container){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ji(this,m),this._hash=m.hash&&new cn("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,y.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Dc({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new Su,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update("style"===u.dataType),this.fire(new y.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new y.Event(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new y.Event("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(m,o){if(void 0===o&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const f=this._controlPositions[o];return-1!==o.indexOf("bottom")?f.insertBefore(u,f.firstChild):f.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}resize(m){const o=this._containerDimensions(),u=o[0],f=o[1];this._resizeCanvas(u,f,this.getPixelRatio()),this.transform.resize(u,f),this.painter.resize(u,f,this.getPixelRatio());const g=!this._moving;return g&&(this.stop(),this.fire(new y.Event("movestart",m)).fire(new y.Event("move",m))),this.fire(new y.Event("resize",m)),g&&this.fire(new y.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[o,u]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(o,u,m),this.painter.resize(o,u,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(y.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(y.LngLat.convert(m))}unproject(m){return this.transform.pointLocation(y.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,o,u){if("mouseenter"===m||"mouseover"===m){let f=!1;return{layer:o,listener:u,delegates:{mousemove:b=>{const E=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];E.length?f||(f=!0,u.call(this,new Bn(m,this,b.originalEvent,{features:E}))):f=!1},mouseout:()=>{f=!1}}}}if("mouseleave"===m||"mouseout"===m){let f=!1;return{layer:o,listener:u,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?f=!0:f&&(f=!1,u.call(this,new Bn(m,this,E.originalEvent)))},mouseout:E=>{f&&(f=!1,u.call(this,new Bn(m,this,E.originalEvent)))}}}}{const f=g=>{const b=this.getLayer(o)?this.queryRenderedFeatures(g.point,{layers:[o]}):[];b.length&&(g.features=b,u.call(this,g),delete g.features)};return{layer:o,listener:u,delegates:{[m]:f}}}}on(m,o,u){if(void 0===u)return super.on(m,o);const f=this._createDelegatedListener(m,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(m,o,u){if(void 0===u)return super.once(m,o);const f=this._createDelegatedListener(m,o,u);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(m,o,u){return void 0===u?super.off(m,o):(this._delegatedListeners&&this._delegatedListeners[m]&&(f=>{const g=this._delegatedListeners[m];for(let b=0;b<g.length;b++){const E=g[b];if(E.layer===o&&E.listener===u){for(const I in E.delegates)this.off(I,E.delegates[I]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(m,o){if(!this.style)return[];let u;if(void 0!==o||void 0===m||m instanceof y.pointGeometry||Array.isArray(m)||(o=m,m=void 0),o=o||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof y.pointGeometry||"number"==typeof m[0])u=[y.pointGeometry.convert(m)];else{const f=y.pointGeometry.convert(m[0]),g=y.pointGeometry.convert(m[1]);u=[f,new y.pointGeometry(g.x,f.y),g,new y.pointGeometry(f.x,g.y),f]}return this.style.queryRenderedFeatures(u,o,this.transform)}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}setStyle(m,o){return!1!==(o=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(m,o))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const o=this._locale[m];if(null==o)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Sr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if("string"==typeof m){const u=this._requestManager.transformRequest(m,y.ResourceType.Style);y.getJSON(u,(f,g)=>{f?this.fire(new y.ErrorEvent(f)):g&&this._updateDiff(g,o)})}else"object"==typeof m&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(u){y.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style.sourceCaches[m];if(void 0!==o)return o.loaded();this.fire(new y.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const o in m){const u=m[o]._tiles;for(const f in u){const g=u[f];if("loaded"!==g.state&&"errored"!==g.state)return!1}}return!0}addSourceType(m,o,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,u)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:u=1,sdf:f=!1,stretchX:g,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||y.isImageBitmap(o)){const{width:I,height:T,data:R}=y.exported.getImageData(o);this.style.addImage(m,{data:new y.RGBAImage({width:I,height:T},R),pixelRatio:u,stretchX:g,stretchY:b,content:E,sdf:f,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:T,data:R}=o,O=o;this.style.addImage(m,{data:new y.RGBAImage({width:I,height:T},new Uint8Array(R)),pixelRatio:u,stretchX:g,stretchY:b,content:E,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}}updateImage(m,o){const u=this.style.getImage(m);if(!u)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=o instanceof HTMLImageElement||y.isImageBitmap(o)?y.exported.getImageData(o):o,{width:g,height:b,data:E}=f;if(void 0===g||void 0===b)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==u.data.width||b!==u.data.height)return this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||y.isImageBitmap(o));u.data.replace(E,I),this.style.updateImage(m,u)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){y.getImage(this._requestManager.transformRequest(m,y.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,u){return this.style.setLayerZoomRange(m,o,u),this._update(!0)}setFilter(m,o,u={}){return this.style.setFilter(m,o,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,u,f={}){return this.style.setPaintProperty(m,o,u,f),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,u,f={}){return this.style.setLayoutProperty(m,o,u,f),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,o=0;return this._container&&(m=this._container.clientWidth||400,o=this._container.clientHeight||300),[m,o]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=ue.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=ue.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions();this._resizeCanvas(u[0],u[1],this.getPixelRatio());const f=this._controlContainer=ue.create("div","maplibregl-control-container mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{g[b]=ue.create("div",`maplibregl-ctrl-${b} mapboxgl-ctrl-${b}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o,u){this._canvas.width=u*m,this._canvas.height=u*o,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const m=y.extend({},pn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(this.painter=new Ho(o,this.transform),y.exported$1.testSupport(o)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let o,u=0;const f=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,o),u=y.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,I=y.exported.now();this.style.zoomHistory.update(E,I);const T=new y.EvaluationParameters(E,{now:I,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=T.crossFadingFactor();1===R&&R===this._crossFadingFactor||(g=!0,this._crossFadingFactor=R),this.style.update(T)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,y.PerformanceUtils.mark(y.PerformanceMarkers.load),this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=y.exported.now()-u;f.endQueryEXT(f.TIME_ELAPSED_EXT,o),setTimeout(()=>{const I=f.getQueryObjectEXT(o,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(o),this.fire(new y.Event("gpu-timing-frame",{cpuTime:E,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(E);this.fire(new y.Event("gpu-timing-layer",{layerTimes:I}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty;return b||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,y.PerformanceUtils.mark(y.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ue.remove(this._canvasContainer),ue.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),y.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new y.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=y.exported.frame(m=>{y.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){y.setCacheLimits(m,o)}},NavigationControl:class{constructor(m){this.options=y.extend({},bo,m),this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),u=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ec(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ue.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const u=ue.create("button",m,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(m,o){const u=this._map._getUIString(`NavigationControl.${o}`);m.title=u,m.setAttribute("aria-label",u)}},GeolocateControl:class extends y.Evented{constructor(m){super(),this.options=y.extend({},Iu,m),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var o;return this._map=m,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==gr?o(gr):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(u=>{gr="denied"!==u.state,o(gr)}):(gr=!!window.navigator.geolocation,o(gr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ue.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pi=0,ai=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),u=m.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new y.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,f=this._map.getBearing(),g=y.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),g,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new y.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,o=this._map.unproject([0,m]),u=this._map.unproject([1,m]),f=o.distanceTo(u),g=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&ai)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ue.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ue.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new wl(this._dotElement),this._circleElement=ue.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new y.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pi--,ai=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pi++,pi>1?(m={maximumAge:6e5,timeout:0},ai=!0):(m=this.options.positionOptions,ai=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dc,LogoControl:Su,ScaleControl:class{constructor(m){this.options=y.extend({},ms,m),y.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){na(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ue.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,na(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ue.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=ue.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends y.Evented{constructor(m){super(),this.options=y.extend(Object.create(lr),m),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ue.remove(this._content),this._container&&(ue.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=y.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),u=document.createElement("body");let f;for(u.innerHTML=m;f=u.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ue.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ue.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ue.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=ue.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(b=>this._container.classList.add(b)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let u=this.options.anchor;const f=gs(this.options.offset);if(!u){const b=this._container.offsetWidth,E=this._container.offsetHeight;let I;I=o.y+f.bottom.y<E?["top"]:o.y>this._map.transform.height-E?["bottom"]:[],o.x<b/2?I.push("left"):o.x>this._map.transform.width-b/2&&I.push("right"),u=0===I.length?"bottom":I.join("-")}const g=o.add(f[u]).round();ue.setTransform(this._container,`${st[u]} translate(${g.x}px,${g.y}px)`),ta(this._container,u,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Cc);m&&m.focus()}_onClose(){this.remove()}},Marker:wl,Style:Sr,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.pointGeometry,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,AJAXError:y.AJAXError,config:y.config,CanvasSource:$r,GeoJSONSource:zo,ImageSource:po,RasterDEMTileSource:rn,RasterTileSource:di,VectorTileSource:Gn,VideoSource:No,prewarm:function(){yo().acquire(Us)},clearPrewarmedResources:function(){const m=Bo;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(Us),Bo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return go.workerCount},set workerCount(m){go.workerCount=m},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){y.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){y.clearTileCache(m)},workerUrl:"",addProtocol(m,o){y.config.REGISTERED_PROTOCOLS[m]=o},removeProtocol(m){delete y.config.REGISTERED_PROTOCOLS[m]}};return kn.extend(ka,{isSafari:y.isSafari,getPerformanceMetrics:y.PerformanceUtils.getPerformanceMetrics}),ka}),an}()}},zs=>{zs(zs.s=382)}]);